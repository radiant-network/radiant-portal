import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{R as Ne,r as o}from"./index-CBYaBgW8.js";import{A as De}from"./action-button-9r-08jXC.js";import{B as V}from"./button-D8XzRdJf.js";import"./button.variants-Du9eY_ux.js";import{C as ze}from"./checkbox-filter-CgMxmOlu.js";import{d as we,e as Ie,C as Ge,a as Ue}from"./card-Cyh3E19J.js";import{I as ne}from"./input-Bj-MPxry.js";import{L as he}from"./label-BI8zg36L.js";import{S as Qe}from"./separator-ChZWIdMg.js";import{S as oe}from"./skeleton-_T1otFf0.js";import{S as Je}from"./switch-Jy17y5RA.js";import{q as I,D as Ee}from"./query-builder-remote-BOgfgeT4.js";import{M as Y,T as pe,R as T}from"./sqon-BcDlHyYL.js";import{u as P}from"./i18n-CT4yKlOF.js";import{A as Pe,a as He,b as We,c as Ye}from"./accordion-DSXieqtP.js";import{A as ye}from"./applications-config-3OOAo44D.js";import{u as Te,o as ae}from"./api-ClkuAUoi.js";import{S as Ke}from"./search-DKmUqS9g.js";import{E as Xe,L as Ze,G as et,a as tt,b as st,c as nt}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{C as rt}from"./checkbox-BUFo-vqr.js";import{d as ge,S as ve,a as Se,b as _e,c as ke}from"./select-DnbErV3f.js";import{c as ot}from"./index-C66Dxnp2.js";import{u as at}from"./chunk-WWGJGFF6-0IpzJ_3T.js";import{R as lt,a as it}from"./radio-group-DekDLgvf.js";import{T as ct,a as dt,b as ut}from"./tooltip-0vX-MTK3.js";const mt=["omim_gene_panel","ddd_gene_panel","cosmic_gene_panel","hpo_gene_panel","vep_impact","exomiser_gene_combined_score","cadd_score","cadd_phred","dann_score","fathmm_pred","lrt_pred","polyphen2_hvar_pred","revel_score","sift_pred","pf_wgs","pf_wgs_affected","pf_wgs_not_affected","nb_snv","hpo_gene_panel","pe","sm"],Oe=Ne.createContext({caseId:1,seqId:1}),pt=t=>{switch(t){case ye.cnv_occurrence:return s=>ae.aggregateGermlineCNVOccurrences(s.caseId,s.seqId,s.aggregationBody).then(n=>n.data);default:return s=>ae.aggregateGermlineSNVOccurrences(s.caseId,s.seqId,s.aggregationBody,s.withDictionary).then(n=>n.data)}};function Ae(t,s=30,n=!1,d=!1,p){let c;const{caseId:r,seqId:h}=Ne.useContext(Oe);n?c={caseId:r,seqId:h,aggregationBody:{field:t,size:s},withDictionary:d}:c=null;const l=I.getResolvedActiveQuery(p);return l&&c&&(c.aggregationBody.sqon={content:l.content,op:l.op}),Te(c,pt(p),{revalidateOnFocus:!1})}function je(t,s){const n=t.toLowerCase().split(/\s+/).filter(Boolean);return s.filter(d=>{const p=d.key.toLowerCase(),c=d.label.toLowerCase();function r(h,l){let O=0;for(const j of l){const x=h.indexOf(j,O);if(x===-1)return!1;O=x+j.length}return!0}return r(p,n)||r(c,n)})}function fe(t,s){return s<t?s:t}function ft(t,s){try{const n=sessionStorage.getItem(s);if(n){const d=JSON.parse(n),p=`${t.key}_withDictionary`;if(Object.prototype.hasOwnProperty.call(d,p))return d[p]}}catch(n){console.warn(`Failed to read dictionary toggle state from sessionStorage for ${t.key}:`,n)}return!1}function Fe({field:t,maxVisibleItems:s=5}){const{t:n,sanitize:d,lazyTranslate:p}=P(),{appId:c}=xe(),r=Le(c),h=()=>{try{const a=sessionStorage.getItem(r);if(a){const i=JSON.parse(a);Object.keys(i).forEach(_=>{_.endsWith("_withDictionary")||delete i[_]}),Object.keys(i).length>0?sessionStorage.setItem(r,JSON.stringify(i)):sessionStorage.removeItem(r)}}catch(a){console.warn("Failed to clear unapplied filters from sessionStorage:",a)}},[l,O]=o.useState(ft(t,r)),{data:j,isLoading:x}=Ae(t.key,void 0,!0,l,c),y=()=>{const a=`appLoaded_${c}`;if(!window[a]){try{const w=sessionStorage.getItem(r);if(w){const R=JSON.parse(w);Object.keys(R).forEach(J=>{J.endsWith("_withDictionary")||delete R[J]}),Object.keys(R).length>0?sessionStorage.setItem(r,JSON.stringify(R)):sessionStorage.removeItem(r)}}catch(w){console.warn("Failed to clear unapplied filters on page refresh:",w)}window[a]=!0;const g=I.getResolvedActiveQuery(c).content.find(w=>w.content.field===t.key);return(g==null?void 0:g.content.value)||[]}try{const g=sessionStorage.getItem(r);if(g){const w=JSON.parse(g);if(Object.prototype.hasOwnProperty.call(w,t.key))return w[t.key]}}catch(g){console.warn(`Failed to read filter state from sessionStorage for ${t.key}:`,g)}const _=I.getResolvedActiveQuery(c).content.find(g=>g.content.field===t.key);return(_==null?void 0:_.content.value)||[]},[b,N]=o.useState(j||[]),[m,$]=o.useState(j||[]),[M,H]=o.useState(""),[v,F]=o.useState(y()),[A,C]=o.useState(fe((j||[]).length,s)),[K,E]=o.useState(!1),[f,L]=o.useState(!1),[U,B]=o.useState(!1),[Q,X]=o.useState(()=>{const a=I.getResolvedActiveQuery(c);return JSON.stringify(a)}),[W,le]=o.useState(()=>{try{const a=sessionStorage.getItem(r);if(a){const i=JSON.parse(a);return Object.prototype.hasOwnProperty.call(i,t.key)}}catch(a){console.warn(`Failed to check sessionStorage state for ${t.key}:`,a)}return!1});o.useEffect(()=>{const a=I.getResolvedActiveQuery(c),i=JSON.stringify(a);if(Q&&Q!==i){h();const _=I.getResolvedActiveQuery(c).content.find(g=>g.content.field===t.key),z=(_==null?void 0:_.content.value)||[];F(z)}X(i)},[c,t.key,h,v]),o.useEffect(()=>{let a=!1;try{const w=sessionStorage.getItem(r);if(w){const R=JSON.parse(w);a=Object.prototype.hasOwnProperty.call(R,t.key)}}catch(w){console.warn(`Failed to check sessionStorage values for ${t.key}:`,w)}if(a)return;const i=I.getResolvedActiveQuery(c).content.find(w=>w.content.field===t.key),_=(i==null?void 0:i.content.value)||[],z=[...v].sort(),g=[..._].sort();JSON.stringify(z)!==JSON.stringify(g)&&(f||F(_))},[c,t.key,v,f,r]),o.useEffect(()=>{const a=I.getResolvedActiveQuery(c).content.find(k=>k.content.field===t.key),i=(a==null?void 0:a.content.value)||[],_=JSON.stringify([...v].sort())!==JSON.stringify([...i].sort());L(_),v.length===0&&i.length>0&&!U&&!f&&!W&&F(i),W&&le(!1),v.length>0&&U&&B(!1);let z=[];try{const k=sessionStorage.getItem(r);if(k){const G=JSON.parse(k);Object.prototype.hasOwnProperty.call(G,t.key)&&(z=G[t.key]||[])}}catch(k){console.warn(`Failed to read unapplied values from sessionStorage for ${t.key}:`,k)}const g=[...j||[]],w=[...new Set([...i,...z])];w.length>0&&w.forEach(k=>{g.some(se=>se.key===k)||g.push({key:k,count:0,label:k})}),g==null||g.sort((k,G)=>{const se=k.key&&i.includes(k.key),Be=G.key&&i.includes(G.key);return se===Be?G.count-k.count:se?-1:1}),g==null||g.forEach(k=>{k.label=n(`common.filters.values.${t.key}.${d(k.key)}`,{defaultValue:p(k.key)})}),N(g||[]);const R=M.trim()?je(M,g||[]):g||[];$(R);const J=R.length;if(K&&J>s)C(J);else{const k=fe(J,s);A!==k&&C(k),K&&k<=s&&E(!1)}},[j,c,t.key,s,r,v,U,f,W,M]),o.useEffect(()=>{try{const a=sessionStorage.getItem(r)||"{}",i=JSON.parse(a);i[t.key]=v,sessionStorage.setItem(r,JSON.stringify(i))}catch(a){console.warn(`Failed to save filter state to sessionStorage for ${t.key}:`,a)}},[v,r,t.key]),o.useEffect(()=>{if(t.withDictionary)try{const a=sessionStorage.getItem(r)||"{}",i=JSON.parse(a),_=`${t.key}_withDictionary`;i[_]=l,sessionStorage.setItem(r,JSON.stringify(i))}catch(a){console.warn(`Failed to save dictionary toggle state to sessionStorage for ${t.key}:`,a)}},[l,r,t.key,t.withDictionary]);const ie=o.useCallback(a=>{if(H(a),E(!1),!a.trim()){$(b),C(fe(b.length,s));return}const i=je(a,b);$(i),s>i.length?C(i.length):i.length>s&&C(s)},[b,s]),ce=o.useCallback(()=>{C(m.length),E(!0)},[m]),de=o.useCallback(()=>{C(s),E(!1)},[s]),ue=o.useCallback(()=>{v.length!==m.length&&(L(!0),F(m.map(a=>a.key)))},[m,v]),D=o.useCallback(()=>{L(!0),F([]),B(!0);try{const a=sessionStorage.getItem(r);if(a){const i=JSON.parse(a);delete i[t.key],Object.keys(i).length===0?sessionStorage.removeItem(r):sessionStorage.setItem(r,JSON.stringify(i))}}catch(a){console.warn(`Failed to clear filter state from sessionStorage for ${t.key}:`,a)}},[r,t.key]),Z=o.useCallback(()=>{v.length!==0&&D()},[v,D]),ee=o.useCallback(a=>{let i=[];v.some(_=>_===a.key)?i=v.filter(_=>_!==a.key):i=[...v,a.key],L(!0),F(i)},[v]),te=o.useCallback(()=>{D()},[D]),q=o.useCallback(a=>{L(!1),B(!1),I.updateActiveQueryField(c,{field:t.key,value:[...v],merge_strategy:Y.OVERRIDE_VALUES,operator:a}),h()},[v,c,t.key,h]),u=o.useCallback(()=>{q(pe.In)},[q]),S=o.useCallback(()=>{q(pe.NotIn)},[q]),me=o.useCallback(()=>{q(pe.In)},[q]);return e.jsxs(e.Fragment,{children:[e.jsxs(we,{size:"sm",variant:"outline",children:[e.jsx(ne,{startIcon:Ke,size:"xs",type:"text",placeholder:n("common.filters.search.placeholder"),className:"w-full text-xs mt-3 py-1.5 px-3 mb-4 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:a=>ie(a.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(V,{size:"xs",onClick:()=>ue(),variant:"link",className:"px-0",children:n("common.filters.buttons.all")}),e.jsx(Qe,{orientation:"vertical",className:"h-4"}),e.jsx(V,{size:"xs",onClick:()=>Z(),variant:"link",className:"px-0",children:n("common.filters.buttons.none")}),t.withDictionary&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-grow"}),e.jsx(he,{htmlFor:"with-dictionary-switch",className:"text-xs",children:n("common.filters.with_dictionary")}),e.jsx(Je,{id:"with-dictionary-switch",checked:l,size:"xs",onCheckedChange:()=>O(!l)})]})]}),e.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[x&&Array.from({length:3},(a,i)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(oe,{className:"w-full h-6 rounded"}),e.jsx(oe,{className:"h-6 w-12 rounded-md"})]},`skeleton-${i}`)),!x&&m.length===0&&e.jsx("div",{className:"text-muted-foreground py-4",children:n("common.filters.no_values_found")}),!x&&m.length>0&&Array.from({length:A},(a,i)=>e.jsx("div",{className:"gap-3 py-1.5",children:e.jsx(ze,{size:"xs",label:n(`common.filters.labels.${t.key}_value.${m[i].key}`,{defaultValue:m[i].label}),checked:v.some(_=>_===m[i].key),count:m[i].count,onCheckedChange:()=>ee(m[i])})},m[i].key))]}),!x&&m.length>A&&e.jsx(V,{className:"mt-2 px-0",onClick:ce,size:"xs",variant:"link",children:n("common.filters.buttons.show_more",{count:m.length-A})}),!x&&A>s&&e.jsx(V,{className:"mt-2 px-0",onClick:de,size:"xs",variant:"link",children:n("common.filters.buttons.show_less")})]}),e.jsx(Ie,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(V,{size:"xxs",variant:"ghost",onClick:te,disabled:v.length===0||x,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(De,{size:"xxs",variant:"outline",className:"h-7",color:"primary",actions:[{label:n("common.filters.buttons.some_not_in"),onClick:me},{label:n("common.filters.buttons.not_in"),onClick:S}],onDefaultAction:u,disabled:x,children:n("common.filters.buttons.apply")})})]})})]})}Fe.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}}}};const ht=ot({slots:{base:"text-muted-foreground"},variants:{size:{xs:{base:"text-xs"},sm:{base:"text-sm"}}},defaultVariants:{size:"sm"}});function Re({className:t,size:s,children:n}){const d=ht({size:s});return e.jsx("p",{className:d.base({className:t}),children:n})}Re.__docgenInfo={description:"",methods:[],displayName:"TextMuted"};const yt=function(){const{caseId:t}=at(),s=t?Number(t):void 0;if(s==null)throw new Error("Required parameter case_id was null or undefined.");return s},Ce="integer",xt=t=>{switch(t){case ye.cnv_occurrence:return s=>ae.statisticsGermlineCNVOccurrences(s.caseId,s.seqId,s.statisticsBody).then(n=>n.data);default:return s=>ae.statisticsGermlineSNVOccurrences(s.caseId,s.seqId,s.statisticsBody).then(n=>n.data)}};function gt(t,s,n,d,p=!1){const c={caseId:n,seqId:d,statisticsBody:{field:t}},r=p?Ee:I.getResolvedActiveQuery(s);return r&&(c.statisticsBody.sqon={content:r.content,op:r.op}),Te(c,xt(s),{revalidateOnFocus:!1})}function be(t,s,n,d){var N;let p=!1,c=(n==null?void 0:n.defaultOperator)??T.LessThan,r="0",h="0",l="",O=!1;const j=(d==null?void 0:d.type)===Ce?0:3,x=s.content.find(m=>"content"in m&&"field"in m.content?m.content.field===t:!1),y=s.content.find(m=>"content"in m&&"field"in m.content?m.content.field===`${t}_unit`:!1);if(x){const m=x.content.value;if(console.log("[NumericalFilter] values",m),m.includes("__missing__"))return{hasUnappliedItems:p,selectedRange:c,minValue:r,maxValue:h,numericalValue:l,hasNoData:!0,selectedUnit:void 0};p=!0,m.length===2?(c=T.Between,r=Number(m[0]).toFixed(j),h=Number(m[1]).toFixed(j)):l=m[0],x.op&&(c=x.op)}else console.log("[NumericalFilter else] no filter exists",n),O=!1,(n==null?void 0:n.defaultMin)!==void 0?(r=n.defaultMin.toString(),l=n.defaultMin.toString()):(d==null?void 0:d.min)!==void 0&&(r=Number(d.min.toFixed(j)).toString(),l=Number(d.min.toFixed(j)).toString()),(n==null?void 0:n.defaultMax)!==void 0?h=n.defaultMax.toString():(d==null?void 0:d.max)!==void 0&&(h=Number(d.max.toFixed(j)).toString()),n!=null&&n.defaultOperator&&(c=T[n.defaultOperator]);let b;return y&&y.content.value[0]&&((N=n==null?void 0:n.rangeTypes)!=null&&N.length)&&(b=n.rangeTypes[0].key),{hasUnappliedItems:p,selectedRange:c,minValue:r,maxValue:h,numericalValue:l,hasNoData:O,selectedUnit:b}}function qe({field:t}){var D,Z,ee,te,q;const{t:s}=P(),{appId:n,aggregations:d}=xe(),{seqId:p}=o.useContext(Oe),c=yt(),r=t.key,h={[T.GreaterThan]:{display:s("common.filters.operators.greater_than"),dropdown:s("common.filters.operators.greater_than"),icon:nt},[T.LessThan]:{display:s("common.filters.operators.less_than"),dropdown:s("common.filters.operators.less_than"),icon:st},[T.Between]:{display:s("common.filters.operators.between"),dropdown:s("common.filters.operators.between"),icon:tt},[T.GreaterThanOrEqualTo]:{display:s("common.filters.operators.greater_than_or_equal"),dropdown:s("common.filters.operators.greater_than_or_equal"),icon:et},[T.LessThanOrEqualTo]:{display:s("common.filters.operators.less_than_or_equal"),dropdown:s("common.filters.operators.less_than_or_equal"),icon:Ze},[T.In]:{display:s("common.filters.operators.in"),dropdown:s("common.filters.operators.in"),icon:Xe}},{data:l,isLoading:O}=gt(r,n,c,p,!1),j=(l==null?void 0:l.type)===Ce?0:3,[x,y]=o.useState(T.GreaterThan),[b,N]=o.useState("0"),[m,$]=o.useState("0"),[M,H]=o.useState("0"),[v,F]=o.useState(!1),[A,C]=o.useState(),[K,E]=o.useState(!1),f=(D=Object.values(d).flatMap(u=>u.items).find(u=>u.key===r))==null?void 0:D.defaults,L=t.type==="numerical"&&(f==null?void 0:f.noDataInputOption),U=(f==null?void 0:f.intervalDecimal)!==void 0&&((f==null?void 0:f.max)!==void 0||(f==null?void 0:f.min)!==void 0)||l&&(l.min!==void 0||l.max!==void 0),B=(f==null?void 0:f.min)??(l==null?void 0:l.min)??0,Q=(f==null?void 0:f.max)??(l==null?void 0:l.max)??100,X=o.useCallback(()=>{const u=I.getResolvedActiveQuery(n);if(!(u!=null&&u.content))return;const S=be(r,u,f,l);F(S.hasNoData),H(S.minValue),$(S.maxValue),E(S.hasUnappliedItems),y(S.selectedRange??T.GreaterThan),N(S.numericalValue)},[n,r,f,l]);o.useEffect(()=>{X()},[X]);const W=o.useCallback(u=>{y(u),E(!0)},[]),le=o.useCallback(u=>{F(u),E(!0)},[]),ie=o.useCallback(u=>{C(u),E(!0)},[]),ce=()=>{E(!1);const u=be(r,Ee,f,l);F(u.hasNoData),H(u.minValue),$(u.maxValue),E(u.hasUnappliedItems),y(u.selectedRange),N(u.numericalValue)},de=o.useCallback(()=>{if(E(!1),v){I.updateActiveQueryField(n,{field:r,value:["__missing__"],merge_strategy:Y.OVERRIDE_VALUES});return}let u=[];u=x===T.Between?[parseFloat(M.toString()),parseFloat(m.toString())]:[parseFloat(b.toString())],I.updateActiveQueryField(n,{field:r,value:u,merge_strategy:Y.OVERRIDE_VALUES,operator:x}),A&&I.updateActiveQueryField(n,{field:`${r}_unit`,value:[A],merge_strategy:Y.OVERRIDE_VALUES})},[n,r,x,b,M,m,v,A]),ue=Object.entries(T).map(([u,S])=>{if(S in h){const me=h[S].icon;return e.jsx(ge,{value:S,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{size:16}),e.jsx("span",{children:h[S].dropdown})]})},S)}return null}).filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsx(we,{id:`${r}_container`,size:"sm",variant:"outline",children:e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${r}_operator`,children:e.jsxs(ve,{value:x,onValueChange:W,children:[e.jsx(Se,{size:"sm",children:e.jsx(_e,{placeholder:s("common.filters.operators.select_operator"),children:((Z=h[x])==null?void 0:Z.display)||s("common.filters.operators.unknown")})}),e.jsx(ke,{children:ue})]})}),x===T.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(ne,{size:"xs",className:"w-half",value:M,onChange:u=>{const S=u.target.value;isNaN(Number(S))||(H(S),E(!0))},min:B,max:Q,id:`${r}_min`,"data-testid":`${r}_min`}),e.jsx(ne,{size:"xs",className:"w-half",value:m,onChange:u=>{const S=u.target.value;isNaN(Number(S))||($(S),E(!0))},min:B,max:Q,id:`${r}_max`,"data-testid":`${r}_max`})]}):e.jsx(ne,{size:"xs",className:"w-full",value:b,onChange:u=>{const S=u.target.value;isNaN(Number(S))||(N(S),E(!0))},min:B,max:Q,id:`${r}_value`,"data-testid":`${r}_value`}),U&&e.jsx("div",{id:`${r}_interval`,children:e.jsxs(Re,{size:"xs",children:[s("common.filters.labels.actual_interval")," : ",(ee=l==null?void 0:l.min)==null?void 0:ee.toFixed(j)," -"," ",(te=l==null?void 0:l.max)==null?void 0:te.toFixed(j)]})})]}),(f==null?void 0:f.rangeTypes)&&f.rangeTypes.length>0&&e.jsx("div",{id:`${r}_range_type_container`,className:"mt-3",children:O?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-5 w-16 mb-1",id:`${r}_unit_label_skeleton`}),e.jsx(oe,{className:"h-9 w-full",id:`${r}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"text-sm",id:`${r}_unit_label`,children:s("common.filters.labels.unit")}),e.jsxs(ve,{defaultValue:A||f.rangeTypes[0].key,onValueChange:ie,children:[e.jsx(Se,{children:e.jsx(_e,{placeholder:s("common.filters.labels.select_unit"),children:((q=f.rangeTypes.find(u=>u.key===A))==null?void 0:q.name)||s("common.filters.labels.select_unit")})}),e.jsx(ke,{children:f.rangeTypes.map(u=>e.jsx(ge,{value:u.key,children:u.name},u.key))})]})]})}),L&&!U&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden mt-3",id:`${r}_no_data_label`,children:[e.jsx(rt,{checked:v,onCheckedChange:le,id:`${r}_no_data`}),e.jsx("span",{children:s("common.filters.labels.no_data")})]})]})}),e.jsx(Ie,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(V,{size:"xxs",variant:"ghost",onClick:ce,disabled:!K,id:`${r}_clear`,children:s("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(V,{size:"xxs",variant:"outline",onClick:de,id:`${r}_apply`,children:s("common.filters.buttons.apply")})})]})})]})}qe.__docgenInfo={description:"",methods:[],displayName:"NumericalFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function Ve({data:t,field:s}){const{t:n}=P(),{appId:d}=xe(),{data:p}=Ae(s.key,void 0,!0,!1,d),[c,r]=o.useState(t||p||[]),[h,l]=o.useState(null);o.useEffect(()=>{r(t||p||[])},[t,p]),o.useEffect(()=>{const y=I.getActiveQuery(d).content.find(b=>b.content.field===s.key);if(y){const b=y.content.value;b.length>=1&&l(b[0])}else l(null)},[d,s.key]);const O=o.useCallback(y=>{y.key!==h&&y.key!==void 0&&(l(y.key||null),I.updateActiveQueryField(d,{field:s.key,value:[...y.key],merge_strategy:Y.OVERRIDE_VALUES}))},[h]),j=o.useCallback(y=>h===y.key,[h]),x=o.useCallback(()=>{l(null)},[h]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[e.jsx(lt,{children:c.map(y=>e.jsx("div",{className:"space-y-3 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(it,{value:y.key||"",id:y.key,checked:j(y),onClick:()=>{O(y)}}),e.jsx(he,{htmlFor:y.key,children:y.key})]}),e.jsx("span",{className:"bg-accent px-2 py-1 rounded-md font-mono text-xs",children:y.count})]})},y.key))}),h!==null&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-4 border-border"}),e.jsx("div",{className:"flex align-right justify-end items-center space-x-2",children:e.jsx(V,{onClick:x,size:"xs",children:n("common.filters.buttons.clear")})})]})]})}Ve.__docgenInfo={description:"",methods:[],displayName:"ToggleFilter",props:{data:{required:!1,tsType:{name:"Array",elements:[{name:"Aggregation"}],raw:"Aggregation[]"},description:""},field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function re({field:t,children:s}){const{t:n}=P(),d=n(`common.filters.labels.${t.translation_key}`,{defaultValue:t.key});let p=null;if(mt.includes(t.key)){const r=`common.filters.labels.${t.translation_key}_tooltip`;p=n(r)===r?null:n(r)}function c(){return e.jsx("div",{className:"flex items-center justify-between w-full text-xs",children:e.jsx("span",{children:d})})}return e.jsx(Ge,{size:"sm",children:e.jsxs(Pe,{value:t.key,className:"border-none",children:[e.jsx(Ue,{size:"sm",children:e.jsx(He,{children:p?e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsx("span",{children:c()})}),e.jsx(ut,{children:e.jsx("span",{children:p})})]}):c()})}),e.jsx(We,{className:"pb-0",children:s})]},t.key)})}function $e({field:t,isOpen:s}){const{t:n}=P(),d=t.type;if(d==="divider")return e.jsx("h4",{className:"px-2 h-8 text-sidebar-foreground/70 text-xs font-medium line-height-xs text-ellipsis overflow-hidden flex justify-between items-center",children:n(`common.filters.${t.key}`)});let p;switch(d){case"multiple":p=e.jsx(re,{field:t,isOpen:s,children:e.jsx(Fe,{field:t})});break;case"numerical":p=e.jsx(re,{field:t,isOpen:s,children:e.jsx(qe,{field:t})});break;case"boolean":p=e.jsx(re,{field:t,isOpen:s,children:e.jsx(Ve,{field:t})});break;default:p=e.jsx("div",{children:n("common.filters.unsupported_type",{type:t.type})})}return p}re.__docgenInfo={description:"",methods:[],displayName:"AccordionContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};$e.__docgenInfo={description:"To be use when the filter needs to be inside an Accordion component",methods:[],displayName:"FilterContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""}}};const Me=o.createContext({appId:ye.variant_entity,aggregations:{}}),xe=()=>{const t=o.useContext(Me);if(!t)throw new Error("useFilterConfig must be used within a FilterConfigProvider");return t};function Le(t){return`temp-filters-${t}`}function vt({groupKey:t,appId:s,aggregations:n}){var b;const{t:d}=P(),[p,c]=o.useState(!1),[r,h]=o.useState([]),[l,O]=o.useState(t),j=Le(s),x=()=>{sessionStorage.removeItem(j)},y=t?((b=n[t])==null?void 0:b.items)||[]:Object.values(n).flatMap(N=>N.items);return o.useEffect(()=>{c(!1),h([])},[t]),o.useEffect(()=>{(l&&l!==null&&t===null||l&&l!==null&&t&&t!==null&&l!==t)&&x(),O(t)},[t,l]),e.jsx(Me,{value:{appId:s,aggregations:n},children:e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(V,{variant:"link",size:"xs",onClick:()=>{const N=!p;c(N),h(N?y.map(m=>m.key):[])},children:d(p?"common.actions.collapse_all":"common.actions.expand_all")})}),e.jsx(Ye,{className:"flex flex-col gap-1",type:"multiple",value:r,onValueChange:N=>h(N),children:y.map((N,m)=>e.jsx($e,{isOpen:r.includes(N.key),field:N},`${N.key}-${m}`))})]})})}vt.__docgenInfo={description:"",methods:[],displayName:"FilterList",props:{groupKey:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregations:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [key: string]: AggregationGroup;
}`,signature:{properties:[{key:{name:"string"},value:{name:"AggregationGroup",required:!0}}]}},description:""},appId:{required:!0,tsType:{name:"ApplicationId"},description:""}}};export{Oe as A,vt as F,Me as a,yt as u};
