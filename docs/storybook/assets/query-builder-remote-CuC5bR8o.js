var ii=Object.defineProperty;var ai=(t,e,n)=>e in t?ii(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var J=(t,e,n)=>ai(t,typeof e!="symbol"?e+"":e,n);import{g as ue}from"./index-CBYaBgW8.js";import{e as si,f as ce,g as Ot,h as le,j as qt,k as en,d as fe,l as Tt,m as oi,n as Et,o as tn,b as Y,p as ui,q as ci,s as rn,t as li,u as fi,v as nn,w as di,x as vi,c as an,a as de,y as sn,z as on,A as un,B as pi,r as gi,C as yi,D as bi,E as _i,F as cn,G as hi,H as Qi,i as Ai}from"./isEqual-BlEvgNkC.js";import{B as ve,a as Ct,T as ln,M as Z,S as Ii,R as Mt,s as Si}from"./sqon-D24dxqRC.js";var ge,Vt;function mi(){if(Vt)return ge;Vt=1;var t=si(),e=ce(),n=Ot(),r=fe(),i=le(),a=qt(),s=Tt(),o=en(),u="[object Map]",c="[object Set]",l=Object.prototype,f=l.hasOwnProperty;function d(v){if(v==null)return!0;if(i(v)&&(r(v)||typeof v=="string"||typeof v.splice=="function"||a(v)||o(v)||n(v)))return!v.length;var y=e(v);if(y==u||y==c)return!v.size;if(s(v))return!t(v).length;for(var p in v)if(f.call(v,p))return!1;return!0}return ge=d,ge}var Pi=mi();const j=ue(Pi),I=[];for(let t=0;t<256;++t)I.push((t+256).toString(16).slice(1));function Ri(t,e=0){return(I[t[e+0]]+I[t[e+1]]+I[t[e+2]]+I[t[e+3]]+"-"+I[t[e+4]]+I[t[e+5]]+"-"+I[t[e+6]]+I[t[e+7]]+"-"+I[t[e+8]]+I[t[e+9]]+"-"+I[t[e+10]]+I[t[e+11]]+I[t[e+12]]+I[t[e+13]]+I[t[e+14]]+I[t[e+15]]).toLowerCase()}let ye;const Oi=new Uint8Array(16);function qi(){if(!ye){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ye=crypto.getRandomValues.bind(crypto)}return ye(Oi)}const Ti=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Kt={randomUUID:Ti};function R(t,e,n){var i;if(Kt.randomUUID&&!t)return Kt.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??qi();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ri(r)}var be,Gt;function Ei(){if(Gt)return be;Gt=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i&&n(e[r],r,e)!==!1;);return e}return be=t,be}var _e,Yt;function fn(){if(Yt)return _e;Yt=1;var t=oi(),e=(function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}})();return _e=e,_e}var he,Wt;function Ft(){if(Wt)return he;Wt=1;var t=fn();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return he=e,he}var Qe,Ht;function dn(){if(Ht)return Qe;Ht=1;var t=Ft(),e=Et(),n=Object.prototype,r=n.hasOwnProperty;function i(a,s,o){var u=a[s];(!(r.call(a,s)&&e(u,o))||o===void 0&&!(s in a))&&t(a,s,o)}return Qe=i,Qe}var Ae,$t;function z(){if($t)return Ae;$t=1;var t=dn(),e=Ft();function n(r,i,a,s){var o=!a;a||(a={});for(var u=-1,c=i.length;++u<c;){var l=i[u],f=s?s(a[l],r[l],l,a,r):void 0;f===void 0&&(f=r[l]),o?e(a,l,f):t(a,l,f)}return a}return Ae=n,Ae}var Ie,Jt;function Ci(){if(Jt)return Ie;Jt=1;var t=z(),e=tn();function n(r,i){return r&&t(i,e(i),r)}return Ie=n,Ie}var Se,Xt;function Fi(){if(Xt)return Se;Xt=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return Se=t,Se}var me,Zt;function wi(){if(Zt)return me;Zt=1;var t=Y(),e=Tt(),n=Fi(),r=Object.prototype,i=r.hasOwnProperty;function a(s){if(!t(s))return n(s);var o=e(s),u=[];for(var c in s)c=="constructor"&&(o||!i.call(s,c))||u.push(c);return u}return me=a,me}var Pe,kt;function B(){if(kt)return Pe;kt=1;var t=ui(),e=wi(),n=le();function r(i){return n(i)?t(i,!0):e(i)}return Pe=r,Pe}var Re,zt;function xi(){if(zt)return Re;zt=1;var t=z(),e=B();function n(r,i){return r&&t(i,e(i),r)}return Re=n,Re}var X={exports:{}};X.exports;var Bt;function vn(){return Bt||(Bt=1,(function(t,e){var n=ci(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===r,s=a?n.Buffer:void 0,o=s?s.allocUnsafe:void 0;function u(c,l){if(l)return c.slice();var f=c.length,d=o?o(f):new c.constructor(f);return c.copy(d),d}t.exports=u})(X,X.exports)),X.exports}var Oe,er;function pn(){if(er)return Oe;er=1;function t(e,n){var r=-1,i=e.length;for(n||(n=Array(i));++r<i;)n[r]=e[r];return n}return Oe=t,Oe}var qe,tr;function ji(){if(tr)return qe;tr=1;var t=z(),e=rn();function n(r,i){return t(r,e(r),i)}return qe=n,qe}var Te,rr;function wt(){if(rr)return Te;rr=1;var t=li(),e=t(Object.getPrototypeOf,Object);return Te=e,Te}var Ee,nr;function gn(){if(nr)return Ee;nr=1;var t=nn(),e=wt(),n=rn(),r=fi(),i=Object.getOwnPropertySymbols,a=i?function(s){for(var o=[];s;)t(o,n(s)),s=e(s);return o}:r;return Ee=a,Ee}var Ce,ir;function Di(){if(ir)return Ce;ir=1;var t=z(),e=gn();function n(r,i){return t(r,e(r),i)}return Ce=n,Ce}var Fe,ar;function Ui(){if(ar)return Fe;ar=1;var t=di(),e=gn(),n=B();function r(i){return t(i,n,e)}return Fe=r,Fe}var we,sr;function Ni(){if(sr)return we;sr=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var i=r.length,a=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(a.index=r.index,a.input=r.input),a}return we=n,we}var xe,or;function xt(){if(or)return xe;or=1;var t=vi();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return xe=e,xe}var je,ur;function Li(){if(ur)return je;ur=1;var t=xt();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}return je=e,je}var De,cr;function Mi(){if(cr)return De;cr=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return De=e,De}var Ue,lr;function Vi(){if(lr)return Ue;lr=1;var t=an(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(i){return n?Object(n.call(i)):{}}return Ue=r,Ue}var Ne,fr;function yn(){if(fr)return Ne;fr=1;var t=xt();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}return Ne=e,Ne}var Le,dr;function Ki(){if(dr)return Le;dr=1;var t=xt(),e=Li(),n=Mi(),r=Vi(),i=yn(),a="[object Boolean]",s="[object Date]",o="[object Map]",u="[object Number]",c="[object RegExp]",l="[object Set]",f="[object String]",d="[object Symbol]",v="[object ArrayBuffer]",y="[object DataView]",p="[object Float32Array]",h="[object Float64Array]",E="[object Int8Array]",Q="[object Int16Array]",O="[object Int32Array]",F="[object Uint8Array]",U="[object Uint8ClampedArray]",C="[object Uint16Array]",S="[object Uint32Array]";function _(m,A,q){var T=m.constructor;switch(A){case v:return t(m);case a:case s:return new T(+m);case y:return e(m,q);case p:case h:case E:case Q:case O:case F:case U:case C:case S:return i(m,q);case o:return new T;case u:case f:return new T(m);case c:return n(m);case l:return new T;case d:return r(m)}}return Le=_,Le}var Me,vr;function Gi(){if(vr)return Me;vr=1;var t=Y(),e=Object.create,n=(function(){function r(){}return function(i){if(!t(i))return{};if(e)return e(i);r.prototype=i;var a=new r;return r.prototype=void 0,a}})();return Me=n,Me}var Ve,pr;function bn(){if(pr)return Ve;pr=1;var t=Gi(),e=wt(),n=Tt();function r(i){return typeof i.constructor=="function"&&!n(i)?t(e(i)):{}}return Ve=r,Ve}var Ke,gr;function Yi(){if(gr)return Ke;gr=1;var t=ce(),e=de(),n="[object Map]";function r(i){return e(i)&&t(i)==n}return Ke=r,Ke}var Ge,yr;function Wi(){if(yr)return Ge;yr=1;var t=Yi(),e=sn(),n=on(),r=n&&n.isMap,i=r?e(r):t;return Ge=i,Ge}var Ye,br;function Hi(){if(br)return Ye;br=1;var t=ce(),e=de(),n="[object Set]";function r(i){return e(i)&&t(i)==n}return Ye=r,Ye}var We,_r;function $i(){if(_r)return We;_r=1;var t=Hi(),e=sn(),n=on(),r=n&&n.isSet,i=r?e(r):t;return We=i,We}var He,hr;function Ji(){if(hr)return He;hr=1;var t=un(),e=Ei(),n=dn(),r=Ci(),i=xi(),a=vn(),s=pn(),o=ji(),u=Di(),c=pi(),l=Ui(),f=ce(),d=Ni(),v=Ki(),y=bn(),p=fe(),h=qt(),E=Wi(),Q=Y(),O=$i(),F=tn(),U=B(),C=1,S=2,_=4,m="[object Arguments]",A="[object Array]",q="[object Boolean]",T="[object Date]",H="[object Error]",$="[object Function]",Dn="[object GeneratorFunction]",Un="[object Map]",Nn="[object Number]",jt="[object Object]",Ln="[object RegExp]",Mn="[object Set]",Vn="[object String]",Kn="[object Symbol]",Gn="[object WeakMap]",Yn="[object ArrayBuffer]",Wn="[object DataView]",Hn="[object Float32Array]",$n="[object Float64Array]",Jn="[object Int8Array]",Xn="[object Int16Array]",Zn="[object Int32Array]",kn="[object Uint8Array]",zn="[object Uint8ClampedArray]",Bn="[object Uint16Array]",ei="[object Uint32Array]",b={};b[m]=b[A]=b[Yn]=b[Wn]=b[q]=b[T]=b[Hn]=b[$n]=b[Jn]=b[Xn]=b[Zn]=b[Un]=b[Nn]=b[jt]=b[Ln]=b[Mn]=b[Vn]=b[Kn]=b[kn]=b[zn]=b[Bn]=b[ei]=!0,b[H]=b[$]=b[Gn]=!1;function ie(g,V,K,ti,ae,w){var P,se=V&C,oe=V&S,ri=V&_;if(K&&(P=ae?K(g,ti,ae,w):K(g)),P!==void 0)return P;if(!Q(g))return g;var Dt=p(g);if(Dt){if(P=d(g),!se)return s(g,P)}else{var G=f(g),Ut=G==$||G==Dn;if(h(g))return a(g,se);if(G==jt||G==m||Ut&&!ae){if(P=oe||Ut?{}:y(g),!se)return oe?u(g,i(P,g)):o(g,r(P,g))}else{if(!b[G])return ae?g:{};P=v(g,G,se)}}w||(w=new t);var Nt=w.get(g);if(Nt)return Nt;w.set(g,P),O(g)?g.forEach(function(x){P.add(ie(x,V,K,x,g,w))}):E(g)&&g.forEach(function(x,N){P.set(N,ie(x,V,K,N,g,w))});var ni=ri?oe?l:c:oe?U:F,Lt=Dt?void 0:ni(g);return e(Lt||g,function(x,N){Lt&&(N=x,x=g[N]),n(P,N,ie(x,V,K,N,g,w))}),P}return He=ie,He}var $e,Qr;function Xi(){if(Qr)return $e;Qr=1;var t=Ji(),e=1,n=4;function r(i){return t(i,e|n)}return $e=r,$e}var Zi=Xi();const L=ue(Zi);var Je,Ar;function _n(){if(Ar)return Je;Ar=1;var t=Ft(),e=Et();function n(r,i,a){(a!==void 0&&!e(r[i],a)||a===void 0&&!(i in r))&&t(r,i,a)}return Je=n,Je}var Xe,Ir;function ki(){if(Ir)return Xe;Ir=1;function t(e){return function(n,r,i){for(var a=-1,s=Object(n),o=i(n),u=o.length;u--;){var c=o[e?u:++a];if(r(s[c],c,s)===!1)break}return n}}return Xe=t,Xe}var Ze,Sr;function zi(){if(Sr)return Ze;Sr=1;var t=ki(),e=t();return Ze=e,Ze}var ke,mr;function hn(){if(mr)return ke;mr=1;var t=le(),e=de();function n(r){return e(r)&&t(r)}return ke=n,ke}var ze,Pr;function Bi(){if(Pr)return ze;Pr=1;var t=gi(),e=wt(),n=de(),r="[object Object]",i=Function.prototype,a=Object.prototype,s=i.toString,o=a.hasOwnProperty,u=s.call(Object);function c(l){if(!n(l)||t(l)!=r)return!1;var f=e(l);if(f===null)return!0;var d=o.call(f,"constructor")&&f.constructor;return typeof d=="function"&&d instanceof d&&s.call(d)==u}return ze=c,ze}var Be,Rr;function Qn(){if(Rr)return Be;Rr=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return Be=t,Be}var et,Or;function ea(){if(Or)return et;Or=1;var t=z(),e=B();function n(r){return t(r,e(r))}return et=n,et}var tt,qr;function ta(){if(qr)return tt;qr=1;var t=_n(),e=vn(),n=yn(),r=pn(),i=bn(),a=Ot(),s=fe(),o=hn(),u=qt(),c=yi(),l=Y(),f=Bi(),d=en(),v=Qn(),y=ea();function p(h,E,Q,O,F,U,C){var S=v(h,Q),_=v(E,Q),m=C.get(_);if(m){t(h,Q,m);return}var A=U?U(S,_,Q+"",h,E,C):void 0,q=A===void 0;if(q){var T=s(_),H=!T&&u(_),$=!T&&!H&&d(_);A=_,T||H||$?s(S)?A=S:o(S)?A=r(S):H?(q=!1,A=e(_,!0)):$?(q=!1,A=n(_,!0)):A=[]:f(_)||a(_)?(A=S,a(S)?A=y(S):(!l(S)||c(S))&&(A=i(_))):q=!1}q&&(C.set(_,A),F(A,_,O,U,C),C.delete(_)),t(h,Q,A)}return tt=p,tt}var rt,Tr;function ra(){if(Tr)return rt;Tr=1;var t=un(),e=_n(),n=zi(),r=ta(),i=Y(),a=B(),s=Qn();function o(u,c,l,f,d){u!==c&&n(c,function(v,y){if(d||(d=new t),i(v))r(u,c,y,l,o,f,d);else{var p=f?f(s(u,y),v,y+"",u,c,d):void 0;p===void 0&&(p=v),e(u,y,p)}},a)}return rt=o,rt}var nt,Er;function An(){if(Er)return nt;Er=1;function t(e){return e}return nt=t,nt}var it,Cr;function na(){if(Cr)return it;Cr=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return it=t,it}var at,Fr;function ia(){if(Fr)return at;Fr=1;var t=na(),e=Math.max;function n(r,i,a){return i=e(i===void 0?r.length-1:i,0),function(){for(var s=arguments,o=-1,u=e(s.length-i,0),c=Array(u);++o<u;)c[o]=s[i+o];o=-1;for(var l=Array(i+1);++o<i;)l[o]=s[o];return l[i]=a(c),t(r,this,l)}}return at=n,at}var st,wr;function aa(){if(wr)return st;wr=1;function t(e){return function(){return e}}return st=t,st}var ot,xr;function sa(){if(xr)return ot;xr=1;var t=aa(),e=fn(),n=An(),r=e?function(i,a){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(a),writable:!0})}:n;return ot=r,ot}var ut,jr;function oa(){if(jr)return ut;jr=1;var t=800,e=16,n=Date.now;function r(i){var a=0,s=0;return function(){var o=n(),u=e-(o-s);if(s=o,u>0){if(++a>=t)return arguments[0]}else a=0;return i.apply(void 0,arguments)}}return ut=r,ut}var ct,Dr;function ua(){if(Dr)return ct;Dr=1;var t=sa(),e=oa(),n=e(t);return ct=n,ct}var lt,Ur;function In(){if(Ur)return lt;Ur=1;var t=An(),e=ia(),n=ua();function r(i,a){return n(e(i,a,t),i+"")}return lt=r,lt}var ft,Nr;function ca(){if(Nr)return ft;Nr=1;var t=Et(),e=le(),n=bi(),r=Y();function i(a,s,o){if(!r(o))return!1;var u=typeof s;return(u=="number"?e(o)&&n(s,o.length):u=="string"&&s in o)?t(o[s],a):!1}return ft=i,ft}var dt,Lr;function la(){if(Lr)return dt;Lr=1;var t=In(),e=ca();function n(r){return t(function(i,a){var s=-1,o=a.length,u=o>1?a[o-1]:void 0,c=o>2?a[2]:void 0;for(u=r.length>3&&typeof u=="function"?(o--,u):void 0,c&&e(a[0],a[1],c)&&(u=o<3?void 0:u,o=1),i=Object(i);++s<o;){var l=a[s];l&&r(i,l,s,u)}return i})}return dt=n,dt}var vt,Mr;function fa(){if(Mr)return vt;Mr=1;var t=ra(),e=la(),n=e(function(r,i,a){t(r,i,a)});return vt=n,vt}var da=fa();const va=ue(da);var pt,Vr;function pa(){if(Vr)return pt;Vr=1;var t=an(),e=Ot(),n=fe(),r=t?t.isConcatSpreadable:void 0;function i(a){return n(a)||e(a)||!!(r&&a&&a[r])}return pt=i,pt}var gt,Kr;function ga(){if(Kr)return gt;Kr=1;var t=nn(),e=pa();function n(r,i,a,s,o){var u=-1,c=r.length;for(a||(a=e),o||(o=[]);++u<c;){var l=r[u];i>0&&a(l)?i>1?n(l,i-1,a,s,o):t(o,l):s||(o[o.length]=l)}return o}return gt=n,gt}var yt,Gr;function ya(){if(Gr)return yt;Gr=1;function t(e,n,r,i){for(var a=e.length,s=r+(i?1:-1);i?s--:++s<a;)if(n(e[s],s,e))return s;return-1}return yt=t,yt}var bt,Yr;function ba(){if(Yr)return bt;Yr=1;function t(e){return e!==e}return bt=t,bt}var _t,Wr;function _a(){if(Wr)return _t;Wr=1;function t(e,n,r){for(var i=r-1,a=e.length;++i<a;)if(e[i]===n)return i;return-1}return _t=t,_t}var ht,Hr;function ha(){if(Hr)return ht;Hr=1;var t=ya(),e=ba(),n=_a();function r(i,a,s){return a===a?n(i,a,s):t(i,e,s)}return ht=r,ht}var Qt,$r;function Qa(){if($r)return Qt;$r=1;var t=ha();function e(n,r){var i=n==null?0:n.length;return!!i&&t(n,r,0)>-1}return Qt=e,Qt}var At,Jr;function Aa(){if(Jr)return At;Jr=1;function t(e,n,r){for(var i=-1,a=e==null?0:e.length;++i<a;)if(r(n,e[i]))return!0;return!1}return At=t,At}var It,Xr;function Ia(){if(Xr)return It;Xr=1;function t(){}return It=t,It}var St,Zr;function Sa(){if(Zr)return St;Zr=1;var t=_i(),e=Ia(),n=cn(),r=1/0,i=t&&1/n(new t([,-0]))[1]==r?function(a){return new t(a)}:e;return St=i,St}var mt,kr;function ma(){if(kr)return mt;kr=1;var t=hi(),e=Qa(),n=Aa(),r=Qi(),i=Sa(),a=cn(),s=200;function o(u,c,l){var f=-1,d=e,v=u.length,y=!0,p=[],h=p;if(l)y=!1,d=n;else if(v>=s){var E=c?null:i(u);if(E)return a(E);y=!1,d=r,h=new t}else h=c?[]:p;e:for(;++f<v;){var Q=u[f],O=c?c(Q):Q;if(Q=l||Q!==0?Q:0,y&&O===O){for(var F=h.length;F--;)if(h[F]===O)continue e;c&&h.push(O),p.push(Q)}else d(h,O,l)||(h!==p&&h.push(O),p.push(Q))}return p}return mt=o,mt}var Pt,zr;function Pa(){if(zr)return Pt;zr=1;var t=ga(),e=In(),n=ma(),r=hn(),i=e(function(a){return n(t(a,1,r,!0))});return Pt=i,Pt}var Ra=Pa();const Oa=ue(Ra),D=t=>!Object.keys(t).length||j(t==null?void 0:t.content),Sn=t=>!D(t),ee=t=>!qa(t),qa=t=>isNaN(t),ts=t=>t.content.value&&t.content.value.some(e=>e==null?void 0:e.toString().startsWith(Ii)),rs=t=>!!t.content.isUploadedList,ns=t=>!!t.content.remoteComponent,te=t=>typeof t=="object"&&Sn(t)&&"op"in t&&Object.values(ve).includes(t.op),is=t=>t.content.value.every(e=>["false","true"].includes(e.toString().toLowerCase())),as=t=>t.op===Mt.In?!1:t.op in Mt,ss=t=>!!t.title,M=(t=R())=>({id:t,content:[],op:ve.And}),os=(t,e=[])=>{const n=L(t),r=[];return n.map(i=>{r.push(Ta(i,e))}),r},Ta=(t,e)=>({content:t.content.filter(r=>{let i=!1;if(!Array.isArray(r.content))r.content&&e!=null&&e.includes(r.content.field)||(i=!0);else if(r.content.length!==0&&(e!=null&&e.includes(r.content.field)||(i=!0),Array.isArray(r.content))){const{field:a}=r.content[0].content;e!=null&&e.includes(a)&&(i=!1)}return i}),id:t.id,op:t.op}),k=t=>{let e=t;const n=t.filter(i=>D(i)),r=t.filter(i=>Sn(i));if(n.length){const i=n[0];e=[...r,i]}return L(e)},mn=(t,e)=>{const n=(a,s)=>s.filter(o=>o!==a).map(o=>ee(o)&&typeof o=="number"&&o>a?o-1:o),r=e.filter((a,s)=>s!==t).map(a=>D(a)?a:{...a,content:n(t,a.content)}),i=r.filter(a=>j(a.content));return i.length?mn(r.findIndex(a=>a.id==i[0].id),r):r},Br=(t,e)=>{var i,a,s,o;const n=e.getRawQueries(),r=e.getState().activeQueryId;if(n.length===1)e.resetQueries(t);else{const u=e.getQueryIndex(t),c=k(mn(u,n));if(c.length){const l=Ea(c,u),f=c[l];let d=e.getSelectedQueryIndexes();d.includes(u)&&(d=d.filter(p=>p!==u).map(p=>p>u?p-1:p),(a=(i=e.coreProps).onQuerySelectChange)==null||a.call(i,d));const v=c.find(p=>p.id===r),y={activeQueryId:v?r:f.id,queries:c,selectedQueryIndexes:d};v||(o=(s=e.coreProps).onActiveQueryChange)==null||o.call(s,f),e.setState(p=>({...p,...y}))}else e.resetQueries(t)}},Ea=(t,e)=>t.length-1>=e?e:e+1>t.length-1?e-1<t.length&&e-1>=0?e-1:t.length-1:e+1,Pn=(t,e)=>({...e,content:e.content.map(n=>te(n)&&!n.skipBooleanOperatorCheck?Pn(t,n):n),op:t}),Rn=(t,e)=>({...e,content:e.content.filter(function n(r){return ee(r)?!0:te(r)?r.content.filter(n).length>0:r.content.field!==t})}),Ca=({sqon:t,field:e,index:n,isUploadedList:r,merge_strategy:i=Z.APPEND_VALUES,operator:a=ln.In,overrideValuesName:s,remoteComponent:o,value:u})=>{let c;const l={content:{field:e,index:n,isUploadedList:r,overrideValuesName:s,remoteComponent:o,value:u},op:a};return j(t)?(c=M(),c.content=[l]):c=Fa(t,l,{operator:Ct.OVERRIDE_OPERATOR,values:i}),c},Fa=(t,e,n)=>{const r=L(t);return n=va({},{operator:Ct.DEFAULT,values:Z.DEFAULT},n),On(r,e,n)?r:{...r,content:[...r.content,e]}},On=(t,e,n)=>{let r=!1;return t.content.forEach(i=>{if(ee(i)||i.name)return;const a=i;if(te(a)){r=On(a,e,n);return}const s=a;s.content.field===e.content.field&&(r=!0,e.content.overrideValuesName&&(s.content.overrideValuesName=e.content.overrideValuesName),e.op&&n.operator!==Ct.KEEP_OPERATOR&&(s.op=e.op),n.values===Z.APPEND_VALUES&&(s.content.value=Oa([],s.content.value,e.content.value)),n.values===Z.OVERRIDE_VALUES&&(s.content.value=e.content.value))}),r},wa=(t,e)=>{const n=e.content,r=typeof t=="number"?n.filter(i=>i!==t):n.filter(i=>{if(typeof i=="number")return!0;const a=i,{skipBooleanOperatorCheck:s}=a,o=s&&a.content[0].content.field!==t,u=i.content.field!==t;return s?o:u});return{...e,content:r,op:e.op}},xa=(t,e)=>{const r=e.content.filter(i=>i.id!==t);return{...e,content:r,op:e.op}},qn=(t,e)=>te(e)?e.content.reduce((n,r)=>n||qn(t,r),!1):typeof e=="number"&&e===t,us=(t,e)=>L(t).map(r=>{const i=r.content.map(a=>a.id===e.id?{id:e.id,content:e.queries[0].content,op:a.op,name:e.name}:a);return{...r,content:i}}),Tn=t=>L(t).map(r=>{const i=r.content.map(a=>Object.prototype.hasOwnProperty.call(a,"title")&&a.id?{filterID:a.id}:a);return{...r,content:i}}),ja=(t,e)=>{let n=-1;const r=t.content.filter((i,a)=>{if(ee(i))return!0;const s=i,{skipBooleanOperatorCheck:o}=s,u=o&&s.content.find(c=>c.content.field===e);return(u||i.content.field==e)&&(n=a),o?!u:i.content.field!==e});return[n,{...t,content:r}]},Da=(t,e,n)=>(console.error("createSQONFromFilters is not implemented"),[]),Ua=(t,e,n)=>(console.error("createSQONFromFilters is not implemented"),[]),En=(t,e)=>{const n=r=>r.content.map(i=>ee(i)?e[i]:i).map(i=>En(i,e));return te(t)?{content:n(t),op:t.op}:{content:t.content,op:t.op}};function Cn({defaultTitle:t="New Filter",type:e}){const n=R(),r={id:R(),queries:[M(n)],type:e,name:t,favorite:!1,isDirty:!1,isNew:!0};return{newActiveQueryId:n,newSavedFilter:r}}const Fn=(t,e)=>{const n={},r=t.id??R();return Object.assign(n,{id:r,raw:()=>t,index:()=>e.getState().queries.findIndex(a=>a.id===r),isActive:()=>e.getState().activeQueryId===r,isEmpty:()=>D(t),isNotEmpty:()=>!D(t),toggleSelect:a=>{var u,c;const s=e.getQueryIndex(r);let o=[];a?o=[...e.getState().selectedQueryIndexes,s]:o=e.getState().selectedQueryIndexes.filter(l=>l!==s),e.setState(l=>({...l,selectedQueryIndexes:o})),(c=(u=e.coreProps).onQuerySelectChange)==null||c.call(u,o)},isSelected:()=>e.getState().selectedQueryIndexes.includes(e.getQueryIndex(r)),isSelectable:()=>{const a=e.getState().queries;return a.length===2&&e.hasEmptyQuery()?!1:a.length>1&&n.isNotEmpty()},saveAsCustomPill:async a=>{var o,u;const s={favorite:!1,id:R(),queries:[n.raw()],name:a,type:e.coreProps.savedFilterType};return Promise.resolve((u=(o=e.coreProps).onCustomPillSave)==null?void 0:u.call(o,s)).then(()=>n.update({...n.raw(),content:[{id:s.id,op:s.queries[0].op,content:s.queries[0].content,title:s.name}]}))},delete:()=>{var a,s;Br(r,e),(s=(a=e.coreProps).onQueryDelete)==null||s.call(a,r)},update:a=>{var s,o,u,c;if(j(a.content))Br(r,e);else{const l=e.getState().activeQueryId,f=e.getQueryIndex(r),d=L(e.getRawQueries()),v={...a,id:r,content:a.content,op:a.op};d[f]=v,e.setState(y=>({...y,queries:k(d)})),(o=(s=e.coreProps).onQueryUpdate)==null||o.call(s,v),l===r&&((c=(u=e.coreProps).onActiveQueryChange)==null||c.call(u,v))}},duplicate:()=>{const a=e.getQuery(r);a&&e.createQuery({op:a.raw().op,content:a.raw().content})},setAsActive:()=>{var a,s;e.setState(o=>({...o,activeQueryId:r})),(s=(a=e.coreProps).onActiveQueryChange)==null||s.call(a,n.raw())},changeCombineOperator:a=>{var l,f;const s=L(e.getRawQueries()),o=e.getQueryIndex(r),u=s[o],c=Pn(a,u);s[o]={...u,content:c.content,op:c.op},e.setState(d=>({...d,queries:k(s)})),(f=(l=e.coreProps).onActiveQueryChange)==null||f.call(l,s[o])},addPill:a=>{n.update({...t,content:[...t.content,a]})},removePillById:a=>{n.update(xa(a,t))},removePillByFieldOrIndex:a=>{n.update(wa(a,t))},isReferencedInActiveQuery:()=>{const a=e.getActiveQuery();return a?qn(n.index(),a.raw()):!1},hasCustomPill:()=>n.raw().content.some(a=>a.name||!a.content)}),n};var wn=(t=>(t.Filter="filter",t.Query="query",t))(wn||{});const Na=(t,e)=>{const n={},r=t.id;return Object.assign(n,{id:r,raw:()=>t,getQueries:()=>t.queries&&t.queries.length>0?t.queries.map(a=>Fn(a,e)):[],getRawQueries:()=>t.queries,getQueryById:a=>n.getQueries().find(s=>s.id===a)||null,copy:()=>{const a=n.getRawQueries().map(l=>({...l,id:R()})),o=e.getSavedFilters().filter(l=>!l.isNew()).filter(l=>l.raw().name.includes(t.name)),u=`${t.name} COPY${o.length>1?` ${o.length-1}`:""}`;return{favorite:!1,id:R(),queries:a,name:u,isDirty:!1,isNew:!0,type:e.coreProps.savedFilterType}},duplicate:()=>{var a,s;if(n.isSelected()){const o=n.copy();e.setState(u=>({...u,activeQueryId:o.queries[0].id,queries:o.queries,savedFilters:[...u.savedFilters,o]})),(s=(a=e.coreProps).onSavedFilterCreate)==null||s.call(a,o)}else console.error("Can only duplicate the selected saved filter")},delete:async()=>{var a,s;return Promise.resolve((s=(a=e.coreProps).onSavedFilterDelete)==null?void 0:s.call(a,r)).then(()=>{var c,l,f,d;const{newActiveQueryId:o,newSavedFilter:u}=Cn({type:e.coreProps.savedFilterType,defaultTitle:e.coreProps.savedFilterDefaultTitle});e.setState(v=>({...v,activeQueryId:o,queries:u.queries,savedFilters:[...v.savedFilters.filter(y=>y.id!==r),u]})),(l=(c=e.coreProps).onActiveQueryChange)==null||l.call(c,u.queries[0]),(d=(f=e.coreProps).onSavedFilterCreate)==null||d.call(f,u)})},save:async(a,s)=>{var c,l,f,d;const o={...n.raw(),name:(s==null?void 0:s.name)||n.raw().name,favorite:(s==null?void 0:s.favorite)!==void 0?s.favorite:n.raw().favorite,queries:e.getRawQueries()};return a===wn.Query?Promise.resolve((l=(c=e.coreProps).onCustomPillUpdate)==null?void 0:l.call(c,o)).then(()=>{}):Promise.resolve((d=(f=e.coreProps).onSavedFilterUpdate)==null?void 0:d.call(f,{...o,queries:Tn(o.queries)})).then(v=>{v&&e.setState(y=>({...y,savedFilters:y.savedFilters.map(p=>p.id===v.id?{...v,isNew:!1,isDirty:!1}:p)}))})},select:()=>{e.setState(a=>({...a,activeQueryId:t.queries[0].id,queries:t.queries}))},discardChanges:()=>{n.isSelected()?e.setState(a=>({...a,activeQueryId:t.queries[0].id,queries:t.queries})):console.error("Can only discard changes to the selected saved filter")},hasQueries:()=>n.getQueries().length>0,isSelected:()=>{const a=e.getState().queries.map(s=>s.id);return t.queries.find(s=>a.includes(s.id))!==void 0},isFavorite:()=>t.favorite||!1,isNew:()=>t.isNew||!1,isDirty:()=>!n.isSelected()||t.isNew?!1:t.isDirty||e.getRawQueries().length!==t.queries.length?!0:!t.queries.every(a=>{const s=e.getRawQueries().find(o=>o.id==a.id);return s?Ai({content:Si(s.content),id:s.id,op:s.op},{content:a.content,id:a.id,op:a.op}):!1})}),n},La=()=>{const t=R();return{activeQueryId:t,queries:[M(t)],savedFilters:[],selectedQueryIndexes:[]}},cs=t=>{const e={};return Object.assign(e,{coreProps:t,setCoreProps:r=>{e.coreProps=r(e.coreProps)},setState:r=>{var i,a;(a=(i=e.coreProps).onStateChange)==null||a.call(i,r(e.coreProps.state))},getState:()=>e.coreProps.state,reset:()=>{e.setState(()=>e.coreProps.initialState)},clearQueries:()=>{var a,s;const r=R(),i=M(r);e.setState(o=>({...o,activeQueryId:r,queries:[i]})),(s=(a=e.coreProps).onActiveQueryChange)==null||s.call(a,i)},saveNewFilter:async r=>{var a,s;const i={id:(r==null?void 0:r.id)||R(),name:(r==null?void 0:r.name)||e.coreProps.savedFilterDefaultTitle||"New Filter",favorite:(r==null?void 0:r.favorite)===void 0?!1:r.favorite,queries:(r==null?void 0:r.queries)||e.getRawQueries(),type:(r==null?void 0:r.type)||e.coreProps.savedFilterType};return Promise.resolve((s=(a=e.coreProps).onSavedFilterSave)==null?void 0:s.call(a,{...i,queries:Tn(i.queries)})).then(o=>{o&&e.setState(u=>{const c=u.savedFilters.filter(l=>l.id!==i.id);return{...u,savedFilters:[...c,{...o,isNew:!1,isDirty:!1}]}})})},createSavedFilter:()=>{var a,s;const{newActiveQueryId:r,newSavedFilter:i}=Cn({type:e.coreProps.savedFilterType,defaultTitle:e.coreProps.savedFilterDefaultTitle});e.setState(o=>({...o,activeQueryId:r,queries:i.queries,savedFilters:[...o.savedFilters,i]})),(s=(a=e.coreProps).onSavedFilterCreate)==null||s.call(a,i)},getSelectedSavedFilter:()=>{if(!e.getActiveQuery())return null;let i=e.getSavedFilters().find(a=>a.isSelected()&&!a.isNew());return i||(i=e.getSavedFilters().find(a=>a.isNew())),i||null},getSavedFilters:()=>e.coreProps.state.savedFilters&&e.coreProps.state.savedFilters.length>0?e.coreProps.state.savedFilters.map(i=>Na(i,e)):[],getQueries:()=>e.coreProps.state.queries&&e.coreProps.state.queries.length>0?e.coreProps.state.queries.map(r=>Fn(r,e)):[],getRawQueries:()=>e.coreProps.state.queries||[],getSelectedQueryIndexes:()=>e.getState().selectedQueryIndexes,toggleQuerySelect:(r,i)=>{var a;(a=e.getQuery(r))==null||a.toggleSelect(i)},resetQuerySelection:()=>{var r,i;e.setState(a=>({...a,selectedQueryIndexes:[]})),(i=(r=e.coreProps).onQuerySelectChange)==null||i.call(r,[])},createQuery:({id:r=R(),op:i=ve.And,content:a})=>{var o,u,c,l;const s={id:r,op:i,content:a};return e.setState(f=>({...f,activeQueryId:s.id,queries:k([...e.getRawQueries(),s])})),(u=(o=e.coreProps).onActiveQueryChange)==null||u.call(o,s),(l=(c=e.coreProps).onQueryCreate)==null||l.call(c,s),s.id},getQuery:r=>e.getQueries().find(i=>i.id===r)||null,setActiveQuery:r=>{var i;(i=e.getQuery(r))==null||i.setAsActive()},getActiveQuery:()=>e.coreProps.state.activeQueryId?e.getQuery(e.coreProps.state.activeQueryId):null,getQueryIndex:r=>{const i=e.getQuery(r);return i?i.index():-1},updateQuery:(r,i)=>{var a;(a=e.getQuery(r))==null||a.update(i)},duplicateQuery:r=>{var i;(i=e.getQuery(r))==null||i.duplicate()},deleteQuery:r=>{var i;(i=e.getQuery(r))==null||i.delete()},changeQueryCombineOperator:(r,i)=>{var a;(a=e.getQuery(r))==null||a.changeCombineOperator(i)},hasEmptyQuery:()=>e.getQueries().some(r=>r.isEmpty()),hasQueries:()=>e.getQueries().length>0,canCombine:()=>e.getQueries().length>1&&e.getSelectedQueryIndexes().length>1,resetQueries:r=>{var a,s;const i=M(r);(s=(a=e.coreProps).onActiveQueryChange)==null||s.call(a,i),e.setState(o=>({...o,activeQueryId:r,queries:[i]}))},combineSelectedQueries:r=>{var s,o,u,c,l,f;if(!e.canCombine()){console.error("Cannot combine queries. There must be at least 2 queries selected.");return}const i={id:R(),op:r,content:e.getSelectedQueryIndexes().sort()},a=[];e.setState(d=>({...d,activeQueryId:i.id,queries:k([...d.queries,i]),selectedQueryIndexes:a})),(o=(s=e.coreProps).onActiveQueryChange)==null||o.call(s,i),(c=(u=e.coreProps).onQueryCreate)==null||c.call(u,i),(f=(l=e.coreProps).onQuerySelectChange)==null||f.call(l,a)},isEmpty:()=>e.getQueries().length===1&&e.getQueries()[0].isEmpty()}),e},Ma="QBCacheUpdate",xn="query-builder-cache",ls={content:[],op:"and"};var Va=(t=>(t.ADD_QUERY="ADD_QUERY",t.UPDATE_QUERY="UPDATE_QUERY",t.SET_STATE="SET_STATE",t))(Va||{});class Ka extends Event{constructor(n){super(Ma);J(this,"eventData");J(this,"eventType");J(this,"value");J(this,"queryBuilderId");this.eventType=n.eventType,this.queryBuilderId=n.queryBuilderId,this.value=n.value,this.eventData=n.eventData}}const pe=(t,{eventType:e,eventData:n,value:r,skipEvent:i})=>{if(window.localStorage.setItem(`${xn}-${t}`,JSON.stringify(r)),!i){const a=new Ka({queryBuilderId:t,value:r,eventType:e,eventData:n});window.dispatchEvent(a)}},Rt=t=>{const e=La();return pe(t,{value:e,eventType:"SET_STATE",eventData:e}),e},re=t=>{if(typeof window<"u"){const e=window.localStorage.getItem(`${xn}-${t}`);if(!e)return Rt(t);try{return JSON.parse(e)}catch{return Rt(t)}}else return{}},Ga=(t,e,n=!1)=>{const r=re(t),i=(r==null?void 0:r.queries)??[],a=i.find(o=>D(o)),s=i.find(o=>o.id===r.activeQueryId&&D(o));pe(t,{eventType:"ADD_QUERY",eventData:e,value:{activeQueryId:n||s?e.id:(r==null?void 0:r.activeQueryId)??e.id,queries:a?i.map(o=>D(o)?e:o):[...i,e]}})},Ya=(t,e=En)=>{var r;const n=re(t);return e(((r=n==null?void 0:n.queries)==null?void 0:r.find(({id:i})=>i===n.activeQueryId))??M(),n.queries)},ne=t=>{var n;const e=re(t);return((n=e==null?void 0:e.queries)==null?void 0:n.find(({id:r})=>r===e.activeQueryId))??M()},W=(t,e)=>{var i;const n=re(t),r=(i=n==null?void 0:n.queries)==null?void 0:i.find(({id:a})=>a===e.id);if(r)r.content=e.content,r.op=e.op;else throw new Error(`Query with id ${e.id} not found`);pe(t,{eventType:"UPDATE_QUERY",eventData:r,value:n})},Wa=(t,{field:e,index:n,isUploadedList:r,merge_strategy:i=Z.APPEND_VALUES,operator:a=ln.In,overrideValuesName:s,remoteComponent:o,value:u})=>{const c=Za.getActiveQuery(t);W(t,j(u)?Rn(e,c):Ca({sqon:c,field:e,index:n,isUploadedList:r,merge_strategy:i,operator:a,overrideValuesName:s,remoteComponent:o,value:u}))},Ha=(t,e)=>{W(t,jn(t,{field:e.filterGroup.field,operator:e.operator,sqonContent:Ua(e.filterGroup,e.selectedFilters,e.index)}))},jn=(t,{field:e,operator:n=ve.And,sqonContent:r})=>{const i=ne(t);let a={id:R(),content:r,op:n};if(!j(i)){const s=ja(i,e),o=s[0],u=s[1],c={...u};j(c.content)&&j(i)?a={id:R(),content:[],op:n}:(o>=0?c.content.splice(o,0,...r):c.content=[...c.content,...r],a={...c,content:[...c.content]},u.content.length===0&&(a.op=n))}return a},$a=(t,e)=>W(t,e.selectedFilters.length>0?jn(t,{field:e.field,sqonContent:Da(e.field,e.selectedFilters)}):Rn(e.field,ne(t))),Ja=(t,e)=>{const n=ne(t);W(t,{...n,content:[...n.content,e]})},Xa=(t,e)=>{const n=ne(t);n.content=n.content.filter(r=>r.id!==e).filter(r=>r!==void 0),W(t,n)},Za={addQuery:Ga,updateQuery:W,getActiveQuery:ne,getResolvedActiveQuery:Ya,updateActiveQueryField:Wa,updateActiveQueryFilters:Ha,updateQueryByTableFilter:$a,addPillToActiveQuery:Ja,removePillFromActiveQuery:Xa,setLocalQueryBuilderState:pe,getLocalQueryBuilderState:re,setDefaultLocalQueryBuilderState:Rt};export{ls as D,Ma as Q,wn as S,cs as a,Va as b,Na as c,as as d,L as e,ss as f,La as g,te as h,is as i,ee as j,ts as k,rs as l,ns as m,En as n,Za as q,os as r,us as u,R as v};
