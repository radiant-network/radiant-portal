import{j as n}from"./jsx-runtime-D_zvdyIk.js";import{r as a}from"./index-CBYaBgW8.js";import{b as be,g as we,_ as ye,a as xe,c as ee,d as B}from"./command-CqDCn1-N.js";import{B as te}from"./badge-B8JYzoyf.js";import{S as Re}from"./skeleton-_T1otFf0.js";import{u as Ne}from"./i18n-xmjcbfpT.js";import{u as je}from"./useDebounce-CEPqGWFj.js";import{c as T}from"./utils-CDN07tui.js";import{X as Oe}from"./x-4HkHZ1eq.js";import{C as le}from"./check-DSe_yRo5.js";function E(c,r){if(c.length===0)return{};if(!r)return{"":c};const p={};return c.forEach(o=>{const v=o[r]||"";p[v]||(p[v]=[]),p[v].push(o)}),p}function ne(c,r){return r.filter(p=>c.includes(p.value))}function ke(c,r){for(const[,p]of Object.entries(c))if(p.some(o=>r.find(v=>v.value===o.value)))return!0;return!1}function se({value:c,onChange:r,placeholder:p,defaultOptions:o=[],options:v,debounceDelay:ae=500,onSearch:f,onSearchSync:V,emptyIndicator:H,maxSelected:K=Number.MAX_SAFE_INTEGER,onMaxSelected:N,hidePlaceholderWhenSelected:X,disabled:S,groupBy:g,className:re,selectFirstItem:ie=!0,creatable:q=!1,triggerSearchOnFocus:A=!1,commandProps:i,inputProps:u,hideClearAllButton:ue=!1,openOnFocus:J=!1,renderBadge:U,ref:oe}){const{t:$}=Ne(),d=a.useRef(null),M=a.useRef(null),[w,h]=a.useState(!1),[ce,Q]=a.useState(!1),[Y,Z]=a.useState(!1),F=a.useRef(null),[t,j]=a.useState(ne(c||[],o)),[C,G]=a.useState(0),[de,W]=a.useState(!1),[O,I]=a.useState(E(o,g)),[m,D]=a.useState(""),R=je(m,ae);a.useImperativeHandle(oe,()=>({selectedValue:[...t],input:d.current,focus:()=>{var e;return(e=d==null?void 0:d.current)==null?void 0:e.focus()},reset:()=>j([])}),[t]);const k=e=>{F.current&&!F.current.contains(e.target)&&d.current&&!d.current.contains(e.target)&&(h(!1),d.current.blur())},L=a.useCallback(e=>{const l=t.filter(s=>s.value!==e.value);j(l),r==null||r(l.map(s=>s.value))},[r,t]),fe=a.useCallback(e=>{const l=d.current;l&&((e.key==="Delete"||e.key==="Backspace")&&l.value===""&&t.length>0&&(t[t.length-1].fixed||L(t[t.length-1])),e.key==="Escape"&&l.blur())},[L,t]);a.useEffect(()=>(w?(document.addEventListener("mousedown",k),document.addEventListener("touchend",k)):(document.removeEventListener("mousedown",k),document.removeEventListener("touchend",k)),()=>{document.removeEventListener("mousedown",k),document.removeEventListener("touchend",k)}),[w]),a.useEffect(()=>{c&&o.length>0&&j(ne(c,o))},[c,o]),a.useEffect(()=>{if(!M.current||t.length===0){G(t.length);return}if(m.length>0){G(1);return}const e=()=>{const s=M.current;if(!s)return;const b=Array.from(s.children);if(b.length===0)return;const _=s.offsetWidth,y=4;let x=0,P=0;const ve=60;for(let z=0;z<b.length;z++){const ge=b[z].offsetWidth;if(x+=ge+(z>0?y:0),x+ve>_)break;P++}G(Math.max(1,P))};e();const l=new ResizeObserver(e);return M.current&&l.observe(M.current),()=>{l.disconnect()}},[t,m]),a.useEffect(()=>{if(!v||f)return;const e=E(v||[],g);JSON.stringify(e)!==JSON.stringify(O)&&I(e)},[o,v,g,f,O]),a.useEffect(()=>{const e=()=>{const s=V==null?void 0:V(R);I(E(s||[],g))};(async()=>{!V||!w||(A&&e(),R&&e())})()},[R,g,w,A]),a.useEffect(()=>{const e=async()=>{Z(!0);const s=await(f==null?void 0:f(R)),b=E(s||[],g);I(b),Z(!1)};(async()=>{!f||!w||(A&&await e(),R&&await e())})()},[R,g,w,A]);const me=()=>{if(!q||ke(O,[{value:m,label:m}])||t.find(l=>l.value===m))return;const e=n.jsx(B,{value:m,className:"cursor-pointer",onMouseDown:l=>{l.preventDefault(),l.stopPropagation()},onSelect:l=>{if(t.length>=K){N==null||N(t.length);return}D(""),I(E(o,g)),h(!1);const s=[...t,{value:l,label:l}];j(s),r==null||r(s.map(b=>b.value))},children:`Create "${m}"`});if(!f&&m.length>0||f&&R.length>0&&!Y)return e},pe=a.useCallback(()=>f&&!q&&Object.keys(O).length===0?n.jsx("div",{className:"p-2 py-4 text-center text-sm",children:$("common.filters.no_values_found")}):n.jsx(be,{children:H||n.jsx("div",{className:"text-center text-sm",children:$("common.filters.no_values_found")})}),[q,H,f,O]),he=a.useCallback(()=>{if(i!=null&&i.filter)return i.filter;if(q)return(e,l)=>e.toLowerCase().includes(l.toLowerCase())?1:-1},[q,i==null?void 0:i.filter]);return n.jsxs(we,{...i,onKeyDown:e=>{var l;fe(e),(l=i==null?void 0:i.onKeyDown)==null||l.call(i,e)},className:T("h-auto overflow-visible bg-background",i==null?void 0:i.className),shouldFilter:(i==null?void 0:i.shouldFilter)!==void 0?i.shouldFilter:!f,filter:he(),children:[n.jsxs("div",{ref:F,className:T("flex min-h-9 shadow-xs rounded-md border border-input text-sm ring-offset-background focus-within:ring-1 focus-within:ring-ring",{"px-3 py-2":t.length!==0,"cursor-text":!S&&t.length!==0},re),onClick:()=>{var e;S||(e=d==null?void 0:d.current)==null||e.focus()},children:[n.jsxs("div",{ref:M,className:"relative flex flex-1 flex-wrap gap-1",children:[t.slice(0,C).map(e=>U?U({option:e,onRemove:()=>L(e)}):n.jsx(te,{"data-disabled":S||void 0,onClose:()=>L(e),children:e.badgeLabel||(typeof e.label=="string"?e.label:e.value)},e.value)),t.length>C&&n.jsxs(te,{className:"cursor-pointer",onClick:e=>{e.stopPropagation(),W(!0),h(!0)},children:["+",t.length-C]}),n.jsx(ye.Input,{...u,ref:d,value:m,disabled:S,onValueChange:e=>{var l;D(e),W(!1),J?!w&&e.length>0&&h(!0):h(e.length>0),(l=u==null?void 0:u.onValueChange)==null||l.call(u,e)},onBlur:e=>{var l;ce||(h(!1),W(!1)),(l=u==null?void 0:u.onBlur)==null||l.call(u,e)},onFocus:e=>{var l;(J||m.length>0)&&h(!0),(l=u==null?void 0:u.onFocus)==null||l.call(u,e)},placeholder:X&&t.length!==0?"":p,className:T("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":X,"px-3 py-2":t.length===0,"ml-1":t.length!==0},u==null?void 0:u.className)})]}),n.jsx("button",{type:"button",onClick:()=>{j(t.filter(e=>e.fixed)),r==null||r(t.filter(e=>e.fixed).map(e=>e.value))},className:T((ue||S||t.length<1||t.filter(e=>e.fixed).length===t.length)&&"hidden"),children:n.jsx(Oe,{size:18})})]}),n.jsx("div",{className:T("relative",w?"block":"hidden"),ref:F,children:n.jsx(xe,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in fade-in-0 zoom-in-95",onMouseLeave:()=>{Q(!1)},onMouseEnter:()=>{Q(!0)},children:Y?n.jsx("div",{className:"p-1",children:n.jsx(Re,{className:"h-8 w-full"})}):de?n.jsx(ee,{className:"h-full overflow-auto",children:t.slice(C).map(e=>n.jsxs(B,{value:e.value,onSelect:()=>{L(e),t.length-1<=C&&(W(!1),h(!1))},className:"cursor-pointer",children:[n.jsx("span",{className:"flex-1",children:e.label}),n.jsx(le,{className:"w-4"})]},e.value))}):n.jsxs(n.Fragment,{children:[pe(),me(),!ie&&n.jsx(B,{value:"-",className:"hidden"}),Object.entries(O).map(([e,l])=>n.jsx(ee,{heading:e,className:"h-full overflow-auto",children:n.jsx(n.Fragment,{children:l.map(s=>{var _;const b=(_=t.map(y=>y.value))==null?void 0:_.includes(s.value);return n.jsxs(B,{value:s.value,disabled:s.disable,onSelect:()=>{if(t.length>=K){N==null||N(t.length);return}D(""),I(E(o,g)),h(!1);let y=[];t.find(x=>x.value===s.value)?y=t.filter(x=>x.value!==s.value):y=[...t,s],j(y),r==null||r(y.map(x=>x.value))},className:T("cursor-pointer",s.disable&&"cursor-default text-muted-foreground"),children:[n.jsx("span",{className:"flex-1",children:s.label}),b?n.jsx(le,{className:"w-4"}):null]},s.value)})})},e))]})})})]})}se.displayName="MultipleSelector";se.__docgenInfo={description:"",methods:[{name:"focus",docblock:null,modifiers:[],params:[],returns:null},{name:"reset",docblock:null,modifiers:[],params:[],returns:null}],displayName:"MultipleSelector",props:{ref:{required:!1,tsType:{name:"union",raw:"React.RefCallback<MultipleSelectorRef> | React.RefObject<MultipleSelectorRef>",elements:[{name:"ReactRefCallback",raw:"React.RefCallback<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]},{name:"ReactRefObject",raw:"React.RefObject<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]}]},description:""},value:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},defaultOptions:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"",defaultValue:{value:"[]",computed:!1}},options:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"manually controlled options"},placeholder:{required:!1,tsType:{name:"string"},description:""},emptyIndicator:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"Empty component."},debounceDelay:{required:!1,tsType:{name:"number"},description:"Debounce time for async search. Only work with `onSearch`.",defaultValue:{value:"500",computed:!1}},triggerSearchOnFocus:{required:!1,tsType:{name:"boolean"},description:"Only work with `onSearch` prop. Trigger search when `onFocus`.\nFor example, when user click on the input, it will trigger the search to get initial options.",defaultValue:{value:"false",computed:!1}},onSearch:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => Promise<MultiSelectorOption[]>",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Promise",elements:[{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}],raw:"Promise<MultiSelectorOption[]>"}}},description:"async search"},onSearchSync:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => MultiSelectorOption[]",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}}},description:`sync search. This search will not showing loadingIndicator.
The rest props are the same as async search.
i.e.: creatable, groupBy, delay.`},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(options: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"options"}],return:{name:"void"}}},description:""},maxSelected:{required:!1,tsType:{name:"number"},description:"Limit the maximum number of selected options.",defaultValue:{value:"Number.MAX_SAFE_INTEGER",computed:!0}},onMaxSelected:{required:!1,tsType:{name:"signature",type:"function",raw:"(maxLimit: number) => void",signature:{arguments:[{type:{name:"number"},name:"maxLimit"}],return:{name:"void"}}},description:"When the number of selected options exceeds the limit, the onMaxSelected will be called."},hidePlaceholderWhenSelected:{required:!1,tsType:{name:"boolean"},description:"Hide the placeholder when there are options selected."},disabled:{required:!1,tsType:{name:"boolean"},description:""},groupBy:{required:!1,tsType:{name:"string"},description:"Group the options base on provided key."},className:{required:!1,tsType:{name:"string"},description:""},selectFirstItem:{required:!1,tsType:{name:"boolean"},description:`First item selected is a default behavior by cmdk. That is why the default is true.
This is a workaround solution by add a dummy item.

@reference: https://github.com/pacocoursey/cmdk/issues/171`,defaultValue:{value:"true",computed:!1}},creatable:{required:!1,tsType:{name:"boolean"},description:"Allow user to create option when there is no option matched.",defaultValue:{value:"false",computed:!1}},commandProps:{required:!1,tsType:{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof Command>",elements:[{name:"Command"}]},description:"Props of `Command`"},inputProps:{required:!1,tsType:{name:"Omit",elements:[{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>",elements:[{name:"CommandPrimitive.Input"}]},{name:"union",raw:"'value' | 'placeholder' | 'disabled'",elements:[{name:"literal",value:"'value'"},{name:"literal",value:"'placeholder'"},{name:"literal",value:"'disabled'"}]}],raw:`Omit<
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>,
  'value' | 'placeholder' | 'disabled'
>`},description:"Props of `CommandInput`"},hideClearAllButton:{required:!1,tsType:{name:"boolean"},description:"hide the clear all button.",defaultValue:{value:"false",computed:!1}},openOnFocus:{required:!1,tsType:{name:"boolean"},description:`Open dropdown on focus to show all available options.
When false, dropdown only opens when user starts typing.
@default false`,defaultValue:{value:"false",computed:!1}},renderBadge:{required:!1,tsType:{name:"signature",type:"function",raw:"(params: { option: MultiSelectorOption; onRemove: () => void }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ option: MultiSelectorOption; onRemove: () => void }",signature:{properties:[{key:"option",value:{name:"MultiSelectorOption",required:!0}},{key:"onRemove",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]}},name:"params"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"Render the badge for each option."}}};export{se as M};
