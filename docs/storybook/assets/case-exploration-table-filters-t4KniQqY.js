import{j as o}from"./jsx-runtime-D_zvdyIk.js";import{r as p}from"./index-CBYaBgW8.js";import{k as L,l as P}from"./data-table-CMd7xxiI.js";import{F as A}from"./filter-button-sRTjazzq.js";import{B as G}from"./button-O8T4L_tu.js";import{S}from"./skeleton-_T1otFf0.js";import{u as T}from"./i18n-BbKbA56i.js";import{g as K,C as U,a as X,b as B,c as J,d as W}from"./command-CqDCn1-N.js";import{X as V}from"./x-4HkHZ1eq.js";import{S as Q}from"./search-DKmUqS9g.js";import{T as Y}from"./test-tube-diagonal-Dy9u_yEx.js";import{c as O}from"./createLucideIcon-B119WVF5.js";import{U as Z}from"./user-3oWHM7_v.js";import{P as ee}from"./priority-indicator-BHQQLBKV.js";import{F as N,C as te,R as se,H as oe}from"./refresh-ccw-CVzmjQM2.js";import{C as ae}from"./check-DSe_yRo5.js";import{P as ne}from"./pen-BSZDi--G.js";/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],ie=O("Barcode",re);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],R=O("FolderOpen",le);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]],ue=O("ListFilter",ce);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pe=O("OctagonX",de);function me(e){return{case_id:R,patient_id:Z,submitter_patient_id:ie,sequencing_experiment_id:Y}[e.toLowerCase()]||R}async function fe(e,s,t){if(!e||e.length<s)return{};const a=await t(e,"10");return!(a!=null&&a.data)||a.data.length===0?{}:a.data.reduce((c,l)=>(c[l.type]||(c[l.type]=[]),c[l.type].push(l),c),{})}function E({onSelect:e,onClear:s,selectedValue:t,placeholder:a,minSearchLength:n=3,api:c}){const{t:l}=T(),[f,m]=p.useState(""),[u,g]=p.useState(""),[b,i]=p.useState(!1);p.useEffect(()=>{m(t||"")},[t]),p.useEffect(()=>{const d=setTimeout(()=>{g(f)},300);return()=>clearTimeout(d)},[f]);const{data:h}=L(u&&u.length>=n?u:null,d=>d?fe(d,n,c):Promise.resolve({}),{revalidateOnFocus:!1,dedupingInterval:300}),j=p.useCallback((d,_)=>{const x=_.trim();e(d,x),m(x),i(!1)},[e]),F=p.useCallback(()=>{m(""),s==null||s()},[s]),k=h&&Object.keys(h).length>0;return o.jsxs("div",{className:"flex flex-col",children:[o.jsx("label",{className:"text-sm font-medium text-foreground h-[14px] mb-2",children:l("case_exploration.filters_group.search_by_id")}),o.jsxs(K,{className:"relative h-8 w-[340px] overflow-visible",shouldFilter:!1,children:[o.jsx(U,{"data-cy":"table-filters-search-input",className:"px-1.5",variant:"search",placeholder:a,leftAddon:o.jsx(Q,{size:16}),rightAddon:f.length>0&&o.jsx(V,{onClick:F,size:16}),value:f,onValueChange:m,onFocus:()=>{i(!0)},onBlur:()=>setTimeout(()=>i(!1),100)}),b&&f.length>0&&o.jsxs(X,{className:"absolute max-h-[240px] left-0 top-full z-50 mt-1 w-full overflow-auto rounded-md border bg-background shadow-lg",onMouseDown:d=>d.preventDefault(),children:[!k&&o.jsx(B,{children:l("common.table.filters.no_values_found")}),k&&Object.keys(h||{}).map(d=>o.jsxs(o.Fragment,{children:[Object.keys(h||{}).indexOf(d)!==0&&o.jsx("hr",{className:"w-full h-px bg-border"}),o.jsx(J,{heading:o.jsx("span",{className:"h-[28px] &:not(:first-child)]:bg-border",children:l(`common.table.filters.search.${d}`,d.toUpperCase())}),children:((h==null?void 0:h[d])||[]).map(_=>{const x=me(_.type);return o.jsxs(W,{className:"h-[32px]",value:`${_.value}::${d}`,"data-cy":`table-filters-search-item-${_.value}::${d}`,onSelect:r=>{j(_.type,r.split("::")[0])},children:[o.jsx(x,{size:16,className:"text-muted-foreground"}),o.jsx("span",{children:_.value})]},_.value)})},d)]}))]})]})]})}E.__docgenInfo={description:"",methods:[],displayName:"TableFiltersSearch",props:{placeholder:{required:!1,tsType:{name:"string"},description:""},onSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: string, value: string) => void",signature:{arguments:[{type:{name:"string"},name:"type"},{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},selectedValue:{required:!1,tsType:{name:"string"},description:""},minSearchLength:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"3",computed:!1}},api:{required:!0,tsType:{name:"signature",type:"function",raw:`(
  prefix: string,
  limit?: string,
  options?: RawAxiosRequestConfig,
) => Promise<AxiosResponse<AutocompleteResult[]>>`,signature:{arguments:[{type:{name:"string"},name:"prefix"},{type:{name:"string"},name:"limit"},{type:{name:"RawAxiosRequestConfig"},name:"options"}],return:{name:"Promise",elements:[{name:"AxiosResponse",elements:[{name:"Array",elements:[{name:"AutocompleteResult"}],raw:"AutocompleteResult[]"}],raw:"AxiosResponse<AutocompleteResult[]>"}],raw:"Promise<AxiosResponse<AutocompleteResult[]>>"}}},description:""}}};function C(e){return e.sort((s,t)=>s.label.localeCompare(t.label))}function $(e,s){return(s||Object.keys(e)).sort((a,n)=>{var f,m;const c=((f=e[a])==null?void 0:f.weight)||999,l=((m=e[n])==null?void 0:m.weight)||999;return c-l})}function he(e){const s=Object.keys(e).filter(t=>e[t].visible);return $(e,s)}function ge(e,s){const t=[],a=Object.keys(s);for(const n in e)if(e[n].length!==0){if(a.includes(n)){t.push({field:s[n].key,value:e[n]});continue}t.push({field:n,value:e[n]})}return t}function M(e,s){const t={};for(const a in e)Object.keys(s).includes(a)&&(t[a]=e[a]);return t}function _e(e,s){for(const t in e)if(!Object.keys(s).includes(t)&&e[t].length>0)return e[t][0]}function ye({filterSearch:e,visibleFilters:s}){return o.jsxs("div",{className:"flex flex-col justify-start gap-2 min-w-[400px] h-[48px]",children:[o.jsx(S,{className:"w-[120px] h-[24px]"}),o.jsxs("div",{className:"flex gap-2 h-[32px]",children:[e&&o.jsx(S,{className:"w-[260px] h-full"}),Object.keys(s).map(t=>o.jsx(S,{className:"w-[100px] h-full"},t)),o.jsx(S,{className:"w-[75px] h-full"})]})]})}function D({loading:e=!1,openFilters:s,setOpenFilters:t,filters:a,setFilters:n,changedFilterButtons:c,setChangedFilterButtons:l,setSearchCriteria:f,filterButtons:m,filterSearch:u,criterias:g,defaultFilters:b}){const{t:i}=T(),h=p.useCallback((r,y)=>{n({...a,[r]:y})},[a,n]),j=p.useMemo(()=>m.filter(r=>!r.isVisible),[m]),F=m.some(r=>r.selectedItems.length>0)||c.length>0,k=()=>{n(b),l([]),t({})},d=p.useCallback(r=>{const y=[...c,...r.filter(v=>!c.includes(v))];l(y);const w=r.reduce((v,H)=>(v[H]=!0,v),{});t({...s,...w})},[]),_=p.useCallback((r,y)=>{n({...M(a,g),[r]:[y]})},[a,n]),x=p.useCallback(()=>{n(M(a,g))},[a,n]);return p.useEffect(()=>{f(ge(a,g))},[a,f]),e?o.jsx(ye,{filterSearch:u,visibleFilters:Object.keys(g).filter(r=>g[r].visible)}):o.jsxs("div",{id:"table-filters",className:"py-0 flex flex-2 flex-wrap gap-2 items-button",children:[u&&o.jsx(E,{onSelect:_,onClear:x,selectedValue:_e(a,g),placeholder:u.placeholder,minSearchLength:u.minSearchLength,api:u.api}),o.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[m.filter(r=>r.isVisible).sort((r,y)=>{const w=Math.max(...Object.keys(g).map(v=>g[v].weight??-1));return(g[r.key].weight??w+c.indexOf(r.key))-(g[y.key].weight??w+c.indexOf(y.key))}).map(r=>o.jsx(A,{popoverSize:r.popoverSize,label:r.label,options:r.options,selected:r.selectedItems,onSelect:y=>h(r.key,y),isOpen:r.isOpen,withTooltip:r.withTooltip},r.key)),j.length>0&&o.jsx(A,{label:i("common.filters.more","More"),options:j,selected:c,onSelect:d,actionMode:!0,icon:o.jsx(ue,{size:16}),placeholder:i("common.table.filters.more_placeholder","Filters"),closeOnSelect:!0}),F&&o.jsxs(G,{variant:"link",onClick:k,className:"text-sm py-2 px-3 h-8",children:[o.jsx(V,{size:14}),i("common.actions.clear","Clear")]})]})]})}D.__docgenInfo={description:`Controlled component

His parent component must manage all different filter states, useState`,methods:[],displayName:"DataTableFilters",props:{loading:{defaultValue:{value:"false",computed:!1},required:!1}}};const z=["routine","urgent","asap","stat"];function be(e){return e.sort((t,a)=>{var l,f;const n=z.indexOf(((l=t.key)==null?void 0:l.toLowerCase())||""),c=z.indexOf(((f=a.key)==null?void 0:f.toLowerCase())||"");return n!==-1&&c!==-1?n-c:n!==-1?-1:c!==-1?1:0}).map(t=>({...t,label:o.jsx(ee,{size:"sm",code:t.key})}))}const xe="case_exploration.status";function ve(e){return{draft:ne,submitted:oe,in_progress:se,completed:ae,incomplete:te,revoke:pe,unknown:N}[e.toLowerCase()]||N}function je(e,s){return e.map(t=>({...t,label:s(`${xe}.${t.key}`,t.label||""),icon:ve(t.key||"")}))}function ke(e,s){const[t,a]=p.useState(()=>{if(typeof window>"u")return s;try{const n=localStorage.getItem(e);return n?JSON.parse(n):s}catch{return s}});return p.useEffect(()=>{try{localStorage.setItem(e,JSON.stringify(t))}catch{}},[e,t]),[t,a]}const I={priority_code:{key:"priority_code",weight:1,visible:!0},status_code:{key:"status_code",weight:2,visible:!0},case_type_code:{key:"case_type_code",weight:3,visible:!0},project_code:{key:"project_code",visible:!1},analysis_catalog_code:{key:"analysis_catalog_code",visible:!1},diagnosis_lab_code:{key:"diagnosis_lab_code",visible:!1},ordering_organization_code:{key:"ordering_organization_code",visible:!1},panel_code:{key:"panel_code",visible:!1},resolution_status_code:{key:"resolution_status_code",visible:!1},life_status_code:{key:"proband_life_status_code",visible:!1},case_category_code:{key:"case_category_code",visible:!1}},q={priority_code:[],status_code:[],case_type_code:[],project_code:[],analysis_catalog_code:[],diagnosis_lab_code:[],ordering_organization_code:[],panel_code:[],resolution_status_code:[],life_status_code:[],case_category_code:[]};async function we(e){return(await P.casesFilters(e)).data}function Se({loading:e=!0,setSearchCriteria:s}){const[t,a]=p.useState([]),[n,c]=p.useState({}),[l,f]=ke("case-exploration-filters",{...q}),{t:m}=T(),{data:u}=L("case-filters",()=>we({search_criteria:[]}),{revalidateOnFocus:!1,revalidateOnMount:!0,revalidateIfStale:!1,revalidateOnReconnect:!1}),g=p.useMemo(()=>u?$(I).filter(i=>i in u).map(i=>{const h={key:i,label:m(`case_exploration.case.filters.${i}`),isVisible:he(I).includes(i),isOpen:n[i]||!1,selectedItems:l[i]||[],options:[]};switch(i){case"priority_code":return{...h,options:be(u[i]||[])};case"status_code":return{...h,options:C(je(u[i]||[],m))};case"case_type_code":return{...h,options:C(u[i]||[])};case"project_code":case"analysis_catalog_code":case"diagnosis_lab_code":case"ordering_organization_code":case"panel_code":return{...h,popoverSize:"lg",isVisible:l[i]&&l[i].length>0||t.includes(i)||!1,options:C(u[i]||[]),withTooltip:!0};case"life_status_code":case"case_category_code":case"resolution_status_code":return{...h,isVisible:l[i]&&l[i].length>0||t.includes(i)||!1,options:C(u[i]||[])};default:return h}}):[],[u,l,t,n,m]);return o.jsx(D,{filterSearch:{placeholder:m("case_exploration.filters_group.search_placeholder"),minSearchLength:1,api:b=>P.autocompleteCases(b,"10")},filterButtons:g,changedFilterButtons:t,setChangedFilterButtons:a,filters:l,setFilters:f,openFilters:n,setOpenFilters:c,loading:e,setSearchCriteria:s,criterias:I,defaultFilters:q})}Se.__docgenInfo={description:"",methods:[],displayName:"FiltersGroupForm",props:{loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},setSearchCriteria:{required:!0,tsType:{name:"signature",type:"function",raw:"(searchCriteria: SearchCriterion[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"SearchCriterion"}],raw:"SearchCriterion[]"},name:"searchCriteria"}],return:{name:"void"}}},description:""}}};export{Se as F};
