import{j as n}from"./jsx-runtime-D_zvdyIk.js";import{r}from"./index-CBYaBgW8.js";import{b as ge,g as be,_ as we,a as ye,c as P,d as B}from"./command-CqDCn1-N.js";import{B as ee}from"./badge-B8JYzoyf.js";import{S as xe}from"./skeleton-_T1otFf0.js";import{u as Re}from"./i18n-D8mtTGJ2.js";import{u as Ne}from"./useDebounce-CEPqGWFj.js";import{c as T}from"./utils-CDN07tui.js";import{X as je}from"./x-4HkHZ1eq.js";import{C as te}from"./check-DSe_yRo5.js";function E(c,a){if(c.length===0)return{};if(!a)return{"":c};const h={};return c.forEach(o=>{const p=o[a]||"";h[p]||(h[p]=[]),h[p].push(o)}),h}function le(c,a){return a.filter(h=>c.includes(h.value))}function Oe(c,a){for(const[,h]of Object.entries(c))if(h.some(o=>a.find(p=>p.value===o.value)))return!0;return!1}function ne({value:c,onChange:a,placeholder:h,defaultOptions:o=[],options:p,debounceDelay:se=500,onSearch:f,onSearchSync:V,emptyIndicator:H,maxSelected:K=Number.MAX_SAFE_INTEGER,onMaxSelected:N,hidePlaceholderWhenSelected:X,disabled:S,groupBy:v,className:re,selectFirstItem:ae=!0,creatable:q=!1,triggerSearchOnFocus:A=!1,commandProps:i,inputProps:u,hideClearAllButton:ie=!1,renderBadge:J,ref:ue}){const{t:U}=Re(),d=r.useRef(null),M=r.useRef(null),[x,b]=r.useState(!1),[oe,$]=r.useState(!1),[Q,Y]=r.useState(!1),F=r.useRef(null),[t,j]=r.useState(le(c||[],o)),[C,G]=r.useState(0),[ce,_]=r.useState(!1),[O,I]=r.useState(E(o,v)),[m,D]=r.useState(""),R=Ne(m,se);r.useImperativeHandle(ue,()=>({selectedValue:[...t],input:d.current,focus:()=>{var e;return(e=d==null?void 0:d.current)==null?void 0:e.focus()},reset:()=>j([])}),[t]);const k=e=>{F.current&&!F.current.contains(e.target)&&d.current&&!d.current.contains(e.target)&&(b(!1),d.current.blur())},L=r.useCallback(e=>{const l=t.filter(s=>s.value!==e.value);j(l),a==null||a(l.map(s=>s.value))},[a,t]),de=r.useCallback(e=>{const l=d.current;l&&((e.key==="Delete"||e.key==="Backspace")&&l.value===""&&t.length>0&&(t[t.length-1].fixed||L(t[t.length-1])),e.key==="Escape"&&l.blur())},[L,t]);r.useEffect(()=>(x?(document.addEventListener("mousedown",k),document.addEventListener("touchend",k)):(document.removeEventListener("mousedown",k),document.removeEventListener("touchend",k)),()=>{document.removeEventListener("mousedown",k),document.removeEventListener("touchend",k)}),[x]),r.useEffect(()=>{c&&o.length>0&&j(le(c,o))},[c,o]),r.useEffect(()=>{if(!M.current||t.length===0){G(t.length);return}if(m.length>0){G(1);return}const e=()=>{const s=M.current;if(!s)return;const g=Array.from(s.children);if(g.length===0)return;const W=s.offsetWidth,w=4;let y=0,Z=0;const pe=60;for(let z=0;z<g.length;z++){const ve=g[z].offsetWidth;if(y+=ve+(z>0?w:0),y+pe>W)break;Z++}G(Math.max(1,Z))};e();const l=new ResizeObserver(e);return M.current&&l.observe(M.current),()=>{l.disconnect()}},[t,m]),r.useEffect(()=>{if(!p||f)return;const e=E(p||[],v);JSON.stringify(e)!==JSON.stringify(O)&&I(e)},[o,p,v,f,O]),r.useEffect(()=>{const e=()=>{const s=V==null?void 0:V(R);I(E(s||[],v))};(async()=>{!V||!x||(A&&e(),R&&e())})()},[R,v,x,A]),r.useEffect(()=>{const e=async()=>{Y(!0);const s=await(f==null?void 0:f(R)),g=E(s||[],v);I(g),Y(!1)};(async()=>{!f||!x||(A&&await e(),R&&await e())})()},[R,v,x,A]);const fe=()=>{if(!q||Oe(O,[{value:m,label:m}])||t.find(l=>l.value===m))return;const e=n.jsx(B,{value:m,className:"cursor-pointer",onMouseDown:l=>{l.preventDefault(),l.stopPropagation()},onSelect:l=>{if(t.length>=K){N==null||N(t.length);return}D(""),I(E(o,v)),b(!1);const s=[...t,{value:l,label:l}];j(s),a==null||a(s.map(g=>g.value))},children:`Create "${m}"`});if(!f&&m.length>0||f&&R.length>0&&!Q)return e},me=r.useCallback(()=>f&&!q&&Object.keys(O).length===0?n.jsx("div",{className:"p-2 py-4 text-center text-sm",children:U("common.filters.no_values_found")}):n.jsx(ge,{children:H||n.jsx("div",{className:"text-center text-sm",children:U("common.filters.no_values_found")})}),[q,H,f,O]),he=r.useCallback(()=>{if(i!=null&&i.filter)return i.filter;if(q)return(e,l)=>e.toLowerCase().includes(l.toLowerCase())?1:-1},[q,i==null?void 0:i.filter]);return n.jsxs(be,{...i,onKeyDown:e=>{var l;de(e),(l=i==null?void 0:i.onKeyDown)==null||l.call(i,e)},className:T("h-auto overflow-visible bg-background",i==null?void 0:i.className),shouldFilter:(i==null?void 0:i.shouldFilter)!==void 0?i.shouldFilter:!f,filter:he(),children:[n.jsxs("div",{ref:F,className:T("flex min-h-9 shadow-xs rounded-md border border-input text-sm ring-offset-background focus-within:ring-1 focus-within:ring-ring",{"px-3 py-2":t.length!==0,"cursor-text":!S&&t.length!==0},re),onClick:()=>{var e;S||(e=d==null?void 0:d.current)==null||e.focus()},children:[n.jsxs("div",{ref:M,className:"relative flex flex-1 flex-wrap gap-1",children:[t.slice(0,C).map(e=>J?J({option:e,onRemove:()=>L(e)}):n.jsx(ee,{"data-disabled":S||void 0,onClose:()=>L(e),children:e.badgeLabel||(typeof e.label=="string"?e.label:e.value)},e.value)),t.length>C&&n.jsxs(ee,{className:"cursor-pointer",onClick:e=>{e.stopPropagation(),_(!0),b(!0)},children:["+",t.length-C]}),n.jsx(we.Input,{...u,ref:d,value:m,disabled:S,onValueChange:e=>{var l;D(e),_(!1),b(e.length>0),(l=u==null?void 0:u.onValueChange)==null||l.call(u,e)},onBlur:e=>{var l;oe||(b(!1),_(!1)),(l=u==null?void 0:u.onBlur)==null||l.call(u,e)},onFocus:e=>{var l;m.length>0&&b(!0),(l=u==null?void 0:u.onFocus)==null||l.call(u,e)},placeholder:X&&t.length!==0?"":h,className:T("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":X,"px-3 py-2":t.length===0,"ml-1":t.length!==0},u==null?void 0:u.className)})]}),n.jsx("button",{type:"button",onClick:()=>{j(t.filter(e=>e.fixed)),a==null||a(t.filter(e=>e.fixed).map(e=>e.value))},className:T((ie||S||t.length<1||t.filter(e=>e.fixed).length===t.length)&&"hidden"),children:n.jsx(je,{size:18})})]}),n.jsx("div",{className:T("relative",x?"block":"hidden"),ref:F,children:n.jsx(ye,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in fade-in-0 zoom-in-95",onMouseLeave:()=>{$(!1)},onMouseEnter:()=>{$(!0)},children:Q?n.jsx("div",{className:"p-1",children:n.jsx(xe,{className:"h-8 w-full"})}):ce?n.jsx(P,{className:"h-full overflow-auto",children:t.slice(C).map(e=>n.jsxs(B,{value:e.value,onSelect:()=>{L(e),t.length-1<=C&&(_(!1),b(!1))},className:"cursor-pointer",children:[n.jsx("span",{className:"flex-1",children:e.label}),n.jsx(te,{className:"w-4"})]},e.value))}):n.jsxs(n.Fragment,{children:[me(),fe(),!ae&&n.jsx(B,{value:"-",className:"hidden"}),Object.entries(O).map(([e,l])=>n.jsx(P,{heading:e,className:"h-full overflow-auto",children:n.jsx(n.Fragment,{children:l.map(s=>{var W;const g=(W=t.map(w=>w.value))==null?void 0:W.includes(s.value);return n.jsxs(B,{value:s.value,disabled:s.disable,onSelect:()=>{if(t.length>=K){N==null||N(t.length);return}D(""),I(E(o,v)),b(!1);let w=[];t.find(y=>y.value===s.value)?w=t.filter(y=>y.value!==s.value):w=[...t,s],j(w),a==null||a(w.map(y=>y.value))},className:T("cursor-pointer",s.disable&&"cursor-default text-muted-foreground"),children:[n.jsx("span",{className:"flex-1",children:s.label}),g?n.jsx(te,{className:"w-4"}):null]},s.value)})})},e))]})})})]})}ne.displayName="MultipleSelector";ne.__docgenInfo={description:"",methods:[{name:"focus",docblock:null,modifiers:[],params:[],returns:null},{name:"reset",docblock:null,modifiers:[],params:[],returns:null}],displayName:"MultipleSelector",props:{ref:{required:!1,tsType:{name:"union",raw:"React.RefCallback<MultipleSelectorRef> | React.RefObject<MultipleSelectorRef>",elements:[{name:"ReactRefCallback",raw:"React.RefCallback<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]},{name:"ReactRefObject",raw:"React.RefObject<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]}]},description:""},value:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},defaultOptions:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"",defaultValue:{value:"[]",computed:!1}},options:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"manually controlled options"},placeholder:{required:!1,tsType:{name:"string"},description:""},emptyIndicator:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"Empty component."},debounceDelay:{required:!1,tsType:{name:"number"},description:"Debounce time for async search. Only work with `onSearch`.",defaultValue:{value:"500",computed:!1}},triggerSearchOnFocus:{required:!1,tsType:{name:"boolean"},description:"Only work with `onSearch` prop. Trigger search when `onFocus`.\nFor example, when user click on the input, it will trigger the search to get initial options.",defaultValue:{value:"false",computed:!1}},onSearch:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => Promise<MultiSelectorOption[]>",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Promise",elements:[{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}],raw:"Promise<MultiSelectorOption[]>"}}},description:"async search"},onSearchSync:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => MultiSelectorOption[]",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}}},description:`sync search. This search will not showing loadingIndicator.
The rest props are the same as async search.
i.e.: creatable, groupBy, delay.`},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(options: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"options"}],return:{name:"void"}}},description:""},maxSelected:{required:!1,tsType:{name:"number"},description:"Limit the maximum number of selected options.",defaultValue:{value:"Number.MAX_SAFE_INTEGER",computed:!0}},onMaxSelected:{required:!1,tsType:{name:"signature",type:"function",raw:"(maxLimit: number) => void",signature:{arguments:[{type:{name:"number"},name:"maxLimit"}],return:{name:"void"}}},description:"When the number of selected options exceeds the limit, the onMaxSelected will be called."},hidePlaceholderWhenSelected:{required:!1,tsType:{name:"boolean"},description:"Hide the placeholder when there are options selected."},disabled:{required:!1,tsType:{name:"boolean"},description:""},groupBy:{required:!1,tsType:{name:"string"},description:"Group the options base on provided key."},className:{required:!1,tsType:{name:"string"},description:""},selectFirstItem:{required:!1,tsType:{name:"boolean"},description:`First item selected is a default behavior by cmdk. That is why the default is true.
This is a workaround solution by add a dummy item.

@reference: https://github.com/pacocoursey/cmdk/issues/171`,defaultValue:{value:"true",computed:!1}},creatable:{required:!1,tsType:{name:"boolean"},description:"Allow user to create option when there is no option matched.",defaultValue:{value:"false",computed:!1}},commandProps:{required:!1,tsType:{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof Command>",elements:[{name:"Command"}]},description:"Props of `Command`"},inputProps:{required:!1,tsType:{name:"Omit",elements:[{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>",elements:[{name:"CommandPrimitive.Input"}]},{name:"union",raw:"'value' | 'placeholder' | 'disabled'",elements:[{name:"literal",value:"'value'"},{name:"literal",value:"'placeholder'"},{name:"literal",value:"'disabled'"}]}],raw:`Omit<
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>,
  'value' | 'placeholder' | 'disabled'
>`},description:"Props of `CommandInput`"},hideClearAllButton:{required:!1,tsType:{name:"boolean"},description:"hide the clear all button.",defaultValue:{value:"false",computed:!1}},renderBadge:{required:!1,tsType:{name:"signature",type:"function",raw:"(params: { option: MultiSelectorOption; onRemove: () => void }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ option: MultiSelectorOption; onRemove: () => void }",signature:{properties:[{key:"option",value:{name:"MultiSelectorOption",required:!0}},{key:"onRemove",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]}},name:"params"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"Render the badge for each option."}}};export{ne as M};
