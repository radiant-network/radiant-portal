import{r as i,j as e,b as de,d as ue,f as pn,e as pe,K as B,a6 as mn,c as X}from"./iframe-DQ1t6oJB.js";import{S as j,a as He}from"./api-BYcQ-ONY.js";import{H as $,h as O}from"./index-B2ZPreKl.js";import{B as hn,U as fn,O as yn,F as xn,P as gn,G as bn,V as vt,D as vn}from"./variant-icon-BhGHmUdk.js";import{B as T,a as jn}from"./button-IY8sM8Om.js";import{a as kn,S as jt,c as kt,d as _t,e as Nt,f as _n,g as Nn,m as It}from"./sidebar-CFYK4NPr.js";import{u as M}from"./i18n-CxZaJApP.js";import{P as In,a as An}from"./panel-left-open-PtvnWloS.js";import{T as Sn,f as Cn,p as Xe,U as Tn}from"./upload-id-modal-TXUoiY1d.js";import{L as me}from"./label-C6tcOezt.js";import{R as On,a as wn}from"./radio-group-D9onPQUQ.js";import{v as H,q as Ie,D as En}from"./query-builder-remote-B2lKQbLw.js";import{A as Q,F as b,u as Ln,C as qn}from"./applications-config-CSk71pEA.js";import{F as Mn}from"./isEqual-DfIZcfAd.js";import{A as Rn}from"./action-button-mMydjjE-.js";import{C as Bn}from"./checkbox-filter-B9gIaLnx.js";import{d as Se,e as At,C as he,a as Fn}from"./card-BbwE_m0r.js";import{I as le}from"./input-B7CYTio9.js";import{S as St}from"./separator-DgpYhT7H.js";import{S as L}from"./skeleton-Ca82QW3n.js";import{S as Dn}from"./switch-DTc4QM8d.js";import{t as Qn,n as Vn}from"./number-format-BokkmQVL.js";import{S as Pn}from"./search-BumnZBLC.js";import{a as Ct,c as Tt,b as Ot,E as wt,L as Et,G as Lt}from"./less-than-or-equal-operator-icon-D8-glmoQ.js";import{C as qt}from"./checkbox-C4ZvKrpl.js";import{d as Ke,S as Ye,a as We,b as Je,c as Ze}from"./select-KPYJ3CSv.js";import{A as Mt,a as Rt,b as Bt,c as Ft}from"./accordion-CW7NFGzv.js";import{M as Un}from"./multi-selector-Cv4rFI2j.js";import{g as et,u as z,o as fe,k as $n,D as zn}from"./data-table-D-r_M84U.js";import{_ as Z,a as ee}from"./helper-CrqNd9tO.js";import{P as Dt,a as Qt,b as Vt,c as tt}from"./popover-C75z6Xu5.js";import{S as Gn}from"./spinner-PcSbBgHg.js";import{X as Pt}from"./x-ChjgsgCE.js";import{N as Hn}from"./not-in-operator-icon-BwosWjf2.js";import{t as Xn}from"./take-BbsdxJ4f.js";import{C as Kn}from"./chevron-left-kABg5Jo1.js";import{C as Yn}from"./chevron-right-Rk3dNRac.js";import{T as Wn}from"./trash-C-o5lVGw.js";import{R as D}from"./sqon-COfEEhMd.js";import{o as Ce,h as Te,a as Oe,b as we,d as Jn}from"./api-occurrence-C0A67pa3.js";import{a as Ee,m as Le,b as qe}from"./table-mock-CKWcmSes.js";import{M as Zn,R as es,a as ts}from"./chunk-EPOLDU6W-5guO-eFT.js";import"./preload-helper-Dp1pzeXC.js";import"./index-BxNbdRnE.js";import"./check-DG46Gk0p.js";import"./index-CjHr8yZ0.js";import"./sheet-Bgpob1Fa.js";import"./dialog-CaY_SWYH.js";import"./circle-B0Wia5FS.js";import"./index-aG_8ZNxP.js";import"./useDebounce-BfimMQq9.js";import"./collapsible-card-DksWVL7X.js";import"./index-Cu-SsyMM.js";import"./collapsible-CaqVOjzT.js";import"./chevron-up-C-N1hrSZ.js";import"./chevron-down-KSMdbpBM.js";import"./display-table-DP8yTh7z.js";import"./empty-B4T_yAD6.js";import"./hover-card-CeS2AOg8.js";import"./index-ZdyPDFnT.js";import"./dropdown-menu---oLv9GO.js";import"./command-BpJjTVrB.js";import"./badge-jNZs0a3S.js";import"./settings-v0pHDEVD.js";import"./pagination-qXBitUoP.js";import"./ellipsis-B44jWlWF.js";import"./index-Dgjmjfsk.js";import"./chunk-WWGJGFF6-oy27kPmq.js";import"./_baseSlice-DkFNCYmM.js";import"./toString-5kpcHRjc.js";import"./empty-cell-BdebX_cG.js";const ns={organization:vn,variant:vt,gene:bn,pathogenicity:gn,frequency:xn,occurrence:yn,parental_analysis:fn,metric_qc:hn},nt=pn({base:"text-secondary dark:text-foreground",variants:{selected:{true:"bg-sidebar-brand-accent text-sidebar-brand-accent-foreground"}},defaultVariants:{selected:!1}});function Ut({onItemSelect:t,aggregationGroups:s,selectedItemId:n}){const{t:r}=M(),{open:a,toggleSidebar:l}=kn(),[o,u]=i.useState(null),c=n!==void 0?n:o,y=d=>{const m=c===d?null:d;u(m),t&&t(m)};return e.jsx(jt,{variant:"sidebar",collapsible:"icon",className:"static! flex flex-col w-full bg-primary dark:bg-secondary ",children:e.jsx(kt,{children:e.jsxs(_t,{children:[e.jsxs(de,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(T,{iconOnly:!0,onClick:()=>l(),className:nt({className:"mb-1 hover:bg-sidebar-brand-accent hover:text-sidebar-brand-accent-foreground"}),size:"sm",variant:"ghost",children:a?e.jsx(In,{}):e.jsx(An,{})})}),e.jsx(pe,{side:"right",align:"center",children:r(a?"query_filters.sidebar_panel.collapse":"query_filters.sidebar_panel.expand")})]}),e.jsx(Nt,{children:Object.entries(s).map(([d])=>{const m=ns[d],k=r(`query_filters.sidebar_panel.filters.${d}`);return e.jsx(_n,{children:e.jsx(Nn,{asChild:!0,className:nt({selected:c===d}),onClick:g=>{g.preventDefault(),y(d)},tooltip:k,children:e.jsxs("div",{children:[e.jsx(m,{}),e.jsx("span",{children:k})]})})},d)})})]})})})}Ut.__docgenInfo={description:"",methods:[],displayName:"SidebarGroups",props:{onItemSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(itemId: string | null) => void",signature:{arguments:[{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"itemId"}],return:{name:"void"}}},description:""},selectedItemId:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregationGroups:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};const q={GreaterThan:j.GreaterThan,LessThan:j.LessThan,Between:j.Between,GreaterThanOrEqualTo:j.GreaterThanOrEqualTo,LessThanOrEqualTo:j.LessThanOrEqualTo,In:j.In},_e={In:j.In,NotIn:j.NotIn},U={And:j.And,Or:j.Or};function st(t,s){if(typeof t=="object"&&t!==null&&"content"in t){const n=t.content;if("field"in n)return n.field===s}return!1}function ss(){return{content:[],id:H(),op:U.And}}function rt(t){return t.content.length===0}var V=(t=>(t.REMOVE_QUERY="remove-query",t.SET_ACTIVE_QUERY="set-active-query",t.ADD_MULTISELECT_VALUE="update-active-query",t.REMOVE_MULTISELECT_PILL="remove-multiselect-pill",t.CHANGE_COMBINER_OPERATOR="change-combiner-operator",t))(V||{});function Ae(){const t=H();return{aggregations:{},activeQueryId:t,sqons:[{content:[],id:t,op:U.And}],fetcher:{list:s=>(console.error(`fetcher.list has not been set: ${s}`),Promise.resolve([])),count:s=>(console.error(`fetcher.count has not been set: ${s}`),Promise.resolve({count:0}))},history:{type:"empty",target:"",uuid:t}}}const Me=i.createContext(Ae()),$t=i.createContext(()=>{console.warn("QueryBuilderDispatchContext has been initialized without any dispatch props")});function rs(t,s){switch(s.type){case"set-active-query":return{...t,activeQueryId:s.payload};case"remove-query":{const{activeQueryId:n}=t,{sqons:r}=t,a=r.findIndex(l=>l.id===s.payload.id);return r.splice(a,1),{...t,sqons:[{content:[],op:U.And,id:n}]}}case"update-active-query":{const{activeQueryId:n}=t,{sqons:r}=t,a=r.findIndex(u=>u.id===n);if(a<0)return r.push({id:n,content:[s.payload],op:U.And}),{...t,sqons:[...r],history:s.payload.content.field};const l=s.payload.content.field,o=r[a].content.findIndex(u=>st(u,l));return o<0?(r[a].content=[...r[a].content,s.payload],{...t,sqons:[...r],history:{uuid:H(),type:"add",target:l}}):s.payload.content.value.length>0?(r[a].content[o]=s.payload,{...t,sqons:[...r],history:{uuid:H(),type:"update",target:l}}):(r[a].content.splice(o,1),{...t,sqons:[...r],history:{uuid:H(),type:"update",target:l}})}case"remove-multiselect-pill":{const{activeQueryId:n}=t,{sqons:r}=t,a=r.findIndex(u=>u.id===n);if(a<0)throw Error(`Cannot remove pill from an undefined active query: ${s.type} ${n} ${s.payload}`);const l=s.payload.content.field,o=r[a].content.findIndex(u=>st(u,l));return r[a].content.splice(o,1),{...t,sqons:[...r],history:{uuid:H(),type:"remove",target:l}}}case"change-combiner-operator":{const{activeQueryId:n}=t,{sqons:r}=t,a=r.findIndex(l=>l.id===n);if(a<0)throw Error(`ActiveQueryId does not exist in sqons: ${s.type} ${n} ${s.payload}`);return r[a].op=s.payload.operator,{...t}}default:throw Error(`Unknown action: ${s.type} ${JSON.stringify(s.payload)}`)}}function zt({children:t,...s}){const[n,r]=i.useReducer(rs,s);return e.jsx(Me,{value:n,children:e.jsx($t,{value:r,children:t})})}function K(){return i.useContext(Me)}function Y(){return i.useContext($t)}function te(){const{activeQueryId:t,sqons:s}=K();return s.find(n=>n.id===t)??ss()}function ye(){const t=te();return{content:t.content,op:t.op}}function as(){const{history:t}=K();return t}function os(t){const s=te();if(s.content.length===0)return[];const n=s.content.findIndex(r=>typeof r=="object"&&r!==null&&"content"in r&&"field"in r.content&&r.content.field===t);return s.content[n]?s.content[n].content.value:[]}zt.__docgenInfo={description:"",methods:[],displayName:"QBProvider",props:{aggregations:{required:!0,tsType:{name:"AggregationConfig"},description:""},sqons:{required:!0,tsType:{name:"Array",elements:[{name:"ISyntheticSqon"}],raw:"ISyntheticSqon[]"},description:""},activeQueryId:{required:!0,tsType:{name:"string"},description:""},fetcher:{required:!0,tsType:{name:"IQBFetcher"},description:""},history:{required:!0,tsType:{name:"IHistory"},description:""},children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""}}};const Re=i.createContext({appId:Q.snv_occurrence,builderFetcher:t=>{},statisticFetcher:t=>{}});function J(){const t=i.useContext(Re);if(!t)throw new Error("useFilterConfig must be used within a FilterConfigProvider");return t}function is(){const{appId:t}=i.useContext(Re);return`temp-filters-${t}`}function Be({data:t,field:s}){const{t:n}=M(),{builderFetcher:r}=J(),a=Y(),{data:l}=r({field:s.key,size:30}),[o,u]=i.useState(t||l||[]),[c,y]=i.useState(null);i.useEffect(()=>{u(t||l||[])},[t,l]),i.useEffect(()=>{y(null)},[s.key]);const d=i.useCallback(g=>{g.key!==c&&g.key!==void 0&&(y(g.key||null),a({type:V.ADD_MULTISELECT_VALUE,payload:{field:s.key,value:[...g.key]}}))},[c]),m=i.useCallback(g=>c===g.key,[c]),k=i.useCallback(()=>{y(null)},[c]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[e.jsx(On,{children:o.map(g=>e.jsx("div",{className:"space-y-3 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(wn,{value:g.key||"",id:g.key,checked:m(g),onClick:()=>{d(g)}}),e.jsx(me,{htmlFor:g.key,children:g.key})]}),e.jsx("span",{className:"bg-accent px-2 py-1 rounded-md font-mono text-xs",children:g.count})]})},g.key))}),c!==null&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-4 border-border"}),e.jsx("div",{className:"flex align-right justify-end items-center space-x-2",children:e.jsx(T,{onClick:k,size:"xs",children:n("common.filters.buttons.clear")})})]})]})}Be.__docgenInfo={description:"",methods:[],displayName:"BooleanFacet",props:{data:{required:!1,tsType:{name:"Array",elements:[{name:"Aggregation"}],raw:"Aggregation[]"},description:""},field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function ls(t,s){const n=t.toLowerCase().split(/\s+/).filter(Boolean);return s.filter(r=>{const a=r.key.toLowerCase(),l=r.label.toLowerCase();function o(u,c){let y=0;for(const d of c){const m=u.indexOf(d,y);if(m===-1)return!1;y=m+d.length}return!0}return o(a,n)||o(l,n)})}function Ne(t,s){return s<t?s:t}function cs(t){return(s,n)=>{const r=s.key&&t.includes(s.key),a=n.key&&t.includes(n.key);return r===a?n.count-s.count:r?-1:1}}function Fe({field:t,maxVisibleItems:s=5}){const{t:n,sanitize:r,lazyTranslate:a}=M(),{appId:l,builderFetcher:o}=J(),u=Y(),[c,y]=i.useState(!1),{data:d,isLoading:m}=o({field:t.key,withDictionary:c}),k=as(),g=os(t.key),_=i.useMemo(()=>(d??[]).map(S=>({...S,label:n(`common.filters.values.${S.key}.${r(S.key)}`,{defaultValue:a(S.key)})})).sort(cs(g)),[d,g]),[h,p]=i.useState(_),[f,A]=i.useState(g),[w,C]=i.useState(Ne((d??[]).length,s)),E=i.useCallback(N=>{if(!N.trim()){p(d),C(Ne(d.length,s));return}const S=ls(N,d);p(S),s>S.length?C(S.length):S.length>s&&C(s)},[s,d]),P=i.useCallback(()=>{C(h.length)},[h]),G=i.useCallback(()=>{C(s)},[s]),R=i.useCallback(()=>{f.length!==h.length&&A(h.map(N=>N.key))},[h,f]),v=i.useCallback(()=>{A([])},[t.key]),ve=i.useCallback(()=>{f.length!==0&&v()},[f,v]),se=N=>{if(f.includes(N.key??"")){A(f.filter(S=>S!==N.key));return}A([...f,N.key])},W=i.useCallback(()=>{v()},[v]),F=i.useCallback(N=>{u({type:V.ADD_MULTISELECT_VALUE,payload:{content:{field:t.key,value:[...f]},op:N}})},[f,l,t.key]),re=i.useCallback(()=>{F(_e.In)},[F]),je=i.useCallback(()=>{F(_e.NotIn)},[F]),ke=i.useCallback(()=>{F(_e.In)},[F]);return i.useEffect(()=>{m||(p(_),C(Ne((d??[]).length,s)))},[m,d]),i.useEffect(()=>{k.target==t.key&&(Mn(g,f)||A(g))},[k.uuid]),e.jsxs(e.Fragment,{children:[e.jsxs(Se,{size:"sm",variant:"outline",children:[e.jsx(le,{startIcon:Pn,size:"xs",type:"text",placeholder:n("common.filters.search.placeholder"),className:"w-full text-xs mt-3 py-1.5 px-3 mb-4 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:N=>E(N.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(T,{size:"xs",onClick:()=>R(),variant:"link",className:"px-0",children:n("common.filters.buttons.all")}),e.jsx(St,{orientation:"vertical",className:"h-4"}),e.jsx(T,{size:"xs",onClick:()=>ve(),variant:"link",className:"px-0",children:n("common.filters.buttons.none")}),t.withDictionary&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grow"}),e.jsx(me,{htmlFor:"with-dictionary-switch",className:"text-xs",children:n("common.filters.with_dictionary")}),e.jsx(Dn,{id:"with-dictionary-switch",checked:c,size:"xs",onCheckedChange:()=>y(!c)})]})]}),e.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[m&&Array.from({length:3},(N,S)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(L,{className:"w-full h-6 rounded"}),e.jsx(L,{className:"h-6 w-12 rounded-md"})]},`skeleton-${S}`)),!m&&h.length===0&&e.jsx("div",{className:"text-muted-foreground py-4",children:n("common.filters.no_values_found")}),!m&&h.length>0&&h.slice(0,w).map(N=>e.jsx("div",{className:"gap-3 py-1.5",children:e.jsx(Bn,{size:"xs",label:N.label,checked:f.some(S=>S===N.key),count:N.count,onCheckedChange:()=>se(N)})},N.key))]}),!m&&h.length>w&&e.jsx(T,{className:"mt-2 px-0",onClick:P,size:"xs",variant:"link",children:n("common.filters.buttons.show_more",{value:Qn(h.length-w)})}),!m&&w>s&&e.jsx(T,{className:"mt-2 px-0",onClick:G,size:"xs",variant:"link",children:n("common.filters.buttons.show_less")})]}),e.jsx(At,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(T,{size:"xxs",variant:"ghost",onClick:W,disabled:f.length===0||m,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(Rn,{size:"xxs",variant:"outline",className:"h-7",color:"primary",actions:[{label:n("common.filters.buttons.some_not_in"),onClick:ke},{label:n("common.filters.buttons.not_in"),onClick:je}],onDefaultAction:re,disabled:m,children:n("common.filters.buttons.apply")})})]})})]})}Fe.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}}}};const Gt="integer";function at(t,s,n,r){var _;let a=!1,l=(n==null?void 0:n.defaultOperator)??q.LessThan,o="0",u="0",c="",y=!1;const d=(r==null?void 0:r.type)===Gt?0:3,m=s.content.find(h=>"content"in h&&"field"in h.content?h.content.field===t:!1),k=s.content.find(h=>"content"in h&&"field"in h.content?h.content.field===`${t}_unit`:!1);if(m){const h=m.content.value;if(console.log("[NumericalFilter] values",h),h.includes("__missing__"))return{hasUnappliedItems:a,selectedRange:l,minValue:o,maxValue:u,numericalValue:c,hasNoData:!0,selectedUnit:void 0};a=!0,h.length===2?(l=q.Between,o=Number(Number(h[0]).toFixed(d)).toLocaleString(B.language),u=Number(Number(h[1]).toFixed(d)).toLocaleString(B.language)):c=Number(h[0]).toLocaleString(B.language),m.op&&(l=m.op)}else console.log("[NumericalFilter else] no filter exists",n),y=!1,(n==null?void 0:n.defaultMin)!==void 0?(o=n.defaultMin.toLocaleString(B.language),c=n.defaultMin.toLocaleString(B.language)):(r==null?void 0:r.min)!==void 0&&(o=Number(r.min.toFixed(d)).toLocaleString(B.language),c=Number(r.min.toFixed(d)).toLocaleString(B.language)),(n==null?void 0:n.defaultMax)!==void 0?u=n.defaultMax.toLocaleString(B.language):(r==null?void 0:r.max)!==void 0&&(u=Number(r.max.toFixed(d)).toLocaleString(B.language)),n!=null&&n.defaultOperator&&(l=q[n.defaultOperator]);let g;return k&&k.content.value[0]&&((_=n==null?void 0:n.rangeTypes)!=null&&_.length)&&(g=n.rangeTypes[0].key),{hasUnappliedItems:a,selectedRange:l,minValue:o,maxValue:u,numericalValue:c,hasNoData:y,selectedUnit:g}}function ds(t){return{[q.GreaterThan]:{display:t("common.filters.operators.greater_than"),dropdown:t("common.filters.operators.greater_than"),icon:Lt},[q.LessThan]:{display:t("common.filters.operators.less_than"),dropdown:t("common.filters.operators.less_than"),icon:Et},[q.Between]:{display:t("common.filters.operators.between"),dropdown:t("common.filters.operators.between"),icon:wt},[q.GreaterThanOrEqualTo]:{display:t("common.filters.operators.greater_than_or_equal"),dropdown:t("common.filters.operators.greater_than_or_equal"),icon:Ot},[q.LessThanOrEqualTo]:{display:t("common.filters.operators.less_than_or_equal"),dropdown:t("common.filters.operators.less_than_or_equal"),icon:Tt},[q.In]:{display:t("common.filters.operators.in"),dropdown:t("common.filters.operators.in"),icon:Ct}}}function De({field:t}){var Ue,$e,ze,Ge;const{t:s}=M(),n=Y(),{aggregations:r}=K(),{appId:a}=J(),{statisticFetcher:l}=J(),o=t.key,u=ds(s),{data:c,isLoading:y}=l({field:o}),d=(c==null?void 0:c.type)===Gt?0:3,[m,k]=i.useState(q.GreaterThan),[g,_]=i.useState("0"),[h,p]=i.useState("0"),[f,A]=i.useState("0"),[w,C]=i.useState(!1),[E,P]=i.useState(),[G,R]=i.useState(!1),v=(Ue=Object.values(r).flatMap(x=>x.items).find(x=>x.key===o))==null?void 0:Ue.defaults,ve=t.type==="numerical"&&(v==null?void 0:v.noDataInputOption),se=(v==null?void 0:v.intervalDecimal)!==void 0&&((v==null?void 0:v.max)!==void 0||(v==null?void 0:v.min)!==void 0)||c&&(c.min!==void 0||c.max!==void 0),W=(v==null?void 0:v.min)??(c==null?void 0:c.min)??0,F=(v==null?void 0:v.max)??(c==null?void 0:c.max)??100,re=i.useCallback(()=>{const x=Ie.getResolvedActiveQuery(a);if(!(x!=null&&x.content))return;const I=at(o,x,v,c);C(I.hasNoData),A(I.minValue),p(I.maxValue),R(I.hasUnappliedItems),k(I.selectedRange??q.GreaterThan),_(I.numericalValue)},[a,o,v,c]);i.useEffect(()=>{re()},[re]);const je=i.useCallback(x=>{k(x),R(!0)},[]),ke=i.useCallback(x=>{C(x),R(!0)},[]),N=i.useCallback(x=>{P(x),R(!0)},[]),S=()=>{R(!1);const x=at(o,En,v,c);C(x.hasNoData),A(x.minValue),p(x.maxValue),R(x.hasUnappliedItems),k(x.selectedRange),_(x.numericalValue)},cn=i.useCallback(()=>{if(R(!1),w){n({type:V.ADD_MULTISELECT_VALUE,payload:{field:o,value:["__missing__"]}});return}let x=[];x=m===q.Between?[parseFloat(f.toString()),parseFloat(h.toString())]:[parseFloat(g.toString())],n({type:V.ADD_MULTISELECT_VALUE,payload:{field:o,value:x,operator:m}}),E&&n({type:V.ADD_MULTISELECT_VALUE,payload:{field:`${o}_unit`,value:[E]}})},[a,o,m,g,f,h,w,E]),dn=Object.entries(q).map(([x,I])=>{if(I in u){const un=u[I].icon;return e.jsx(Ke,{value:I,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(un,{size:16}),e.jsx("span",{children:u[I].dropdown})]})},I)}return null}).filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsx(Se,{id:`${o}_container`,size:"sm",variant:"outline",children:e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${o}_operator`,children:e.jsxs(Ye,{value:m,onValueChange:je,children:[e.jsx(We,{size:"sm",children:e.jsx(Je,{placeholder:s("common.filters.operators.select_operator"),children:(($e=u[m])==null?void 0:$e.display)||s("common.filters.operators.unknown")})}),e.jsx(Ze,{children:dn})]})}),m===q.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(le,{size:"xs",className:"w-half",value:f,onChange:x=>{const I=x.target.value;isNaN(Number(I))||(A(I),R(!0))},min:W,max:F,id:`${o}_min`,"data-testid":`${o}_min`}),e.jsx(le,{size:"xs",className:"w-half",value:h,onChange:x=>{const I=x.target.value;isNaN(Number(I))||(p(I),R(!0))},min:W,max:F,id:`${o}_max`,"data-testid":`${o}_max`})]}):e.jsx(le,{size:"xs",className:"w-full",value:g,onChange:x=>{const I=x.target.value;isNaN(Number(I))||(_(I),R(!0))},min:W,max:F,id:`${o}_value`,"data-testid":`${o}_value`}),se&&e.jsx("div",{id:`${o}_interval`,children:e.jsxs(Sn,{size:"xs",children:[s("common.filters.labels.actual_interval")," : ",(ze=c==null?void 0:c.min)==null?void 0:ze.toFixed(d)," -"," ",(c==null?void 0:c.min)!==void 0?Number(c.min.toFixed(d)).toLocaleString(B.language):""," ","-"," ",(c==null?void 0:c.max)!==void 0?Number(c.max.toFixed(d)).toLocaleString(B.language):""]})})]}),(v==null?void 0:v.rangeTypes)&&v.rangeTypes.length>0&&e.jsx("div",{id:`${o}_range_type_container`,className:"mt-3",children:y?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-5 w-16 mb-1",id:`${o}_unit_label_skeleton`}),e.jsx(L,{className:"h-9 w-full",id:`${o}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"text-sm",id:`${o}_unit_label`,children:s("common.filters.labels.unit")}),e.jsxs(Ye,{defaultValue:E||v.rangeTypes[0].key,onValueChange:N,children:[e.jsx(We,{children:e.jsx(Je,{placeholder:s("common.filters.labels.select_unit"),children:((Ge=v.rangeTypes.find(x=>x.key===E))==null?void 0:Ge.name)||s("common.filters.labels.select_unit")})}),e.jsx(Ze,{children:v.rangeTypes.map(x=>e.jsx(Ke,{value:x.key,children:x.name},x.key))})]})]})}),ve&&!se&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden mt-3",id:`${o}_no_data_label`,children:[e.jsx(qt,{checked:w,onCheckedChange:ke,id:`${o}_no_data`}),e.jsx("span",{children:s("common.filters.labels.no_data")})]})]})}),e.jsx(At,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(T,{size:"xxs",variant:"ghost",onClick:S,disabled:!G,id:`${o}_clear`,children:s("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(T,{size:"xxs",variant:"outline",onClick:cn,id:`${o}_apply`,children:s("common.filters.buttons.apply")})})]})})]})}De.__docgenInfo={description:"",methods:[],displayName:"NumericalFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function ce({field:t,children:s}){const{t:n}=M(),r=n(`common.filters.labels.${t.translation_key}`,{defaultValue:t.key});let a=null;if(Cn.includes(t.key)){const o=`common.filters.labels.${t.translation_key}_tooltip`;a=n(o)===o?null:n(o)}function l(){return e.jsx("div",{className:"flex items-center justify-between w-full text-xs",children:e.jsx("span",{children:r})})}return e.jsx(he,{size:"sm",children:e.jsxs(Mt,{value:t.key,className:"border-none",children:[e.jsx(Fn,{size:"sm",children:e.jsx(Rt,{children:a?e.jsxs(de,{children:[e.jsx(ue,{asChild:!0,children:e.jsx("span",{children:l()})}),e.jsx(pe,{children:e.jsx("span",{children:a})})]}):l()})}),e.jsx(Bt,{className:"pb-0",children:s})]},t.key)})}function us({field:t}){const{t:s}=M();let n;switch(t.type){case b.MULTIPLE:n=e.jsx(Fe,{field:t});break;case b.NUMERICAL:n=e.jsx(De,{field:t});break;case b.BOOLEAN:n=e.jsx(Be,{field:t});break;default:n=e.jsx("div",{children:s("common.filters.unsupported_type",{type:t.type})})}return n}function Ht({field:t,isOpen:s}){const{t:n}=M(),r=t.type;if(r===b.DIVIDER)return e.jsx("h4",{className:"px-2 h-8 text-sidebar-foreground/70 text-xs font-medium line-height-xs text-ellipsis overflow-hidden flex justify-between items-center",children:n(`common.filters.${t.key}`)});let a;switch(r){case b.MULTIPLE:a=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(Fe,{field:t})});break;case b.NUMERICAL:a=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(De,{field:t})});break;case b.BOOLEAN:a=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(Be,{field:t})});break;default:a=e.jsx("div",{children:n("common.filters.unsupported_type",{type:t.type})})}return a}ce.__docgenInfo={description:"",methods:[],displayName:"AccordionContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};Ht.__docgenInfo={description:"To be use when the facet needs to be inside an Accordion component",methods:[],displayName:"FacetContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""}}};const ps=2;function Xt({search:t}){const{t:s}=M(),{appId:n}=J(),{translation_key:r,key:a}=t,l=a.replace(/search_by_/g,""),[o,u]=i.useState([]),[c,y]=i.useState([]),[d,m]=i.useState(null);i.useEffect(()=>{var f;const _=Ie.getResolvedActiveQuery(n);if(JSON.stringify(_)===JSON.stringify(d))return;const h=_.content.find(A=>"content"in A&&"field"in A.content?A.content.field===l:!1),p=((f=h==null?void 0:h.content)==null?void 0:f.value)||[];Array.isArray(p)&&u(p),m(_)},[n,l,Ie.getActiveQuery(n)]),i.useEffect(()=>{(async()=>{if(o.length===0){y([]);return}if(o.length>ps){const h=o.map(p=>({value:p,label:p,badgeLabel:p}));y(h);return}try{const h=o.map(async f=>{var A,w;try{const E=(await et.geneAutoComplete(f)).data.find(P=>{var G;return((G=P.source)==null?void 0:G.name)===f});if(E)return{value:f,label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:((A=E.source)==null?void 0:A.name)||f}),e.jsx("span",{className:"text-xs text-muted-foreground",children:((w=E.source)==null?void 0:w.id)||""})]}),badgeLabel:f}}catch(C){console.error(`Error fetching gene ${f}:`,C)}return{value:f,label:f,badgeLabel:f}}),p=await Promise.all(h);y(p)}catch(h){console.error("Error fetching gene details:",h);const p=o.map(f=>({value:f,label:f,badgeLabel:f}));y(p)}})()},[o]);const k=async _=>{if(!_)return[];try{return(await et.geneAutoComplete(_)).data.map(p=>{var f,A,w,C,E,P;return{value:((f=p.source)==null?void 0:f.name)||"",label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:Xe(((A=p.highlight)==null?void 0:A.name)||((w=p.source)==null?void 0:w.name)||"")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Xe(((C=p.highlight)==null?void 0:C.id)||((E=p.source)==null?void 0:E.id)||"")})]}),badgeLabel:((P=p.source)==null?void 0:P.name)||""}})}catch(h){return console.error("Error fetching genes:",h),[]}},g=_=>{u(_)};return e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{children:s(`common.filters.labels.${r}`)}),e.jsxs(de,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(mn,{size:16})}),e.jsx(pe,{children:s(`common.filters.labels.${r}_tooltip`)})]})]}),e.jsx(Un,{value:o,defaultOptions:c,onChange:g,onSearch:k,placeholder:s(`common.filters.labels.${r}_placeholder`),className:"w-full",debounceDelay:300,maxSelected:100,hidePlaceholderWhenSelected:!0})]})}Xt.__docgenInfo={description:"",methods:[],displayName:"SearchFacet",props:{search:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function Kt({groupKey:t,aggregations:s}){var h;const{t:n}=M(),[r,a]=i.useState(!1),[l,o]=i.useState([]),[u,c]=i.useState(t),y=is(),d=()=>{sessionStorage.removeItem(y)},m=t?((h=s[t])==null?void 0:h.items)||[]:Object.values(s).flatMap(p=>p.items),k=m.filter(p=>p.type===b.SEARCH_BY),g=m.filter(p=>p.type===b.UPLOAD_LIST),_=m.filter(p=>p.type!==b.SEARCH_BY&&p.type!==b.UPLOAD_LIST);return i.useEffect(()=>{a(!1),o([])},[t]),i.useEffect(()=>{(u&&u!==null&&t===null||u&&u!==null&&t&&t!==null&&u!==t)&&d(),c(t)},[t,u]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3",children:[k.map((p,f)=>e.jsx(Xt,{search:p},`${p.key}-${f}`)),g.map((p,f)=>e.jsx(Tn,{variant:p.key.replace(/upload_list_/g,"")},`${p.key}-${f}`))]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(T,{variant:"link",size:"xs",onClick:()=>{const p=!r;a(p),o(p?_.map(f=>f.key):[])},children:n(r?"common.actions.collapse_all":"common.actions.expand_all")})}),e.jsx(Ft,{className:"flex flex-col gap-1",type:"multiple",value:l,onValueChange:p=>o(p),children:_.map((p,f)=>e.jsx(Ht,{isOpen:l.includes(p.key),field:p},`${p.key}-${f}`))})]})}Kt.__docgenInfo={description:"",methods:[],displayName:"FacetList",props:{groupKey:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregations:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function ms(t){switch(t){case Q.snv_occurrence:return{builderFetcher:ot,statisticFetcher:it};case Q.cnv_occurrence:return{builderFetcher:hs,statisticFetcher:fs};default:return{builderFetcher:ot,statisticFetcher:it}}}function ot({field:t,size:s=30,withDictionary:n=!1}){const r=ye(),a=Z(),l=ee(),o={caseId:a,seqId:l,aggregationBody:{field:t,size:s,sqon:r},withDictionary:n};return z(o,async()=>fe.aggregateGermlineSNVOccurrences(o.caseId,o.seqId,o.aggregationBody,o.withDictionary).then(u=>u.data),{revalidateOnFocus:!1})}function it({field:t}){const s=ye(),n=Z(),r=ee(),a={caseId:n,seqId:r,statisticsBody:{field:t,sqon:s}};return z(a,async()=>fe.statisticsGermlineSNVOccurrences(a.caseId,a.seqId,a.statisticsBody).then(l=>l.data),{revalidateOnFocus:!1})}function hs({field:t,size:s=30}){const n=ye(),r=Z(),a=ee(),l={caseId:r,seqId:a,aggregationBody:{field:t,size:s,sqon:n}};return z(l,async()=>fe.aggregateGermlineCNVOccurrences(l.caseId,l.seqId,l.aggregationBody).then(o=>o.data),{revalidateOnFocus:!1})}function fs({field:t}){const s=ye(),n=Z(),r=ee(),a={caseId:n,seqId:r,statisticsBody:{field:t,sqon:s}};return z(a,async()=>fe.statisticsGermlineCNVOccurrences(a.caseId,a.seqId,a.statisticsBody).then(l=>l.data),{revalidateOnFocus:!1})}async function ys(t){return(await $n.getUserPreferences(t.key)).data}function xs({appId:t,setPreference:s}){const n=z(`query-builder-get-${t}`,()=>ys({key:`query-builder-${t}`}),{revalidateOnMount:!0,revalidateIfStale:!1,revalidateOnFocus:!1});i.useEffect(()=>{n.data?s({...n.data,history:Ae().history}):n.error&&s(Ae())},[n.isLoading])}function gs(t){return Object.fromEntries(Object.entries(t).map(([s,n])=>{const r={...n,items:n.items.filter(a=>a.facetHidden!==!0)};return[s,r]}).filter(([s,n])=>n.items.length>0))}function bs(t,s){const n=s.content.field;let r;for(const a in t)if(r=t[a].items.find(l=>l.key===n),r)return r;return console.error(`${n} doesn't exist in aggregations`,t),{type:b.MULTIPLE,key:"error",translation_key:"error"}}function Yt({children:t,onRemovePill:s}){return e.jsxs("div",{className:"flex items-center rounded-xs p-0.5 bg-muted group-data-[query-active=true]/query:bg-primary/25",children:[t,e.jsx(T,{iconOnly:!0,variant:"ghost",size:"sm",className:"mr-0.5 ml-1 py-0.5 enabled:hover:bg-transparent size-4",onClick:n=>{n.stopPropagation(),s()},children:e.jsx(Pt,{})})]})}Yt.__docgenInfo={description:`Simple wrapper that:
- Add the blue background to highlight the query pill if it has been selected by the user
- Add the X button to remove query-pill

         ┌────────────────────────────┐
┌───────┌──────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >][X]      | 389K | [copy] [trash]  |
└───────└──────────────────────────────────────────┘─────────────────┘
         └────────────────────────────┘`,methods:[],displayName:"QueryPillContainer",props:{onRemovePill:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function Wt({field:t,operator:s}){const{t:n,lazyTranslate:r}=M();return e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"ml-1 mr-0.5 text-xs font-medium",children:n(`common.filters.labels.${t}`,{defaultValue:r(t)})}),e.jsx("span",{className:"ml-1 mr-0.5",children:s})]})}Wt.__docgenInfo={description:`Label for a pill
@TODO: Change dictionary key from filters to facet

         ┌────────────┐                   ┌─────┐
┌───────┌───────────────────────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >][X] and Ipsum < 60[x]     | 389K | [copy] [trash]  |
└───────└───────────────────────────────────────────────────────────┘─────────────────┘
         └────────────┘                   └─────┘`,methods:[],displayName:"LabelOperator",props:{field:{required:!0,tsType:{name:"string"},description:""},operator:{required:!0,tsType:{name:"ReactNode"},description:""}}};function Jt({type:t,size:s,className:n}){switch(t){case j.GreaterThan:return e.jsx(Lt,{size:s,className:n});case j.GreaterThanOrEqualTo:return e.jsx(Ot,{size:s,className:n});case j.LessThan:return e.jsx(Et,{size:s,className:n});case j.LessThanOrEqualTo:return e.jsx(Tt,{size:s,className:n});case j.Between:return e.jsx(wt,{size:s,className:n});case j.NotIn:return e.jsx(Hn,{size:s,className:n});default:return e.jsx(Ct,{size:s,className:n})}}Jt.__docgenInfo={description:`Return to corresponding operator for the sqon

/**
Label for a pill
@TODO: Change dictionary key from filters to facet

                      ┌─┐                       ┌─┐
┌───────┌───────────────────────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >][X] and Ipsum < 60[x]     | 389K | [copy] [trash]  |
└───────└───────────────────────────────────────────────────────────┘─────────────────┘
                      └─┘                       └─┘`,methods:[],displayName:"Operator",props:{size:{required:!1,tsType:{name:"number"},description:""},type:{required:!1,tsType:{name:"union",raw:"SqonOpEnum | (string & {})",elements:[{name:"SqonOpEnum"},{name:"unknown"}]},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};function Zt({canExpand:t,className:s,classNameContent:n,children:r,clickable:a,...l}){return e.jsx("div",{className:X("bg-background rounded-xs pl-2 text-xs font-medium leading-5 relative",t?"pr-[22px]":"pr-2",s),...l,children:e.jsx("div",{className:X("flex flex-wrap items-center",a?"hover:shadow-[inset_0_-4px_0_-2.5px_black] hover:cursor-pointer":"",n),children:r})})}Zt.__docgenInfo={description:`Visual container for QueryPillValues. Highlight with a white background

                        ┌─────────────┐
┌───────┌──────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >][X]      | 389K | [copy] [trash]  |
└───────└──────────────────────────────────────────┘─────────────────┘
                        └─────────────┘`,methods:[],displayName:"QueryPillValuesContainer",props:{canExpand:{required:!1,tsType:{name:"boolean"},description:""},clickable:{required:!1,tsType:{name:"boolean"},description:""},classNameContent:{required:!1,tsType:{name:"string"},description:""}}};const lt=3,vs=",",js="&";function en({valueFacet:t,...s}){const[n,r]=i.useState(!1),{t:a,sanitize:l,lazyTranslate:o}=M(),u=t.content.value.length>lt,c=n?t.content.value:Xn(t.content.value,lt);return e.jsxs(Zt,{canExpand:u,...s,children:[t.content.overrideValuesName?e.jsx("div",{children:e.jsx("span",{children:t.content.overrideValuesName})}):c.map((y,d)=>e.jsxs("div",{children:[e.jsx("span",{children:a(`common.filters.values.${t.content.field}.${l(y)}`,{defaultValue:o(y)})}),c.length-1>d&&e.jsx("span",{className:"px-1",children:t.op===j.All?js:vs})]},`${y}-${d}`)),u&&e.jsx("div",{className:"absolute right-1 hover:cursor-pointer",children:n?e.jsx(Kn,{size:16,onClick:y=>{y.preventDefault(),r(!1)}}):e.jsx(Yn,{size:16,onClick:y=>{y.preventDefault(),r(!0)}})})]})}en.__docgenInfo={description:`QueryPillValues display the selected values from the facets.
- Display the first 3 selected values
- Clicking on [>] or [ < ] change the expand state

                        ┌──────────┐
┌───────┌──────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >] [X]     | 389K | [copy] [trash]  |
└───────└──────────────────────────────────────────┘─────────────────┘
                        └──────────┘`,methods:[],displayName:"QueryPillValues",props:{valueFacet:{required:!0,tsType:{name:"IValueFacet"},description:""}}};function tn({content:t}){const{aggregations:s}=i.useContext(Me),n=bs(s,t),r=Y(),a=i.useCallback(()=>{r({type:V.REMOVE_MULTISELECT_PILL,payload:t})},[t]);return e.jsx(Yt,{onRemovePill:a,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Wt,{field:t.content.field,operator:e.jsx(Jt,{size:14,type:t.op})}),e.jsxs(Dt,{children:[e.jsx(Qt,{children:e.jsx(en,{valueFacet:t})}),e.jsx(Vt,{align:"start",className:"p-2.5",children:e.jsx(us,{field:n,isOpen:!0})})]})]})})}tn.__docgenInfo={description:`┌────────────────────────┐
┌───────┌──────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >] [X]     | 389K | [copy] [trash]  |
└───────└──────────────────────────────────────────┘─────────────────┘
         └────────────────────────┘`,methods:[],displayName:"MultiSelectQueryPill",props:{content:{required:!0,tsType:{name:"IValueFacet"},description:""}}};function nn(){const{t}=M(),s=te(),n=Y(),r=i.useCallback(a=>{a.stopPropagation(),n({type:V.CHANGE_COMBINER_OPERATOR,payload:{operator:s.op===U.And?U.Or:U.And}})},[]);return e.jsx("div",{className:"px-2",onClick:r,children:e.jsxs(de,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(T,{variant:"link",className:"text-current text-sm p-0 h-auto font-normal",onClick:()=>{console.warn("CombinerOperator:onClick is not implemented")},children:t(`common.query_pill.operator.${s.op}`)})}),e.jsxs(pe,{children:[t("common.query_pill.operator.change_operator_to"),s.op===U.And?t("common.query_pill.operator.or"):t("common.query_pill.operator.and")]})]})})}nn.__docgenInfo={description:`Combiner is "and" or "or" operator that link every pill

                                      ┌───┐
┌───────┌───────────────────────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >][X] and Ipsum < 60[x]     | 389K | [copy] [trash]  |
└───────└───────────────────────────────────────────────────────────┘─────────────────┘
                                      └───┘`,methods:[],displayName:"CombinerOperator"};function ks(t,s){return e.jsxs("div",{className:"flex mt-1",children:[e.jsx(tn,{content:t})," ",s&&e.jsx(nn,{})]})}function sn({sqon:t,active:s}){var d;const{t:n}=M(),{fetcher:r}=K(),a=Y(),l=i.useCallback(()=>({"border-primary/75 bg-primary/10":s,"border-muted-foreground/20 bg-muted/35 text-muted-foreground":!s}),[s])(),o=z(`${JSON.stringify(t)}-count`,()=>r.count({countBody:{sqon:{content:t.content,op:t.op}}}),{revalidateOnFocus:!1,revalidateOnMount:!0,shouldRetryOnError:!1}),u=i.useCallback(()=>{console.warn("QueryBar:handleSelection has not be implemented")},[t]),c=i.useCallback(()=>{console.warn("QueryBar:handleDuplicate has not be implemented")},[t]),y=i.useCallback(()=>{a({type:V.REMOVE_QUERY,payload:t})},[t]);return e.jsxs("div",{className:"flex flex-1 group/query","data-query-active":s,children:[e.jsxs("div",{className:X("flex gap-2 items-center py-4 px-4 border-l border-t border-b",l),children:[e.jsx(qt,{size:"sm",checked:!1,onClick:u}),e.jsx("span",{className:"text-xs font-medium",children:n("common.query_bar.selector",{index:1})})]}),e.jsxs("div",{className:X("flex flex-1 justify-between py-3 px-3 border",l),children:[e.jsx("div",{className:"flex flex-1 flex-wrap max-h-[30vh]",children:t.content.map((m,k)=>e.jsx(i.Fragment,{children:ks(m,k<t.content.length-1)},k))}),e.jsx("div",{className:"flex items-center gap-1",children:o.isLoading?e.jsx(Gn,{}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{size:14}),e.jsx("span",{className:"font-medium",children:Vn(((d=o.data)==null?void 0:d.count)??0)})]})})]}),e.jsxs("div",{className:X("flex items-center py-2 px-3 border-r border-t border-b",l),onClick:m=>m.stopPropagation(),children:[e.jsx(T,{iconOnly:!0,variant:"ghost",size:"sm",onClick:c,children:e.jsx(jn,{})}),e.jsxs(Dt,{children:[e.jsx(Qt,{asChild:!0,children:e.jsx(T,{iconOnly:!0,variant:"ghost",size:"sm",children:e.jsx(Wn,{})})}),e.jsxs(Vt,{side:"left",className:"w-[200px] space-y-3",children:[e.jsx("div",{className:"text-sm",children:n("common.query_bar.delete_popover.title")}),e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(tt,{asChild:!0,children:e.jsx(T,{size:"xs",variant:"outline",children:n("common.query_bar.delete_popover.cancel")})}),e.jsx(tt,{asChild:!0,children:e.jsx(T,{size:"xs",variant:"destructive",onClick:y,children:n("common.query_bar.delete_popover.ok")})})]})]})]})]})]})}sn.__docgenInfo={description:`Represent a single query.
A query is a combinaison of multiple sqon (multi-select, numerical, boolean etc.)

┌───────┌──────────────────────────────────────────┐─────────────────┐
| [] Q1 | Loremp Ipsum = [1,2, 3 >][X]      | 389K | [copy] [trash]  |
└───────└──────────────────────────────────────────┘─────────────────┘`,methods:[],displayName:"QueryBar",props:{sqon:{required:!0,tsType:{name:"ISyntheticSqon"},description:""},active:{required:!0,tsType:{name:"boolean"},description:""}}};function rn(){const{t}=M(),{sqons:s,activeQueryId:n}=K(),r=te();return e.jsx(he,{className:"py-0",children:e.jsx(Ft,{type:"multiple",defaultValue:["query-builder"],children:e.jsxs(Mt,{value:"query-builder",className:"border-none",children:[e.jsx(Rt,{className:"border-b py-0 px-6 data-[state=closed]:rounded-sm data-[state=closed]:border-none hover:cursor-pointer",asChild:!0,children:"TODO"}),e.jsx(Bt,{className:"py-4 px-6 space-y-4",children:e.jsxs("div",{className:"flex gap-2 max-h-[30vh] overflow-y-scroll",children:[s.filter(a=>!rt(a)).map(a=>e.jsx(sn,{sqon:a,active:n===a.id},a.id)),rt(r)&&t("common.query_bar.empty")]})})]})})})}rn.__docgenInfo={description:`Card that display all queries for query-builder

┌─────────────────────────────────────────────────────────────────────────┐
| Title                                                                   |
|─────────────────────────────────────────────────────────────────────────|
|  ┌───────┌──────────────────────────────────────────┐─────────────────┐ |
|  | [] Q1 | Loremp Ipsum = [1,2, 3 >][X]      | 389K | [copy] [trash]  | |
|  └───────└──────────────────────────────────────────┘─────────────────┘ |
|  ┌───────┌──────────────────────────────────────────┐─────────────────┐ |
|  | [] Q2 | Ipsum > 60 [X]                  | 389K | [copy] [trash]  | |
|  └───────└──────────────────────────────────────────┘─────────────────┘ |
|  [New Query] (*) Label                                                  |
└─────────────────────────────────────────────────────────────────────────┘`,methods:[],displayName:"QueriesBarCard"};function an({defaultSidebarOpen:t,aggregations:s}){return e.jsx("div",{className:"bg-muted w-full",children:e.jsxs("div",{className:"flex flex-1 h-screen overflow-hidden",children:[e.jsx("aside",{className:"w-auto min-w-fit h-full shrink-0",children:e.jsx("div",{className:"z-10",children:e.jsx(It,{open:t,className:"h-full flex flex-row",children:e.jsx(jt,{variant:"sidebar",collapsible:"icon",className:"static! flex flex-col w-full bg-primary dark:bg-secondary ",children:e.jsx(kt,{children:e.jsxs(_t,{children:[e.jsx(L,{className:"size-8 mb-1"}),e.jsx(Nt,{children:Object.keys(s).map(n=>e.jsx(L,{className:"size-8 w-full"},n))})]})})})})})}),e.jsx("main",{className:"flex-1 shrink px-3 pb-3 overflow-auto",children:e.jsx("div",{className:"py-3 space-y-2",children:e.jsx(he,{className:"py-0",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"py-4 px-6 flex justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(L,{className:"h-8 w-32"}),new Array(2).fill(0).map((n,r)=>e.jsx(L,{className:"size-8"},r))]}),e.jsxs("div",{className:"flex gap-2",children:[new Array(5).fill(0).map((n,r)=>e.jsx(L,{className:"size-8"},r)),e.jsx(L,{className:"h-8 w-36"})]})]}),e.jsx(St,{}),e.jsxs("div",{className:"flex flex-col py-4 gap-4",children:[e.jsxs("div",{className:"px-6 flex flex-col gap-2",children:[e.jsx(L,{className:"h-[50px] w-full"}),e.jsx(L,{className:"h-[50px] w-full"})]}),e.jsxs("div",{className:"px-6 flex gap-3",children:[e.jsx(L,{className:"h-7 w-26"}),e.jsx(L,{className:"h-7 w-16"})]})]})]})})})})]})})}an.__docgenInfo={description:"",methods:[],displayName:"QueryBuilderSkeleton",props:{aggregations:{required:!0,tsType:{name:"AggregationConfig"},description:""},defaultSidebarOpen:{required:!0,tsType:{name:"boolean"},description:""}}};function ne({appId:t,defaultSidebarOpen:s=!1,fetcher:n,children:r}){const[a,l]=i.useState(s),u=Ln()[t].aggregations,c=gs(u),[y,d]=i.useState(null),[m,k]=i.useState(),g=ms(t);return xs({appId:t,setPreference:k}),m?e.jsx(zt,{...m,aggregations:u,fetcher:n,children:e.jsx(Re,{value:{appId:t,...g},children:e.jsx("div",{className:"bg-muted w-full",children:e.jsxs("div",{className:"flex flex-1 h-screen overflow-hidden",children:[e.jsx("aside",{className:"w-auto min-w-fit h-full shrink-0",children:e.jsxs(It,{open:a,onOpenChange:l,className:"h-full flex flex-row",children:[e.jsx("div",{className:"z-10",children:e.jsx(Ut,{aggregationGroups:c,selectedItemId:y,onItemSelect:d})}),e.jsx("div",{className:X("overflow-auto mb-16 border-r transition-[width] duration-300 ease-in-out",{"w-[280px] p-4 opacity-100 relative":y,"w-0 opacity-0":!y}),children:e.jsxs("div",{className:"whitespace-nowrap",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>d(null),className:"text-muted-foreground hover:text-foreground",children:e.jsx(Pt,{size:16})})}),e.jsx(Kt,{aggregations:c,groupKey:y})]})})]})}),e.jsxs("main",{className:"flex-1 shrink px-3 pb-3 overflow-auto",children:[e.jsx("div",{className:"py-3 space-y-2",children:e.jsx(rn,{})}),r]})]})})})}):e.jsx(an,{defaultSidebarOpen:s,aggregations:u})}ne.__docgenInfo={description:"Query-Builder (facets + query-bar)",methods:[],displayName:"QueryBuilder",props:{appId:{required:!0,tsType:{name:"ApplicationId"},description:""},children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""},defaultSidebarOpen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fetcher:{required:!0,tsType:{name:"IQBFetcher"},description:""}}};function xe({...t}){var m;const s=te(),{fetcher:n}=K(),[r,a]=i.useState([]),[l,o]=i.useState({pageIndex:0,pageSize:10}),[u,c]=i.useState([]),y=z(`${JSON.stringify(s)}-list`,()=>n.list({listBody:{additional_fields:r,limit:l.pageSize,page_index:l.pageIndex,sort:u,sqon:{content:s.content,op:s.op}}}),{revalidateOnFocus:!1,revalidateOnMount:!0,shouldRetryOnError:!1}),d=z(`${JSON.stringify(s)}-count`,()=>n.count({countBody:{sqon:{content:s.content,op:s.op}}}),{revalidateOnFocus:!1,revalidateOnMount:!0,shouldRetryOnError:!1});return e.jsx(he,{children:e.jsx(Se,{children:e.jsx(zn,{data:y.data??[],total:((m=d.data)==null?void 0:m.count)??0,loadingStates:{list:y.isLoading,total:d.isLoading},serverOptions:{setAdditionalFields:a,onSortingChange:c},pagination:{state:l,type:"server",onPaginationChange:o},...t})})})}xe.__docgenInfo={description:`Wrapper for data-table
Used to access QBContext and create list and count query`,methods:[],displayName:"QueryBuilderDataTable"};const Qe="api/users/preferences/:key";async function on({params:t}){const s=t.key;return s==="data-table-storybook-query-builder"?new $(null,{status:404}):s==="query-builder-cnv_occurrence"?new $(null,{status:404}):$.json({activeQueryId:"3593dbdf-44e7-49c9-934a-7b10db87b603",sqons:[{id:"3593dbdf-44e7-49c9-934a-7b10db87b603",content:[{content:{field:"firstName",value:["henry","jack","irene","liam","olivia","tanner"]},op:"in"},{content:{field:"lastName",value:["tremblay","anderson","young"]},op:"in"},{content:{field:"status",value:["single"]},op:"in"}],op:"and"}],savedFilters:[],selectedQueryIndexes:[0]})}const ge="api/mock/list",be="api/mock/count";function ct(t,s){var o;const{op:n}=s,r=s.content.field,a=s.content.value,l=(o=t[r])==null?void 0:o.toString().toLowerCase();switch(n){case j.In:return a.includes(l);case j.And:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.Or:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.Not:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.Between:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.GreaterThan:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.LessThan:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.GreaterThanOrEqualTo:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.LessThanOrEqualTo:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0;case j.NotIn:return!a.includes(l);case j.All:return console.warn(`mock-api:filtercontent ${n} operator has not been coded`),!0}return!1}function ln(t){return Ee.filter(s=>{switch(t.op){case j.Or:return t.content.map(r=>ct(s,r)).includes(!0);default:return t.content.map(r=>ct(s,r)).every(r=>r===!0)}})}async function Ve({request:t}){var r;const n=(r=(await t.clone().json()).listBody)==null?void 0:r.sqon;return n&&n.content.length>0?$.json(ln(n)):$.json(Ee)}async function Pe({request:t}){var r;const n=(r=(await t.clone().json()).countBody)==null?void 0:r.sqon;if(n&&n.content.length>0){const a=ln(n);return $.json({count:a.length})}return $.json({count:Ee.length})}const{mocked:dt}=__STORYBOOK_MODULE_TEST__,_s={variant_entity:{app_id:Q.variant_entity},snv_occurrence:{app_id:Q.snv_occurrence,aggregations:{variant:{items:[{key:"firstName",translation_key:"multiple",type:b.MULTIPLE},{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"status",translation_key:"status (with dictionary)",type:b.MULTIPLE,withDictionary:!0},{key:"divider",translation_key:"Divider",type:b.DIVIDER},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"visits",translation_key:"Visits (integer)",type:b.NUMERICAL,defaults:{min:0,max:1e3,defaultOperator:D.LessThan,defaultMin:0,defaultMax:1e3}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]},gene:{items:[{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]}}},cnv_occurrence:{app_id:Q.cnv_occurrence,aggregations:{pathogenicity:{items:[{key:"firstName",translation_key:"multiple",type:b.MULTIPLE},{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"status",translation_key:"status (with dictionary)",type:b.MULTIPLE,withDictionary:!0},{key:"divider",translation_key:"Divider",type:b.DIVIDER},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"visits",translation_key:"Visits (integer)",type:b.NUMERICAL,defaults:{min:0,max:1e3,defaultOperator:D.LessThan,defaultMin:0,defaultMax:1e3}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]},frequency:{items:[{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:D.LessThan,defaultMin:0,defaultMax:100}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]}}},admin:{admin_code:"admin",app_id:Q.admin},portal:{name:"",navigation:{}}},Vr={title:"QueryBuilder/QueryBuilderV3",component:ne,beforeEach:async()=>{dt(Z).mockReturnValue(1),dt(ee).mockReturnValue(1)},args:{fetcher:{list:async t=>He.post(ge,{listBody:t.listBody}).then(s=>s.data),count:async t=>He.post(be,{countBody:t.countBody}).then(s=>s.data)}},decorators:[t=>e.jsx(Zn,{initialEntries:["/case/1?seq_id=1"],children:e.jsx(es,{children:e.jsx(ts,{path:"/case/:caseId",element:e.jsx(qn,{config:_s,children:e.jsx(t,{})})})})})]},ae={parameters:{msw:{handlers:[O.post(ge,Ve),O.post(be,Pe),O.post(Ce,Te),O.post(Oe,we),O.get(Qe,async()=>(await Jn(1e4),new $(null,{status:403})))]}},args:{appId:Q.snv_occurrence,children:e.jsx(e.Fragment,{}),defaultSidebarOpen:!0},render:t=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bold font-mono text-red",children:"Do a hard refresh to reset loading state"}),e.jsx(ne,{appId:t.appId,defaultSidebarOpen:t.defaultSidebarOpen,fetcher:t.fetcher,children:e.jsx(xe,{id:"storybook-query-builder",columns:[...Le,qe.accessor("isActive",{header:"Active"})],defaultColumnSettings:[]})})]})},oe={parameters:{msw:{handlers:[O.post(ge,Ve),O.post(be,Pe),O.post(Ce,Te),O.post(Oe,we),O.get(Qe,on)]}},args:{appId:Q.cnv_occurrence,children:e.jsx(e.Fragment,{}),defaultSidebarOpen:!0},render:t=>e.jsx(ne,{appId:t.appId,defaultSidebarOpen:t.defaultSidebarOpen,fetcher:t.fetcher,children:e.jsx(xe,{id:"storybook-query-builder",columns:[...Le,qe.accessor("isActive",{header:"Active"})],defaultColumnSettings:[]})})},ie={parameters:{msw:{handlers:[O.post(ge,Ve),O.post(be,Pe),O.post(Ce,Te),O.post(Oe,we),O.get(Qe,on)]}},args:{appId:Q.snv_occurrence,children:e.jsx(e.Fragment,{}),defaultSidebarOpen:!0},render:t=>e.jsx(ne,{appId:t.appId,defaultSidebarOpen:t.defaultSidebarOpen,fetcher:t.fetcher,children:e.jsx(xe,{id:"storybook-query-builder",columns:[...Le,qe.accessor("isActive",{header:"Active"})],defaultColumnSettings:[]})})};var ut,pt,mt;ae.parameters={...ae.parameters,docs:{...(ut=ae.parameters)==null?void 0:ut.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(mockListApi, httpMockListApiResponse), http.post(mockCountApi, httpMockCountApiResponse), http.post(occurrenceAggregateApi, httpOccurrenceAggregateApiResponse), http.post(occurrenceAggregateStatisticApi, httpOccurrenceAggregateStatisticsApiResponse), http.get(userPreferenceApi, async () => {
        await delay(10000);
        return new HttpResponse(null, {
          status: 403
        });
      })]
    }
  },
  args: {
    appId: ApplicationId.snv_occurrence,
    children: <></>,
    // unused
    defaultSidebarOpen: true
  },
  render: args => <>
      <div className="bold font-mono text-red">Do a hard refresh to reset loading state</div>
      <QueryBuilder appId={args.appId} defaultSidebarOpen={args.defaultSidebarOpen} fetcher={args.fetcher}>
        <QueryBuilderDataTable id="storybook-query-builder" columns={[...mockColumns, mockColumnHelper.accessor('isActive', {
        header: 'Active'
      })] as TableColumnDef<TableMockData, any>[]} defaultColumnSettings={[]} />
      </QueryBuilder>
    </>
}`,...(mt=(pt=ae.parameters)==null?void 0:pt.docs)==null?void 0:mt.source}}};var ht,ft,yt;oe.parameters={...oe.parameters,docs:{...(ht=oe.parameters)==null?void 0:ht.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(mockListApi, httpMockListApiResponse), http.post(mockCountApi, httpMockCountApiResponse), http.post(occurrenceAggregateApi, httpOccurrenceAggregateApiResponse), http.post(occurrenceAggregateStatisticApi, httpOccurrenceAggregateStatisticsApiResponse), http.get(userPreferenceApi, httpUserPreferenceApiResponse)]
    }
  },
  args: {
    appId: ApplicationId.cnv_occurrence,
    children: <></>,
    // unused
    defaultSidebarOpen: true
  },
  render: args => <QueryBuilder appId={args.appId} defaultSidebarOpen={args.defaultSidebarOpen} fetcher={args.fetcher}>
      <QueryBuilderDataTable id="storybook-query-builder" columns={[...mockColumns, mockColumnHelper.accessor('isActive', {
      header: 'Active'
    })] as TableColumnDef<TableMockData, any>[]} defaultColumnSettings={[]} />
    </QueryBuilder>
}`,...(yt=(ft=oe.parameters)==null?void 0:ft.docs)==null?void 0:yt.source}}};var xt,gt,bt;ie.parameters={...ie.parameters,docs:{...(xt=ie.parameters)==null?void 0:xt.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(mockListApi, httpMockListApiResponse), http.post(mockCountApi, httpMockCountApiResponse), http.post(occurrenceAggregateApi, httpOccurrenceAggregateApiResponse), http.post(occurrenceAggregateStatisticApi, httpOccurrenceAggregateStatisticsApiResponse), http.get(userPreferenceApi, httpUserPreferenceApiResponse)]
    }
  },
  args: {
    appId: ApplicationId.snv_occurrence,
    children: <></>,
    // unused
    defaultSidebarOpen: true
  },
  render: args => <QueryBuilder appId={args.appId} defaultSidebarOpen={args.defaultSidebarOpen} fetcher={args.fetcher}>
      <QueryBuilderDataTable id="storybook-query-builder" columns={[...mockColumns, mockColumnHelper.accessor('isActive', {
      header: 'Active'
    })] as TableColumnDef<TableMockData, any>[]} defaultColumnSettings={[]} />
    </QueryBuilder>
}`,...(bt=(gt=ie.parameters)==null?void 0:gt.docs)==null?void 0:bt.source}}};const Pr=["Loading","Default","Multiselect"];export{oe as Default,ae as Loading,ie as Multiselect,Pr as __namedExportsOrder,Vr as default};
