import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{h as Ae}from"./index-DRDTZ9zG.js";import{k as Qe,o as de,m as Te,D as pt}from"./data-table-BsQK_ZfM.js";import{r as a,R as Ge}from"./index-CBYaBgW8.js";import{c as ft}from"./index-C66Dxnp2.js";import{B as ht,U as yt,O as xt,F as gt,P as vt,G as St,V as jt,D as bt}from"./variant-icon-C_DRBYBR.js";import{B as M}from"./button-JKxddmHK.js";import{u as _t,a as kt,b as Nt,c as It,d as wt,e as Et,f as At,S as Tt}from"./sidebar-D8Ey6VHe.js";import{T as be,a as _e,b as ke}from"./tooltip-0vX-MTK3.js";import{u as Q}from"./i18n-CqMj48hY.js";import{P as Ot,a as Ct}from"./panel-left-open-BsQqi0Jz.js";import{A as $,F as q,u as Rt,C as Ft}from"./applications-config-D6sxpq9M.js";import{c as qt}from"./utils-CDN07tui.js";import{A as Dt,T as Vt,f as Lt,p as Oe,U as Bt}from"./upload-id-modal-C5u8TXQZ.js";import{q as D,D as Pe}from"./query-builder-remote-CAJM2EYn.js";import{L as me}from"./label-BI8zg36L.js";import{R as Mt,a as Ut}from"./radio-group-DekDLgvf.js";import{M as Z,T as Se,R as O}from"./sqon-DDFmFWEM.js";import{A as $t}from"./action-button-9r-08jXC.js";import"./button.variants-Du9eY_ux.js";import{C as Qt}from"./checkbox-filter-BvP0FXCK.js";import{d as Ne,e as ze,C as Ie,a as Gt}from"./card-Cyh3E19J.js";import{I as le}from"./input-Bj-MPxry.js";import{S as Pt}from"./separator-ChZWIdMg.js";import{S as ue}from"./skeleton-_T1otFf0.js";import{S as zt}from"./switch-Jy17y5RA.js";import{S as Jt}from"./search-DKmUqS9g.js";import{E as Yt,L as Ht,G as Wt,a as Kt,b as Xt,c as Zt}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{C as es}from"./checkbox-BUFo-vqr.js";import{d as Ce,S as Re,a as Fe,b as qe,c as De}from"./select-DnbErV3f.js";import{A as Je,a as Ye,b as He,c as We}from"./accordion-DSXieqtP.js";import{M as ts}from"./multi-selector-BxH76igP.js";import{I as ss}from"./info-1oMsIW1a.js";import{X as ns}from"./x-4HkHZ1eq.js";import{o as rs,h as as,s as os,a as is}from"./api-occurrence-BaSPzlyp.js";import{M as ls,R as cs,a as ds}from"./chunk-EPOLDU6W-BBQlfikL.js";import"./decorators-C6Ye0Q4n.js";import"./isEqual-DJddVrXl.js";import"./api-DPRnJls5.js";import"./index-sTUCEGFJ.js";import"./index-BWnBDfn-.js";import"./createLucideIcon-B119WVF5.js";import"./dropdown-menu-DPm_FhUX.js";import"./index-D9mtqW9-.js";import"./index-Dy6y0jaD.js";import"./index-BCzuw4Jg.js";import"./index-C8BBKGwP.js";import"./index-BL8Z-moU.js";import"./Combination-CrkgvPnV.js";import"./index-iyInEJkZ.js";import"./index-C2iKAgIe.js";import"./index-CWHKeK-O.js";import"./index-CfgEC-S9.js";import"./index-DnEzm5An.js";import"./check-DSe_yRo5.js";import"./settings-Dw4TSVKU.js";import"./number-format-D6gxQ_H-.js";import"./pagination-BKco0I0w.js";import"./ellipsis-RxOQoOKc.js";import"./empty-LncwPSrD.js";import"./chart-scatter-DVTaxjlK.js";import"./index-lnksFm0-.js";import"./badge-B8JYzoyf.js";import"./circle-alert-DTyzftz0.js";import"./chevron-down-DOuPo75j.js";import"./chevron-right-BONyyZTy.js";import"./index-C-d7IIsQ.js";import"./spinner-DMuui_2m.js";import"./index-C2vczdB5.js";import"./index-Cq0TEE3l.js";import"./index-CfXWnpL9.js";import"./iframe-h4AkwOaq.js";import"./i18next-CYn7LYXT.js";import"./dialog-TAP2eCwF.js";import"./useDebounce-CEPqGWFj.js";import"./collapsible-card-gSQy_aZA.js";import"./index-ByDNlZau.js";import"./collapsible-DZVyllqn.js";import"./chevron-up-C0Hb7JXF.js";import"./display-table-xEs_qbGm.js";import"./hover-card-DGWDDH_5.js";import"./index-SF2qmtPV.js";import"./command-CqDCn1-N.js";const us={organization:bt,variant:jt,gene:St,pathogenicity:vt,frequency:gt,occurrence:xt,parental_analysis:yt,metric_qc:ht},Ve=ft({base:"text-secondary dark:text-foreground",variants:{selected:{true:"bg-sidebar-brand-accent text-sidebar-brand-accent-foreground"}},defaultVariants:{selected:!1}});function Ke({onItemSelect:t,aggregationGroups:s,selectedItemId:n}){const{t:o}=Q(),{open:p,toggleSidebar:l}=_t(),[h,r]=a.useState(null),m=n!==void 0?n:h,u=k=>{const b=m===k?null:k;r(b),t&&t(b)};return e.jsx(kt,{variant:"sidebar",collapsible:"icon",className:"static! flex flex-col w-full bg-primary dark:bg-secondary ",children:e.jsx(Nt,{children:e.jsxs(It,{children:[e.jsxs(be,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(M,{iconOnly:!0,onClick:()=>l(),className:Ve({className:"mb-1 hover:bg-sidebar-brand-accent hover:text-sidebar-brand-accent-foreground"}),size:"sm",variant:"ghost",children:p?e.jsx(Ot,{}):e.jsx(Ct,{})})}),e.jsx(ke,{side:"right",align:"center",children:o(p?"query_filters.sidebar_panel.collapse":"query_filters.sidebar_panel.expand")})]}),e.jsx(wt,{children:Object.entries(s).map(([k])=>{const b=us[k],_=o(`query_filters.sidebar_panel.filters.${k}`);return e.jsx(Et,{children:e.jsx(At,{asChild:!0,className:Ve({selected:m===k}),onClick:g=>{g.preventDefault(),u(k)},tooltip:_,children:e.jsxs("div",{children:[e.jsx(b,{}),e.jsx("span",{children:_})]})})},k)})})]})})})}Ke.__docgenInfo={description:"",methods:[],displayName:"SidebarGroups",props:{onItemSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(itemId: string | null) => void",signature:{arguments:[{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"itemId"}],return:{name:"void"}}},description:""},selectedItemId:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregationGroups:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [key: string]: AggregationGroup;
}`,signature:{properties:[{key:{name:"string"},value:{name:"AggregationGroup",required:!0}}]}},description:""}}};const Xe=a.createContext({appId:$.variant_entity,aggregations:{}}),pe=()=>{const t=a.useContext(Xe);if(!t)throw new Error("useFilterConfig must be used within a FilterConfigProvider");return t};function Ze(t){return`temp-filters-${t}`}const ms=Ge.createContext({caseId:1,seqId:1}),ps=t=>{switch(t){case $.cnv_occurrence:return s=>de.aggregateGermlineCNVOccurrences(s.caseId,s.seqId,s.aggregationBody).then(n=>n.data);default:return s=>de.aggregateGermlineSNVOccurrences(s.caseId,s.seqId,s.aggregationBody,s.withDictionary).then(n=>n.data)}};function et(t,s=30,n=!1,o=!1,p){let l;const{caseId:h,seqId:r}=Ge.useContext(ms);n?l={caseId:h,seqId:r,aggregationBody:{field:t,size:s},withDictionary:o}:l=null;const m=D.getResolvedActiveQuery(p);return m&&l&&(l.aggregationBody.sqon={content:m.content,op:m.op}),Qe(l,ps(p),{revalidateOnFocus:!1})}var H=(t=>(t.UPDATE_ACTIVE_QUERY="update-active-query",t))(H||{});const tt=a.createContext({}),st=a.createContext(()=>{console.warn("QueryBuilderDispatchContext has been initialized without any dispatch props")});function fs(t,s){switch(s.type){case H.UPDATE_ACTIVE_QUERY:return{...t,activeQuery:s.payload};default:throw Error("Unknown action: "+s.type)}}function nt({children:t}){const[s,n]=a.useReducer(fs,{activeQuery:{}});return e.jsx(tt,{value:s,children:e.jsx(st,{value:n,children:t})})}function hs(){return a.useContext(tt)}function we(){return a.useContext(st)}nt.__docgenInfo={description:"Provider",methods:[],displayName:"QBProvider",props:{children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""}}};function rt({data:t,field:s}){const{t:n}=Q(),{appId:o}=pe(),p=we(),{data:l}=et(s.key,void 0,!0,!1,o),[h,r]=a.useState(t||l||[]),[m,u]=a.useState(null);a.useEffect(()=>{r(t||l||[])},[t,l]),a.useEffect(()=>{const g=D.getActiveQuery(o).content.find(j=>j.content.field===s.key);if(g){const j=g.content.value;j.length>=1&&u(j[0])}else u(null)},[o,s.key]);const k=a.useCallback(g=>{g.key!==m&&g.key!==void 0&&(u(g.key||null),p({type:H.UPDATE_ACTIVE_QUERY,payload:{field:s.key,value:[...g.key],merge_strategy:Z.OVERRIDE_VALUES}}))},[m]),b=a.useCallback(g=>m===g.key,[m]),_=a.useCallback(()=>{u(null)},[m]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[e.jsx(Mt,{children:h.map(g=>e.jsx("div",{className:"space-y-3 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ut,{value:g.key||"",id:g.key,checked:b(g),onClick:()=>{k(g)}}),e.jsx(me,{htmlFor:g.key,children:g.key})]}),e.jsx("span",{className:"bg-accent px-2 py-1 rounded-md font-mono text-xs",children:g.count})]})},g.key))}),m!==null&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-4 border-border"}),e.jsx("div",{className:"flex align-right justify-end items-center space-x-2",children:e.jsx(M,{onClick:_,size:"xs",children:n("common.filters.buttons.clear")})})]})]})}rt.__docgenInfo={description:"",methods:[],displayName:"BooleanFacet",props:{data:{required:!1,tsType:{name:"Array",elements:[{name:"Aggregation"}],raw:"Aggregation[]"},description:""},field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function Le(t,s){const n=t.toLowerCase().split(/\s+/).filter(Boolean);return s.filter(o=>{const p=o.key.toLowerCase(),l=o.label.toLowerCase();function h(r,m){let u=0;for(const k of m){const b=r.indexOf(k,u);if(b===-1)return!1;u=b+k.length}return!0}return h(p,n)||h(l,n)})}function je(t,s){return s<t?s:t}function ys(t,s){try{const n=sessionStorage.getItem(s);if(n){const o=JSON.parse(n),p=`${t.key}_withDictionary`;if(Object.prototype.hasOwnProperty.call(o,p))return o[p]}}catch(n){console.warn(`Failed to read dictionary toggle state from sessionStorage for ${t.key}:`,n)}return!1}function at({field:t,maxVisibleItems:s=5}){const{t:n,sanitize:o,lazyTranslate:p}=Q(),{appId:l}=pe(),h=we(),r=Ze(l),m=()=>{try{const i=sessionStorage.getItem(r);if(i){const d=JSON.parse(i);Object.keys(d).forEach(E=>{E.endsWith("_withDictionary")||delete d[E]}),Object.keys(d).length>0?sessionStorage.setItem(r,JSON.stringify(d)):sessionStorage.removeItem(r)}}catch(i){console.warn("Failed to clear unapplied filters from sessionStorage:",i)}},[u,k]=a.useState(ys(t,r)),{data:b,isLoading:_}=et(t.key,void 0,!0,u,l),g=()=>{const i=`appLoaded_${l}`;if(!window[i]){try{const T=sessionStorage.getItem(r);if(T){const B=JSON.parse(T);Object.keys(B).forEach(X=>{X.endsWith("_withDictionary")||delete B[X]}),Object.keys(B).length>0?sessionStorage.setItem(r,JSON.stringify(B)):sessionStorage.removeItem(r)}}catch(T){console.warn("Failed to clear unapplied filters on page refresh:",T)}window[i]=!0;const N=D.getResolvedActiveQuery(l).content.find(T=>T.content.field===t.key);return(N==null?void 0:N.content.value)||[]}try{const N=sessionStorage.getItem(r);if(N){const T=JSON.parse(N);if(Object.prototype.hasOwnProperty.call(T,t.key))return T[t.key]}}catch(N){console.warn(`Failed to read filter state from sessionStorage for ${t.key}:`,N)}const E=D.getResolvedActiveQuery(l).content.find(N=>N.content.field===t.key);return(E==null?void 0:E.content.value)||[]},[j,x]=a.useState(b||[]),[y,c]=a.useState(b||[]),[I,L]=a.useState(""),[S,C]=a.useState(g()),[R,V]=a.useState(je((b||[]).length,s)),[te,F]=a.useState(!1),[v,G]=a.useState(!1),[W,P]=a.useState(!1),[K,se]=a.useState(()=>{const i=D.getResolvedActiveQuery(l);return JSON.stringify(i)}),[ee,fe]=a.useState(()=>{try{const i=sessionStorage.getItem(r);if(i){const d=JSON.parse(i);return Object.prototype.hasOwnProperty.call(d,t.key)}}catch(i){console.warn(`Failed to check sessionStorage state for ${t.key}:`,i)}return!1});a.useEffect(()=>{const i=D.getResolvedActiveQuery(l),d=JSON.stringify(i);if(K&&K!==d){m();const E=D.getResolvedActiveQuery(l).content.find(N=>N.content.field===t.key),J=(E==null?void 0:E.content.value)||[];C(J)}se(d)},[l,t.key,m,S]),a.useEffect(()=>{let i=!1;try{const T=sessionStorage.getItem(r);if(T){const B=JSON.parse(T);i=Object.prototype.hasOwnProperty.call(B,t.key)}}catch(T){console.warn(`Failed to check sessionStorage values for ${t.key}:`,T)}if(i)return;const d=D.getResolvedActiveQuery(l).content.find(T=>T.content.field===t.key),E=(d==null?void 0:d.content.value)||[],J=[...S].sort(),N=[...E].sort();JSON.stringify(J)!==JSON.stringify(N)&&(v||C(E))},[l,t.key,S,v,r]),a.useEffect(()=>{const i=D.getResolvedActiveQuery(l).content.find(A=>A.content.field===t.key),d=(i==null?void 0:i.content.value)||[],E=JSON.stringify([...S].sort())!==JSON.stringify([...d].sort());G(E),S.length===0&&d.length>0&&!W&&!v&&!ee&&C(d),ee&&fe(!1),S.length>0&&W&&P(!1);let J=[];try{const A=sessionStorage.getItem(r);if(A){const Y=JSON.parse(A);Object.prototype.hasOwnProperty.call(Y,t.key)&&(J=Y[t.key]||[])}}catch(A){console.warn(`Failed to read unapplied values from sessionStorage for ${t.key}:`,A)}const N=[...b||[]],T=[...new Set([...d,...J])];T.length>0&&T.forEach(A=>{N.some(oe=>oe.key===A)||N.push({key:A,count:0,label:A})}),N==null||N.sort((A,Y)=>{const oe=A.key&&d.includes(A.key),mt=Y.key&&d.includes(Y.key);return oe===mt?Y.count-A.count:oe?-1:1}),N==null||N.forEach(A=>{A.label=n(`common.filters.values.${t.key}.${o(A.key)}`,{defaultValue:p(A.key)})}),x(N||[]);const B=I.trim()?Le(I,N||[]):N||[];c(B);const X=B.length;if(te&&X>s)V(X);else{const A=je(X,s);R!==A&&V(A),te&&A<=s&&F(!1)}},[b,l,t.key,s,r,S,W,v,ee,I]),a.useEffect(()=>{try{const i=sessionStorage.getItem(r)||"{}",d=JSON.parse(i);d[t.key]=S,sessionStorage.setItem(r,JSON.stringify(d))}catch(i){console.warn(`Failed to save filter state to sessionStorage for ${t.key}:`,i)}},[S,r,t.key]),a.useEffect(()=>{if(t.withDictionary)try{const i=sessionStorage.getItem(r)||"{}",d=JSON.parse(i),E=`${t.key}_withDictionary`;d[E]=u,sessionStorage.setItem(r,JSON.stringify(d))}catch(i){console.warn(`Failed to save dictionary toggle state to sessionStorage for ${t.key}:`,i)}},[u,r,t.key,t.withDictionary]);const he=a.useCallback(i=>{if(L(i),F(!1),!i.trim()){c(j),V(je(j.length,s));return}const d=Le(i,j);c(d),s>d.length?V(d.length):d.length>s&&V(s)},[j,s]),ye=a.useCallback(()=>{V(y.length),F(!0)},[y]),xe=a.useCallback(()=>{V(s),F(!1)},[s]),ge=a.useCallback(()=>{S.length!==y.length&&(G(!0),C(y.map(i=>i.key)))},[y,S]),z=a.useCallback(()=>{G(!0),C([]),P(!0);try{const i=sessionStorage.getItem(r);if(i){const d=JSON.parse(i);delete d[t.key],Object.keys(d).length===0?sessionStorage.removeItem(r):sessionStorage.setItem(r,JSON.stringify(d))}}catch(i){console.warn(`Failed to clear filter state from sessionStorage for ${t.key}:`,i)}},[r,t.key]),ne=a.useCallback(()=>{S.length!==0&&z()},[S,z]),re=a.useCallback(i=>{let d=[];S.some(E=>E===i.key)?d=S.filter(E=>E!==i.key):d=[...S,i.key],G(!0),C(d)},[S]),ae=a.useCallback(()=>{z()},[z]),U=a.useCallback(i=>{G(!1),P(!1),h({type:H.UPDATE_ACTIVE_QUERY,payload:{field:t.key,value:[...S],merge_strategy:Z.OVERRIDE_VALUES,operator:i}}),m()},[S,l,t.key,m]),f=a.useCallback(()=>{U(Se.In)},[U]),w=a.useCallback(()=>{U(Se.NotIn)},[U]),ve=a.useCallback(()=>{U(Se.In)},[U]);return e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{size:"sm",variant:"outline",children:[e.jsx(le,{startIcon:Jt,size:"xs",type:"text",placeholder:n("common.filters.search.placeholder"),className:"w-full text-xs mt-3 py-1.5 px-3 mb-4 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:i=>he(i.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(M,{size:"xs",onClick:()=>ge(),variant:"link",className:"px-0",children:n("common.filters.buttons.all")}),e.jsx(Pt,{orientation:"vertical",className:"h-4"}),e.jsx(M,{size:"xs",onClick:()=>ne(),variant:"link",className:"px-0",children:n("common.filters.buttons.none")}),t.withDictionary&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grow"}),e.jsx(me,{htmlFor:"with-dictionary-switch",className:"text-xs",children:n("common.filters.with_dictionary")}),e.jsx(zt,{id:"with-dictionary-switch",checked:u,size:"xs",onCheckedChange:()=>k(!u)})]})]}),e.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[_&&Array.from({length:3},(i,d)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(ue,{className:"w-full h-6 rounded"}),e.jsx(ue,{className:"h-6 w-12 rounded-md"})]},`skeleton-${d}`)),!_&&y.length===0&&e.jsx("div",{className:"text-muted-foreground py-4",children:n("common.filters.no_values_found")}),!_&&y.length>0&&Array.from({length:R},(i,d)=>e.jsx("div",{className:"gap-3 py-1.5",children:e.jsx(Qt,{size:"xs",label:n(`common.filters.labels.${t.key}_value.${y[d].key}`,{defaultValue:y[d].label}),checked:S.some(E=>E===y[d].key),count:y[d].count,onCheckedChange:()=>re(y[d])})},y[d].key))]}),!_&&y.length>R&&e.jsx(M,{className:"mt-2 px-0",onClick:ye,size:"xs",variant:"link",children:n("common.filters.buttons.show_more",{count:y.length-R})}),!_&&R>s&&e.jsx(M,{className:"mt-2 px-0",onClick:xe,size:"xs",variant:"link",children:n("common.filters.buttons.show_less")})]}),e.jsx(ze,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(M,{size:"xxs",variant:"ghost",onClick:ae,disabled:S.length===0||_,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx($t,{size:"xxs",variant:"outline",className:"h-7",color:"primary",actions:[{label:n("common.filters.buttons.some_not_in"),onClick:ve},{label:n("common.filters.buttons.not_in"),onClick:w}],onDefaultAction:f,disabled:_,children:n("common.filters.buttons.apply")})})]})})]})}at.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}}}};const ot="integer",xs=t=>{switch(t){case $.cnv_occurrence:return s=>de.statisticsGermlineCNVOccurrences(s.caseId,s.seqId,s.statisticsBody).then(n=>n.data);default:return s=>de.statisticsGermlineSNVOccurrences(s.caseId,s.seqId,s.statisticsBody).then(n=>n.data)}};function gs(t,s,n,o,p=!1){const l={caseId:n,seqId:o,statisticsBody:{field:t}},h=p?Pe:D.getResolvedActiveQuery(s);return h&&(l.statisticsBody.sqon={content:h.content,op:h.op}),Qe(l,xs(s),{revalidateOnFocus:!1})}function Be(t,s,n,o){var j;let p=!1,l=(n==null?void 0:n.defaultOperator)??O.LessThan,h="0",r="0",m="",u=!1;const k=(o==null?void 0:o.type)===ot?0:3,b=s.content.find(x=>"content"in x&&"field"in x.content?x.content.field===t:!1),_=s.content.find(x=>"content"in x&&"field"in x.content?x.content.field===`${t}_unit`:!1);if(b){const x=b.content.value;if(console.log("[NumericalFilter] values",x),x.includes("__missing__"))return{hasUnappliedItems:p,selectedRange:l,minValue:h,maxValue:r,numericalValue:m,hasNoData:!0,selectedUnit:void 0};p=!0,x.length===2?(l=O.Between,h=Number(x[0]).toFixed(k),r=Number(x[1]).toFixed(k)):m=x[0],b.op&&(l=b.op)}else console.log("[NumericalFilter else] no filter exists",n),u=!1,(n==null?void 0:n.defaultMin)!==void 0?(h=n.defaultMin.toString(),m=n.defaultMin.toString()):(o==null?void 0:o.min)!==void 0&&(h=Number(o.min.toFixed(k)).toString(),m=Number(o.min.toFixed(k)).toString()),(n==null?void 0:n.defaultMax)!==void 0?r=n.defaultMax.toString():(o==null?void 0:o.max)!==void 0&&(r=Number(o.max.toFixed(k)).toString()),n!=null&&n.defaultOperator&&(l=O[n.defaultOperator]);let g;return _&&_.content.value[0]&&((j=n==null?void 0:n.rangeTypes)!=null&&j.length)&&(g=n.rangeTypes[0].key),{hasUnappliedItems:p,selectedRange:l,minValue:h,maxValue:r,numericalValue:m,hasNoData:u,selectedUnit:g}}function it({field:t}){var z,ne,re,ae,U;const{t:s}=Q(),n=we(),{appId:o,aggregations:p}=pe(),{seqId:l,caseId:h}=a.useContext(Dt),r=t.key,m={[O.GreaterThan]:{display:s("common.filters.operators.greater_than"),dropdown:s("common.filters.operators.greater_than"),icon:Zt},[O.LessThan]:{display:s("common.filters.operators.less_than"),dropdown:s("common.filters.operators.less_than"),icon:Xt},[O.Between]:{display:s("common.filters.operators.between"),dropdown:s("common.filters.operators.between"),icon:Kt},[O.GreaterThanOrEqualTo]:{display:s("common.filters.operators.greater_than_or_equal"),dropdown:s("common.filters.operators.greater_than_or_equal"),icon:Wt},[O.LessThanOrEqualTo]:{display:s("common.filters.operators.less_than_or_equal"),dropdown:s("common.filters.operators.less_than_or_equal"),icon:Ht},[O.In]:{display:s("common.filters.operators.in"),dropdown:s("common.filters.operators.in"),icon:Yt}},{data:u,isLoading:k}=gs(r,o,h,l,!1),b=(u==null?void 0:u.type)===ot?0:3,[_,g]=a.useState(O.GreaterThan),[j,x]=a.useState("0"),[y,c]=a.useState("0"),[I,L]=a.useState("0"),[S,C]=a.useState(!1),[R,V]=a.useState(),[te,F]=a.useState(!1),v=(z=Object.values(p).flatMap(f=>f.items).find(f=>f.key===r))==null?void 0:z.defaults,G=t.type==="numerical"&&(v==null?void 0:v.noDataInputOption),W=(v==null?void 0:v.intervalDecimal)!==void 0&&((v==null?void 0:v.max)!==void 0||(v==null?void 0:v.min)!==void 0)||u&&(u.min!==void 0||u.max!==void 0),P=(v==null?void 0:v.min)??(u==null?void 0:u.min)??0,K=(v==null?void 0:v.max)??(u==null?void 0:u.max)??100,se=a.useCallback(()=>{const f=D.getResolvedActiveQuery(o);if(!(f!=null&&f.content))return;const w=Be(r,f,v,u);C(w.hasNoData),L(w.minValue),c(w.maxValue),F(w.hasUnappliedItems),g(w.selectedRange??O.GreaterThan),x(w.numericalValue)},[o,r,v,u]);a.useEffect(()=>{se()},[se]);const ee=a.useCallback(f=>{g(f),F(!0)},[]),fe=a.useCallback(f=>{C(f),F(!0)},[]),he=a.useCallback(f=>{V(f),F(!0)},[]),ye=()=>{F(!1);const f=Be(r,Pe,v,u);C(f.hasNoData),L(f.minValue),c(f.maxValue),F(f.hasUnappliedItems),g(f.selectedRange),x(f.numericalValue)},xe=a.useCallback(()=>{if(F(!1),S){n({type:H.UPDATE_ACTIVE_QUERY,payload:{field:r,value:["__missing__"],merge_strategy:Z.OVERRIDE_VALUES}});return}let f=[];f=_===O.Between?[parseFloat(I.toString()),parseFloat(y.toString())]:[parseFloat(j.toString())],n({type:H.UPDATE_ACTIVE_QUERY,payload:{field:r,value:f,merge_strategy:Z.OVERRIDE_VALUES,operator:_}}),R&&n({type:H.UPDATE_ACTIVE_QUERY,payload:{field:`${r}_unit`,value:[R],merge_strategy:Z.OVERRIDE_VALUES}})},[o,r,_,j,I,y,S,R]),ge=Object.entries(O).map(([f,w])=>{if(w in m){const ve=m[w].icon;return e.jsx(Ce,{value:w,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:16}),e.jsx("span",{children:m[w].dropdown})]})},w)}return null}).filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{id:`${r}_container`,size:"sm",variant:"outline",children:e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${r}_operator`,children:e.jsxs(Re,{value:_,onValueChange:ee,children:[e.jsx(Fe,{size:"sm",children:e.jsx(qe,{placeholder:s("common.filters.operators.select_operator"),children:((ne=m[_])==null?void 0:ne.display)||s("common.filters.operators.unknown")})}),e.jsx(De,{children:ge})]})}),_===O.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(le,{size:"xs",className:"w-half",value:I,onChange:f=>{const w=f.target.value;isNaN(Number(w))||(L(w),F(!0))},min:P,max:K,id:`${r}_min`,"data-testid":`${r}_min`}),e.jsx(le,{size:"xs",className:"w-half",value:y,onChange:f=>{const w=f.target.value;isNaN(Number(w))||(c(w),F(!0))},min:P,max:K,id:`${r}_max`,"data-testid":`${r}_max`})]}):e.jsx(le,{size:"xs",className:"w-full",value:j,onChange:f=>{const w=f.target.value;isNaN(Number(w))||(x(w),F(!0))},min:P,max:K,id:`${r}_value`,"data-testid":`${r}_value`}),W&&e.jsx("div",{id:`${r}_interval`,children:e.jsxs(Vt,{size:"xs",children:[s("common.filters.labels.actual_interval")," : ",(re=u==null?void 0:u.min)==null?void 0:re.toFixed(b)," -"," ",(ae=u==null?void 0:u.max)==null?void 0:ae.toFixed(b)]})})]}),(v==null?void 0:v.rangeTypes)&&v.rangeTypes.length>0&&e.jsx("div",{id:`${r}_range_type_container`,className:"mt-3",children:k?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-5 w-16 mb-1",id:`${r}_unit_label_skeleton`}),e.jsx(ue,{className:"h-9 w-full",id:`${r}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"text-sm",id:`${r}_unit_label`,children:s("common.filters.labels.unit")}),e.jsxs(Re,{defaultValue:R||v.rangeTypes[0].key,onValueChange:he,children:[e.jsx(Fe,{children:e.jsx(qe,{placeholder:s("common.filters.labels.select_unit"),children:((U=v.rangeTypes.find(f=>f.key===R))==null?void 0:U.name)||s("common.filters.labels.select_unit")})}),e.jsx(De,{children:v.rangeTypes.map(f=>e.jsx(Ce,{value:f.key,children:f.name},f.key))})]})]})}),G&&!W&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden mt-3",id:`${r}_no_data_label`,children:[e.jsx(es,{checked:S,onCheckedChange:fe,id:`${r}_no_data`}),e.jsx("span",{children:s("common.filters.labels.no_data")})]})]})}),e.jsx(ze,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(M,{size:"xxs",variant:"ghost",onClick:ye,disabled:!te,id:`${r}_clear`,children:s("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(M,{size:"xxs",variant:"outline",onClick:xe,id:`${r}_apply`,children:s("common.filters.buttons.apply")})})]})})]})}it.__docgenInfo={description:"",methods:[],displayName:"NumericalFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function ce({field:t,children:s}){const{t:n}=Q(),o=n(`common.filters.labels.${t.translation_key}`,{defaultValue:t.key});let p=null;if(Lt.includes(t.key)){const h=`common.filters.labels.${t.translation_key}_tooltip`;p=n(h)===h?null:n(h)}function l(){return e.jsx("div",{className:"flex items-center justify-between w-full text-xs",children:e.jsx("span",{children:o})})}return e.jsx(Ie,{size:"sm",children:e.jsxs(Je,{value:t.key,className:"border-none",children:[e.jsx(Gt,{size:"sm",children:e.jsx(Ye,{children:p?e.jsxs(be,{children:[e.jsx(_e,{asChild:!0,children:e.jsx("span",{children:l()})}),e.jsx(ke,{children:e.jsx("span",{children:p})})]}):l()})}),e.jsx(He,{className:"pb-0",children:s})]},t.key)})}function lt({field:t,isOpen:s}){const{t:n}=Q(),o=t.type;if(o===q.DIVIDER)return e.jsx("h4",{className:"px-2 h-8 text-sidebar-foreground/70 text-xs font-medium line-height-xs text-ellipsis overflow-hidden flex justify-between items-center",children:n(`common.filters.${t.key}`)});let p;switch(o){case q.MULTIPLE:p=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(at,{field:t})});break;case q.NUMERICAL:p=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(it,{field:t})});break;case q.BOOLEAN:p=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(rt,{field:t})});break;default:p=e.jsx("div",{children:n("common.filters.unsupported_type",{type:t.type})})}return p}ce.__docgenInfo={description:"",methods:[],displayName:"AccordionContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};lt.__docgenInfo={description:"To be use when the facet needs to be inside an Accordion component",methods:[],displayName:"FacetContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""}}};function ct({search:t}){const{t:s}=Q(),{appId:n}=pe(),{translation_key:o,key:p}=t,l=p.replace(/search_by_/g,""),[h,r]=a.useState([]),[m,u]=a.useState([]),[k,b]=a.useState(null);a.useEffect(()=>{var c;const j=D.getResolvedActiveQuery(n);if(JSON.stringify(j)===JSON.stringify(k))return;const x=j.content.find(I=>"content"in I&&"field"in I.content?I.content.field===l:!1),y=((c=x==null?void 0:x.content)==null?void 0:c.value)||[];Array.isArray(y)&&r(y),b(j)},[n,l,D.getActiveQuery(n)]),a.useEffect(()=>{(async()=>{if(h.length===0){u([]);return}try{const x=h.map(async c=>{var I,L;try{const C=(await Te.geneAutoComplete(c)).data.find(R=>{var V;return((V=R.source)==null?void 0:V.name)===c});if(C)return{value:c,label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:((I=C.source)==null?void 0:I.name)||c}),e.jsx("span",{className:"text-xs text-muted-foreground",children:((L=C.source)==null?void 0:L.id)||""})]}),badgeLabel:c}}catch(S){console.error(`Error fetching gene ${c}:`,S)}return{value:c,label:c,badgeLabel:c}}),y=await Promise.all(x);u(y)}catch(x){console.error("Error fetching gene details:",x);const y=h.map(c=>({value:c,label:c,badgeLabel:c}));u(y)}})()},[h]);const _=async j=>{if(!j)return[];try{return(await Te.geneAutoComplete(j)).data.map(y=>{var c,I,L,S,C,R;return{value:((c=y.source)==null?void 0:c.name)||"",label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:Oe(((I=y.highlight)==null?void 0:I.name)||((L=y.source)==null?void 0:L.name)||"")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Oe(((S=y.highlight)==null?void 0:S.id)||((C=y.source)==null?void 0:C.id)||"")})]}),badgeLabel:((R=y.source)==null?void 0:R.name)||""}})}catch(x){return console.error("Error fetching genes:",x),[]}},g=j=>{r(j),D.updateActiveQueryField(n,{field:l,value:j,merge_strategy:Z.OVERRIDE_VALUES})};return e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{children:s(`common.filters.labels.${o}`)}),e.jsxs(be,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(ss,{size:16})}),e.jsx(ke,{children:s(`common.filters.labels.${o}_tooltip`)})]})]}),e.jsx(ts,{value:h,defaultOptions:m,onChange:g,onSearch:_,placeholder:s(`common.filters.labels.${o}_placeholder`),className:"w-full",debounceDelay:300,maxSelected:100,hidePlaceholderWhenSelected:!0})]})}ct.__docgenInfo={description:"",methods:[],displayName:"SearchFacet",props:{search:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function dt({groupKey:t,appId:s,aggregations:n}){var y;const{t:o}=Q(),[p,l]=a.useState(!1),[h,r]=a.useState([]),[m,u]=a.useState(t),k=Ze(s),b=()=>{sessionStorage.removeItem(k)},_=t?((y=n[t])==null?void 0:y.items)||[]:Object.values(n).flatMap(c=>c.items),g=_.filter(c=>c.type===q.SEARCH_BY),j=_.filter(c=>c.type===q.UPLOAD_LIST),x=_.filter(c=>c.type!==q.SEARCH_BY&&c.type!==q.UPLOAD_LIST);return a.useEffect(()=>{l(!1),r([])},[t]),a.useEffect(()=>{(m&&m!==null&&t===null||m&&m!==null&&t&&t!==null&&m!==t)&&b(),u(t)},[t,m]),e.jsx(Xe,{value:{appId:s,aggregations:n},children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3",children:[g.map((c,I)=>e.jsx(ct,{search:c},`${c.key}-${I}`)),j.map((c,I)=>e.jsx(Bt,{variant:c.key.replace(/upload_list_/g,"")},`${c.key}-${I}`))]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(M,{variant:"link",size:"xs",onClick:()=>{const c=!p;l(c),r(c?x.map(I=>I.key):[])},children:o(p?"common.actions.collapse_all":"common.actions.expand_all")})}),e.jsx(We,{className:"flex flex-col gap-1",type:"multiple",value:h,onValueChange:c=>r(c),children:x.map((c,I)=>e.jsx(lt,{isOpen:h.includes(c.key),field:c},`${c.key}-${I}`))})]})})}dt.__docgenInfo={description:"",methods:[],displayName:"FacetList",props:{groupKey:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregations:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [key: string]: AggregationGroup;
}`,signature:{properties:[{key:{name:"string"},value:{name:"AggregationGroup",required:!0}}]}},description:""},appId:{required:!0,tsType:{name:"ApplicationId"},description:""}}};function ut(){const{activeQuery:t}=hs();return console.log("activeQuery",t),e.jsx(Ie,{className:"py-0",children:e.jsx(We,{type:"multiple",defaultValue:["query-builder"],children:e.jsxs(Je,{value:"query-builder",className:"border-none",children:[e.jsx(Ye,{className:"border-b py-0 px-6 data-[state=closed]:rounded-sm data-[state=closed]:border-none hover:cursor-pointer",asChild:!0,children:"Title Placeholder"}),e.jsx(He,{className:"py-4 px-6 space-y-4",children:e.jsx("div",{className:"flex flex-col gap-2 max-h-[30vh] overflow-y-scroll",children:t==null?void 0:t.field})})]})})})}ut.__docgenInfo={description:"",methods:[],displayName:"Query"};function vs(t){return Object.fromEntries(Object.entries(t).map(([s,n])=>{const o={...n,items:n.items.filter(p=>p.facetHidden!==!0)};return[s,o]}).filter(([s,n])=>n.items.length>0))}function Ee({appId:t,defaultSidebarOpen:s=!1,children:n}){const[o,p]=a.useState(s),l=Rt(),h=vs(l[t].aggregations),[r,m]=a.useState(null);return e.jsx(nt,{children:e.jsx("div",{className:"bg-muted w-full",children:e.jsxs("div",{className:"flex flex-1 h-screen overflow-hidden",children:[e.jsx("aside",{className:"w-auto min-w-fit h-full shrink-0",children:e.jsxs(Tt,{open:o,onOpenChange:p,className:"h-full flex flex-row",children:[e.jsx("div",{className:"z-10",children:e.jsx(Ke,{aggregationGroups:h,selectedItemId:r,onItemSelect:m})}),e.jsx("div",{className:qt("overflow-auto mb-16 border-r transition-[width] duration-300 ease-in-out",{"w-[280px] p-4 opacity-100 relative":r,"w-0 opacity-0":!r}),children:e.jsxs("div",{className:"whitespace-nowrap",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>m(null),className:"text-muted-foreground hover:text-foreground",children:e.jsx(ns,{size:16})})}),e.jsx(dt,{appId:t,aggregations:h,groupKey:r})]})})]})}),e.jsxs("main",{className:"flex-1 shrink px-3 pb-3 overflow-auto",children:[e.jsx("div",{className:"py-3 space-y-2",children:e.jsx(ut,{})}),n]})]})})})}Ee.__docgenInfo={description:"",methods:[],displayName:"QueryBuilder",props:{appId:{required:!0,tsType:{name:"ApplicationId"},description:""},children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""},defaultSidebarOpen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const Ss={variant_entity:{app_id:$.variant_entity},snv_occurrence:{app_id:$.snv_occurrence,aggregations:{variant:{items:[{key:"multiple",translation_key:"multiple",type:q.MULTIPLE},{key:"multiple (with dictionary)",translation_key:"multiple (with dictionary)",type:q.MULTIPLE,withDictionary:!0},{key:"numerical (decimal)",translation_key:"numerical (decimal)",type:q.NUMERICAL,defaults:{min:0,max:100,defaultOperator:O.LessThan,defaultMin:0,defaultMax:100}},{key:"numerical (integer)",translation_key:"numerical (integer)",type:q.NUMERICAL,defaults:{min:0,max:100,defaultOperator:O.LessThan,defaultMin:0,defaultMax:100}},{key:"numerical (with unit)",translation_key:"numerical (with unit)",type:q.NUMERICAL,defaults:{min:0,max:120,defaultOperator:O.Between,defaultMin:0,defaultMax:120,intervalDecimal:0,rangeTypes:[{key:"year",name:"Year"},{key:"month",name:"Month"},{key:"day",name:"Day"}]}},{key:"numerical (no data)",translation_key:"numerical (no data)",type:q.NUMERICAL,defaults:{min:void 0,max:void 0,defaultOperator:O.GreaterThan,noDataInputOption:!0}},{key:"toggle filter",translation_key:"toggle filter",type:q.BOOLEAN}]}}},cnv_occurrence:{app_id:$.cnv_occurrence,aggregations:{}},admin:{admin_code:"admin",app_id:$.admin},portal:{name:"",navigation:{}}},Kn={title:"QueryBuilder/QueryBuilderV3",component:Ee,args:{},decorators:[t=>e.jsx(ls,{initialEntries:["/case/1"],children:e.jsx(cs,{children:e.jsx(ds,{path:"/case/:caseId",element:e.jsx(Ft,{config:Ss,children:e.jsx(t,{})})})})})]},ie={parameters:{msw:{handlers:[Ae.post(rs,as),Ae.post(os,is)]}},args:{},render:()=>e.jsx(Ee,{appId:$.snv_occurrence,defaultSidebarOpen:!0,children:e.jsx(Ie,{children:e.jsx(Ne,{children:e.jsx(pt,{id:"storybook-query-builder",columns:[],data:[],loadingStates:{total:!1,list:!1},defaultColumnSettings:[],pagination:{type:"hidden",state:void 0,onPaginationChange:void 0}})})})})};var Me,Ue,$e;ie.parameters={...ie.parameters,docs:{...(Me=ie.parameters)==null?void 0:Me.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(occurrenceApi, httpOccurrenceApiResponse), http.post(statisticApi, httpStatisticsApiResponse)]
    }
  },
  args: {},
  render: () => <QueryBuilder appId={ApplicationId.snv_occurrence} defaultSidebarOpen>
      <Card>
        <CardContent>
          <DataTable id="storybook-query-builder" columns={[]} data={[]} loadingStates={{
          total: false,
          list: false
        }} defaultColumnSettings={[]} pagination={{
          type: 'hidden',
          state: undefined,
          onPaginationChange: undefined
        }} />
        </CardContent>
      </Card>
    </QueryBuilder>
}`,...($e=(Ue=ie.parameters)==null?void 0:Ue.docs)==null?void 0:$e.source}}};const Xn=["Default"];export{ie as Default,Xn as __namedExportsOrder,Kn as default};
