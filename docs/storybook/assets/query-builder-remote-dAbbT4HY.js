var Un=Object.defineProperty;var Ln=(t,e,n)=>e in t?Un(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var J=(t,e,n)=>Ln(t,typeof e!="symbol"?e+"":e,n);import{a5 as ue}from"./iframe-DMgXTsUt.js";import{r as Nn,a as ce,b as bt,c as le,d as _t,e as jr,f as fe,g as ht,h as Mn,i as Qt,j as Dr,k as K,l as Vn,m as Kn,n as xr,o as Gn,p as Yn,q as Ur,s as $n,t as Wn,u as Lr,v as de,w as Nr,x as Mr,y as Vr,z as Hn,A as Jn,B as Xn,C as Kr,D as kn,E as Zn,F as zn}from"./isEqual-DcYXrK42.js";import{B as pe,a as At,T as Gr,M as k,S as Bn,R as Ct,s as ei}from"./sqon-COfEEhMd.js";var ge,Ft;function ti(){if(Ft)return ge;Ft=1;var t=Nn(),e=ce(),n=bt(),r=fe(),i=le(),a=_t(),s=ht(),o=jr(),u="[object Map]",c="[object Set]",l=Object.prototype,f=l.hasOwnProperty;function d(p){if(p==null)return!0;if(i(p)&&(r(p)||typeof p=="string"||typeof p.splice=="function"||a(p)||o(p)||n(p)))return!p.length;var b=e(p);if(b==u||b==c)return!p.size;if(s(p))return!t(p).length;for(var y in p)if(f.call(p,y))return!1;return!0}return ge=d,ge}var ri=ti();const q=ue(ri),Q=[];for(let t=0;t<256;++t)Q.push((t+256).toString(16).slice(1));function ni(t,e=0){return(Q[t[e+0]]+Q[t[e+1]]+Q[t[e+2]]+Q[t[e+3]]+"-"+Q[t[e+4]]+Q[t[e+5]]+"-"+Q[t[e+6]]+Q[t[e+7]]+"-"+Q[t[e+8]]+Q[t[e+9]]+"-"+Q[t[e+10]]+Q[t[e+11]]+Q[t[e+12]]+Q[t[e+13]]+Q[t[e+14]]+Q[t[e+15]]).toLowerCase()}let ye;const ii=new Uint8Array(16);function ai(){if(!ye){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ye=crypto.getRandomValues.bind(crypto)}return ye(ii)}const si=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qt={randomUUID:si};function I(t,e,n){var i;if(qt.randomUUID&&!t)return qt.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??ai();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ni(r)}var be,wt;function oi(){if(wt)return be;wt=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i&&n(e[r],r,e)!==!1;);return e}return be=t,be}var _e,jt;function Yr(){if(jt)return _e;jt=1;var t=Mn(),e=(function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}})();return _e=e,_e}var he,Dt;function mt(){if(Dt)return he;Dt=1;var t=Yr();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return he=e,he}var Qe,xt;function $r(){if(xt)return Qe;xt=1;var t=mt(),e=Qt(),n=Object.prototype,r=n.hasOwnProperty;function i(a,s,o){var u=a[s];(!(r.call(a,s)&&e(u,o))||o===void 0&&!(s in a))&&t(a,s,o)}return Qe=i,Qe}var Ae,Ut;function z(){if(Ut)return Ae;Ut=1;var t=$r(),e=mt();function n(r,i,a,s){var o=!a;a||(a={});for(var u=-1,c=i.length;++u<c;){var l=i[u],f=s?s(a[l],r[l],l,a,r):void 0;f===void 0&&(f=r[l]),o?e(a,l,f):t(a,l,f)}return a}return Ae=n,Ae}var me,Lt;function ui(){if(Lt)return me;Lt=1;var t=z(),e=Dr();function n(r,i){return r&&t(i,e(i),r)}return me=n,me}var Se,Nt;function ci(){if(Nt)return Se;Nt=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return Se=t,Se}var Ie,Mt;function li(){if(Mt)return Ie;Mt=1;var t=K(),e=ht(),n=ci(),r=Object.prototype,i=r.hasOwnProperty;function a(s){if(!t(s))return n(s);var o=e(s),u=[];for(var c in s)c=="constructor"&&(o||!i.call(s,c))||u.push(c);return u}return Ie=a,Ie}var Pe,Vt;function B(){if(Vt)return Pe;Vt=1;var t=Vn(),e=li(),n=le();function r(i){return n(i)?t(i,!0):e(i)}return Pe=r,Pe}var Te,Kt;function fi(){if(Kt)return Te;Kt=1;var t=z(),e=B();function n(r,i){return r&&t(i,e(i),r)}return Te=n,Te}var X={exports:{}};X.exports;var Gt;function Wr(){return Gt||(Gt=1,(function(t,e){var n=Kn(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===r,s=a?n.Buffer:void 0,o=s?s.allocUnsafe:void 0;function u(c,l){if(l)return c.slice();var f=c.length,d=o?o(f):new c.constructor(f);return c.copy(d),d}t.exports=u})(X,X.exports)),X.exports}var Re,Yt;function Hr(){if(Yt)return Re;Yt=1;function t(e,n){var r=-1,i=e.length;for(n||(n=Array(i));++r<i;)n[r]=e[r];return n}return Re=t,Re}var Oe,$t;function di(){if($t)return Oe;$t=1;var t=z(),e=xr();function n(r,i){return t(r,e(r),i)}return Oe=n,Oe}var Ee,Wt;function St(){if(Wt)return Ee;Wt=1;var t=Gn(),e=t(Object.getPrototypeOf,Object);return Ee=e,Ee}var Ce,Ht;function Jr(){if(Ht)return Ce;Ht=1;var t=Ur(),e=St(),n=xr(),r=Yn(),i=Object.getOwnPropertySymbols,a=i?function(s){for(var o=[];s;)t(o,n(s)),s=e(s);return o}:r;return Ce=a,Ce}var Fe,Jt;function pi(){if(Jt)return Fe;Jt=1;var t=z(),e=Jr();function n(r,i){return t(r,e(r),i)}return Fe=n,Fe}var qe,Xt;function vi(){if(Xt)return qe;Xt=1;var t=$n(),e=Jr(),n=B();function r(i){return t(i,n,e)}return qe=r,qe}var we,kt;function gi(){if(kt)return we;kt=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var i=r.length,a=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(a.index=r.index,a.input=r.input),a}return we=n,we}var je,Zt;function It(){if(Zt)return je;Zt=1;var t=Wn();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return je=e,je}var De,zt;function yi(){if(zt)return De;zt=1;var t=It();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}return De=e,De}var xe,Bt;function bi(){if(Bt)return xe;Bt=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return xe=e,xe}var Ue,er;function _i(){if(er)return Ue;er=1;var t=Lr(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(i){return n?Object(n.call(i)):{}}return Ue=r,Ue}var Le,tr;function Xr(){if(tr)return Le;tr=1;var t=It();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}return Le=e,Le}var Ne,rr;function hi(){if(rr)return Ne;rr=1;var t=It(),e=yi(),n=bi(),r=_i(),i=Xr(),a="[object Boolean]",s="[object Date]",o="[object Map]",u="[object Number]",c="[object RegExp]",l="[object Set]",f="[object String]",d="[object Symbol]",p="[object ArrayBuffer]",b="[object DataView]",y="[object Float32Array]",E="[object Float64Array]",L="[object Int8Array]",R="[object Int16Array]",Y="[object Int32Array]",$="[object Uint8Array]",j="[object Uint8ClampedArray]",O="[object Uint16Array]",A="[object Uint32Array]";function _(m,h,P){var T=m.constructor;switch(h){case p:return t(m);case a:case s:return new T(+m);case b:return e(m,P);case y:case E:case L:case R:case Y:case $:case j:case O:case A:return i(m,P);case o:return new T;case u:case f:return new T(m);case c:return n(m);case l:return new T;case d:return r(m)}}return Ne=_,Ne}var Me,nr;function Qi(){if(nr)return Me;nr=1;var t=K(),e=Object.create,n=(function(){function r(){}return function(i){if(!t(i))return{};if(e)return e(i);r.prototype=i;var a=new r;return r.prototype=void 0,a}})();return Me=n,Me}var Ve,ir;function kr(){if(ir)return Ve;ir=1;var t=Qi(),e=St(),n=ht();function r(i){return typeof i.constructor=="function"&&!n(i)?t(e(i)):{}}return Ve=r,Ve}var Ke,ar;function Ai(){if(ar)return Ke;ar=1;var t=ce(),e=de(),n="[object Map]";function r(i){return e(i)&&t(i)==n}return Ke=r,Ke}var Ge,sr;function mi(){if(sr)return Ge;sr=1;var t=Ai(),e=Nr(),n=Mr(),r=n&&n.isMap,i=r?e(r):t;return Ge=i,Ge}var Ye,or;function Si(){if(or)return Ye;or=1;var t=ce(),e=de(),n="[object Set]";function r(i){return e(i)&&t(i)==n}return Ye=r,Ye}var $e,ur;function Ii(){if(ur)return $e;ur=1;var t=Si(),e=Nr(),n=Mr(),r=n&&n.isSet,i=r?e(r):t;return $e=i,$e}var We,cr;function Pi(){if(cr)return We;cr=1;var t=Vr(),e=oi(),n=$r(),r=ui(),i=fi(),a=Wr(),s=Hr(),o=di(),u=pi(),c=Hn(),l=vi(),f=ce(),d=gi(),p=hi(),b=kr(),y=fe(),E=_t(),L=mi(),R=K(),Y=Ii(),$=Dr(),j=B(),O=1,A=2,_=4,m="[object Arguments]",h="[object Array]",P="[object Boolean]",T="[object Date]",W="[object Error]",H="[object Function]",gn="[object GeneratorFunction]",yn="[object Map]",bn="[object Number]",Pt="[object Object]",_n="[object RegExp]",hn="[object Set]",Qn="[object String]",An="[object Symbol]",mn="[object WeakMap]",Sn="[object ArrayBuffer]",In="[object DataView]",Pn="[object Float32Array]",Tn="[object Float64Array]",Rn="[object Int8Array]",On="[object Int16Array]",En="[object Int32Array]",Cn="[object Uint8Array]",Fn="[object Uint8ClampedArray]",qn="[object Uint16Array]",wn="[object Uint32Array]",g={};g[m]=g[h]=g[Sn]=g[In]=g[P]=g[T]=g[Pn]=g[Tn]=g[Rn]=g[On]=g[En]=g[yn]=g[bn]=g[Pt]=g[_n]=g[hn]=g[Qn]=g[An]=g[Cn]=g[Fn]=g[qn]=g[wn]=!0,g[W]=g[H]=g[mn]=!1;function ie(v,N,M,jn,ae,C){var S,se=N&O,oe=N&A,Dn=N&_;if(M&&(S=ae?M(v,jn,ae,C):M(v)),S!==void 0)return S;if(!R(v))return v;var Tt=y(v);if(Tt){if(S=d(v),!se)return s(v,S)}else{var V=f(v),Rt=V==H||V==gn;if(E(v))return a(v,se);if(V==Pt||V==m||Rt&&!ae){if(S=oe||Rt?{}:b(v),!se)return oe?u(v,i(S,v)):o(v,r(S,v))}else{if(!g[V])return ae?v:{};S=p(v,V,se)}}C||(C=new t);var Ot=C.get(v);if(Ot)return Ot;C.set(v,S),Y(v)?v.forEach(function(F){S.add(ie(F,N,M,F,v,C))}):L(v)&&v.forEach(function(F,D){S.set(D,ie(F,N,M,D,v,C))});var xn=Dn?oe?l:c:oe?j:$,Et=Tt?void 0:xn(v);return e(Et||v,function(F,D){Et&&(D=F,F=v[D]),n(S,D,ie(F,N,M,D,v,C))}),S}return We=ie,We}var He,lr;function Ti(){if(lr)return He;lr=1;var t=Pi(),e=1,n=4;function r(i){return t(i,e|n)}return He=r,He}var Ri=Ti();const x=ue(Ri);var Je,fr;function Zr(){if(fr)return Je;fr=1;var t=mt(),e=Qt();function n(r,i,a){(a!==void 0&&!e(r[i],a)||a===void 0&&!(i in r))&&t(r,i,a)}return Je=n,Je}var Xe,dr;function Oi(){if(dr)return Xe;dr=1;function t(e){return function(n,r,i){for(var a=-1,s=Object(n),o=i(n),u=o.length;u--;){var c=o[e?u:++a];if(r(s[c],c,s)===!1)break}return n}}return Xe=t,Xe}var ke,pr;function Ei(){if(pr)return ke;pr=1;var t=Oi(),e=t();return ke=e,ke}var Ze,vr;function zr(){if(vr)return Ze;vr=1;var t=le(),e=de();function n(r){return e(r)&&t(r)}return Ze=n,Ze}var ze,gr;function Ci(){if(gr)return ze;gr=1;var t=Jn(),e=St(),n=de(),r="[object Object]",i=Function.prototype,a=Object.prototype,s=i.toString,o=a.hasOwnProperty,u=s.call(Object);function c(l){if(!n(l)||t(l)!=r)return!1;var f=e(l);if(f===null)return!0;var d=o.call(f,"constructor")&&f.constructor;return typeof d=="function"&&d instanceof d&&s.call(d)==u}return ze=c,ze}var Be,yr;function Br(){if(yr)return Be;yr=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return Be=t,Be}var et,br;function Fi(){if(br)return et;br=1;var t=z(),e=B();function n(r){return t(r,e(r))}return et=n,et}var tt,_r;function qi(){if(_r)return tt;_r=1;var t=Zr(),e=Wr(),n=Xr(),r=Hr(),i=kr(),a=bt(),s=fe(),o=zr(),u=_t(),c=Xn(),l=K(),f=Ci(),d=jr(),p=Br(),b=Fi();function y(E,L,R,Y,$,j,O){var A=p(E,R),_=p(L,R),m=O.get(_);if(m){t(E,R,m);return}var h=j?j(A,_,R+"",E,L,O):void 0,P=h===void 0;if(P){var T=s(_),W=!T&&u(_),H=!T&&!W&&d(_);h=_,T||W||H?s(A)?h=A:o(A)?h=r(A):W?(P=!1,h=e(_,!0)):H?(P=!1,h=n(_,!0)):h=[]:f(_)||a(_)?(h=A,a(A)?h=b(A):(!l(A)||c(A))&&(h=i(_))):P=!1}P&&(O.set(_,h),$(h,_,Y,j,O),O.delete(_)),t(E,R,h)}return tt=y,tt}var rt,hr;function wi(){if(hr)return rt;hr=1;var t=Vr(),e=Zr(),n=Ei(),r=qi(),i=K(),a=B(),s=Br();function o(u,c,l,f,d){u!==c&&n(c,function(p,b){if(d||(d=new t),i(p))r(u,c,b,l,o,f,d);else{var y=f?f(s(u,b),p,b+"",u,c,d):void 0;y===void 0&&(y=p),e(u,b,y)}},a)}return rt=o,rt}var nt,Qr;function ji(){if(Qr)return nt;Qr=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return nt=t,nt}var it,Ar;function Di(){if(Ar)return it;Ar=1;var t=ji(),e=Math.max;function n(r,i,a){return i=e(i===void 0?r.length-1:i,0),function(){for(var s=arguments,o=-1,u=e(s.length-i,0),c=Array(u);++o<u;)c[o]=s[i+o];o=-1;for(var l=Array(i+1);++o<i;)l[o]=s[o];return l[i]=a(c),t(r,this,l)}}return it=n,it}var at,mr;function xi(){if(mr)return at;mr=1;function t(e){return function(){return e}}return at=t,at}var st,Sr;function Ui(){if(Sr)return st;Sr=1;var t=xi(),e=Yr(),n=Kr(),r=e?function(i,a){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(a),writable:!0})}:n;return st=r,st}var ot,Ir;function Li(){if(Ir)return ot;Ir=1;var t=800,e=16,n=Date.now;function r(i){var a=0,s=0;return function(){var o=n(),u=e-(o-s);if(s=o,u>0){if(++a>=t)return arguments[0]}else a=0;return i.apply(void 0,arguments)}}return ot=r,ot}var ut,Pr;function Ni(){if(Pr)return ut;Pr=1;var t=Ui(),e=Li(),n=e(t);return ut=n,ut}var ct,Tr;function en(){if(Tr)return ct;Tr=1;var t=Kr(),e=Di(),n=Ni();function r(i,a){return n(e(i,a,t),i+"")}return ct=r,ct}var lt,Rr;function Mi(){if(Rr)return lt;Rr=1;var t=Qt(),e=le(),n=kn(),r=K();function i(a,s,o){if(!r(o))return!1;var u=typeof s;return(u=="number"?e(o)&&n(s,o.length):u=="string"&&s in o)?t(o[s],a):!1}return lt=i,lt}var ft,Or;function Vi(){if(Or)return ft;Or=1;var t=en(),e=Mi();function n(r){return t(function(i,a){var s=-1,o=a.length,u=o>1?a[o-1]:void 0,c=o>2?a[2]:void 0;for(u=r.length>3&&typeof u=="function"?(o--,u):void 0,c&&e(a[0],a[1],c)&&(u=o<3?void 0:u,o=1),i=Object(i);++s<o;){var l=a[s];l&&r(i,l,s,u)}return i})}return ft=n,ft}var dt,Er;function Ki(){if(Er)return dt;Er=1;var t=wi(),e=Vi(),n=e(function(r,i,a){t(r,i,a)});return dt=n,dt}var Gi=Ki();const Yi=ue(Gi);var pt,Cr;function $i(){if(Cr)return pt;Cr=1;var t=Lr(),e=bt(),n=fe(),r=t?t.isConcatSpreadable:void 0;function i(a){return n(a)||e(a)||!!(r&&a&&a[r])}return pt=i,pt}var vt,Fr;function Wi(){if(Fr)return vt;Fr=1;var t=Ur(),e=$i();function n(r,i,a,s,o){var u=-1,c=r.length;for(a||(a=e),o||(o=[]);++u<c;){var l=r[u];i>0&&a(l)?i>1?n(l,i-1,a,s,o):t(o,l):s||(o[o.length]=l)}return o}return vt=n,vt}var gt,qr;function Hi(){if(qr)return gt;qr=1;var t=Wi(),e=en(),n=Zn(),r=zr(),i=e(function(a){return n(t(a,1,r,!0))});return gt=i,gt}var Ji=Hi();const Xi=ue(Ji),w=t=>!Object.keys(t).length||q(t==null?void 0:t.content),tn=t=>!w(t),ee=t=>!ki(t),ki=t=>isNaN(t),Sa=t=>t.content.value&&t.content.value.some(e=>e==null?void 0:e.toString().startsWith(Bn)),Ia=t=>!!t.content.isUploadedList,Pa=t=>!!t.content.remoteComponent,te=t=>typeof t=="object"&&tn(t)&&"op"in t&&Object.values(pe).includes(t.op),Ta=t=>t.content.value.every(e=>["false","true"].includes(e.toString().toLowerCase())),Ra=t=>t.op===Ct.In?!1:t.op in Ct,Oa=t=>!!t.title,U=(t=I())=>({id:t,content:[],op:pe.And}),Ea=(t,e=[])=>{const n=x(t),r=[];return n.map(i=>{r.push(Zi(i,e))}),r},Zi=(t,e)=>({content:t.content.filter(r=>{let i=!1;if(!Array.isArray(r.content))r.content&&e!=null&&e.includes(r.content.field)||(i=!0);else if(r.content.length!==0&&(e!=null&&e.includes(r.content.field)||(i=!0),Array.isArray(r.content))){const{field:a}=r.content[0].content;e!=null&&e.includes(a)&&(i=!1)}return i}),id:t.id,op:t.op}),Z=t=>{let e=t;const n=t.filter(i=>w(i)),r=t.filter(i=>tn(i));if(n.length){const i=n[0];e=[...r,i]}return x(e)},rn=(t,e)=>{const n=(a,s)=>s.filter(o=>o!==a).map(o=>ee(o)&&typeof o=="number"&&o>a?o-1:o),r=e.filter((a,s)=>s!==t).map(a=>w(a)?a:{...a,content:n(t,a.content)}),i=r.filter(a=>q(a.content));return i.length?rn(r.findIndex(a=>a.id==i[0].id),r):r},wr=(t,e)=>{var i,a,s,o;const n=e.getRawQueries(),r=e.getState().activeQueryId;if(n.length===1)e.resetQueries(t);else{const u=e.getQueryIndex(t),c=Z(rn(u,n));if(c.length){const l=zi(c,u),f=c[l];let d=e.getSelectedQueryIndexes();d.includes(u)&&(d=d.filter(y=>y!==u).map(y=>y>u?y-1:y),(a=(i=e.coreProps).onQuerySelectChange)==null||a.call(i,d));const p=c.find(y=>y.id===r),b={activeQueryId:p?r:f.id,queries:c,selectedQueryIndexes:d};p||(o=(s=e.coreProps).onActiveQueryChange)==null||o.call(s,f),e.setState(y=>({...y,...b}))}else e.resetQueries(t)}},zi=(t,e)=>t.length-1>=e?e:e+1>t.length-1?e-1<t.length&&e-1>=0?e-1:t.length-1:e+1,nn=(t,e)=>({...e,content:e.content.map(n=>te(n)&&!n.skipBooleanOperatorCheck?nn(t,n):n),op:t}),an=(t,e)=>({...e,content:e.content.filter(function n(r){return ee(r)?!0:te(r)?r.content.filter(n).length>0:r.content.field!==t})}),Bi=({sqon:t,field:e,index:n,isUploadedList:r,merge_strategy:i=k.APPEND_VALUES,operator:a=Gr.In,overrideValuesName:s,remoteComponent:o,value:u})=>{let c;const l={content:{field:e,index:n,isUploadedList:r,overrideValuesName:s,remoteComponent:o,value:u},op:a};return q(t)?(c=U(),c.content=[l]):c=ea(t,l,{operator:At.OVERRIDE_OPERATOR,values:i}),c},ea=(t,e,n)=>{const r=x(t);return n=Yi({},{operator:At.DEFAULT,values:k.DEFAULT},n),sn(r,e,n)?r:{...r,content:[...r.content,e]}},sn=(t,e,n)=>{let r=!1;return t.content.forEach(i=>{if(ee(i)||i.name)return;const a=i;if(te(a)){r=sn(a,e,n);return}const s=a;s.content.field===e.content.field&&(r=!0,e.content.overrideValuesName&&(s.content.overrideValuesName=e.content.overrideValuesName),e.op&&n.operator!==At.KEEP_OPERATOR&&(s.op=e.op),n.values===k.APPEND_VALUES&&(s.content.value=Xi([],s.content.value,e.content.value)),n.values===k.OVERRIDE_VALUES&&(s.content.value=e.content.value))}),r},ta=(t,e)=>{const n=e.content,r=typeof t=="number"?n.filter(i=>i!==t):n.filter(i=>{if(typeof i=="number")return!0;const a=i,{skipBooleanOperatorCheck:s}=a,o=s&&a.content[0].content.field!==t,u=i.content.field!==t;return s?o:u});return{...e,content:r,op:e.op}},ra=(t,e)=>{const r=e.content.filter(i=>i.id!==t);return{...e,content:r,op:e.op}},on=(t,e)=>te(e)?e.content.reduce((n,r)=>n||on(t,r),!1):typeof e=="number"&&e===t,Ca=(t,e)=>x(t).map(r=>{const i=r.content.map(a=>a.id===e.id?{id:e.id,content:e.queries[0].content,op:a.op,name:e.name}:a);return{...r,content:i}}),un=t=>x(t).map(r=>{const i=r.content.map(a=>Object.prototype.hasOwnProperty.call(a,"title")&&a.id?{filterID:a.id}:a);return{...r,content:i}}),na=(t,e)=>{let n=-1;const r=t.content.filter((i,a)=>{if(ee(i))return!0;const s=i,{skipBooleanOperatorCheck:o}=s,u=o&&s.content.find(c=>c.content.field===e);return(u||i.content.field==e)&&(n=a),o?!u:i.content.field!==e});return[n,{...t,content:r}]},ia=(t,e,n)=>(console.error("createSQONFromFilters is not implemented"),[]),aa=(t,e,n)=>(console.error("createSQONFromFilters is not implemented"),[]),cn=(t,e)=>{const n=r=>r.content.map(i=>ee(i)?e[i]:i).map(i=>cn(i,e));return te(t)?{content:n(t),op:t.op}:{content:t.content,op:t.op}};function ln({defaultTitle:t="New Filter",type:e}){const n=I(),r={id:I(),queries:[U(n)],type:e,name:t,favorite:!1,isDirty:!1,isNew:!0};return{newActiveQueryId:n,newSavedFilter:r}}const fn=(t,e)=>{const n={},r=t.id??I();return Object.assign(n,{id:r,raw:()=>t,index:()=>e.getState().queries.findIndex(a=>a.id===r),isActive:()=>e.getState().activeQueryId===r,isEmpty:()=>w(t),isNotEmpty:()=>!w(t),toggleSelect:a=>{var u,c;const s=e.getQueryIndex(r);let o=[];a?o=[...e.getState().selectedQueryIndexes,s]:o=e.getState().selectedQueryIndexes.filter(l=>l!==s),e.setState(l=>({...l,selectedQueryIndexes:o})),(c=(u=e.coreProps).onQuerySelectChange)==null||c.call(u,o)},isSelected:()=>e.getState().selectedQueryIndexes.includes(e.getQueryIndex(r)),isSelectable:()=>{const a=e.getState().queries;return a.length===2&&e.hasEmptyQuery()?!1:a.length>1&&n.isNotEmpty()},saveAsCustomPill:async a=>{var o,u;const s={favorite:!1,id:I(),queries:[n.raw()],name:a,type:e.coreProps.savedFilterType};return Promise.resolve((u=(o=e.coreProps).onCustomPillSave)==null?void 0:u.call(o,s)).then(()=>n.update({...n.raw(),content:[{id:s.id,op:s.queries[0].op,content:s.queries[0].content,title:s.name}]}))},delete:()=>{var a,s;wr(r,e),(s=(a=e.coreProps).onQueryDelete)==null||s.call(a,r)},update:a=>{var s,o,u,c;if(q(a.content))wr(r,e);else{const l=e.getState().activeQueryId,f=e.getQueryIndex(r),d=x(e.getRawQueries()),p={...a,id:r,content:a.content,op:a.op};d[f]=p,e.setState(b=>({...b,queries:Z(d)})),(o=(s=e.coreProps).onQueryUpdate)==null||o.call(s,p),l===r&&((c=(u=e.coreProps).onActiveQueryChange)==null||c.call(u,p))}},duplicate:()=>{const a=e.getQuery(r);a&&e.createQuery({op:a.raw().op,content:a.raw().content})},setAsActive:()=>{var a,s;e.setState(o=>({...o,activeQueryId:r})),(s=(a=e.coreProps).onActiveQueryChange)==null||s.call(a,n.raw())},changeCombineOperator:a=>{var l,f;const s=x(e.getRawQueries()),o=e.getQueryIndex(r),u=s[o],c=nn(a,u);s[o]={...u,content:c.content,op:c.op},e.setState(d=>({...d,queries:Z(s)})),(f=(l=e.coreProps).onActiveQueryChange)==null||f.call(l,s[o])},addPill:a=>{n.update({...t,content:[...t.content,a]})},removePillById:a=>{n.update(ra(a,t))},removePillByFieldOrIndex:a=>{n.update(ta(a,t))},isReferencedInActiveQuery:()=>{const a=e.getActiveQuery();return a?on(n.index(),a.raw()):!1},hasCustomPill:()=>n.raw().content.some(a=>a.name||!a.content)}),n};var dn=(t=>(t.Filter="filter",t.Query="query",t))(dn||{});const sa=(t,e)=>{const n={},r=t.id;return Object.assign(n,{id:r,raw:()=>t,getQueries:()=>t.queries&&t.queries.length>0?t.queries.map(a=>fn(a,e)):[],getRawQueries:()=>t.queries,getQueryById:a=>n.getQueries().find(s=>s.id===a)||null,copy:()=>{const a=n.getRawQueries().map(l=>({...l,id:I()})),o=e.getSavedFilters().filter(l=>!l.isNew()).filter(l=>l.raw().name.includes(t.name)),u=`${t.name} COPY${o.length>1?` ${o.length-1}`:""}`;return{favorite:!1,id:I(),queries:a,name:u,isDirty:!1,isNew:!0,type:e.coreProps.savedFilterType}},duplicate:()=>{var a,s;if(n.isSelected()){const o=n.copy();e.setState(u=>({...u,activeQueryId:o.queries[0].id,queries:o.queries,savedFilters:[...u.savedFilters,o]})),(s=(a=e.coreProps).onSavedFilterCreate)==null||s.call(a,o)}else console.error("Can only duplicate the selected saved filter")},delete:async()=>{var a,s;return Promise.resolve((s=(a=e.coreProps).onSavedFilterDelete)==null?void 0:s.call(a,r)).then(()=>{var c,l,f,d;const{newActiveQueryId:o,newSavedFilter:u}=ln({type:e.coreProps.savedFilterType,defaultTitle:e.coreProps.savedFilterDefaultTitle});e.setState(p=>({...p,activeQueryId:o,queries:u.queries,savedFilters:[...p.savedFilters.filter(b=>b.id!==r),u]})),(l=(c=e.coreProps).onActiveQueryChange)==null||l.call(c,u.queries[0]),(d=(f=e.coreProps).onSavedFilterCreate)==null||d.call(f,u)})},save:async(a,s)=>{var c,l,f,d;const o={...n.raw(),name:(s==null?void 0:s.name)||n.raw().name,favorite:(s==null?void 0:s.favorite)!==void 0?s.favorite:n.raw().favorite,queries:e.getRawQueries()};return a===dn.Query?Promise.resolve((l=(c=e.coreProps).onCustomPillUpdate)==null?void 0:l.call(c,o)).then(()=>{}):Promise.resolve((d=(f=e.coreProps).onSavedFilterUpdate)==null?void 0:d.call(f,{...o,queries:un(o.queries)})).then(p=>{p&&e.setState(b=>({...b,savedFilters:b.savedFilters.map(y=>y.id===p.id?{...p,isNew:!1,isDirty:!1}:y)}))})},select:()=>{e.setState(a=>({...a,activeQueryId:t.queries[0].id,queries:t.queries}))},discardChanges:()=>{n.isSelected()?e.setState(a=>({...a,activeQueryId:t.queries[0].id,queries:t.queries})):console.error("Can only discard changes to the selected saved filter")},hasQueries:()=>n.getQueries().length>0,isSelected:()=>{const a=e.getState().queries.map(s=>s.id);return t.queries.find(s=>a.includes(s.id))!==void 0},isFavorite:()=>t.favorite||!1,isNew:()=>t.isNew||!1,isDirty:()=>!n.isSelected()||t.isNew?!1:t.isDirty||e.getRawQueries().length!==t.queries.length?!0:!t.queries.every(a=>{const s=e.getRawQueries().find(o=>o.id==a.id);return s?zn({content:ei(s.content),id:s.id,op:s.op},{content:a.content,id:a.id,op:a.op}):!1})}),n},oa=()=>{const t=I();return{activeQueryId:t,queries:[U(t)],savedFilters:[],selectedQueryIndexes:[]}},Fa=t=>{const e={};return Object.assign(e,{coreProps:t,setCoreProps:r=>{e.coreProps=r(e.coreProps)},setState:r=>{var i,a;(a=(i=e.coreProps).onStateChange)==null||a.call(i,r(e.coreProps.state))},getState:()=>e.coreProps.state,reset:()=>{e.setState(()=>e.coreProps.initialState)},clearQueries:()=>{var a,s;const r=I(),i=U(r);e.setState(o=>({...o,activeQueryId:r,queries:[i]})),(s=(a=e.coreProps).onActiveQueryChange)==null||s.call(a,i)},saveNewFilter:async r=>{var a,s;const i={id:(r==null?void 0:r.id)||I(),name:(r==null?void 0:r.name)||e.coreProps.savedFilterDefaultTitle||"New Filter",favorite:(r==null?void 0:r.favorite)===void 0?!1:r.favorite,queries:(r==null?void 0:r.queries)||e.getRawQueries(),type:(r==null?void 0:r.type)||e.coreProps.savedFilterType};return Promise.resolve((s=(a=e.coreProps).onSavedFilterSave)==null?void 0:s.call(a,{...i,queries:un(i.queries)})).then(o=>{o&&e.setState(u=>{const c=u.savedFilters.filter(l=>l.id!==i.id);return{...u,savedFilters:[...c,{...o,isNew:!1,isDirty:!1}]}})})},createSavedFilter:()=>{var a,s;const{newActiveQueryId:r,newSavedFilter:i}=ln({type:e.coreProps.savedFilterType,defaultTitle:e.coreProps.savedFilterDefaultTitle});e.setState(o=>({...o,activeQueryId:r,queries:i.queries,savedFilters:[...o.savedFilters,i]})),(s=(a=e.coreProps).onSavedFilterCreate)==null||s.call(a,i)},getSelectedSavedFilter:()=>{if(!e.getActiveQuery())return null;let i=e.getSavedFilters().find(a=>a.isSelected()&&!a.isNew());return i||(i=e.getSavedFilters().find(a=>a.isNew())),i||null},getSavedFilters:()=>e.coreProps.state.savedFilters&&e.coreProps.state.savedFilters.length>0?e.coreProps.state.savedFilters.map(i=>sa(i,e)):[],getQueries:()=>e.coreProps.state.queries&&e.coreProps.state.queries.length>0?e.coreProps.state.queries.map(r=>fn(r,e)):[],getRawQueries:()=>e.coreProps.state.queries||[],getSelectedQueryIndexes:()=>e.getState().selectedQueryIndexes,toggleQuerySelect:(r,i)=>{var a;(a=e.getQuery(r))==null||a.toggleSelect(i)},resetQuerySelection:()=>{var r,i;e.setState(a=>({...a,selectedQueryIndexes:[]})),(i=(r=e.coreProps).onQuerySelectChange)==null||i.call(r,[])},createQuery:({id:r=I(),op:i=pe.And,content:a})=>{var o,u,c,l;const s={id:r,op:i,content:a};return e.setState(f=>({...f,activeQueryId:s.id,queries:Z([...e.getRawQueries(),s])})),(u=(o=e.coreProps).onActiveQueryChange)==null||u.call(o,s),(l=(c=e.coreProps).onQueryCreate)==null||l.call(c,s),s.id},getQuery:r=>e.getQueries().find(i=>i.id===r)||null,setActiveQuery:r=>{var i;(i=e.getQuery(r))==null||i.setAsActive()},getActiveQuery:()=>e.coreProps.state.activeQueryId?e.getQuery(e.coreProps.state.activeQueryId):null,getQueryIndex:r=>{const i=e.getQuery(r);return i?i.index():-1},updateQuery:(r,i)=>{var a;(a=e.getQuery(r))==null||a.update(i)},duplicateQuery:r=>{var i;(i=e.getQuery(r))==null||i.duplicate()},deleteQuery:r=>{var i;(i=e.getQuery(r))==null||i.delete()},changeQueryCombineOperator:(r,i)=>{var a;(a=e.getQuery(r))==null||a.changeCombineOperator(i)},hasEmptyQuery:()=>e.getQueries().some(r=>r.isEmpty()),hasQueries:()=>e.getQueries().length>0,canCombine:()=>e.getQueries().length>1&&e.getSelectedQueryIndexes().length>1,resetQueries:r=>{var a,s;const i=U(r);(s=(a=e.coreProps).onActiveQueryChange)==null||s.call(a,i),e.setState(o=>({...o,activeQueryId:r,queries:[i]}))},combineSelectedQueries:r=>{var s,o,u,c,l,f;if(!e.canCombine()){console.error("Cannot combine queries. There must be at least 2 queries selected.");return}const i={id:I(),op:r,content:e.getSelectedQueryIndexes().sort()},a=[];e.setState(d=>({...d,activeQueryId:i.id,queries:Z([...d.queries,i]),selectedQueryIndexes:a})),(o=(s=e.coreProps).onActiveQueryChange)==null||o.call(s,i),(c=(u=e.coreProps).onQueryCreate)==null||c.call(u,i),(f=(l=e.coreProps).onQuerySelectChange)==null||f.call(l,a)},isEmpty:()=>e.getQueries().length===1&&e.getQueries()[0].isEmpty()}),e},ua="QBCacheUpdate",pn="query-builder-cache",qa={content:[],op:"and"};var ca=(t=>(t.ADD_QUERY="ADD_QUERY",t.UPDATE_QUERY="UPDATE_QUERY",t.SET_STATE="SET_STATE",t))(ca||{});class la extends Event{constructor(n){super(ua);J(this,"eventData");J(this,"eventType");J(this,"value");J(this,"queryBuilderId");this.eventType=n.eventType,this.queryBuilderId=n.queryBuilderId,this.value=n.value,this.eventData=n.eventData}}const ve=(t,{eventType:e,eventData:n,value:r,skipEvent:i})=>{if(window.localStorage.setItem(`${pn}-${t}`,JSON.stringify(r)),!i){const a=new la({queryBuilderId:t,value:r,eventType:e,eventData:n});window.dispatchEvent(a)}},yt=t=>{const e=oa();return ve(t,{value:e,eventType:"SET_STATE",eventData:e}),e},re=t=>{if(typeof window<"u"){const e=window.localStorage.getItem(`${pn}-${t}`);if(!e)return yt(t);try{return JSON.parse(e)}catch{return yt(t)}}else return{}},fa=(t,e,n=!1)=>{const r=re(t),i=(r==null?void 0:r.queries)??[],a=i.find(o=>w(o)),s=i.find(o=>o.id===r.activeQueryId&&w(o));ve(t,{eventType:"ADD_QUERY",eventData:e,value:{activeQueryId:n||s?e.id:(r==null?void 0:r.activeQueryId)??e.id,queries:a?i.map(o=>w(o)?e:o):[...i,e]}})},da=(t,e=cn)=>{var r;const n=re(t);return e(((r=n==null?void 0:n.queries)==null?void 0:r.find(({id:i})=>i===n.activeQueryId))??U(),n.queries)},ne=t=>{var n;const e=re(t);return((n=e==null?void 0:e.queries)==null?void 0:n.find(({id:r})=>r===e.activeQueryId))??U()},G=(t,e)=>{var i;const n=re(t),r=(i=n==null?void 0:n.queries)==null?void 0:i.find(({id:a})=>a===e.id);if(r)r.content=e.content,r.op=e.op;else throw new Error(`Query with id ${e.id} not found`);ve(t,{eventType:"UPDATE_QUERY",eventData:r,value:n})},pa=(t,{field:e,index:n,isUploadedList:r,merge_strategy:i=k.APPEND_VALUES,operator:a=Gr.In,overrideValuesName:s,remoteComponent:o,value:u})=>{const c=_a.getActiveQuery(t);G(t,q(u)?an(e,c):Bi({sqon:c,field:e,index:n,isUploadedList:r,merge_strategy:i,operator:a,overrideValuesName:s,remoteComponent:o,value:u}))},va=(t,e)=>{G(t,vn(t,{field:e.filterGroup.field,operator:e.operator,sqonContent:aa(e.filterGroup,e.selectedFilters,e.index)}))},vn=(t,{field:e,operator:n=pe.And,sqonContent:r})=>{const i=ne(t);let a={id:I(),content:r,op:n};if(!q(i)){const s=na(i,e),o=s[0],u=s[1],c={...u};q(c.content)&&q(i)?a={id:I(),content:[],op:n}:(o>=0?c.content.splice(o,0,...r):c.content=[...c.content,...r],a={...c,content:[...c.content]},u.content.length===0&&(a.op=n))}return a},ga=(t,e)=>G(t,e.selectedFilters.length>0?vn(t,{field:e.field,sqonContent:ia(e.field,e.selectedFilters)}):an(e.field,ne(t))),ya=(t,e)=>{const n=ne(t);G(t,{...n,content:[...n.content,e]})},ba=(t,e)=>{const n=ne(t);n.content=n.content.filter(r=>r.id!==e).filter(r=>r!==void 0),G(t,n)},_a={addQuery:fa,updateQuery:G,getActiveQuery:ne,getResolvedActiveQuery:da,updateActiveQueryField:pa,updateActiveQueryFilters:va,updateQueryByTableFilter:ga,addPillToActiveQuery:ya,removePillFromActiveQuery:ba,setLocalQueryBuilderState:ve,getLocalQueryBuilderState:re,setDefaultLocalQueryBuilderState:yt};export{qa as D,ua as Q,dn as S,ca as a,Ra as b,Fa as c,x as d,Oa as e,te as f,oa as g,ee as h,Ta as i,Sa as j,Ia as k,Pa as l,cn as m,_a as q,Ea as r,Ca as u,I as v};
