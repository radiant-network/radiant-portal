import{j as n}from"./jsx-runtime-D_zvdyIk.js";import{r as u}from"./index-CBYaBgW8.js";import{b as re,g as se,_ as ie,a as ue,d as F,c as oe}from"./command-CqDCn1-N.js";import{B as ce}from"./badge-Bvz88wlt.js";import{S as de}from"./skeleton-_T1otFf0.js";import{u as me}from"./i18n-BnrpIskt.js";import{u as fe}from"./useDebounce-CEPqGWFj.js";import{c as T}from"./utils-CDN07tui.js";import{X as pe}from"./x-4HkHZ1eq.js";import{C as ve}from"./check-DSe_yRo5.js";function j(c,r){if(c.length===0)return{};if(!r)return{"":c};const f={};return c.forEach(o=>{const p=o[r]||"";f[p]||(f[p]=[]),f[p].push(o)}),f}function U(c,r){return r.filter(f=>c.includes(f.value))}function he(c,r){for(const[,f]of Object.entries(c))if(f.some(o=>r.find(p=>p.value===o.value)))return!0;return!1}function $({value:c,onChange:r,placeholder:f,defaultOptions:o=[],options:p,debounceDelay:B=500,onSearch:m,onSearchSync:C,emptyIndicator:_,maxSelected:W=Number.MAX_SAFE_INTEGER,onMaxSelected:w,hidePlaceholderWhenSelected:G,disabled:k,groupBy:v,className:Q,selectFirstItem:Y=!0,creatable:E=!1,triggerSearchOnFocus:I=!1,commandProps:s,inputProps:i,hideClearAllButton:Z=!1,renderBadge:z,ref:P}){const{t:K}=me(),d=u.useRef(null),[b,y]=u.useState(!1),[ee,X]=u.useState(!1),[D,H]=u.useState(!1),L=u.useRef(null),[l,x]=u.useState(U(c||[],o)),[R,q]=u.useState(j(o,v)),[h,A]=u.useState(""),g=fe(h,B);u.useImperativeHandle(P,()=>({selectedValue:[...l],input:d.current,focus:()=>{var e;return(e=d==null?void 0:d.current)==null?void 0:e.focus()},reset:()=>x([])}),[l]);const N=e=>{L.current&&!L.current.contains(e.target)&&d.current&&!d.current.contains(e.target)&&(y(!1),d.current.blur())},V=u.useCallback(e=>{const t=l.filter(a=>a.value!==e.value);x(t),r==null||r(t.map(a=>a.value))},[r,l]),te=u.useCallback(e=>{const t=d.current;t&&((e.key==="Delete"||e.key==="Backspace")&&t.value===""&&l.length>0&&(l[l.length-1].fixed||V(l[l.length-1])),e.key==="Escape"&&t.blur())},[V,l]);u.useEffect(()=>(b?(document.addEventListener("mousedown",N),document.addEventListener("touchend",N)):(document.removeEventListener("mousedown",N),document.removeEventListener("touchend",N)),()=>{document.removeEventListener("mousedown",N),document.removeEventListener("touchend",N)}),[b]),u.useEffect(()=>{c&&o.length>0&&x(U(c,o))},[c,o]),u.useEffect(()=>{if(!p||m)return;const e=j(p||[],v);JSON.stringify(e)!==JSON.stringify(R)&&q(e)},[o,p,v,m,R]),u.useEffect(()=>{const e=()=>{const a=C==null?void 0:C(g);q(j(a||[],v))};(async()=>{!C||!b||(I&&e(),g&&e())})()},[g,v,b,I]),u.useEffect(()=>{const e=async()=>{H(!0);const a=await(m==null?void 0:m(g)),M=j(a||[],v);q(M),H(!1)};(async()=>{!m||!b||(I&&await e(),g&&await e())})()},[g,v,b,I]);const le=()=>{if(!E||he(R,[{value:h,label:h}])||l.find(t=>t.value===h))return;const e=n.jsx(F,{value:h,className:"cursor-pointer",onMouseDown:t=>{t.preventDefault(),t.stopPropagation()},onSelect:t=>{if(l.length>=W){w==null||w(l.length);return}A(""),q(j(o,v)),y(!1);const a=[...l,{value:t,label:t}];x(a),r==null||r(a.map(M=>M.value))},children:`Create "${h}"`});if(!m&&h.length>0||m&&g.length>0&&!D)return e},ne=u.useCallback(()=>m&&!E&&Object.keys(R).length===0?n.jsx("div",{className:"p-2 py-4 text-center text-sm",children:K("common.filters.no_values_found")}):n.jsx(re,{children:_||n.jsx("div",{className:"text-center text-sm",children:K("common.filters.no_values_found")})}),[E,_,m,R]),ae=u.useCallback(()=>{if(s!=null&&s.filter)return s.filter;if(E)return(e,t)=>e.toLowerCase().includes(t.toLowerCase())?1:-1},[E,s==null?void 0:s.filter]);return n.jsxs(se,{...s,onKeyDown:e=>{var t;te(e),(t=s==null?void 0:s.onKeyDown)==null||t.call(s,e)},className:T("h-auto overflow-visible bg-background",s==null?void 0:s.className),shouldFilter:(s==null?void 0:s.shouldFilter)!==void 0?s.shouldFilter:!m,filter:ae(),children:[n.jsxs("div",{ref:L,className:T("flex min-h-9 shadow-xs rounded-md border border-input text-sm ring-offset-background focus-within:ring-1 focus-within:ring-ring",{"px-3 py-2":l.length!==0,"cursor-text":!k&&l.length!==0},Q),onClick:()=>{var e;k||(e=d==null?void 0:d.current)==null||e.focus()},children:[n.jsxs("div",{className:"relative flex flex-1 flex-wrap gap-1",children:[l.map(e=>z?z({option:e,onRemove:()=>V(e)}):n.jsx(ce,{"data-disabled":k||void 0,onClose:()=>V(e),children:e.badgeLabel||(typeof e.label=="string"?e.label:e.value)},e.value)),n.jsx(ie.Input,{...i,ref:d,value:h,disabled:k,onValueChange:e=>{var t;A(e),y(e.length>0),(t=i==null?void 0:i.onValueChange)==null||t.call(i,e)},onBlur:e=>{var t;ee||y(!1),(t=i==null?void 0:i.onBlur)==null||t.call(i,e)},onFocus:e=>{var t;h.length>0&&y(!0),(t=i==null?void 0:i.onFocus)==null||t.call(i,e)},placeholder:G&&l.length!==0?"":f,className:T("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":G,"px-3 py-2":l.length===0,"ml-1":l.length!==0},i==null?void 0:i.className)})]}),n.jsx("button",{type:"button",onClick:()=>{x(l.filter(e=>e.fixed)),r==null||r(l.filter(e=>e.fixed).map(e=>e.value))},className:T((Z||k||l.length<1||l.filter(e=>e.fixed).length===l.length)&&"hidden"),children:n.jsx(pe,{size:18,className:""})})]}),n.jsx("div",{className:T("relative",b?"block":"hidden"),ref:L,children:n.jsx(ue,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in fade-in-0 zoom-in-95",onMouseLeave:()=>{X(!1)},onMouseEnter:()=>{X(!0)},children:D?n.jsx("div",{className:"p-1",children:n.jsx(de,{className:"h-8 w-full"})}):n.jsxs(n.Fragment,{children:[ne(),le(),!Y&&n.jsx(F,{value:"-",className:"hidden"}),Object.entries(R).map(([e,t])=>n.jsx(oe,{heading:e,className:"h-full overflow-auto",children:n.jsx(n.Fragment,{children:t.map(a=>{var J;const M=(J=l.map(O=>O.value))==null?void 0:J.includes(a.value);return n.jsxs(F,{value:a.value,disabled:a.disable,onSelect:()=>{if(l.length>=W){w==null||w(l.length);return}A(""),q(j(o,v)),y(!1);let O=[];l.find(S=>S.value===a.value)?O=l.filter(S=>S.value!==a.value):O=[...l,a],x(O),r==null||r(O.map(S=>S.value))},className:T("cursor-pointer",a.disable&&"cursor-default text-muted-foreground"),children:[n.jsx("span",{className:"flex-1",children:a.label}),M?n.jsx(ve,{className:"w-4"}):null]},a.value)})})},e))]})})})]})}$.displayName="MultipleSelector";$.__docgenInfo={description:"",methods:[{name:"focus",docblock:null,modifiers:[],params:[],returns:null},{name:"reset",docblock:null,modifiers:[],params:[],returns:null}],displayName:"MultipleSelector",props:{ref:{required:!1,tsType:{name:"union",raw:"React.RefCallback<MultipleSelectorRef> | React.RefObject<MultipleSelectorRef>",elements:[{name:"ReactRefCallback",raw:"React.RefCallback<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]},{name:"ReactRefObject",raw:"React.RefObject<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]}]},description:""},value:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},defaultOptions:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"",defaultValue:{value:"[]",computed:!1}},options:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"manually controlled options"},placeholder:{required:!1,tsType:{name:"string"},description:""},emptyIndicator:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"Empty component."},debounceDelay:{required:!1,tsType:{name:"number"},description:"Debounce time for async search. Only work with `onSearch`.",defaultValue:{value:"500",computed:!1}},triggerSearchOnFocus:{required:!1,tsType:{name:"boolean"},description:"Only work with `onSearch` prop. Trigger search when `onFocus`.\nFor example, when user click on the input, it will trigger the search to get initial options.",defaultValue:{value:"false",computed:!1}},onSearch:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => Promise<MultiSelectorOption[]>",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Promise",elements:[{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}],raw:"Promise<MultiSelectorOption[]>"}}},description:"async search"},onSearchSync:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => MultiSelectorOption[]",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}}},description:`sync search. This search will not showing loadingIndicator.
The rest props are the same as async search.
i.e.: creatable, groupBy, delay.`},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(options: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"options"}],return:{name:"void"}}},description:""},maxSelected:{required:!1,tsType:{name:"number"},description:"Limit the maximum number of selected options.",defaultValue:{value:"Number.MAX_SAFE_INTEGER",computed:!0}},onMaxSelected:{required:!1,tsType:{name:"signature",type:"function",raw:"(maxLimit: number) => void",signature:{arguments:[{type:{name:"number"},name:"maxLimit"}],return:{name:"void"}}},description:"When the number of selected options exceeds the limit, the onMaxSelected will be called."},hidePlaceholderWhenSelected:{required:!1,tsType:{name:"boolean"},description:"Hide the placeholder when there are options selected."},disabled:{required:!1,tsType:{name:"boolean"},description:""},groupBy:{required:!1,tsType:{name:"string"},description:"Group the options base on provided key."},className:{required:!1,tsType:{name:"string"},description:""},selectFirstItem:{required:!1,tsType:{name:"boolean"},description:`First item selected is a default behavior by cmdk. That is why the default is true.
This is a workaround solution by add a dummy item.

@reference: https://github.com/pacocoursey/cmdk/issues/171`,defaultValue:{value:"true",computed:!1}},creatable:{required:!1,tsType:{name:"boolean"},description:"Allow user to create option when there is no option matched.",defaultValue:{value:"false",computed:!1}},commandProps:{required:!1,tsType:{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof Command>",elements:[{name:"Command"}]},description:"Props of `Command`"},inputProps:{required:!1,tsType:{name:"Omit",elements:[{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>",elements:[{name:"CommandPrimitive.Input"}]},{name:"union",raw:"'value' | 'placeholder' | 'disabled'",elements:[{name:"literal",value:"'value'"},{name:"literal",value:"'placeholder'"},{name:"literal",value:"'disabled'"}]}],raw:`Omit<
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>,
  'value' | 'placeholder' | 'disabled'
>`},description:"Props of `CommandInput`"},hideClearAllButton:{required:!1,tsType:{name:"boolean"},description:"hide the clear all button.",defaultValue:{value:"false",computed:!1}},renderBadge:{required:!1,tsType:{name:"signature",type:"function",raw:"(params: { option: MultiSelectorOption; onRemove: () => void }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ option: MultiSelectorOption; onRemove: () => void }",signature:{properties:[{key:"option",value:{name:"MultiSelectorOption",required:!0}},{key:"onRemove",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]}},name:"params"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"Render the badge for each option."}}};export{$ as M};
