import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{h as Ae}from"./index-DRDTZ9zG.js";import{k as Qe,o as de,m as Te,D as ft}from"./data-table-B2molODf.js";import{r,R as Ge}from"./index-CBYaBgW8.js";import{c as ht}from"./index-C66Dxnp2.js";import{B as yt,U as xt,O as gt,F as vt,P as St,G as bt,V as jt,D as _t}from"./variant-icon-C_DRBYBR.js";import{B as U}from"./button-DVi2YR5Y.js";import{u as kt,a as Nt,b as It,c as wt,d as Et,e as At,f as Tt,S as Ot}from"./sidebar-DsAAuTEk.js";import{T as je,a as _e,b as ke}from"./tooltip-0vX-MTK3.js";import{u as Q}from"./i18n-C40I7Y3q.js";import{P as Ct,a as Rt}from"./panel-left-open-BsQqi0Jz.js";import{A as $,F as L,u as Ft,C as Lt}from"./applications-config-D6sxpq9M.js";import{c as qt}from"./utils-CDN07tui.js";import{A as Dt,T as Vt,f as Bt,p as Oe,U as Mt}from"./upload-id-modal-CUE_HAei.js";import{q,D as Pe}from"./query-builder-remote-Dsglp4p2.js";import{L as me}from"./label-BI8zg36L.js";import{R as Ut,a as $t}from"./radio-group-DekDLgvf.js";import{M as Z,T as Se,R as O}from"./sqon-BcXfVpY_.js";import{A as Qt}from"./action-button-9r-08jXC.js";import"./button.variants-Du9eY_ux.js";import{C as Gt}from"./checkbox-filter-C5g7WDGX.js";import{d as Ne,e as ze,C as Ie,a as Pt}from"./card-Cyh3E19J.js";import{I as le}from"./input-Bj-MPxry.js";import{S as zt}from"./separator-ChZWIdMg.js";import{S as ue}from"./skeleton-_T1otFf0.js";import{S as Jt}from"./switch-Jy17y5RA.js";import{a as Yt}from"./number-format-CIhM6SrW.js";import{S as Ht}from"./search-DKmUqS9g.js";import{E as Wt,L as Kt,G as Xt,a as Zt,b as es,c as ts}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{C as ss}from"./checkbox-BUFo-vqr.js";import{d as Ce,S as Re,a as Fe,b as Le,c as qe}from"./select-DnbErV3f.js";import{i as B}from"./i18next-CYn7LYXT.js";import{A as Je,a as Ye,b as He,c as We}from"./accordion-DSXieqtP.js";import{M as ns}from"./multi-selector-BQxzoQYT.js";import{I as as}from"./info-1oMsIW1a.js";import{X as rs}from"./x-4HkHZ1eq.js";import{o as os,h as is,s as ls,a as cs}from"./api-occurrence-BaSPzlyp.js";import{M as ds,R as us,a as ms}from"./chunk-EPOLDU6W-BBQlfikL.js";import"./decorators-C6Ye0Q4n.js";import"./isEqual-DJddVrXl.js";import"./api-BFDjw7rQ.js";import"./index-sTUCEGFJ.js";import"./index-BWnBDfn-.js";import"./createLucideIcon-B119WVF5.js";import"./dropdown-menu-DPm_FhUX.js";import"./index-D9mtqW9-.js";import"./index-Dy6y0jaD.js";import"./index-BCzuw4Jg.js";import"./index-C8BBKGwP.js";import"./index-BL8Z-moU.js";import"./Combination-CrkgvPnV.js";import"./index-iyInEJkZ.js";import"./index-C2iKAgIe.js";import"./index-CWHKeK-O.js";import"./index-CfgEC-S9.js";import"./index-DnEzm5An.js";import"./check-DSe_yRo5.js";import"./settings-Dw4TSVKU.js";import"./pagination-DoMGtJzZ.js";import"./ellipsis-RxOQoOKc.js";import"./empty-LncwPSrD.js";import"./chart-scatter-DVTaxjlK.js";import"./index-lnksFm0-.js";import"./badge-B8JYzoyf.js";import"./circle-alert-DTyzftz0.js";import"./chevron-down-DOuPo75j.js";import"./chevron-right-BONyyZTy.js";import"./index-C-d7IIsQ.js";import"./spinner-DMuui_2m.js";import"./index-C2vczdB5.js";import"./index-Cq0TEE3l.js";import"./index-CfXWnpL9.js";import"./iframe-BPQjb6vk.js";import"./dialog-TAP2eCwF.js";import"./useDebounce-CEPqGWFj.js";import"./collapsible-card-gSQy_aZA.js";import"./index-ByDNlZau.js";import"./collapsible-DZVyllqn.js";import"./chevron-up-C0Hb7JXF.js";import"./display-table-Bwc3y68U.js";import"./hover-card-DGWDDH_5.js";import"./index-SF2qmtPV.js";import"./command-CqDCn1-N.js";const ps={organization:_t,variant:jt,gene:bt,pathogenicity:St,frequency:vt,occurrence:gt,parental_analysis:xt,metric_qc:yt},De=ht({base:"text-secondary dark:text-foreground",variants:{selected:{true:"bg-sidebar-brand-accent text-sidebar-brand-accent-foreground"}},defaultVariants:{selected:!1}});function Ke({onItemSelect:t,aggregationGroups:s,selectedItemId:n}){const{t:o}=Q(),{open:f,toggleSidebar:l}=kt(),[h,a]=r.useState(null),p=n!==void 0?n:h,c=k=>{const b=p===k?null:k;a(b),t&&t(b)};return e.jsx(Nt,{variant:"sidebar",collapsible:"icon",className:"static! flex flex-col w-full bg-primary dark:bg-secondary ",children:e.jsx(It,{children:e.jsxs(wt,{children:[e.jsxs(je,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(U,{iconOnly:!0,onClick:()=>l(),className:De({className:"mb-1 hover:bg-sidebar-brand-accent hover:text-sidebar-brand-accent-foreground"}),size:"sm",variant:"ghost",children:f?e.jsx(Ct,{}):e.jsx(Rt,{})})}),e.jsx(ke,{side:"right",align:"center",children:o(f?"query_filters.sidebar_panel.collapse":"query_filters.sidebar_panel.expand")})]}),e.jsx(Et,{children:Object.entries(s).map(([k])=>{const b=ps[k],_=o(`query_filters.sidebar_panel.filters.${k}`);return e.jsx(At,{children:e.jsx(Tt,{asChild:!0,className:De({selected:p===k}),onClick:g=>{g.preventDefault(),c(k)},tooltip:_,children:e.jsxs("div",{children:[e.jsx(b,{}),e.jsx("span",{children:_})]})})},k)})})]})})})}Ke.__docgenInfo={description:"",methods:[],displayName:"SidebarGroups",props:{onItemSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(itemId: string | null) => void",signature:{arguments:[{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"itemId"}],return:{name:"void"}}},description:""},selectedItemId:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregationGroups:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [key: string]: AggregationGroup;
}`,signature:{properties:[{key:{name:"string"},value:{name:"AggregationGroup",required:!0}}]}},description:""}}};const Xe=r.createContext({appId:$.variant_entity,aggregations:{}}),pe=()=>{const t=r.useContext(Xe);if(!t)throw new Error("useFilterConfig must be used within a FilterConfigProvider");return t};function Ze(t){return`temp-filters-${t}`}const fs=Ge.createContext({caseId:1,seqId:1}),hs=t=>{switch(t){case $.cnv_occurrence:return s=>de.aggregateGermlineCNVOccurrences(s.caseId,s.seqId,s.aggregationBody).then(n=>n.data);default:return s=>de.aggregateGermlineSNVOccurrences(s.caseId,s.seqId,s.aggregationBody,s.withDictionary).then(n=>n.data)}};function et(t,s=30,n=!1,o=!1,f){let l;const{caseId:h,seqId:a}=Ge.useContext(fs);n?l={caseId:h,seqId:a,aggregationBody:{field:t,size:s},withDictionary:o}:l=null;const p=q.getResolvedActiveQuery(f);return p&&l&&(l.aggregationBody.sqon={content:p.content,op:p.op}),Qe(l,hs(f),{revalidateOnFocus:!1})}var H=(t=>(t.UPDATE_ACTIVE_QUERY="update-active-query",t))(H||{});const tt=r.createContext({}),st=r.createContext(()=>{console.warn("QueryBuilderDispatchContext has been initialized without any dispatch props")});function ys(t,s){switch(s.type){case H.UPDATE_ACTIVE_QUERY:return{...t,activeQuery:s.payload};default:throw Error("Unknown action: "+s.type)}}function nt({children:t}){const[s,n]=r.useReducer(ys,{activeQuery:{}});return e.jsx(tt,{value:s,children:e.jsx(st,{value:n,children:t})})}function xs(){return r.useContext(tt)}function we(){return r.useContext(st)}nt.__docgenInfo={description:"Provider",methods:[],displayName:"QBProvider",props:{children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""}}};function at({data:t,field:s}){const{t:n}=Q(),{appId:o}=pe(),f=we(),{data:l}=et(s.key,void 0,!0,!1,o),[h,a]=r.useState(t||l||[]),[p,c]=r.useState(null);r.useEffect(()=>{a(t||l||[])},[t,l]),r.useEffect(()=>{const g=q.getActiveQuery(o).content.find(j=>j.content.field===s.key);if(g){const j=g.content.value;j.length>=1&&c(j[0])}else c(null)},[o,s.key]);const k=r.useCallback(g=>{g.key!==p&&g.key!==void 0&&(c(g.key||null),f({type:H.UPDATE_ACTIVE_QUERY,payload:{field:s.key,value:[...g.key],merge_strategy:Z.OVERRIDE_VALUES}}))},[p]),b=r.useCallback(g=>p===g.key,[p]),_=r.useCallback(()=>{c(null)},[p]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[e.jsx(Ut,{children:h.map(g=>e.jsx("div",{className:"space-y-3 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($t,{value:g.key||"",id:g.key,checked:b(g),onClick:()=>{k(g)}}),e.jsx(me,{htmlFor:g.key,children:g.key})]}),e.jsx("span",{className:"bg-accent px-2 py-1 rounded-md font-mono text-xs",children:g.count})]})},g.key))}),p!==null&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-4 border-border"}),e.jsx("div",{className:"flex align-right justify-end items-center space-x-2",children:e.jsx(U,{onClick:_,size:"xs",children:n("common.filters.buttons.clear")})})]})]})}at.__docgenInfo={description:"",methods:[],displayName:"BooleanFacet",props:{data:{required:!1,tsType:{name:"Array",elements:[{name:"Aggregation"}],raw:"Aggregation[]"},description:""},field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function Ve(t,s){const n=t.toLowerCase().split(/\s+/).filter(Boolean);return s.filter(o=>{const f=o.key.toLowerCase(),l=o.label.toLowerCase();function h(a,p){let c=0;for(const k of p){const b=a.indexOf(k,c);if(b===-1)return!1;c=b+k.length}return!0}return h(f,n)||h(l,n)})}function be(t,s){return s<t?s:t}function gs(t,s){try{const n=sessionStorage.getItem(s);if(n){const o=JSON.parse(n),f=`${t.key}_withDictionary`;if(Object.prototype.hasOwnProperty.call(o,f))return o[f]}}catch(n){console.warn(`Failed to read dictionary toggle state from sessionStorage for ${t.key}:`,n)}return!1}function rt({field:t,maxVisibleItems:s=5}){const{t:n,sanitize:o,lazyTranslate:f}=Q(),{appId:l}=pe(),h=we(),a=Ze(l),p=()=>{try{const i=sessionStorage.getItem(a);if(i){const u=JSON.parse(i);Object.keys(u).forEach(E=>{E.endsWith("_withDictionary")||delete u[E]}),Object.keys(u).length>0?sessionStorage.setItem(a,JSON.stringify(u)):sessionStorage.removeItem(a)}}catch(i){console.warn("Failed to clear unapplied filters from sessionStorage:",i)}},[c,k]=r.useState(gs(t,a)),{data:b,isLoading:_}=et(t.key,void 0,!0,c,l),g=()=>{const i=`appLoaded_${l}`;if(!window[i]){try{const T=sessionStorage.getItem(a);if(T){const M=JSON.parse(T);Object.keys(M).forEach(X=>{X.endsWith("_withDictionary")||delete M[X]}),Object.keys(M).length>0?sessionStorage.setItem(a,JSON.stringify(M)):sessionStorage.removeItem(a)}}catch(T){console.warn("Failed to clear unapplied filters on page refresh:",T)}window[i]=!0;const N=q.getResolvedActiveQuery(l).content.find(T=>T.content.field===t.key);return(N==null?void 0:N.content.value)||[]}try{const N=sessionStorage.getItem(a);if(N){const T=JSON.parse(N);if(Object.prototype.hasOwnProperty.call(T,t.key))return T[t.key]}}catch(N){console.warn(`Failed to read filter state from sessionStorage for ${t.key}:`,N)}const E=q.getResolvedActiveQuery(l).content.find(N=>N.content.field===t.key);return(E==null?void 0:E.content.value)||[]},[j,x]=r.useState(b||[]),[y,d]=r.useState(b||[]),[I,V]=r.useState(""),[S,C]=r.useState(g()),[R,D]=r.useState(be((b||[]).length,s)),[te,F]=r.useState(!1),[v,G]=r.useState(!1),[W,P]=r.useState(!1),[K,se]=r.useState(()=>{const i=q.getResolvedActiveQuery(l);return JSON.stringify(i)}),[ee,fe]=r.useState(()=>{try{const i=sessionStorage.getItem(a);if(i){const u=JSON.parse(i);return Object.prototype.hasOwnProperty.call(u,t.key)}}catch(i){console.warn(`Failed to check sessionStorage state for ${t.key}:`,i)}return!1});r.useEffect(()=>{const i=q.getResolvedActiveQuery(l),u=JSON.stringify(i);if(K&&K!==u){p();const E=q.getResolvedActiveQuery(l).content.find(N=>N.content.field===t.key),J=(E==null?void 0:E.content.value)||[];C(J)}se(u)},[l,t.key,p,S]),r.useEffect(()=>{let i=!1;try{const T=sessionStorage.getItem(a);if(T){const M=JSON.parse(T);i=Object.prototype.hasOwnProperty.call(M,t.key)}}catch(T){console.warn(`Failed to check sessionStorage values for ${t.key}:`,T)}if(i)return;const u=q.getResolvedActiveQuery(l).content.find(T=>T.content.field===t.key),E=(u==null?void 0:u.content.value)||[],J=[...S].sort(),N=[...E].sort();JSON.stringify(J)!==JSON.stringify(N)&&(v||C(E))},[l,t.key,S,v,a]),r.useEffect(()=>{const i=q.getResolvedActiveQuery(l).content.find(A=>A.content.field===t.key),u=(i==null?void 0:i.content.value)||[],E=JSON.stringify([...S].sort())!==JSON.stringify([...u].sort());G(E),S.length===0&&u.length>0&&!W&&!v&&!ee&&C(u),ee&&fe(!1),S.length>0&&W&&P(!1);let J=[];try{const A=sessionStorage.getItem(a);if(A){const Y=JSON.parse(A);Object.prototype.hasOwnProperty.call(Y,t.key)&&(J=Y[t.key]||[])}}catch(A){console.warn(`Failed to read unapplied values from sessionStorage for ${t.key}:`,A)}const N=[...b||[]],T=[...new Set([...u,...J])];T.length>0&&T.forEach(A=>{N.some(oe=>oe.key===A)||N.push({key:A,count:0,label:A})}),N==null||N.sort((A,Y)=>{const oe=A.key&&u.includes(A.key),pt=Y.key&&u.includes(Y.key);return oe===pt?Y.count-A.count:oe?-1:1}),N==null||N.forEach(A=>{A.label=n(`common.filters.values.${t.key}.${o(A.key)}`,{defaultValue:f(A.key)})}),x(N||[]);const M=I.trim()?Ve(I,N||[]):N||[];d(M);const X=M.length;if(te&&X>s)D(X);else{const A=be(X,s);R!==A&&D(A),te&&A<=s&&F(!1)}},[b,l,t.key,s,a,S,W,v,ee,I]),r.useEffect(()=>{try{const i=sessionStorage.getItem(a)||"{}",u=JSON.parse(i);u[t.key]=S,sessionStorage.setItem(a,JSON.stringify(u))}catch(i){console.warn(`Failed to save filter state to sessionStorage for ${t.key}:`,i)}},[S,a,t.key]),r.useEffect(()=>{if(t.withDictionary)try{const i=sessionStorage.getItem(a)||"{}",u=JSON.parse(i),E=`${t.key}_withDictionary`;u[E]=c,sessionStorage.setItem(a,JSON.stringify(u))}catch(i){console.warn(`Failed to save dictionary toggle state to sessionStorage for ${t.key}:`,i)}},[c,a,t.key,t.withDictionary]);const he=r.useCallback(i=>{if(V(i),F(!1),!i.trim()){d(j),D(be(j.length,s));return}const u=Ve(i,j);d(u),s>u.length?D(u.length):u.length>s&&D(s)},[j,s]),ye=r.useCallback(()=>{D(y.length),F(!0)},[y]),xe=r.useCallback(()=>{D(s),F(!1)},[s]),ge=r.useCallback(()=>{S.length!==y.length&&(G(!0),C(y.map(i=>i.key)))},[y,S]),z=r.useCallback(()=>{G(!0),C([]),P(!0);try{const i=sessionStorage.getItem(a);if(i){const u=JSON.parse(i);delete u[t.key],Object.keys(u).length===0?sessionStorage.removeItem(a):sessionStorage.setItem(a,JSON.stringify(u))}}catch(i){console.warn(`Failed to clear filter state from sessionStorage for ${t.key}:`,i)}},[a,t.key]),ne=r.useCallback(()=>{S.length!==0&&z()},[S,z]),ae=r.useCallback(i=>{let u=[];S.some(E=>E===i.key)?u=S.filter(E=>E!==i.key):u=[...S,i.key],G(!0),C(u)},[S]),re=r.useCallback(()=>{z()},[z]),m=r.useCallback(i=>{G(!1),P(!1),h({type:H.UPDATE_ACTIVE_QUERY,payload:{field:t.key,value:[...S],merge_strategy:Z.OVERRIDE_VALUES,operator:i}}),p()},[S,l,t.key,p]),w=r.useCallback(()=>{m(Se.In)},[m]),ve=r.useCallback(()=>{m(Se.NotIn)},[m]),mt=r.useCallback(()=>{m(Se.In)},[m]);return e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{size:"sm",variant:"outline",children:[e.jsx(le,{startIcon:Ht,size:"xs",type:"text",placeholder:n("common.filters.search.placeholder"),className:"w-full text-xs mt-3 py-1.5 px-3 mb-4 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:i=>he(i.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(U,{size:"xs",onClick:()=>ge(),variant:"link",className:"px-0",children:n("common.filters.buttons.all")}),e.jsx(zt,{orientation:"vertical",className:"h-4"}),e.jsx(U,{size:"xs",onClick:()=>ne(),variant:"link",className:"px-0",children:n("common.filters.buttons.none")}),t.withDictionary&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grow"}),e.jsx(me,{htmlFor:"with-dictionary-switch",className:"text-xs",children:n("common.filters.with_dictionary")}),e.jsx(Jt,{id:"with-dictionary-switch",checked:c,size:"xs",onCheckedChange:()=>k(!c)})]})]}),e.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[_&&Array.from({length:3},(i,u)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(ue,{className:"w-full h-6 rounded"}),e.jsx(ue,{className:"h-6 w-12 rounded-md"})]},`skeleton-${u}`)),!_&&y.length===0&&e.jsx("div",{className:"text-muted-foreground py-4",children:n("common.filters.no_values_found")}),!_&&y.length>0&&Array.from({length:R},(i,u)=>e.jsx("div",{className:"gap-3 py-1.5",children:e.jsx(Gt,{size:"xs",label:n(`common.filters.labels.${t.key}_value.${y[u].key}`,{defaultValue:y[u].label}),checked:S.some(E=>E===y[u].key),count:y[u].count,onCheckedChange:()=>ae(y[u])})},y[u].key))]}),!_&&y.length>R&&e.jsx(U,{className:"mt-2 px-0",onClick:ye,size:"xs",variant:"link",children:n("common.filters.buttons.show_more",{value:Yt(y.length-R)})}),!_&&R>s&&e.jsx(U,{className:"mt-2 px-0",onClick:xe,size:"xs",variant:"link",children:n("common.filters.buttons.show_less")})]}),e.jsx(ze,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(U,{size:"xxs",variant:"ghost",onClick:re,disabled:S.length===0||_,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(Qt,{size:"xxs",variant:"outline",className:"h-7",color:"primary",actions:[{label:n("common.filters.buttons.some_not_in"),onClick:mt},{label:n("common.filters.buttons.not_in"),onClick:ve}],onDefaultAction:w,disabled:_,children:n("common.filters.buttons.apply")})})]})})]})}rt.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}}}};const ot="integer",vs=t=>{switch(t){case $.cnv_occurrence:return s=>de.statisticsGermlineCNVOccurrences(s.caseId,s.seqId,s.statisticsBody).then(n=>n.data);default:return s=>de.statisticsGermlineSNVOccurrences(s.caseId,s.seqId,s.statisticsBody).then(n=>n.data)}};function Ss(t,s,n,o,f=!1){const l={caseId:n,seqId:o,statisticsBody:{field:t}},h=f?Pe:q.getResolvedActiveQuery(s);return h&&(l.statisticsBody.sqon={content:h.content,op:h.op}),Qe(l,vs(s),{revalidateOnFocus:!1})}function Be(t,s,n,o){var j;let f=!1,l=(n==null?void 0:n.defaultOperator)??O.LessThan,h="0",a="0",p="",c=!1;const k=(o==null?void 0:o.type)===ot?0:3,b=s.content.find(x=>"content"in x&&"field"in x.content?x.content.field===t:!1),_=s.content.find(x=>"content"in x&&"field"in x.content?x.content.field===`${t}_unit`:!1);if(b){const x=b.content.value;if(console.log("[NumericalFilter] values",x),x.includes("__missing__"))return{hasUnappliedItems:f,selectedRange:l,minValue:h,maxValue:a,numericalValue:p,hasNoData:!0,selectedUnit:void 0};f=!0,x.length===2?(l=O.Between,h=Number(Number(x[0]).toFixed(k)).toLocaleString(B.language),a=Number(Number(x[1]).toFixed(k)).toLocaleString(B.language)):p=Number(x[0]).toLocaleString(B.language),b.op&&(l=b.op)}else console.log("[NumericalFilter else] no filter exists",n),c=!1,(n==null?void 0:n.defaultMin)!==void 0?(h=n.defaultMin.toLocaleString(B.language),p=n.defaultMin.toLocaleString(B.language)):(o==null?void 0:o.min)!==void 0&&(h=Number(o.min.toFixed(k)).toLocaleString(B.language),p=Number(o.min.toFixed(k)).toLocaleString(B.language)),(n==null?void 0:n.defaultMax)!==void 0?a=n.defaultMax.toLocaleString(B.language):(o==null?void 0:o.max)!==void 0&&(a=Number(o.max.toFixed(k)).toLocaleString(B.language)),n!=null&&n.defaultOperator&&(l=O[n.defaultOperator]);let g;return _&&_.content.value[0]&&((j=n==null?void 0:n.rangeTypes)!=null&&j.length)&&(g=n.rangeTypes[0].key),{hasUnappliedItems:f,selectedRange:l,minValue:h,maxValue:a,numericalValue:p,hasNoData:c,selectedUnit:g}}function it({field:t}){var z,ne,ae,re;const{t:s}=Q(),n=we(),{appId:o,aggregations:f}=pe(),{seqId:l,caseId:h}=r.useContext(Dt),a=t.key,p={[O.GreaterThan]:{display:s("common.filters.operators.greater_than"),dropdown:s("common.filters.operators.greater_than"),icon:ts},[O.LessThan]:{display:s("common.filters.operators.less_than"),dropdown:s("common.filters.operators.less_than"),icon:es},[O.Between]:{display:s("common.filters.operators.between"),dropdown:s("common.filters.operators.between"),icon:Zt},[O.GreaterThanOrEqualTo]:{display:s("common.filters.operators.greater_than_or_equal"),dropdown:s("common.filters.operators.greater_than_or_equal"),icon:Xt},[O.LessThanOrEqualTo]:{display:s("common.filters.operators.less_than_or_equal"),dropdown:s("common.filters.operators.less_than_or_equal"),icon:Kt},[O.In]:{display:s("common.filters.operators.in"),dropdown:s("common.filters.operators.in"),icon:Wt}},{data:c,isLoading:k}=Ss(a,o,h,l,!1),b=(c==null?void 0:c.type)===ot?0:3,[_,g]=r.useState(O.GreaterThan),[j,x]=r.useState("0"),[y,d]=r.useState("0"),[I,V]=r.useState("0"),[S,C]=r.useState(!1),[R,D]=r.useState(),[te,F]=r.useState(!1),v=(z=Object.values(f).flatMap(m=>m.items).find(m=>m.key===a))==null?void 0:z.defaults,G=t.type==="numerical"&&(v==null?void 0:v.noDataInputOption),W=(v==null?void 0:v.intervalDecimal)!==void 0&&((v==null?void 0:v.max)!==void 0||(v==null?void 0:v.min)!==void 0)||c&&(c.min!==void 0||c.max!==void 0),P=(v==null?void 0:v.min)??(c==null?void 0:c.min)??0,K=(v==null?void 0:v.max)??(c==null?void 0:c.max)??100,se=r.useCallback(()=>{const m=q.getResolvedActiveQuery(o);if(!(m!=null&&m.content))return;const w=Be(a,m,v,c);C(w.hasNoData),V(w.minValue),d(w.maxValue),F(w.hasUnappliedItems),g(w.selectedRange??O.GreaterThan),x(w.numericalValue)},[o,a,v,c]);r.useEffect(()=>{se()},[se]);const ee=r.useCallback(m=>{g(m),F(!0)},[]),fe=r.useCallback(m=>{C(m),F(!0)},[]),he=r.useCallback(m=>{D(m),F(!0)},[]),ye=()=>{F(!1);const m=Be(a,Pe,v,c);C(m.hasNoData),V(m.minValue),d(m.maxValue),F(m.hasUnappliedItems),g(m.selectedRange),x(m.numericalValue)},xe=r.useCallback(()=>{if(F(!1),S){n({type:H.UPDATE_ACTIVE_QUERY,payload:{field:a,value:["__missing__"],merge_strategy:Z.OVERRIDE_VALUES}});return}let m=[];m=_===O.Between?[parseFloat(I.toString()),parseFloat(y.toString())]:[parseFloat(j.toString())],n({type:H.UPDATE_ACTIVE_QUERY,payload:{field:a,value:m,merge_strategy:Z.OVERRIDE_VALUES,operator:_}}),R&&n({type:H.UPDATE_ACTIVE_QUERY,payload:{field:`${a}_unit`,value:[R],merge_strategy:Z.OVERRIDE_VALUES}})},[o,a,_,j,I,y,S,R]),ge=Object.entries(O).map(([m,w])=>{if(w in p){const ve=p[w].icon;return e.jsx(Ce,{value:w,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:16}),e.jsx("span",{children:p[w].dropdown})]})},w)}return null}).filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{id:`${a}_container`,size:"sm",variant:"outline",children:e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${a}_operator`,children:e.jsxs(Re,{value:_,onValueChange:ee,children:[e.jsx(Fe,{size:"sm",children:e.jsx(Le,{placeholder:s("common.filters.operators.select_operator"),children:((ne=p[_])==null?void 0:ne.display)||s("common.filters.operators.unknown")})}),e.jsx(qe,{children:ge})]})}),_===O.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(le,{size:"xs",className:"w-half",value:I,onChange:m=>{const w=m.target.value;isNaN(Number(w))||(V(w),F(!0))},min:P,max:K,id:`${a}_min`,"data-testid":`${a}_min`}),e.jsx(le,{size:"xs",className:"w-half",value:y,onChange:m=>{const w=m.target.value;isNaN(Number(w))||(d(w),F(!0))},min:P,max:K,id:`${a}_max`,"data-testid":`${a}_max`})]}):e.jsx(le,{size:"xs",className:"w-full",value:j,onChange:m=>{const w=m.target.value;isNaN(Number(w))||(x(w),F(!0))},min:P,max:K,id:`${a}_value`,"data-testid":`${a}_value`}),W&&e.jsx("div",{id:`${a}_interval`,children:e.jsxs(Vt,{size:"xs",children:[s("common.filters.labels.actual_interval")," : ",(ae=c==null?void 0:c.min)==null?void 0:ae.toFixed(b)," -"," ",(c==null?void 0:c.min)!==void 0?Number(c.min.toFixed(b)).toLocaleString(B.language):""," ","-"," ",(c==null?void 0:c.max)!==void 0?Number(c.max.toFixed(b)).toLocaleString(B.language):""]})})]}),(v==null?void 0:v.rangeTypes)&&v.rangeTypes.length>0&&e.jsx("div",{id:`${a}_range_type_container`,className:"mt-3",children:k?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-5 w-16 mb-1",id:`${a}_unit_label_skeleton`}),e.jsx(ue,{className:"h-9 w-full",id:`${a}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"text-sm",id:`${a}_unit_label`,children:s("common.filters.labels.unit")}),e.jsxs(Re,{defaultValue:R||v.rangeTypes[0].key,onValueChange:he,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:s("common.filters.labels.select_unit"),children:((re=v.rangeTypes.find(m=>m.key===R))==null?void 0:re.name)||s("common.filters.labels.select_unit")})}),e.jsx(qe,{children:v.rangeTypes.map(m=>e.jsx(Ce,{value:m.key,children:m.name},m.key))})]})]})}),G&&!W&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden mt-3",id:`${a}_no_data_label`,children:[e.jsx(ss,{checked:S,onCheckedChange:fe,id:`${a}_no_data`}),e.jsx("span",{children:s("common.filters.labels.no_data")})]})]})}),e.jsx(ze,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(U,{size:"xxs",variant:"ghost",onClick:ye,disabled:!te,id:`${a}_clear`,children:s("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(U,{size:"xxs",variant:"outline",onClick:xe,id:`${a}_apply`,children:s("common.filters.buttons.apply")})})]})})]})}it.__docgenInfo={description:"",methods:[],displayName:"NumericalFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function ce({field:t,children:s}){const{t:n}=Q(),o=n(`common.filters.labels.${t.translation_key}`,{defaultValue:t.key});let f=null;if(Bt.includes(t.key)){const h=`common.filters.labels.${t.translation_key}_tooltip`;f=n(h)===h?null:n(h)}function l(){return e.jsx("div",{className:"flex items-center justify-between w-full text-xs",children:e.jsx("span",{children:o})})}return e.jsx(Ie,{size:"sm",children:e.jsxs(Je,{value:t.key,className:"border-none",children:[e.jsx(Pt,{size:"sm",children:e.jsx(Ye,{children:f?e.jsxs(je,{children:[e.jsx(_e,{asChild:!0,children:e.jsx("span",{children:l()})}),e.jsx(ke,{children:e.jsx("span",{children:f})})]}):l()})}),e.jsx(He,{className:"pb-0",children:s})]},t.key)})}function lt({field:t,isOpen:s}){const{t:n}=Q(),o=t.type;if(o===L.DIVIDER)return e.jsx("h4",{className:"px-2 h-8 text-sidebar-foreground/70 text-xs font-medium line-height-xs text-ellipsis overflow-hidden flex justify-between items-center",children:n(`common.filters.${t.key}`)});let f;switch(o){case L.MULTIPLE:f=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(rt,{field:t})});break;case L.NUMERICAL:f=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(it,{field:t})});break;case L.BOOLEAN:f=e.jsx(ce,{field:t,isOpen:s,children:e.jsx(at,{field:t})});break;default:f=e.jsx("div",{children:n("common.filters.unsupported_type",{type:t.type})})}return f}ce.__docgenInfo={description:"",methods:[],displayName:"AccordionContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};lt.__docgenInfo={description:"To be use when the facet needs to be inside an Accordion component",methods:[],displayName:"FacetContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""}}};function ct({search:t}){const{t:s}=Q(),{appId:n}=pe(),{translation_key:o,key:f}=t,l=f.replace(/search_by_/g,""),[h,a]=r.useState([]),[p,c]=r.useState([]),[k,b]=r.useState(null);r.useEffect(()=>{var d;const j=q.getResolvedActiveQuery(n);if(JSON.stringify(j)===JSON.stringify(k))return;const x=j.content.find(I=>"content"in I&&"field"in I.content?I.content.field===l:!1),y=((d=x==null?void 0:x.content)==null?void 0:d.value)||[];Array.isArray(y)&&a(y),b(j)},[n,l,q.getActiveQuery(n)]),r.useEffect(()=>{(async()=>{if(h.length===0){c([]);return}try{const x=h.map(async d=>{var I,V;try{const C=(await Te.geneAutoComplete(d)).data.find(R=>{var D;return((D=R.source)==null?void 0:D.name)===d});if(C)return{value:d,label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:((I=C.source)==null?void 0:I.name)||d}),e.jsx("span",{className:"text-xs text-muted-foreground",children:((V=C.source)==null?void 0:V.id)||""})]}),badgeLabel:d}}catch(S){console.error(`Error fetching gene ${d}:`,S)}return{value:d,label:d,badgeLabel:d}}),y=await Promise.all(x);c(y)}catch(x){console.error("Error fetching gene details:",x);const y=h.map(d=>({value:d,label:d,badgeLabel:d}));c(y)}})()},[h]);const _=async j=>{if(!j)return[];try{return(await Te.geneAutoComplete(j)).data.map(y=>{var d,I,V,S,C,R;return{value:((d=y.source)==null?void 0:d.name)||"",label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:Oe(((I=y.highlight)==null?void 0:I.name)||((V=y.source)==null?void 0:V.name)||"")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Oe(((S=y.highlight)==null?void 0:S.id)||((C=y.source)==null?void 0:C.id)||"")})]}),badgeLabel:((R=y.source)==null?void 0:R.name)||""}})}catch(x){return console.error("Error fetching genes:",x),[]}},g=j=>{a(j),q.updateActiveQueryField(n,{field:l,value:j,merge_strategy:Z.OVERRIDE_VALUES})};return e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{children:s(`common.filters.labels.${o}`)}),e.jsxs(je,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(as,{size:16})}),e.jsx(ke,{children:s(`common.filters.labels.${o}_tooltip`)})]})]}),e.jsx(ns,{value:h,defaultOptions:p,onChange:g,onSearch:_,placeholder:s(`common.filters.labels.${o}_placeholder`),className:"w-full",debounceDelay:300,maxSelected:100,hidePlaceholderWhenSelected:!0})]})}ct.__docgenInfo={description:"",methods:[],displayName:"SearchFacet",props:{search:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function dt({groupKey:t,appId:s,aggregations:n}){var y;const{t:o}=Q(),[f,l]=r.useState(!1),[h,a]=r.useState([]),[p,c]=r.useState(t),k=Ze(s),b=()=>{sessionStorage.removeItem(k)},_=t?((y=n[t])==null?void 0:y.items)||[]:Object.values(n).flatMap(d=>d.items),g=_.filter(d=>d.type===L.SEARCH_BY),j=_.filter(d=>d.type===L.UPLOAD_LIST),x=_.filter(d=>d.type!==L.SEARCH_BY&&d.type!==L.UPLOAD_LIST);return r.useEffect(()=>{l(!1),a([])},[t]),r.useEffect(()=>{(p&&p!==null&&t===null||p&&p!==null&&t&&t!==null&&p!==t)&&b(),c(t)},[t,p]),e.jsx(Xe,{value:{appId:s,aggregations:n},children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3",children:[g.map((d,I)=>e.jsx(ct,{search:d},`${d.key}-${I}`)),j.map((d,I)=>e.jsx(Mt,{variant:d.key.replace(/upload_list_/g,"")},`${d.key}-${I}`))]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(U,{variant:"link",size:"xs",onClick:()=>{const d=!f;l(d),a(d?x.map(I=>I.key):[])},children:o(f?"common.actions.collapse_all":"common.actions.expand_all")})}),e.jsx(We,{className:"flex flex-col gap-1",type:"multiple",value:h,onValueChange:d=>a(d),children:x.map((d,I)=>e.jsx(lt,{isOpen:h.includes(d.key),field:d},`${d.key}-${I}`))})]})})}dt.__docgenInfo={description:"",methods:[],displayName:"FacetList",props:{groupKey:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregations:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [key: string]: AggregationGroup;
}`,signature:{properties:[{key:{name:"string"},value:{name:"AggregationGroup",required:!0}}]}},description:""},appId:{required:!0,tsType:{name:"ApplicationId"},description:""}}};function ut(){const{activeQuery:t}=xs();return console.log("activeQuery",t),e.jsx(Ie,{className:"py-0",children:e.jsx(We,{type:"multiple",defaultValue:["query-builder"],children:e.jsxs(Je,{value:"query-builder",className:"border-none",children:[e.jsx(Ye,{className:"border-b py-0 px-6 data-[state=closed]:rounded-sm data-[state=closed]:border-none hover:cursor-pointer",asChild:!0,children:"Title Placeholder"}),e.jsx(He,{className:"py-4 px-6 space-y-4",children:e.jsx("div",{className:"flex flex-col gap-2 max-h-[30vh] overflow-y-scroll",children:t==null?void 0:t.field})})]})})})}ut.__docgenInfo={description:"",methods:[],displayName:"Query"};function bs(t){return Object.fromEntries(Object.entries(t).map(([s,n])=>{const o={...n,items:n.items.filter(f=>f.facetHidden!==!0)};return[s,o]}).filter(([s,n])=>n.items.length>0))}function Ee({appId:t,defaultSidebarOpen:s=!1,children:n}){const[o,f]=r.useState(s),l=Ft(),h=bs(l[t].aggregations),[a,p]=r.useState(null);return e.jsx(nt,{children:e.jsx("div",{className:"bg-muted w-full",children:e.jsxs("div",{className:"flex flex-1 h-screen overflow-hidden",children:[e.jsx("aside",{className:"w-auto min-w-fit h-full shrink-0",children:e.jsxs(Ot,{open:o,onOpenChange:f,className:"h-full flex flex-row",children:[e.jsx("div",{className:"z-10",children:e.jsx(Ke,{aggregationGroups:h,selectedItemId:a,onItemSelect:p})}),e.jsx("div",{className:qt("overflow-auto mb-16 border-r transition-[width] duration-300 ease-in-out",{"w-[280px] p-4 opacity-100 relative":a,"w-0 opacity-0":!a}),children:e.jsxs("div",{className:"whitespace-nowrap",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>p(null),className:"text-muted-foreground hover:text-foreground",children:e.jsx(rs,{size:16})})}),e.jsx(dt,{appId:t,aggregations:h,groupKey:a})]})})]})}),e.jsxs("main",{className:"flex-1 shrink px-3 pb-3 overflow-auto",children:[e.jsx("div",{className:"py-3 space-y-2",children:e.jsx(ut,{})}),n]})]})})})}Ee.__docgenInfo={description:"",methods:[],displayName:"QueryBuilder",props:{appId:{required:!0,tsType:{name:"ApplicationId"},description:""},children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""},defaultSidebarOpen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const js={variant_entity:{app_id:$.variant_entity},snv_occurrence:{app_id:$.snv_occurrence,aggregations:{variant:{items:[{key:"multiple",translation_key:"multiple",type:L.MULTIPLE},{key:"multiple (with dictionary)",translation_key:"multiple (with dictionary)",type:L.MULTIPLE,withDictionary:!0},{key:"numerical (decimal)",translation_key:"numerical (decimal)",type:L.NUMERICAL,defaults:{min:0,max:100,defaultOperator:O.LessThan,defaultMin:0,defaultMax:100}},{key:"numerical (integer)",translation_key:"numerical (integer)",type:L.NUMERICAL,defaults:{min:0,max:100,defaultOperator:O.LessThan,defaultMin:0,defaultMax:100}},{key:"numerical (with unit)",translation_key:"numerical (with unit)",type:L.NUMERICAL,defaults:{min:0,max:120,defaultOperator:O.Between,defaultMin:0,defaultMax:120,intervalDecimal:0,rangeTypes:[{key:"year",name:"Year"},{key:"month",name:"Month"},{key:"day",name:"Day"}]}},{key:"numerical (no data)",translation_key:"numerical (no data)",type:L.NUMERICAL,defaults:{min:void 0,max:void 0,defaultOperator:O.GreaterThan,noDataInputOption:!0}},{key:"toggle filter",translation_key:"toggle filter",type:L.BOOLEAN}]}}},cnv_occurrence:{app_id:$.cnv_occurrence,aggregations:{}},admin:{admin_code:"admin",app_id:$.admin},portal:{name:"",navigation:{}}},Zn={title:"QueryBuilder/QueryBuilderV3",component:Ee,args:{},decorators:[t=>e.jsx(ds,{initialEntries:["/case/1"],children:e.jsx(us,{children:e.jsx(ms,{path:"/case/:caseId",element:e.jsx(Lt,{config:js,children:e.jsx(t,{})})})})})]},ie={parameters:{msw:{handlers:[Ae.post(os,is),Ae.post(ls,cs)]}},args:{},render:()=>e.jsx(Ee,{appId:$.snv_occurrence,defaultSidebarOpen:!0,children:e.jsx(Ie,{children:e.jsx(Ne,{children:e.jsx(ft,{id:"storybook-query-builder",columns:[],data:[],loadingStates:{total:!1,list:!1},defaultColumnSettings:[],pagination:{type:"hidden",state:void 0,onPaginationChange:void 0}})})})})};var Me,Ue,$e;ie.parameters={...ie.parameters,docs:{...(Me=ie.parameters)==null?void 0:Me.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(occurrenceApi, httpOccurrenceApiResponse), http.post(statisticApi, httpStatisticsApiResponse)]
    }
  },
  args: {},
  render: () => <QueryBuilder appId={ApplicationId.snv_occurrence} defaultSidebarOpen>
      <Card>
        <CardContent>
          <DataTable id="storybook-query-builder" columns={[]} data={[]} loadingStates={{
          total: false,
          list: false
        }} defaultColumnSettings={[]} pagination={{
          type: 'hidden',
          state: undefined,
          onPaginationChange: undefined
        }} />
        </CardContent>
      </Card>
    </QueryBuilder>
}`,...($e=(Ue=ie.parameters)==null?void 0:Ue.docs)==null?void 0:$e.source}}};const ea=["Default"];export{ie as Default,ea as __namedExportsOrder,Zn as default};
