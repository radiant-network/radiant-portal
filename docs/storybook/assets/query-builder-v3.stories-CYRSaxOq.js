import{r as i,j as e,b as Ie,d as Ne,f as vs,e as Ae,K as Q,a6 as bs,c as De}from"./iframe-DiydeeGO.js";import{S as E,a as ie}from"./api-Bd3rgHIX.js";import{H as X,h as q}from"./index-Dg-o_Ns_.js";import{B as js,U as ks,O as Ss,F as _s,P as Is,G as Ns,V as As,D as Os}from"./variant-icon-CoH1JeSc.js";import{B as P}from"./button-BpQoX9AX.js";import{a as ws,S as wt,c as Tt,d as Ct,e as Lt,f as Ts,g as Cs,m as Et}from"./sidebar-By-orEiK.js";import{u as D}from"./i18n-3c6sQS03.js";import{P as Ls,a as Es}from"./panel-left-open-Co4TlE-c.js";import{T as qs,f as Rs,p as ot,U as Bs}from"./upload-id-modal-htjDf5wz.js";import{L as Oe}from"./label-t5OrrID9.js";import{R as Fs,a as Ms}from"./radio-group-BCfR1RqI.js";import{F as b,A as J,u as Ds,C as Ps}from"./applications-config-vsfwkDJy.js";import{v as qt,q as U,D as Vs}from"./query-builder-remote-DGZWf6tm.js";import{A as Qs}from"./action-button-CfmhRu5e.js";import{C as Us}from"./checkbox-filter-BeMClAH4.js";import{d as Pe,e as Rt,C as we,a as $s}from"./card-Bv3qvq2F.js";import{I as Se}from"./input-jG2CaZGS.js";import{S as Bt}from"./separator-DR0R7ySQ.js";import{S as R}from"./skeleton-D0CoaMIA.js";import{S as zs}from"./switch-afjRw1PK.js";import{t as Gs}from"./number-format-DhfGZGyc.js";import{S as Js}from"./search-BLYWUfpC.js";import{a as Ft,c as Mt,b as Dt,E as Pt,L as Vt,G as Qt}from"./less-than-or-equal-operator-icon-CixI5j-2.js";import{C as Hs}from"./checkbox-ESqalaxl.js";import{d as it,S as lt,a as ct,b as dt,c as ut}from"./select-DdaSx4FQ.js";import{A as Ut,a as $t,b as zt,c as Gt}from"./accordion-DLckTL8n.js";import{M as Ws}from"./multi-selector-CHfr416Z.js";import{g as pt,u as se,o as Te,k as Xs,D as Ks}from"./data-table-LZ_IFdx0.js";import{_ as pe,a as me}from"./helper-BvryC1ka.js";import{X as Jt}from"./x-DeSLZQy8.js";import{N as Ys}from"./not-in-operator-icon-BEHaCLaM.js";import{t as Zs}from"./take-BljiV75v.js";import{C as en}from"./chevron-left-xLAem4kA.js";import{C as tn}from"./chevron-right-DvTpYI5k.js";import{P as sn,a as nn,b as an}from"./popover-HKP-DIvN.js";import{R as G}from"./sqon-C0f5UNeg.js";import{o as Ve,h as Qe,a as Ue,b as $e,d as rn}from"./api-occurrence-D9rf9f91.js";import{a as ze,m as Ge,b as Je}from"./table-mock-DYjkM7Cj.js";import{M as on,R as ln,a as cn}from"./chunk-EPOLDU6W-CThPyvmJ.js";import"./preload-helper-Dp1pzeXC.js";import"./index-B7hOF3du.js";import"./check-Dn9AvtKh.js";import"./index-CWep2SmB.js";import"./sheet-B3tgVqxk.js";import"./dialog-BmVpaksT.js";import"./circle-BhlZk34l.js";import"./index-D3WEPLb5.js";import"./useDebounce-DnTKd-1w.js";import"./collapsible-card-BRXCdUSi.js";import"./index-DBFKZDlk.js";import"./collapsible-CJXrBg0f.js";import"./chevron-up-BT3u3EWc.js";import"./chevron-down-E2GPlgB7.js";import"./display-table-CzpWA8my.js";import"./empty-C6tqhyc9.js";import"./hover-card-CajMpewk.js";import"./index-DyRaPGyE.js";import"./isEqual-CYlMe2vy.js";import"./dropdown-menu-CdVAlv0x.js";import"./command-B7YDIpAT.js";import"./badge-DnMJtbi6.js";import"./settings-DheC79LS.js";import"./pagination-Bld8wr82.js";import"./ellipsis-6erClh3V.js";import"./index-Ct8yfgxN.js";import"./chunk-WWGJGFF6-DSiBKmm_.js";import"./_baseSlice-DkFNCYmM.js";import"./toString-GFsMKb17.js";import"./empty-cell-BjTFyEhX.js";const dn={organization:Os,variant:As,gene:Ns,pathogenicity:Is,frequency:_s,occurrence:Ss,parental_analysis:ks,metric_qc:js},mt=vs({base:"text-secondary dark:text-foreground",variants:{selected:{true:"bg-sidebar-brand-accent text-sidebar-brand-accent-foreground"}},defaultVariants:{selected:!1}});function Ht({onItemSelect:t,aggregationGroups:n,selectedItemId:s}){const{t:a}=D(),{open:l,toggleSidebar:c}=ws(),[o,x]=i.useState(null),r=s!==void 0?s:o,h=f=>{const j=r===f?null:f;x(j),t&&t(j)};return e.jsx(wt,{variant:"sidebar",collapsible:"icon",className:"static! flex flex-col w-full bg-primary dark:bg-secondary ",children:e.jsx(Tt,{children:e.jsxs(Ct,{children:[e.jsxs(Ie,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(P,{iconOnly:!0,onClick:()=>c(),className:mt({className:"mb-1 hover:bg-sidebar-brand-accent hover:text-sidebar-brand-accent-foreground"}),size:"sm",variant:"ghost",children:l?e.jsx(Ls,{}):e.jsx(Es,{})})}),e.jsx(Ae,{side:"right",align:"center",children:a(l?"query_filters.sidebar_panel.collapse":"query_filters.sidebar_panel.expand")})]}),e.jsx(Lt,{children:Object.entries(n).map(([f])=>{const j=dn[f],I=a(`query_filters.sidebar_panel.filters.${f}`);return e.jsx(Ts,{children:e.jsx(Cs,{asChild:!0,className:mt({selected:r===f}),onClick:v=>{v.preventDefault(),h(f)},tooltip:I,children:e.jsxs("div",{children:[e.jsx(j,{}),e.jsx("span",{children:I})]})})},f)})})]})})})}Ht.__docgenInfo={description:"",methods:[],displayName:"SidebarGroups",props:{onItemSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(itemId: string | null) => void",signature:{arguments:[{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"itemId"}],return:{name:"void"}}},description:""},selectedItemId:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregationGroups:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};const B={GreaterThan:E.GreaterThan,LessThan:E.LessThan,Between:E.Between,GreaterThanOrEqualTo:E.GreaterThanOrEqualTo,LessThanOrEqualTo:E.LessThanOrEqualTo,In:E.In},Fe={In:E.In,NotIn:E.NotIn},He={And:E.And};var Wt=(t=>(t.DEFAULT="OVERRIDE_VALUES",t.OVERRIDE_VALUES="OVERRIDE_VALUES",t.APPEND_VALUES="APPEND_VALUES",t))(Wt||{});function un(t){return typeof t=="object"&&t!==null&&"field"in t}function pn(t,n){const s=n.content.field;let a;for(const l in t)if(a=t[l].items.find(c=>c.key===s),a)return a;return console.error(`${s} doesn't exist in aggregations`,t),{type:b.MULTIPLE,key:"error",translation_key:"error"}}function mn(){return{content:[],id:qt(),op:He.And}}function fn(t){return Object.fromEntries(Object.entries(t).map(([n,s])=>{const a={...s,items:s.items.filter(l=>l.facetHidden!==!0)};return[n,a]}).filter(([n,s])=>s.items.length>0))}var oe=(t=>(t.INITIALIZE="initialize",t.SET_ACTIVE_QUERY="set-active-query",t.ADD_IVALUEFACET="update-active-query",t))(oe||{});const Xt={aggregations:{},activeQueryId:qt(),sqons:[]},We=i.createContext(Xt),Kt=i.createContext(()=>{console.warn("QueryBuilderDispatchContext has been initialized without any dispatch props")});function hn(t,n){switch(n.type){case"set-active-query":return{...t,activeQuery:n.payload};case"update-active-query":{const{activeQueryId:s}=t,{sqons:a}=t,l=t.sqons.findIndex(c=>c.id===s);if(l<0)a.push({id:s,content:[n.payload],op:He.And});else{const c=a[l].content.findIndex(o=>un(o)&&o.field===n.payload.field);c<0?a[l].content=[...a[l].content,n.payload]:a[l].content[c]=n.payload}return{context:t,sqons:[...a]}}default:throw Error("Unknown action: "+n.type)}}function Yt({children:t,...n}){const[s,a]=i.useReducer(hn,n);return e.jsx(We,{value:s,children:e.jsx(Kt,{value:a,children:t})})}function Xe(){return i.useContext(We)}function Ke(){return i.useContext(Kt)}function Ye(){const{activeQueryId:t,sqons:n}=Xe();return n.find(s=>s.id===t)??mn()}function Ce(){const t=Ye();return{content:t.content,op:t.op}}Yt.__docgenInfo={description:"",methods:[],displayName:"QBProvider",props:{aggregations:{required:!0,tsType:{name:"AggregationConfig"},description:""},sqons:{required:!0,tsType:{name:"Array",elements:[{name:"ISyntheticSqon"}],raw:"ISyntheticSqon[]"},description:""},activeQueryId:{required:!0,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""}}};const Ze=i.createContext({appId:J.snv_occurrence,builderFetcher:t=>{},statisticFetcher:t=>{}});function ue(){const t=i.useContext(Ze);if(!t)throw new Error("useFilterConfig must be used within a FilterConfigProvider");return t}function Zt(){const{appId:t}=i.useContext(Ze);return`temp-filters-${t}`}function et({data:t,field:n}){const{t:s}=D(),{builderFetcher:a}=ue(),l=Ke(),{data:c}=a({field:n.key,size:30}),[o,x]=i.useState(t||c||[]),[r,h]=i.useState(null);i.useEffect(()=>{x(t||c||[])},[t,c]),i.useEffect(()=>{h(null)},[n.key]);const f=i.useCallback(v=>{v.key!==r&&v.key!==void 0&&(h(v.key||null),l({type:oe.ADD_IVALUEFACET,payload:{field:n.key,value:[...v.key]}}))},[r]),j=i.useCallback(v=>r===v.key,[r]),I=i.useCallback(()=>{h(null)},[r]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[e.jsx(Fs,{children:o.map(v=>e.jsx("div",{className:"space-y-3 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ms,{value:v.key||"",id:v.key,checked:j(v),onClick:()=>{f(v)}}),e.jsx(Oe,{htmlFor:v.key,children:v.key})]}),e.jsx("span",{className:"bg-accent px-2 py-1 rounded-md font-mono text-xs",children:v.count})]})},v.key))}),r!==null&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-4 border-border"}),e.jsx("div",{className:"flex align-right justify-end items-center space-x-2",children:e.jsx(P,{onClick:I,size:"xs",children:s("common.filters.buttons.clear")})})]})]})}et.__docgenInfo={description:"",methods:[],displayName:"BooleanFacet",props:{data:{required:!1,tsType:{name:"Array",elements:[{name:"Aggregation"}],raw:"Aggregation[]"},description:""},field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function ft(t,n){const s=t.toLowerCase().split(/\s+/).filter(Boolean);return n.filter(a=>{const l=a.key.toLowerCase(),c=a.label.toLowerCase();function o(x,r){let h=0;for(const f of r){const j=x.indexOf(f,h);if(j===-1)return!1;h=j+f.length}return!0}return o(l,s)||o(c,s)})}function Me(t,n){return n<t?n:t}function yn(t,n){try{const s=sessionStorage.getItem(n);if(s){const a=JSON.parse(s),l=`${t.key}_withDictionary`;if(Object.prototype.hasOwnProperty.call(a,l))return a[l]}}catch(s){console.warn(`Failed to read dictionary toggle state from sessionStorage for ${t.key}:`,s)}return!1}function tt({field:t,maxVisibleItems:n=5}){const{t:s,sanitize:a,lazyTranslate:l}=D(),{appId:c,builderFetcher:o}=ue(),x=Ke(),r=Zt(),h=()=>{try{const d=sessionStorage.getItem(r);if(d){const u=JSON.parse(d);Object.keys(u).forEach(A=>{A.endsWith("_withDictionary")||delete u[A]}),Object.keys(u).length>0?sessionStorage.setItem(r,JSON.stringify(u)):sessionStorage.removeItem(r)}}catch(d){console.warn("Failed to clear unapplied filters from sessionStorage:",d)}},[f,j]=i.useState(yn(t,r)),{data:I,isLoading:v}=o({field:t.key,withDictionary:f}),O=()=>{const d=`appLoaded_${c}`;if(!window[d]){try{const T=sessionStorage.getItem(r);if(T){const z=JSON.parse(T);Object.keys(z).forEach(re=>{re.endsWith("_withDictionary")||delete z[re]}),Object.keys(z).length>0?sessionStorage.setItem(r,JSON.stringify(z)):sessionStorage.removeItem(r)}}catch(T){console.warn("Failed to clear unapplied filters on page refresh:",T)}window[d]=!0;const _=U.getResolvedActiveQuery(c).content.find(T=>T.content.field===t.key);return(_==null?void 0:_.content.value)||[]}try{const _=sessionStorage.getItem(r);if(_){const T=JSON.parse(_);if(Object.prototype.hasOwnProperty.call(T,t.key))return T[t.key]}}catch(_){console.warn(`Failed to read filter state from sessionStorage for ${t.key}:`,_)}const A=U.getResolvedActiveQuery(c).content.find(_=>_.content.field===t.key);return(A==null?void 0:A.content.value)||[]},[y,p]=i.useState(I||[]),[m,L]=i.useState(I||[]),[F,V]=i.useState(""),[k,M]=i.useState(O()),[$,C]=i.useState(Me((I||[]).length,n)),[S,ne]=i.useState(!1),[K,H]=i.useState(!1),[Y,ae]=i.useState(!1),[he,Ee]=i.useState(()=>{const d=U.getResolvedActiveQuery(c);return JSON.stringify(d)}),[de,qe]=i.useState(()=>{try{const d=sessionStorage.getItem(r);if(d){const u=JSON.parse(d);return Object.prototype.hasOwnProperty.call(u,t.key)}}catch(d){console.warn(`Failed to check sessionStorage state for ${t.key}:`,d)}return!1});i.useEffect(()=>{const d=U.getResolvedActiveQuery(c),u=JSON.stringify(d);if(he&&he!==u){h();const A=U.getResolvedActiveQuery(c).content.find(_=>_.content.field===t.key),ee=(A==null?void 0:A.content.value)||[];M(ee)}Ee(u)},[c,t.key,h,k]),i.useEffect(()=>{let d=!1;try{const T=sessionStorage.getItem(r);if(T){const z=JSON.parse(T);d=Object.prototype.hasOwnProperty.call(z,t.key)}}catch(T){console.warn(`Failed to check sessionStorage values for ${t.key}:`,T)}if(d)return;const u=U.getResolvedActiveQuery(c).content.find(T=>T.content.field===t.key),A=(u==null?void 0:u.content.value)||[],ee=[...k].sort(),_=[...A].sort();JSON.stringify(ee)!==JSON.stringify(_)&&(K||M(A))},[c,t.key,k,K,r]),i.useEffect(()=>{const d=U.getResolvedActiveQuery(c).content.find(w=>w.content.field===t.key),u=(d==null?void 0:d.content.value)||[],A=JSON.stringify([...k].sort())!==JSON.stringify([...u].sort());H(A),k.length===0&&u.length>0&&!Y&&!K&&!de&&M(u),de&&qe(!1),k.length>0&&Y&&ae(!1);let ee=[];try{const w=sessionStorage.getItem(r);if(w){const te=JSON.parse(w);Object.prototype.hasOwnProperty.call(te,t.key)&&(ee=te[t.key]||[])}}catch(w){console.warn(`Failed to read unapplied values from sessionStorage for ${t.key}:`,w)}const _=[...I||[]],T=[...new Set([...u,...ee])];T.length>0&&T.forEach(w=>{_.some(ve=>ve.key===w)||_.push({key:w,count:0,label:w})}),_==null||_.sort((w,te)=>{const ve=w.key&&u.includes(w.key),xs=te.key&&u.includes(te.key);return ve===xs?te.count-w.count:ve?-1:1}),_==null||_.forEach(w=>{w.label=s(`common.filters.values.${t.key}.${a(w.key)}`,{defaultValue:l(w.key)})}),p(_||[]);const z=F.trim()?ft(F,_||[]):_||[];L(z);const re=z.length;if(S&&re>n)C(re);else{const w=Me(re,n);$!==w&&C(w),S&&w<=n&&ne(!1)}},[I,c,t.key,n,r,k,Y,K,de,F]),i.useEffect(()=>{try{const d=sessionStorage.getItem(r)||"{}",u=JSON.parse(d);u[t.key]=k,sessionStorage.setItem(r,JSON.stringify(u))}catch(d){console.warn(`Failed to save filter state to sessionStorage for ${t.key}:`,d)}},[k,r,t.key]),i.useEffect(()=>{if(t.withDictionary)try{const d=sessionStorage.getItem(r)||"{}",u=JSON.parse(d),A=`${t.key}_withDictionary`;u[A]=f,sessionStorage.setItem(r,JSON.stringify(u))}catch(d){console.warn(`Failed to save dictionary toggle state to sessionStorage for ${t.key}:`,d)}},[f,r,t.key,t.withDictionary]);const Re=i.useCallback(d=>{if(V(d),ne(!1),!d.trim()){L(y),C(Me(y.length,n));return}const u=ft(d,y);L(u),n>u.length?C(u.length):u.length>n&&C(n)},[y,n]),Be=i.useCallback(()=>{C(m.length),ne(!0)},[m]),ye=i.useCallback(()=>{C(n),ne(!1)},[n]),ge=i.useCallback(()=>{k.length!==m.length&&(H(!0),M(m.map(d=>d.key)))},[m,k]),Z=i.useCallback(()=>{H(!0),M([]),ae(!0);try{const d=sessionStorage.getItem(r);if(d){const u=JSON.parse(d);delete u[t.key],Object.keys(u).length===0?sessionStorage.removeItem(r):sessionStorage.setItem(r,JSON.stringify(u))}}catch(d){console.warn(`Failed to clear filter state from sessionStorage for ${t.key}:`,d)}},[r,t.key]),xe=i.useCallback(()=>{k.length!==0&&Z()},[k,Z]),g=i.useCallback(d=>{let u=[];k.some(A=>A===d.key)?u=k.filter(A=>A!==d.key):u=[...k,d.key],H(!0),M(u)},[k]),N=i.useCallback(()=>{Z()},[Z]),W=i.useCallback(d=>{H(!1),ae(!1),x({type:oe.ADD_IVALUEFACET,payload:{content:{field:t.key,value:[...k]},op:d}}),h()},[k,c,t.key,h]),hs=i.useCallback(()=>{W(Fe.In)},[W]),ys=i.useCallback(()=>{W(Fe.NotIn)},[W]),gs=i.useCallback(()=>{W(Fe.In)},[W]);return e.jsxs(e.Fragment,{children:[e.jsxs(Pe,{size:"sm",variant:"outline",children:[e.jsx(Se,{startIcon:Js,size:"xs",type:"text",placeholder:s("common.filters.search.placeholder"),className:"w-full text-xs mt-3 py-1.5 px-3 mb-4 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:d=>Re(d.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(P,{size:"xs",onClick:()=>ge(),variant:"link",className:"px-0",children:s("common.filters.buttons.all")}),e.jsx(Bt,{orientation:"vertical",className:"h-4"}),e.jsx(P,{size:"xs",onClick:()=>xe(),variant:"link",className:"px-0",children:s("common.filters.buttons.none")}),t.withDictionary&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grow"}),e.jsx(Oe,{htmlFor:"with-dictionary-switch",className:"text-xs",children:s("common.filters.with_dictionary")}),e.jsx(zs,{id:"with-dictionary-switch",checked:f,size:"xs",onCheckedChange:()=>j(!f)})]})]}),e.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[v&&Array.from({length:3},(d,u)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(R,{className:"w-full h-6 rounded"}),e.jsx(R,{className:"h-6 w-12 rounded-md"})]},`skeleton-${u}`)),!v&&m.length===0&&e.jsx("div",{className:"text-muted-foreground py-4",children:s("common.filters.no_values_found")}),!v&&m.length>0&&Array.from({length:$},(d,u)=>e.jsx("div",{className:"gap-3 py-1.5",children:e.jsx(Us,{size:"xs",label:s(`common.filters.labels.${t.key}_value.${m[u].key}`,{defaultValue:m[u].label}),checked:k.some(A=>A===m[u].key),count:m[u].count,onCheckedChange:()=>g(m[u])})},m[u].key))]}),!v&&m.length>$&&e.jsx(P,{className:"mt-2 px-0",onClick:Be,size:"xs",variant:"link",children:s("common.filters.buttons.show_more",{value:Gs(m.length-$)})}),!v&&$>n&&e.jsx(P,{className:"mt-2 px-0",onClick:ye,size:"xs",variant:"link",children:s("common.filters.buttons.show_less")})]}),e.jsx(Rt,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(P,{size:"xxs",variant:"ghost",onClick:N,disabled:k.length===0||v,children:s("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(Qs,{size:"xxs",variant:"outline",className:"h-7",color:"primary",actions:[{label:s("common.filters.buttons.some_not_in"),onClick:gs},{label:s("common.filters.buttons.not_in"),onClick:ys}],onDefaultAction:hs,disabled:v,children:s("common.filters.buttons.apply")})})]})})]})}tt.__docgenInfo={description:"@TODO: Simplify component to remove session storage. Should be redo after but more readable and maintanable",methods:[],displayName:"MultiSelectFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}}}};const es="integer";function ht(t,n,s,a){var O;let l=!1,c=(s==null?void 0:s.defaultOperator)??B.LessThan,o="0",x="0",r="",h=!1;const f=(a==null?void 0:a.type)===es?0:3,j=n.content.find(y=>"content"in y&&"field"in y.content?y.content.field===t:!1),I=n.content.find(y=>"content"in y&&"field"in y.content?y.content.field===`${t}_unit`:!1);if(j){const y=j.content.value;if(console.log("[NumericalFilter] values",y),y.includes("__missing__"))return{hasUnappliedItems:l,selectedRange:c,minValue:o,maxValue:x,numericalValue:r,hasNoData:!0,selectedUnit:void 0};l=!0,y.length===2?(c=B.Between,o=Number(Number(y[0]).toFixed(f)).toLocaleString(Q.language),x=Number(Number(y[1]).toFixed(f)).toLocaleString(Q.language)):r=Number(y[0]).toLocaleString(Q.language),j.op&&(c=j.op)}else console.log("[NumericalFilter else] no filter exists",s),h=!1,(s==null?void 0:s.defaultMin)!==void 0?(o=s.defaultMin.toLocaleString(Q.language),r=s.defaultMin.toLocaleString(Q.language)):(a==null?void 0:a.min)!==void 0&&(o=Number(a.min.toFixed(f)).toLocaleString(Q.language),r=Number(a.min.toFixed(f)).toLocaleString(Q.language)),(s==null?void 0:s.defaultMax)!==void 0?x=s.defaultMax.toLocaleString(Q.language):(a==null?void 0:a.max)!==void 0&&(x=Number(a.max.toFixed(f)).toLocaleString(Q.language)),s!=null&&s.defaultOperator&&(c=B[s.defaultOperator]);let v;return I&&I.content.value[0]&&((O=s==null?void 0:s.rangeTypes)!=null&&O.length)&&(v=s.rangeTypes[0].key),{hasUnappliedItems:l,selectedRange:c,minValue:o,maxValue:x,numericalValue:r,hasNoData:h,selectedUnit:v}}function gn(t){return{[B.GreaterThan]:{display:t("common.filters.operators.greater_than"),dropdown:t("common.filters.operators.greater_than"),icon:Qt},[B.LessThan]:{display:t("common.filters.operators.less_than"),dropdown:t("common.filters.operators.less_than"),icon:Vt},[B.Between]:{display:t("common.filters.operators.between"),dropdown:t("common.filters.operators.between"),icon:Pt},[B.GreaterThanOrEqualTo]:{display:t("common.filters.operators.greater_than_or_equal"),dropdown:t("common.filters.operators.greater_than_or_equal"),icon:Dt},[B.LessThanOrEqualTo]:{display:t("common.filters.operators.less_than_or_equal"),dropdown:t("common.filters.operators.less_than_or_equal"),icon:Mt},[B.In]:{display:t("common.filters.operators.in"),dropdown:t("common.filters.operators.in"),icon:Ft}}}function st({field:t}){var ye,ge,Z,xe;const{t:n}=D(),s=Ke(),{aggregations:a}=Xe(),{appId:l}=ue(),{statisticFetcher:c}=ue(),o=t.key,x=gn(n),{data:r,isLoading:h}=c({field:o}),f=(r==null?void 0:r.type)===es?0:3,[j,I]=i.useState(B.GreaterThan),[v,O]=i.useState("0"),[y,p]=i.useState("0"),[m,L]=i.useState("0"),[F,V]=i.useState(!1),[k,M]=i.useState(),[$,C]=i.useState(!1),S=(ye=Object.values(a).flatMap(g=>g.items).find(g=>g.key===o))==null?void 0:ye.defaults,ne=t.type==="numerical"&&(S==null?void 0:S.noDataInputOption),K=(S==null?void 0:S.intervalDecimal)!==void 0&&((S==null?void 0:S.max)!==void 0||(S==null?void 0:S.min)!==void 0)||r&&(r.min!==void 0||r.max!==void 0),H=(S==null?void 0:S.min)??(r==null?void 0:r.min)??0,Y=(S==null?void 0:S.max)??(r==null?void 0:r.max)??100,ae=i.useCallback(()=>{const g=U.getResolvedActiveQuery(l);if(!(g!=null&&g.content))return;const N=ht(o,g,S,r);V(N.hasNoData),L(N.minValue),p(N.maxValue),C(N.hasUnappliedItems),I(N.selectedRange??B.GreaterThan),O(N.numericalValue)},[l,o,S,r]);i.useEffect(()=>{ae()},[ae]);const he=i.useCallback(g=>{I(g),C(!0)},[]),Ee=i.useCallback(g=>{V(g),C(!0)},[]),de=i.useCallback(g=>{M(g),C(!0)},[]),qe=()=>{C(!1);const g=ht(o,Vs,S,r);V(g.hasNoData),L(g.minValue),p(g.maxValue),C(g.hasUnappliedItems),I(g.selectedRange),O(g.numericalValue)},Re=i.useCallback(()=>{if(C(!1),F){s({type:oe.ADD_IVALUEFACET,payload:{field:o,value:["__missing__"]}});return}let g=[];g=j===B.Between?[parseFloat(m.toString()),parseFloat(y.toString())]:[parseFloat(v.toString())],s({type:oe.ADD_IVALUEFACET,payload:{field:o,value:g,operator:j}}),k&&s({type:oe.ADD_IVALUEFACET,payload:{field:`${o}_unit`,value:[k]}})},[l,o,j,v,m,y,F,k]),Be=Object.entries(B).map(([g,N])=>{if(N in x){const W=x[N].icon;return e.jsx(it,{value:N,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{size:16}),e.jsx("span",{children:x[N].dropdown})]})},N)}return null}).filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{id:`${o}_container`,size:"sm",variant:"outline",children:e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${o}_operator`,children:e.jsxs(lt,{value:j,onValueChange:he,children:[e.jsx(ct,{size:"sm",children:e.jsx(dt,{placeholder:n("common.filters.operators.select_operator"),children:((ge=x[j])==null?void 0:ge.display)||n("common.filters.operators.unknown")})}),e.jsx(ut,{children:Be})]})}),j===B.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(Se,{size:"xs",className:"w-half",value:m,onChange:g=>{const N=g.target.value;isNaN(Number(N))||(L(N),C(!0))},min:H,max:Y,id:`${o}_min`,"data-testid":`${o}_min`}),e.jsx(Se,{size:"xs",className:"w-half",value:y,onChange:g=>{const N=g.target.value;isNaN(Number(N))||(p(N),C(!0))},min:H,max:Y,id:`${o}_max`,"data-testid":`${o}_max`})]}):e.jsx(Se,{size:"xs",className:"w-full",value:v,onChange:g=>{const N=g.target.value;isNaN(Number(N))||(O(N),C(!0))},min:H,max:Y,id:`${o}_value`,"data-testid":`${o}_value`}),K&&e.jsx("div",{id:`${o}_interval`,children:e.jsxs(qs,{size:"xs",children:[n("common.filters.labels.actual_interval")," : ",(Z=r==null?void 0:r.min)==null?void 0:Z.toFixed(f)," -"," ",(r==null?void 0:r.min)!==void 0?Number(r.min.toFixed(f)).toLocaleString(Q.language):""," ","-"," ",(r==null?void 0:r.max)!==void 0?Number(r.max.toFixed(f)).toLocaleString(Q.language):""]})})]}),(S==null?void 0:S.rangeTypes)&&S.rangeTypes.length>0&&e.jsx("div",{id:`${o}_range_type_container`,className:"mt-3",children:h?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-16 mb-1",id:`${o}_unit_label_skeleton`}),e.jsx(R,{className:"h-9 w-full",id:`${o}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"text-sm",id:`${o}_unit_label`,children:n("common.filters.labels.unit")}),e.jsxs(lt,{defaultValue:k||S.rangeTypes[0].key,onValueChange:de,children:[e.jsx(ct,{children:e.jsx(dt,{placeholder:n("common.filters.labels.select_unit"),children:((xe=S.rangeTypes.find(g=>g.key===k))==null?void 0:xe.name)||n("common.filters.labels.select_unit")})}),e.jsx(ut,{children:S.rangeTypes.map(g=>e.jsx(it,{value:g.key,children:g.name},g.key))})]})]})}),ne&&!K&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden mt-3",id:`${o}_no_data_label`,children:[e.jsx(Hs,{checked:F,onCheckedChange:Ee,id:`${o}_no_data`}),e.jsx("span",{children:n("common.filters.labels.no_data")})]})]})}),e.jsx(Rt,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(P,{size:"xxs",variant:"ghost",onClick:qe,disabled:!$,id:`${o}_clear`,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(P,{size:"xxs",variant:"outline",onClick:Re,id:`${o}_apply`,children:n("common.filters.buttons.apply")})})]})})]})}st.__docgenInfo={description:"",methods:[],displayName:"NumericalFacet",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function _e({field:t,children:n}){const{t:s}=D(),a=s(`common.filters.labels.${t.translation_key}`,{defaultValue:t.key});let l=null;if(Rs.includes(t.key)){const o=`common.filters.labels.${t.translation_key}_tooltip`;l=s(o)===o?null:s(o)}function c(){return e.jsx("div",{className:"flex items-center justify-between w-full text-xs",children:e.jsx("span",{children:a})})}return e.jsx(we,{size:"sm",children:e.jsxs(Ut,{value:t.key,className:"border-none",children:[e.jsx($s,{size:"sm",children:e.jsx($t,{children:l?e.jsxs(Ie,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx("span",{children:c()})}),e.jsx(Ae,{children:e.jsx("span",{children:l})})]}):c()})}),e.jsx(zt,{className:"pb-0",children:n})]},t.key)})}function xn({field:t}){const{t:n}=D();let s;switch(t.type){case b.MULTIPLE:s=e.jsx(tt,{field:t});break;case b.NUMERICAL:s=e.jsx(st,{field:t});break;case b.BOOLEAN:s=e.jsx(et,{field:t});break;default:s=e.jsx("div",{children:n("common.filters.unsupported_type",{type:t.type})})}return s}function ts({field:t,isOpen:n}){const{t:s}=D(),a=t.type;if(a===b.DIVIDER)return e.jsx("h4",{className:"px-2 h-8 text-sidebar-foreground/70 text-xs font-medium line-height-xs text-ellipsis overflow-hidden flex justify-between items-center",children:s(`common.filters.${t.key}`)});let l;switch(a){case b.MULTIPLE:l=e.jsx(_e,{field:t,isOpen:n,children:e.jsx(tt,{field:t})});break;case b.NUMERICAL:l=e.jsx(_e,{field:t,isOpen:n,children:e.jsx(st,{field:t})});break;case b.BOOLEAN:l=e.jsx(_e,{field:t,isOpen:n,children:e.jsx(et,{field:t})});break;default:l=e.jsx("div",{children:s("common.filters.unsupported_type",{type:t.type})})}return l}_e.__docgenInfo={description:"",methods:[],displayName:"AccordionContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};ts.__docgenInfo={description:"To be use when the facet needs to be inside an Accordion component",methods:[],displayName:"FacetContainer",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},searchHandler:{required:!1,tsType:{name:"signature",type:"function",raw:"(_e: React.MouseEvent<SVGElement, MouseEvent>) => void",signature:{arguments:[{type:{name:"ReactMouseEvent",raw:"React.MouseEvent<SVGElement, MouseEvent>",elements:[{name:"SVGElement"},{name:"MouseEvent"}]},name:"_e"}],return:{name:"void"}}},description:""}}};const vn=2;function ss({search:t}){const{t:n}=D(),{appId:s}=ue(),{translation_key:a,key:l}=t,c=l.replace(/search_by_/g,""),[o,x]=i.useState([]),[r,h]=i.useState([]),[f,j]=i.useState(null);i.useEffect(()=>{var m;const O=U.getResolvedActiveQuery(s);if(JSON.stringify(O)===JSON.stringify(f))return;const y=O.content.find(L=>"content"in L&&"field"in L.content?L.content.field===c:!1),p=((m=y==null?void 0:y.content)==null?void 0:m.value)||[];Array.isArray(p)&&x(p),j(O)},[s,c,U.getActiveQuery(s)]),i.useEffect(()=>{(async()=>{if(o.length===0){h([]);return}if(o.length>vn){const y=o.map(p=>({value:p,label:p,badgeLabel:p}));h(y);return}try{const y=o.map(async m=>{var L,F;try{const k=(await pt.geneAutoComplete(m)).data.find(M=>{var $;return(($=M.source)==null?void 0:$.name)===m});if(k)return{value:m,label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:((L=k.source)==null?void 0:L.name)||m}),e.jsx("span",{className:"text-xs text-muted-foreground",children:((F=k.source)==null?void 0:F.id)||""})]}),badgeLabel:m}}catch(V){console.error(`Error fetching gene ${m}:`,V)}return{value:m,label:m,badgeLabel:m}}),p=await Promise.all(y);h(p)}catch(y){console.error("Error fetching gene details:",y);const p=o.map(m=>({value:m,label:m,badgeLabel:m}));h(p)}})()},[o]);const I=async O=>{if(!O)return[];try{return(await pt.geneAutoComplete(O)).data.map(p=>{var m,L,F,V,k,M;return{value:((m=p.source)==null?void 0:m.name)||"",label:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm text-foreground",children:ot(((L=p.highlight)==null?void 0:L.name)||((F=p.source)==null?void 0:F.name)||"")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:ot(((V=p.highlight)==null?void 0:V.id)||((k=p.source)==null?void 0:k.id)||"")})]}),badgeLabel:((M=p.source)==null?void 0:M.name)||""}})}catch(y){return console.error("Error fetching genes:",y),[]}},v=O=>{x(O),U.updateActiveQueryField(s,{field:c,value:O,merge_strategy:Wt.OVERRIDE_VALUES})};return e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{children:n(`common.filters.labels.${a}`)}),e.jsxs(Ie,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(bs,{size:16})}),e.jsx(Ae,{children:n(`common.filters.labels.${a}_tooltip`)})]})]}),e.jsx(Ws,{value:o,defaultOptions:r,onChange:v,onSearch:I,placeholder:n(`common.filters.labels.${a}_placeholder`),className:"w-full",debounceDelay:300,maxSelected:100,hidePlaceholderWhenSelected:!0})]})}ss.__docgenInfo={description:"",methods:[],displayName:"SearchFacet",props:{search:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function ns({groupKey:t,aggregations:n}){var y;const{t:s}=D(),[a,l]=i.useState(!1),[c,o]=i.useState([]),[x,r]=i.useState(t),h=Zt(),f=()=>{sessionStorage.removeItem(h)},j=t?((y=n[t])==null?void 0:y.items)||[]:Object.values(n).flatMap(p=>p.items),I=j.filter(p=>p.type===b.SEARCH_BY),v=j.filter(p=>p.type===b.UPLOAD_LIST),O=j.filter(p=>p.type!==b.SEARCH_BY&&p.type!==b.UPLOAD_LIST);return i.useEffect(()=>{l(!1),o([])},[t]),i.useEffect(()=>{(x&&x!==null&&t===null||x&&x!==null&&t&&t!==null&&x!==t)&&f(),r(t)},[t,x]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3",children:[I.map((p,m)=>e.jsx(ss,{search:p},`${p.key}-${m}`)),v.map((p,m)=>e.jsx(Bs,{variant:p.key.replace(/upload_list_/g,"")},`${p.key}-${m}`))]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(P,{variant:"link",size:"xs",onClick:()=>{const p=!a;l(p),o(p?O.map(m=>m.key):[])},children:s(a?"common.actions.collapse_all":"common.actions.expand_all")})}),e.jsx(Gt,{className:"flex flex-col gap-1",type:"multiple",value:c,onValueChange:p=>o(p),children:O.map((p,m)=>e.jsx(ts,{isOpen:c.includes(p.key),field:p},`${p.key}-${m}`))})]})}ns.__docgenInfo={description:"",methods:[],displayName:"FacetList",props:{groupKey:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},aggregations:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};function bn(t){switch(t){case J.snv_occurrence:return{builderFetcher:yt,statisticFetcher:gt};case J.cnv_occurrence:return{builderFetcher:jn,statisticFetcher:kn};default:return{builderFetcher:yt,statisticFetcher:gt}}}function yt({field:t,size:n=30,withDictionary:s=!1}){const a=Ce(),l=pe(),c=me(),o={caseId:l,seqId:c,aggregationBody:{field:t,size:n,sqon:a},withDictionary:s};return se(o,async()=>Te.aggregateGermlineSNVOccurrences(o.caseId,o.seqId,o.aggregationBody,o.withDictionary).then(x=>x.data),{revalidateOnFocus:!1})}function gt({field:t}){const n=Ce(),s=pe(),a=me(),l={caseId:s,seqId:a,statisticsBody:{field:t,sqon:n}};return se(l,async()=>Te.statisticsGermlineSNVOccurrences(l.caseId,l.seqId,l.statisticsBody).then(c=>c.data),{revalidateOnFocus:!1})}function jn({field:t,size:n=30}){const s=Ce(),a=pe(),l=me(),c={caseId:a,seqId:l,aggregationBody:{field:t,size:n,sqon:s}};return se(c,async()=>Te.aggregateGermlineCNVOccurrences(c.caseId,c.seqId,c.aggregationBody).then(o=>o.data),{revalidateOnFocus:!1})}function kn({field:t}){const n=Ce(),s=pe(),a=me(),l={caseId:s,seqId:a,statisticsBody:{field:t,sqon:n}};return se(l,async()=>Te.statisticsGermlineCNVOccurrences(l.caseId,l.seqId,l.statisticsBody).then(c=>c.data),{revalidateOnFocus:!1})}async function Sn(t){return(await Xs.getUserPreferences(t.key)).data}function _n({appId:t,setPreference:n}){const s=se(`query-builder-get-${t}`,()=>Sn({key:`query-builder-${t}`}),{revalidateOnMount:!0,revalidateIfStale:!1,revalidateOnFocus:!1});i.useEffect(()=>{s.data?n(s.data):s.error&&n(Xt)},[s.isLoading])}function as({children:t,onRemovePill:n}){return e.jsxs("div",{className:"flex items-center rounded-xs p-0.5 bg-muted group-data-[query-active=true]/query:bg-primary/25",children:[t,e.jsx(P,{iconOnly:!0,variant:"ghost",size:"sm",className:"mr-0.5 ml-1 py-0.5 enabled:hover:bg-transparent size-4",onClick:s=>{s.stopPropagation(),n()},children:e.jsx(Jt,{})})]})}as.__docgenInfo={description:`Simple wrapper that add the blue background to highlight the query pill.
Add the X button to remove query-pill

e.g.
In the UI, QueryPillContainer manage [ [....][X] ]
| ┌──────────────────────────────────────────┐ |
| | Loremp Ipsum = [1,2, 3 >][X]      | 389K | |
| └──────────────────────────────────────────┘ |`,methods:[],displayName:"QueryPillContainer",props:{onRemovePill:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function rs({field:t,operator:n}){const{t:s,lazyTranslate:a}=D();return e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"ml-1 mr-0.5 text-xs font-medium",children:s(`common.filters.labels.${t}`,{defaultValue:a(t)})}),e.jsx("span",{className:"ml-1 mr-0.5",children:n})]})}rs.__docgenInfo={description:"",methods:[],displayName:"LabelOperator",props:{field:{required:!0,tsType:{name:"string"},description:""},operator:{required:!0,tsType:{name:"ReactNode"},description:""}}};function os({type:t,size:n,className:s}){switch(t){case E.GreaterThan:return e.jsx(Qt,{size:n,className:s});case E.GreaterThanOrEqualTo:return e.jsx(Dt,{size:n,className:s});case E.LessThan:return e.jsx(Vt,{size:n,className:s});case E.LessThanOrEqualTo:return e.jsx(Mt,{size:n,className:s});case E.Between:return e.jsx(Pt,{size:n,className:s});case E.NotIn:return e.jsx(Ys,{size:n,className:s});default:return e.jsx(Ft,{size:n,className:s})}}os.__docgenInfo={description:"Return to corresponding operator for the sqon",methods:[],displayName:"Operator",props:{size:{required:!1,tsType:{name:"number"},description:""},type:{required:!1,tsType:{name:"union",raw:"SqonOpEnum | (string & {})",elements:[{name:"SqonOpEnum"},{name:"unknown"}]},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};function is({canExpand:t,className:n,classNameContent:s,children:a,clickable:l,...c}){return e.jsx("div",{className:De("bg-background rounded-xs pl-2 text-xs font-medium leading-5 relative",t?"pr-[22px]":"pr-2",n),...c,children:e.jsx("div",{className:De("flex flex-wrap items-center",l?"hover:shadow-[inset_0_-4px_0_-2.5px_black] hover:cursor-pointer":"",s),children:a})})}is.__docgenInfo={description:`Wrapper for QueryPillValues. Highlight with a white background

e.g.
Wrap [ [1,2, 3 >][X] ]
| ┌──────────────────────────────────────────┐ |
| | Loremp Ipsum = [1,2, 3 >][X]      | 389K | |
| └──────────────────────────────────────────┘ |`,methods:[],displayName:"QueryPillValuesContainer",props:{canExpand:{required:!1,tsType:{name:"boolean"},description:""},clickable:{required:!1,tsType:{name:"boolean"},description:""},classNameContent:{required:!1,tsType:{name:"string"},description:""}}};const xt=3;function ls({valueFacet:t,...n}){const[s,a]=i.useState(!1),{t:l,sanitize:c,lazyTranslate:o}=D(),x=t.content.value.length>xt,r=s?t.content.value:Zs(t.content.value,xt);return e.jsxs(is,{canExpand:x,...n,children:[t.content.overrideValuesName?e.jsx("div",{children:e.jsx("span",{children:t.content.overrideValuesName})}):r.map((h,f)=>e.jsxs("div",{children:[e.jsx("span",{children:l(`common.filters.values.${t.content.field}.${c(h)}`,{defaultValue:o(h)})}),r.length-1>f&&e.jsx("span",{className:"px-1",children:t.op===E.All?"&":","})]},`${h}-${f}`)),x&&e.jsx("div",{className:"absolute right-1 hover:cursor-pointer",children:s?e.jsx(en,{size:16,onClick:h=>{h.preventDefault(),a(!1)}}):e.jsx(tn,{size:16,onClick:h=>{h.preventDefault(),a(!0)}})})]})}ls.__docgenInfo={description:`QueryPillValues display the selected values from the facets.
- Display the first 3 selected values
- Clicking on [>] or [ < ] change the expand state

e.g.
In the UI, QueryPillValues manage [ [1,2, 3 >] ]
| ┌──────────────────────────────────────────┐ |
| | Loremp Ipsum = [1,2, 3 >][X]      | 389K | |
| └──────────────────────────────────────────┘ |`,methods:[],displayName:"QueryPillValues",props:{valueFacet:{required:!0,tsType:{name:"IValueFacet"},description:""}}};function cs({content:t}){const{aggregations:n}=i.useContext(We),s=()=>{},a=pn(n,t);return e.jsx(as,{onRemovePill:s,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(rs,{field:t.content.field,operator:e.jsx(os,{size:14,type:t.op})}),e.jsxs(sn,{children:[e.jsx(nn,{children:e.jsx(ls,{valueFacet:t})}),e.jsx(an,{align:"start",className:"p-2.5",children:e.jsx(xn,{field:a,isOpen:!0})})]})]})})}cs.__docgenInfo={description:"",methods:[],displayName:"MultiSelectQueryPill",props:{content:{required:!0,tsType:{name:"IValueFacet"},description:""}}};function ds(){const{t}=D(),n=Ye();return e.jsx("div",{className:"px-2",onClick:s=>s.stopPropagation(),children:e.jsxs(Ie,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(P,{variant:"link",className:"text-current text-sm p-0 h-auto font-normal",onClick:()=>{console.warn("CombinerOperator:onClick is not implemented")},children:t(`common.query_pill.operator.${n.op}`)})}),e.jsxs(Ae,{children:[t("common.query_pill.operator.change_operator_to"),n.op===He.And?t("common.query_pill.operator.or"):t("common.query_pill.operator.and")]})]})})}ds.__docgenInfo={description:"",methods:[],displayName:"CombinerOperator"};function In(t,n){return e.jsxs(e.Fragment,{children:[e.jsx(cs,{content:t})," ",n&&e.jsx(ds,{})]})}function Nn({sqon:t}){return t.content.map((n,s)=>e.jsx(e.Fragment,{children:In(n,s<t.content.length-1)}))}function us(){const{sqons:t}=Xe(),{t:n}=D();return e.jsx(we,{className:"py-0",children:e.jsx(Gt,{type:"multiple",defaultValue:["query-builder"],children:e.jsxs(Ut,{value:"query-builder",className:"border-none",children:[e.jsx($t,{className:"border-b py-0 px-6 data-[state=closed]:rounded-sm data-[state=closed]:border-none hover:cursor-pointer",asChild:!0,children:"TODO"}),e.jsx(zt,{className:"py-4 px-6 space-y-4",children:e.jsxs("div",{className:"flex gap-2 max-h-[30vh] overflow-y-scroll",children:[t.map(s=>e.jsx(Nn,{sqon:s},s.id)),t.length===0&&n("common.query_bar.empty")]})})]})})})}us.__docgenInfo={description:"Card that display all queries for query-builder",methods:[],displayName:"QueriesBarCard"};function ps({defaultSidebarOpen:t,aggregations:n}){return e.jsx("div",{className:"bg-muted w-full",children:e.jsxs("div",{className:"flex flex-1 h-screen overflow-hidden",children:[e.jsx("aside",{className:"w-auto min-w-fit h-full shrink-0",children:e.jsx("div",{className:"z-10",children:e.jsx(Et,{open:t,className:"h-full flex flex-row",children:e.jsx(wt,{variant:"sidebar",collapsible:"icon",className:"static! flex flex-col w-full bg-primary dark:bg-secondary ",children:e.jsx(Tt,{children:e.jsxs(Ct,{children:[e.jsx(R,{className:"size-8 mb-1"}),e.jsx(Lt,{children:Object.keys(n).map(s=>e.jsx(R,{className:"size-8 w-full"},s))})]})})})})})}),e.jsx("main",{className:"flex-1 shrink px-3 pb-3 overflow-auto",children:e.jsx("div",{className:"py-3 space-y-2",children:e.jsx(we,{className:"py-0",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"py-4 px-6 flex justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(R,{className:"h-8 w-32"}),new Array(2).fill(0).map((s,a)=>e.jsx(R,{className:"size-8"},a))]}),e.jsxs("div",{className:"flex gap-2",children:[new Array(5).fill(0).map((s,a)=>e.jsx(R,{className:"size-8"},a)),e.jsx(R,{className:"h-8 w-36"})]})]}),e.jsx(Bt,{}),e.jsxs("div",{className:"flex flex-col py-4 gap-4",children:[e.jsxs("div",{className:"px-6 flex flex-col gap-2",children:[e.jsx(R,{className:"h-[50px] w-full"}),e.jsx(R,{className:"h-[50px] w-full"})]}),e.jsxs("div",{className:"px-6 flex gap-3",children:[e.jsx(R,{className:"h-7 w-26"}),e.jsx(R,{className:"h-7 w-16"})]})]})]})})})})]})})}ps.__docgenInfo={description:"",methods:[],displayName:"QueryBuilderSkeleton",props:{aggregations:{required:!0,tsType:{name:"AggregationConfig"},description:""},defaultSidebarOpen:{required:!0,tsType:{name:"boolean"},description:""}}};function fe({appId:t,defaultSidebarOpen:n=!1,children:s}){const[a,l]=i.useState(n),o=Ds()[t].aggregations,x=fn(o),[r,h]=i.useState(null),[f,j]=i.useState(),I=bn(t);return _n({appId:t,setPreference:j}),f?e.jsx(Yt,{...f,aggregations:o,children:e.jsx("div",{className:"bg-muted w-full",children:e.jsxs("div",{className:"flex flex-1 h-screen overflow-hidden",children:[e.jsx("aside",{className:"w-auto min-w-fit h-full shrink-0",children:e.jsxs(Et,{open:a,onOpenChange:l,className:"h-full flex flex-row",children:[e.jsx("div",{className:"z-10",children:e.jsx(Ht,{aggregationGroups:x,selectedItemId:r,onItemSelect:h})}),e.jsx("div",{className:De("overflow-auto mb-16 border-r transition-[width] duration-300 ease-in-out",{"w-[280px] p-4 opacity-100 relative":r,"w-0 opacity-0":!r}),children:e.jsxs("div",{className:"whitespace-nowrap",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>h(null),className:"text-muted-foreground hover:text-foreground",children:e.jsx(Jt,{size:16})})}),e.jsx(Ze,{value:{appId:t,...I},children:e.jsx(ns,{aggregations:x,groupKey:r})})]})})]})}),e.jsxs("main",{className:"flex-1 shrink px-3 pb-3 overflow-auto",children:[e.jsx("div",{className:"py-3 space-y-2",children:e.jsx(us,{})}),s]})]})})}):e.jsx(ps,{defaultSidebarOpen:n,aggregations:o})}fe.__docgenInfo={description:"Query-Builder (facets + query-bar)",methods:[],displayName:"QueryBuilder",props:{appId:{required:!0,tsType:{name:"ApplicationId"},description:""},children:{required:!0,tsType:{name:"ReactReactElement",raw:"React.ReactElement"},description:""},defaultSidebarOpen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};function Le({fetcher:t,...n}){var j;const s=Ye(),[a,l]=i.useState([]),[c,o]=i.useState({pageIndex:0,pageSize:10}),[x,r]=i.useState([]),h=se(`${n.id}-list`,()=>t.list({listBody:{additional_fields:a,limit:c.pageSize,page_index:c.pageIndex,sort:x,sqon:{content:s.content,op:s.op}}}),{revalidateOnFocus:!1,revalidateOnMount:!0,shouldRetryOnError:!1}),f=se(`${n.id}-count`,()=>t.count({countBody:{sqon:{content:s.content,op:s.op}}}),{revalidateOnFocus:!1,revalidateOnMount:!0,shouldRetryOnError:!1});return e.jsx(we,{children:e.jsx(Pe,{children:e.jsx(Ks,{data:h.data??[],total:((j=f.data)==null?void 0:j.count)??0,loadingStates:{list:h.isLoading,total:f.isLoading},serverOptions:{setAdditionalFields:l,onSortingChange:r},pagination:{state:c,type:"server",onPaginationChange:o},...n})})})}Le.__docgenInfo={description:`Wrapper for data-table
Used to access QBContext and create list and count query`,methods:[],displayName:"QueryBuilderDataTable",props:{fetcher:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  list: (params: IListInput) => Promise<T[]>;
  count: (params: ICountInput) => Promise<Count>;
}`,signature:{properties:[{key:"list",value:{name:"signature",type:"function",raw:"(params: IListInput) => Promise<T[]>",signature:{arguments:[{type:{name:"IListInput"},name:"params"}],return:{name:"Promise",elements:[{name:"Array",elements:[{name:"T"}],raw:"T[]"}],raw:"Promise<T[]>"}},required:!0}},{key:"count",value:{name:"signature",type:"function",raw:"(params: ICountInput) => Promise<Count>",signature:{arguments:[{type:{name:"ICountInput"},name:"params"}],return:{name:"Promise",elements:[{name:"Count"}],raw:"Promise<Count>"}},required:!0}}]}},description:""}}};const nt="api/users/preferences/:key";async function ms({params:t}){const n=t.key;return n==="data-table-storybook-query-builder"?new X(null,{status:404}):n==="query-builder-cnv_occurrence"?new X(null,{status:404}):X.json({activeQueryId:"3593dbdf-44e7-49c9-934a-7b10db87b603",sqons:[{id:"3593dbdf-44e7-49c9-934a-7b10db87b603",content:[{content:{field:"firstName",value:["Henry","Jack","Irene","Liam","Olivia","Tanner"]},op:"in"},{content:{field:"lastName",value:["Tremblay","Anderson","Young"]},op:"in"},{content:{field:"status",value:["Single"]},op:"in"}],op:"and"}],savedFilters:[],selectedQueryIndexes:[0]})}const le="api/mock/list",ce="api/mock/count";function fs(t){return ze.filter(n=>{let s=!1;return t.content.forEach(a=>{const l=a.content.field;a.content.value.includes(n[l])&&(s=!0)}),s})}async function at({request:t}){var a;const s=(a=(await t.clone().json()).listBody)==null?void 0:a.sqon;return s&&s.content.length>0?X.json(fs(s)):X.json(ze)}async function rt({request:t}){var a;const s=(a=(await t.clone().json()).countBody)==null?void 0:a.sqon;if(s&&s.content.length>0){const l=fs(s);return X.json({count:l.length})}return X.json({count:ze.length})}const{mocked:vt}=__STORYBOOK_MODULE_TEST__,An={variant_entity:{app_id:J.variant_entity},snv_occurrence:{app_id:J.snv_occurrence,aggregations:{variant:{items:[{key:"firstName",translation_key:"multiple",type:b.MULTIPLE},{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"status",translation_key:"status (with dictionary)",type:b.MULTIPLE,withDictionary:!0},{key:"divider",translation_key:"Divider",type:b.DIVIDER},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"visits",translation_key:"Visits (integer)",type:b.NUMERICAL,defaults:{min:0,max:1e3,defaultOperator:G.LessThan,defaultMin:0,defaultMax:1e3}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]},gene:{items:[{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]}}},cnv_occurrence:{app_id:J.cnv_occurrence,aggregations:{pathogenicity:{items:[{key:"firstName",translation_key:"multiple",type:b.MULTIPLE},{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"status",translation_key:"status (with dictionary)",type:b.MULTIPLE,withDictionary:!0},{key:"divider",translation_key:"Divider",type:b.DIVIDER},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"visits",translation_key:"Visits (integer)",type:b.NUMERICAL,defaults:{min:0,max:1e3,defaultOperator:G.LessThan,defaultMin:0,defaultMax:1e3}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]},frequency:{items:[{key:"lastName",translation_key:"multiple (with dictionary)",type:b.MULTIPLE},{key:"progress",translation_key:"numerical (decimal)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"age",translation_key:"Age (integer)",type:b.NUMERICAL,defaults:{min:0,max:100,defaultOperator:G.LessThan,defaultMin:0,defaultMax:100}},{key:"isActive",translation_key:"isActive (boolean)",type:b.BOOLEAN}]}}},admin:{admin_code:"admin",app_id:J.admin},portal:{name:"",navigation:{}}},Ua={title:"QueryBuilder/QueryBuilderV3",component:fe,beforeEach:async()=>{vt(pe).mockReturnValue(1),vt(me).mockReturnValue(1)},args:{},decorators:[t=>e.jsx(on,{initialEntries:["/case/1?seq_id=1"],children:e.jsx(ln,{children:e.jsx(cn,{path:"/case/:caseId",element:e.jsx(Ps,{config:An,children:e.jsx(t,{})})})})})]},be={parameters:{msw:{handlers:[q.post(le,at),q.post(ce,rt),q.post(Ve,Qe),q.post(Ue,$e),q.get(nt,async()=>(await rn(1e4),new X(null,{status:403})))]}},args:{appId:J.snv_occurrence,children:e.jsx(e.Fragment,{}),defaultSidebarOpen:!0},render:t=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bold font-mono text-red",children:"Do a hard refresh to reset loading state"}),e.jsx(fe,{appId:t.appId,defaultSidebarOpen:t.defaultSidebarOpen,children:e.jsx(Le,{id:"storybook-query-builder",fetcher:{list:async n=>ie.post(le,{listBody:n.listBody}).then(s=>s.data),count:async n=>ie.post(ce,{countBody:n.countBody}).then(s=>s.data)},columns:[...Ge,Je.accessor("isActive",{header:"Active"})],defaultColumnSettings:[]})})]})},je={parameters:{msw:{handlers:[q.post(le,at),q.post(ce,rt),q.post(Ve,Qe),q.post(Ue,$e),q.get(nt,ms)]}},args:{appId:J.cnv_occurrence,children:e.jsx(e.Fragment,{}),defaultSidebarOpen:!0},render:t=>e.jsx(fe,{appId:t.appId,defaultSidebarOpen:t.defaultSidebarOpen,children:e.jsx(Le,{id:"storybook-query-builder",fetcher:{list:async n=>ie.post(le,{listBody:n.listBody}).then(s=>s.data),count:async n=>ie.post(ce,{countBody:n.countBody}).then(s=>s.data)},columns:[...Ge,Je.accessor("isActive",{header:"Active"})],defaultColumnSettings:[]})})},ke={parameters:{msw:{handlers:[q.post(le,at),q.post(ce,rt),q.post(Ve,Qe),q.post(Ue,$e),q.get(nt,ms)]}},args:{appId:J.snv_occurrence,children:e.jsx(e.Fragment,{}),defaultSidebarOpen:!0},render:t=>e.jsx(fe,{appId:t.appId,defaultSidebarOpen:t.defaultSidebarOpen,children:e.jsx(Le,{id:"storybook-query-builder",fetcher:{list:async n=>ie.post(le,{listBody:n.listBody}).then(s=>s.data),count:async n=>ie.post(ce,{countBody:n.countBody}).then(s=>s.data)},columns:[...Ge,Je.accessor("isActive",{header:"Active"})],defaultColumnSettings:[]})})};var bt,jt,kt;be.parameters={...be.parameters,docs:{...(bt=be.parameters)==null?void 0:bt.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(mockListApi, httpMockListApiResponse), http.post(mockCountApi, httpMockCountApiResponse), http.post(occurrenceAggregateApi, httpOccurrenceAggregateApiResponse), http.post(occurrenceAggregateStatisticApi, httpOccurrenceAggregateStatisticsApiResponse), http.get(userPreferenceApi, async () => {
        await delay(10000);
        return new HttpResponse(null, {
          status: 403
        });
      })]
    }
  },
  args: {
    appId: ApplicationId.snv_occurrence,
    children: <></>,
    // unused
    defaultSidebarOpen: true
  },
  render: args => <>
      <div className="bold font-mono text-red">Do a hard refresh to reset loading state</div>
      <QueryBuilder appId={args.appId} defaultSidebarOpen={args.defaultSidebarOpen}>
        <QueryBuilderDataTable id="storybook-query-builder" fetcher={{
        list: async (params: IListInput) => axios.post(mockListApi, {
          listBody: params.listBody
        }).then(response => response.data),
        count: async (params: ICountInput) => axios.post(mockCountApi, {
          countBody: params.countBody
        }).then(response => response.data)
      }} columns={[...mockColumns, mockColumnHelper.accessor('isActive', {
        header: 'Active'
      })] as TableColumnDef<TableMockData, any>[]} defaultColumnSettings={[]} />
      </QueryBuilder>
    </>
}`,...(kt=(jt=be.parameters)==null?void 0:jt.docs)==null?void 0:kt.source}}};var St,_t,It;je.parameters={...je.parameters,docs:{...(St=je.parameters)==null?void 0:St.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(mockListApi, httpMockListApiResponse), http.post(mockCountApi, httpMockCountApiResponse), http.post(occurrenceAggregateApi, httpOccurrenceAggregateApiResponse), http.post(occurrenceAggregateStatisticApi, httpOccurrenceAggregateStatisticsApiResponse), http.get(userPreferenceApi, httpUserPreferenceApiResponse)]
    }
  },
  args: {
    appId: ApplicationId.cnv_occurrence,
    children: <></>,
    // unused
    defaultSidebarOpen: true
  },
  render: args => <QueryBuilder appId={args.appId} defaultSidebarOpen={args.defaultSidebarOpen}>
      <QueryBuilderDataTable id="storybook-query-builder" fetcher={{
      list: async (params: IListInput) => axios.post(mockListApi, {
        listBody: params.listBody
      }).then(response => response.data),
      count: async (params: ICountInput) => axios.post(mockCountApi, {
        countBody: params.countBody
      }).then(response => response.data)
    }} columns={[...mockColumns, mockColumnHelper.accessor('isActive', {
      header: 'Active'
    })] as TableColumnDef<TableMockData, any>[]} defaultColumnSettings={[]} />
    </QueryBuilder>
}`,...(It=(_t=je.parameters)==null?void 0:_t.docs)==null?void 0:It.source}}};var Nt,At,Ot;ke.parameters={...ke.parameters,docs:{...(Nt=ke.parameters)==null?void 0:Nt.docs,source:{originalSource:`{
  parameters: {
    msw: {
      handlers: [http.post(mockListApi, httpMockListApiResponse), http.post(mockCountApi, httpMockCountApiResponse), http.post(occurrenceAggregateApi, httpOccurrenceAggregateApiResponse), http.post(occurrenceAggregateStatisticApi, httpOccurrenceAggregateStatisticsApiResponse), http.get(userPreferenceApi, httpUserPreferenceApiResponse)]
    }
  },
  args: {
    appId: ApplicationId.snv_occurrence,
    children: <></>,
    // unused
    defaultSidebarOpen: true
  },
  render: args => <QueryBuilder appId={args.appId} defaultSidebarOpen={args.defaultSidebarOpen}>
      <QueryBuilderDataTable id="storybook-query-builder" fetcher={{
      list: async (params: IListInput) => axios.post(mockListApi, {
        listBody: params.listBody
      }).then(response => response.data),
      count: async (params: ICountInput) => axios.post(mockCountApi, {
        countBody: params.countBody
      }).then(response => response.data)
    }} columns={[...mockColumns, mockColumnHelper.accessor('isActive', {
      header: 'Active'
    })] as TableColumnDef<TableMockData, any>[]} defaultColumnSettings={[]} />
    </QueryBuilder>
}`,...(Ot=(At=ke.parameters)==null?void 0:At.docs)==null?void 0:Ot.source}}};const $a=["Loading","Default","Multiselect"];export{je as Default,be as Loading,ke as Multiselect,$a as __namedExportsOrder,Ua as default};
