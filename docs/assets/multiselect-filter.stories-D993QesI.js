import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{a as re}from"./index-B-lxVbXh.js";import{q as _,M as oe,T as C}from"./query-builder-remote-CCBfoM9g.js";import{r}from"./index-DQLiH3RP.js";import{B as v}from"./button-B_hWqCKH.js";import{C as ae}from"./checkbox-CO27iIkV.js";import{I as le}from"./input-DyY2UfVx.js";import{A as ne}from"./ActionButton-A54waDHb.js";import"./button.variants-Czj0iLzG.js";import{u as ie,C as ce}from"./applications-config-pyPLye2e.js";import{n as me}from"./number-format-BmdRvOec.js";import{u as ue}from"./i18n-DXpx3sP5.js";import{S as pe}from"./separator-DcuX0n1V.js";import{u as de,o as fe}from"./index-Cszs0DFs.js";import{S as F}from"./skeleton-Shk8p_SP.js";import{c as E}from"./config-mock-BXxtYAjK.js";import"./v4-CtRu48qb.js";import"./api-BXByjzrT.js";import"./index-D-AYaadb.js";import"./index-CECE1b4A.js";import"./index-CJPVTaBz.js";import"./spinner-DHVcj7-u.js";import"./utils-D-KgF5mV.js";import"./createLucideIcon-BMP5cxO1.js";import"./index-DDGWSPzp.js";import"./index-C5A_jyAq.js";import"./index-C66Dxnp2.js";import"./check-DSCf8CVO.js";import"./dropdown-menu-maOUzwaK.js";import"./index-Bf9LPmYV.js";import"./index-DD7n3F2b.js";import"./index-Bx8PXznd.js";import"./ellipsis-BtlAG3ey.js";import"./iframe-CaUkAZJU.js";import"./index-BjfAAjgr.js";const ye=s=>fe.aggregateGermlineOccurrences(s.seqId,s.aggregationBody).then(o=>o.data);function he(s,o=30,h=!1,n){let d;h?d={seqId:"1",aggregationBody:{field:s,size:o}}:d=null;const u=_.getResolvedActiveQuery(n);return u&&d&&(d.aggregationBody.sqon={content:u.content,op:u.op}),de(d,ye,{revalidateOnFocus:!1})}function xe(s,o){return o.filter(h=>h.key.toLowerCase().includes(s.toLowerCase()))}function B(s,o){return o<s?o:s}function b({field:s,maxVisibleItems:o=5,searchVisible:h=!1}){const{t:n}=ue(),u=ie().variant_exploration.app_id,{data:i,isLoading:x}=he(s.key,void 0,!0,u),[a,w]=r.useState(i||[]),[I,$]=r.useState([]),[c,f]=r.useState([]),[y,g]=r.useState(B(a.length,o)),[G,k]=r.useState(!1);r.useEffect(()=>{let l=_.getResolvedActiveQuery(u).content.find(t=>t.content.field===s.key);f(l?l.content.value:[]),i==null||i.sort((t,m)=>{const j=t.key&&c.includes(t.key),se=m.key&&c.includes(m.key);return j===se?m.count-t.count:j?-1:1}),i==null||i.forEach(t=>{var m;t.label=(m=t.key)==null?void 0:m.replace(/_/g," ").replace(/^\w/,j=>j.toUpperCase())}),w(i||[]),g(B((i==null?void 0:i.length)||0,o))},[i,a]);const H=r.useCallback(l=>{const t=xe(l,i);o>t.length?g(t.length):t.length>o&&g(o),w(t)},[a,y,i]),W=r.useCallback(()=>{g(a.length)},[y,a]),D=r.useCallback(()=>{g(o)},[y]),P=r.useCallback(()=>{c.length!==a.length&&(k(!0),f(a.map(l=>l.key)))},[a,c]),J=r.useCallback(()=>{c.length!==0&&(k(!0),f([]))},[c]),K=r.useCallback(l=>{let t=[];c.some(m=>m===l.key)?t=c.filter(m=>m!==l.key):t=[...c,l.key],k(!0),f(t)},[c]),X=r.useCallback(()=>{k(!1),f([...I])},[I]),p=r.useCallback(l=>{k(!1),$(c),_.updateActiveQueryField(u,{field:s.key,value:[...c],merge_strategy:oe.OVERRIDE_VALUES,operator:l})},[c,u,s.key]),Y=r.useCallback(()=>{p(C.In)},[p]),Z=r.useCallback(()=>{p(C.NotIn)},[p]),ee=r.useCallback(()=>{p(C.All)},[p]),te=r.useCallback(()=>{p(C.In)},[p]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[h&&e.jsx(le,{type:"text",placeholder:n("common.filters.search.placeholder"),className:"w-full p-2 mb-2 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:l=>H(l.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(v,{size:"sm",onClick:()=>P(),variant:"link",className:"px-0",children:n("common.filters.buttons.all")}),e.jsx(v,{size:"sm",onClick:()=>J(),variant:"link",className:"px-0",children:n("common.filters.buttons.none")})]}),e.jsx("div",{className:"max-h-[250px] overflow-auto",children:x?Array.from({length:3},(l,t)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(F,{className:"w-full h-6 rounded"}),e.jsx(F,{className:"h-6 w-12 rounded-md"})]},`skeleton-${t}`)):a.length===0?e.jsx("div",{className:"text-muted-foreground text-center py-4",children:n("common.filters.noValuesFound")}):Array.from({length:y},(l,t)=>e.jsx("div",{className:"space-y-3 pt-2",children:e.jsxs("div",{className:"flex justify-between items-top",children:[e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(ae,{className:"w-4 h-4",checked:c.some(m=>m===a[t].key),onCheckedChange:()=>K(a[t])}),e.jsx("div",{className:"overflow-hidden text-xs whitespace-normal break-words",children:n(`common.filters.labels.${s.key}_value.${a[t].key}`,{defaultValue:a[t].label})}),e.jsx("span",{className:"checkmark"})]}),e.jsx("span",{className:"bg-accent px-2 pb-1 rounded-md text-xs items-top",children:me(a[t].count||0)})]})},a[t].key))}),!x&&a.length>y&&e.jsx(v,{className:"mt-2 px-0",onClick:W,size:"sm",variant:"link",children:n("common.filters.buttons.showMore",{count:a.length-o})}),!x&&y>o&&e.jsx(v,{className:"mt-2 px-0",onClick:D,size:"sm",variant:"link",children:n("common.filters.buttons.showLess")}),e.jsx(pe,{className:"my-4 border-border",id:`${s.key}_divider`}),e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(v,{size:"xs",variant:"ghost",onClick:X,disabled:!G||x,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(ne,{size:"xs",className:"h-7",color:"primary",actions:[{label:n("common.filters.buttons.someNotIn"),onClick:te},{label:n("common.filters.buttons.all"),onClick:ee},{label:n("common.filters.buttons.notIn"),onClick:Z}],onDefaultAction:Y,disabled:x,children:n("common.filters.buttons.apply")})})]})]})}b.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},searchVisible:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const U={...E,variant_exploration:{...E.variant_exploration,aggregations:{variant:{items:[{key:"chromosome",type:"multiple"},{key:"filter",type:"multiple"},{key:"zygosity",type:"multiple"},{key:"impact_score",type:"multiple"},{key:"variant_class",type:"multiple"},{key:"symbol",type:"multiple"}]}}}},Ze={title:"Feature/Query Filters/Multi Select",component:b,args:{field:{key:"chromosome",type:"multiple"},maxVisibleItems:10,searchVisible:!0},decorators:[s=>e.jsx(ce,{config:U,children:e.jsx(s,{})})]},S={render:s=>e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})})},N={render:s=>(re("activeQuery")(_.updateActiveQueryField(U.variant_exploration.app_id,{field:"chromosome",value:["Option1","Option4"]})),e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})}))},A={args:{searchVisible:!1},render:s=>e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})})};var O,Q,M;S.parameters={...S.parameters,docs:{...(O=S.parameters)==null?void 0:O.docs,source:{originalSource:`{
  render: args => {
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(M=(Q=S.parameters)==null?void 0:Q.docs)==null?void 0:M.source}}};var R,q,T;N.parameters={...N.parameters,docs:{...(R=N.parameters)==null?void 0:R.docs,source:{originalSource:`{
  render: args => {
    action('activeQuery')(queryBuilderRemote.updateActiveQueryField(config.variant_exploration.app_id, {
      field: 'chromosome',
      value: ['Option1', 'Option4']
    }));
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(T=(q=N.parameters)==null?void 0:q.docs)==null?void 0:T.source}}};var z,L,V;A.parameters={...A.parameters,docs:{...(z=A.parameters)==null?void 0:z.docs,source:{originalSource:`{
  args: {
    searchVisible: false
  },
  render: args => {
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(V=(L=A.parameters)==null?void 0:L.docs)==null?void 0:V.source}}};const et=["Default","DataAppliedToQueryBuilder","HiddenSearch"];export{N as DataAppliedToQueryBuilder,S as Default,A as HiddenSearch,et as __namedExportsOrder,Ze as default};
