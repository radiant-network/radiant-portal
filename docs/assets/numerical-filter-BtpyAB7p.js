import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as d}from"./index-CGj_12n1.js";import{A as re,a as le,o as oe}from"./use-aggregation-builder-CTDbLjr3.js";import{E as ie,L as ce,G as de,a as me,b as ue,c as pe}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{B as D}from"./button-BY0oAJHe.js";import{C as xe}from"./checkbox-CZhHNwpD.js";import{I as O}from"./input-DyY2UfVx.js";import{L as he}from"./label-DII0GlAa.js";import{d as M,S as B,a as G,b as Q,c as z}from"./select-ISZjwlvT.js";import{S as H}from"./skeleton-Shk8p_SP.js";import{u as fe}from"./i18n-DW4AmtP7.js";import{u as _e}from"./applications-config-q4OA8PiL.js";import{R as u,q as S,M as w,D as Y}from"./query-builder-remote-CEpj2hQD.js";function W({children:p}){return e.jsx("p",{className:"text-sm text-muted-foreground",children:p})}W.__docgenInfo={description:"",methods:[],displayName:"TextMuted",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""}}};const ve=p=>oe.statisticsGermlineSNVOccurrences(p.seqId,p.statisticsBody).then(n=>n.data);function Ne(p,n,l,m=!1){const c={seqId:l,statisticsBody:{field:p}},t=m?Y:S.getResolvedActiveQuery(n);return t&&(c.statisticsBody.sqon={content:t.content,op:t.op}),le(c,ve,{revalidateOnFocus:!1})}function P(p,n,l,m){var y;let c=!1,t=u.LessThan,x="0",r="0",v="",f=!1;const _=n.content.find(i=>"content"in i&&"field"in i.content?i.content.field===p:!1),N=n.content.find(i=>"content"in i&&"field"in i.content?i.content.field===`${p}_unit`:!1);if(_){const i=_.content.value;if(console.log("[NumericalFilter] values",i),i.includes("__missing__"))return{hasUnappliedItems:c,selectedRange:t,minValue:x,maxValue:r,numericalValue:v,hasNoData:!0,selectedUnit:void 0};c=!0,i.length===2?(t=u.Between,x=Number(i[0]).toFixed(3),r=Number(i[1]).toFixed(3)):v=i[0],_.op&&(t=_.op)}else console.log("[NumericalFilter else] no filter exists",l),f=!1,(l==null?void 0:l.defaultMin)!==void 0?(x=l.defaultMin.toString(),v=l.defaultMin.toString()):(m==null?void 0:m.min)!==void 0&&(x=Number(m.min.toFixed(3)).toString(),v=Number(m.min.toFixed(3)).toString()),(l==null?void 0:l.defaultMax)!==void 0?r=l.defaultMax.toString():(m==null?void 0:m.max)!==void 0&&(r=Number(m.max.toFixed(3)).toString()),l!=null&&l.defaultOperator&&(t=u[l.defaultOperator]);return{hasUnappliedItems:c,selectedRange:t,minValue:x,maxValue:r,numericalValue:v,hasNoData:f,selectedUnit:N?N.content.value[0]:(y=l==null?void 0:l.rangeTypes)!=null&&y.length?l.rangeTypes[0].key:void 0}}function ye({field:p}){var A,L,U,q;const{t:n}=fe(),l=_e(),{seqId:m}=d.useContext(re),c=l.variant_exploration.app_id,t=p.key,x={[u.GreaterThan]:{display:n("common.filters.operators.greater_than"),dropdown:n("common.filters.operators.greater_than"),icon:pe},[u.LessThan]:{display:n("common.filters.operators.less_than"),dropdown:n("common.filters.operators.less_than"),icon:ue},[u.Between]:{display:n("common.filters.operators.between"),dropdown:n("common.filters.operators.between"),icon:me},[u.GreaterThanOrEqualTo]:{display:n("common.filters.operators.greater_than_or_equal"),dropdown:n("common.filters.operators.greater_than_or_equal"),icon:de},[u.LessThanOrEqualTo]:{display:n("common.filters.operators.less_than_or_equal"),dropdown:n("common.filters.operators.less_than_or_equal"),icon:ce},[u.In]:{display:n("common.filters.operators.in"),dropdown:n("common.filters.operators.in"),icon:ie}},{data:r,isLoading:v}=Ne(t,c,m,!1),[f,_]=d.useState(u.GreaterThan),[N,y]=d.useState("0"),[i,b]=d.useState("0"),[I,E]=d.useState("0"),[T,V]=d.useState(!1),[j,J]=d.useState(),[K,h]=d.useState(!1),X=l.variant_exploration.aggregations,s=(A=Object.values(X).flatMap(a=>a.items).find(a=>a.key===t))==null?void 0:A.defaults,Z=p.type==="numerical"&&(s==null?void 0:s.noDataInputOption),k=(s==null?void 0:s.intervalDecimal)!==void 0&&((s==null?void 0:s.max)!==void 0||(s==null?void 0:s.min)!==void 0)||r&&(r.min!==void 0||r.max!==void 0),R=(s==null?void 0:s.min)??(r==null?void 0:r.min)??0,F=(s==null?void 0:s.max)??(r==null?void 0:r.max)??100,$=d.useCallback(()=>{const a=S.getResolvedActiveQuery(c);if(!(a!=null&&a.content))return;const o=P(t,a,s,r);V(o.hasNoData),E(o.minValue),b(o.maxValue),h(o.hasUnappliedItems),_(o.selectedRange),y(o.numericalValue)},[c,t,s,r]);d.useEffect(()=>{$()},[$]);const C=d.useCallback(a=>{_(a),h(!0)},[]),g=d.useCallback(a=>{V(a),h(!0)},[]),ee=d.useCallback(a=>{J(a),h(!0)},[]),te=()=>{h(!1);const a=P(t,Y,s,r);V(a.hasNoData),E(a.minValue),b(a.maxValue),h(a.hasUnappliedItems),_(a.selectedRange),y(a.numericalValue)},ae=d.useCallback(()=>{if(h(!1),T){S.updateActiveQueryField(c,{field:t,value:["__missing__"],merge_strategy:w.OVERRIDE_VALUES});return}let a=[];a=f===u.Between?[parseFloat(I.toString()),parseFloat(i.toString())]:[parseFloat(N.toString())],S.updateActiveQueryField(c,{field:t,value:a,merge_strategy:w.OVERRIDE_VALUES,operator:f}),j&&S.updateActiveQueryField(c,{field:`${t}_unit`,value:[j],merge_strategy:w.OVERRIDE_VALUES})},[c,t,f,N,I,i,T,j]),se=Object.entries(u).map(([a,o])=>{if(o in x){const ne=x[o].icon;return e.jsx(M,{value:o,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:16}),e.jsx("span",{children:x[o].dropdown})]})},o)}return null}).filter(Boolean);return e.jsxs("div",{className:"p-2 w-full max-w-md",id:`${t}_container`,children:[e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${t}_operator`,children:e.jsxs(B,{value:f,onValueChange:C,children:[e.jsx(G,{children:e.jsx(Q,{placeholder:n("common.filters.operators.select_operator"),children:x[f].display})}),e.jsx(z,{children:se})]})}),f===u.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(O,{className:"w-half",value:I,onChange:a=>{const o=a.target.value;isNaN(Number(o))||(E(o),h(!0))},min:R,max:F,id:`${t}_min`,"data-testid":`${t}_min`}),e.jsx(O,{className:"w-half",value:i,onChange:a=>{const o=a.target.value;isNaN(Number(o))||(b(o),h(!0))},min:R,max:F,id:`${t}_max`,"data-testid":`${t}_max`})]}):e.jsx(O,{className:"w-full",value:N,onChange:a=>{const o=a.target.value;isNaN(Number(o))||(y(o),h(!0))},min:R,max:F,id:`${t}_value`,"data-testid":`${t}_value`}),k&&e.jsx("div",{id:`${t}_interval`,children:e.jsxs(W,{children:[n("common.filters.labels.actualInterval")," : ",(L=r==null?void 0:r.min)==null?void 0:L.toFixed(3)," -"," ",(U=r==null?void 0:r.max)==null?void 0:U.toFixed(3)]})})]}),(s==null?void 0:s.rangeTypes)&&s.rangeTypes.length>0&&e.jsx("div",{id:`${t}_range_type_container`,children:v&&defaultIsLoadingStats?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-5 w-16 mb-1",id:`${t}_unit_label_skeleton`}),e.jsx(H,{className:"h-9 w-full",id:`${t}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"text-sm",id:`${t}_unit_label`,children:n("common.filters.labels.unit")}),e.jsxs(B,{defaultValue:j||s.rangeTypes[0].key,onValueChange:ee,children:[e.jsx(G,{children:e.jsx(Q,{placeholder:n("common.filters.labels.selectUnit"),children:((q=s.rangeTypes.find(a=>a.key===j))==null?void 0:q.name)||n("common.filters.labels.selectUnit")})}),e.jsx(z,{children:s.rangeTypes.map(a=>e.jsx(M,{value:a.key,children:a.name},a.key))})]})]})}),Z&&!k&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden",id:`${t}_no_data_label`,children:[e.jsx(xe,{checked:T,onCheckedChange:g,id:`${t}_no_data`}),e.jsx("span",{children:n("common.filters.labels.noData")})]})]}),e.jsx("hr",{className:"my-4 border-border",id:`${t}_divider`}),e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(D,{size:"xs",variant:"ghost",onClick:te,disabled:!K,id:`${t}_clear`,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(D,{size:"xs",className:"h-7",color:"primary",onClick:ae,id:`${t}_apply`,children:n("common.filters.buttons.apply")})})]})]})}ye.__docgenInfo={description:"",methods:[],displayName:"NumericalFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};export{ye as N};
