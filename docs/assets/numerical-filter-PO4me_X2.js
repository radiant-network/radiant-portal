import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as m}from"./index-DQLiH3RP.js";import{B}from"./button-DMm2t07S.js";import{R as u,q as S,M as k,D as K}from"./query-builder-remote-C8T8ZF2t.js";import{u as ie}from"./applications-config-pyPLye2e.js";import{d as G,S as Q,a as z,b as H,c as P}from"./select-B3-ZNG_-.js";import{I as $}from"./input-DyY2UfVx.js";import{C as ce}from"./checkbox-Ce_wbgB6.js";import{L as de}from"./label-E-AdJZe_.js";import{E as me,L as ue,G as pe,a as xe,b as he,c as fe}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{u as ve}from"./i18n-CobMLfin.js";import{A as _e,a as Ne,o as ye}from"./use-aggregation-builder-Bjoi4SW_.js";import{S as Y}from"./skeleton-Shk8p_SP.js";function X({children:p}){return e.jsx("p",{className:"text-sm text-muted-foreground",children:p})}X.__docgenInfo={description:"",methods:[],displayName:"TextMuted",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""}}};const je=p=>ye.statisticsGermlineOccurrences(p.seqId,p.statisticsBody).then(n=>n.data);function W(p,n,r,d=!1){const c={seqId:r,statisticsBody:{field:p}},t=d?K:S.getResolvedActiveQuery(n);return t&&(c.statisticsBody.sqon={content:t.content,op:t.op}),Ne(c,je,{revalidateOnFocus:!1})}function J(p,n,r,d){var y;let c=!1,t=u.LessThan,x="0",v="0",_="",o=!1;const N=n.content.find(i=>"content"in i&&"field"in i.content?i.content.field===p:!1),f=n.content.find(i=>"content"in i&&"field"in i.content?i.content.field===`${p}_unit`:!1);if(N){const i=N.content.value;if(console.log("[NumericalFilter] values",i),i.includes("__missing__"))return{hasUnappliedItems:c,selectedRange:t,minValue:x,maxValue:v,numericalValue:_,hasNoData:!0,selectedUnit:void 0};c=!0,i.length===2?(t=u.Between,x=Number(i[0]).toFixed(3),v=Number(i[1]).toFixed(3)):_=i[0],N.op&&(t=N.op)}else console.log("[NumericalFilter else] no filter exists",r),o=!1,(r==null?void 0:r.defaultMin)!==void 0?(x=r.defaultMin.toString(),_=r.defaultMin.toString()):(d==null?void 0:d.min)!==void 0&&(x=Number(d.min.toFixed(3)).toString(),_=Number(d.min.toFixed(3)).toString()),(r==null?void 0:r.defaultMax)!==void 0?v=r.defaultMax.toString():(d==null?void 0:d.max)!==void 0&&(v=Number(d.max.toFixed(3)).toString()),r!=null&&r.defaultOperator&&(t=u[r.defaultOperator]);return{hasUnappliedItems:c,selectedRange:t,minValue:x,maxValue:v,numericalValue:_,hasNoData:o,selectedUnit:f?f.content.value[0]:(y=r==null?void 0:r.rangeTypes)!=null&&y.length?r.rangeTypes[0].key:void 0}}function Se({field:p}){var U,q,D,M;const{t:n}=ve(),r=ie(),{seqId:d}=m.useContext(_e),c=r.variant_exploration.app_id,t=p.key,x={[u.GreaterThan]:{display:n("common.filters.operators.greaterThan"),dropdown:n("common.filters.operators.greaterThan"),icon:fe},[u.LessThan]:{display:n("common.filters.operators.lessThan"),dropdown:n("common.filters.operators.lessThan"),icon:he},[u.Between]:{display:n("common.filters.operators.between"),dropdown:n("common.filters.operators.between"),icon:xe},[u.GreaterThanOrEqualTo]:{display:n("common.filters.operators.greaterThanOrEqual"),dropdown:n("common.filters.operators.greaterThanOrEqual"),icon:pe},[u.LessThanOrEqualTo]:{display:n("common.filters.operators.lessThanOrEqual"),dropdown:n("common.filters.operators.lessThanOrEqual"),icon:ue},[u.In]:{display:n("common.filters.operators.in"),dropdown:n("common.filters.operators.in"),icon:me}},{data:v,isLoading:_}=W(t,c,d,!0),{data:o,isLoading:N}=W(t,c,d,!1),[f,y]=m.useState(u.GreaterThan),[i,T]=m.useState("0"),[b,E]=m.useState("0"),[I,O]=m.useState("0"),[R,V]=m.useState(!1),[j,Z]=m.useState(),[C,h]=m.useState(!1),g=r.variant_exploration.aggregations,s=(U=Object.values(g).flatMap(a=>a.items).find(a=>a.key===t))==null?void 0:U.defaults,ee=p.type==="numerical"&&(s==null?void 0:s.noDataInputOption),L=(s==null?void 0:s.intervalDecimal)!==void 0&&((s==null?void 0:s.max)!==void 0||(s==null?void 0:s.min)!==void 0)||o&&(o.min!==void 0||o.max!==void 0),F=(s==null?void 0:s.min)??(o==null?void 0:o.min)??0,w=(s==null?void 0:s.max)??(o==null?void 0:o.max)??100,A=m.useCallback(()=>{const a=S.getResolvedActiveQuery(c);if(a!=null&&a.content){var l=J(t,a,s,o);V(l.hasNoData),O(l.minValue),E(l.maxValue),h(l.hasUnappliedItems),y(l.selectedRange),T(l.numericalValue)}},[c,t,s,o]);m.useEffect(()=>{A()},[A]);const te=m.useCallback(a=>{y(a),h(!0)},[]),ae=m.useCallback(a=>{V(a),h(!0)},[]),se=m.useCallback(a=>{Z(a),h(!0)},[]),ne=()=>{h(!1);var a=J(t,K,s,v);V(a.hasNoData),O(a.minValue),E(a.maxValue),h(a.hasUnappliedItems),y(a.selectedRange),T(a.numericalValue)},re=m.useCallback(()=>{if(h(!1),R){S.updateActiveQueryField(c,{field:t,value:["__missing__"],merge_strategy:k.OVERRIDE_VALUES});return}let a=[];a=f===u.Between?[parseFloat(I.toString()),parseFloat(b.toString())]:[parseFloat(i.toString())],S.updateActiveQueryField(c,{field:t,value:a,merge_strategy:k.OVERRIDE_VALUES,operator:f}),j&&S.updateActiveQueryField(c,{field:`${t}_unit`,value:[j],merge_strategy:k.OVERRIDE_VALUES})},[c,t,f,i,I,b,R,j]),le=Object.entries(u).map(([a,l])=>{if(l in x){const oe=x[l].icon;return e.jsx(G,{value:l,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:x[l].dropdown})]})},l)}return null}).filter(Boolean);return e.jsxs("div",{className:"p-2 w-full max-w-md",id:`${t}_container`,children:[e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${t}_operator`,children:e.jsxs(Q,{value:f,onValueChange:te,children:[e.jsx(z,{children:e.jsx(H,{placeholder:n("common.filters.operators.selectOperator"),children:x[f].display})}),e.jsx(P,{children:le})]})}),f===u.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx($,{className:"w-half",value:I,onChange:a=>{const l=a.target.value;isNaN(Number(l))||(O(l),h(!0))},min:F,max:w,id:`${t}_min`,"data-testid":`${t}_min`}),e.jsx($,{className:"w-half",value:b,onChange:a=>{const l=a.target.value;isNaN(Number(l))||(E(l),h(!0))},min:F,max:w,id:`${t}_max`,"data-testid":`${t}_max`})]}):e.jsx($,{className:"w-full",value:i,onChange:a=>{const l=a.target.value;isNaN(Number(l))||(T(l),h(!0))},min:F,max:w,id:`${t}_value`,"data-testid":`${t}_value`}),L&&e.jsx("div",{id:`${t}_interval`,children:e.jsxs(X,{children:[n("common.filters.labels.actualInterval")," : ",(q=o==null?void 0:o.min)==null?void 0:q.toFixed(3)," -"," ",(D=o==null?void 0:o.max)==null?void 0:D.toFixed(3)]})})]}),(s==null?void 0:s.rangeTypes)&&s.rangeTypes.length>0&&e.jsx("div",{id:`${t}_range_type_container`,children:N&&_?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-5 w-16 mb-1",id:`${t}_unit_label_skeleton`}),e.jsx(Y,{className:"h-9 w-full",id:`${t}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"text-sm",id:`${t}_unit_label`,children:n("common.filters.labels.unit")}),e.jsxs(Q,{defaultValue:j||s.rangeTypes[0].key,onValueChange:se,children:[e.jsx(z,{children:e.jsx(H,{placeholder:n("common.filters.labels.selectUnit"),children:((M=s.rangeTypes.find(a=>a.key===j))==null?void 0:M.name)||n("common.filters.labels.selectUnit")})}),e.jsx(P,{children:s.rangeTypes.map(a=>e.jsx(G,{value:a.key,children:a.name},a.key))})]})]})}),ee&&!L&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden",id:`${t}_no_data_label`,children:[e.jsx(ce,{checked:R,onCheckedChange:ae,id:`${t}_no_data`}),e.jsx("span",{children:n("common.filters.labels.noData")})]})]}),e.jsx("hr",{className:"my-4 border-border",id:`${t}_divider`}),e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(B,{size:"xs",variant:"ghost",onClick:ne,disabled:!C,id:`${t}_clear`,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(B,{size:"xs",className:"h-7",color:"primary",onClick:re,id:`${t}_apply`,children:n("common.filters.buttons.apply")})})]})]})}Se.__docgenInfo={description:"",methods:[],displayName:"NumericalFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};export{Se as N};
