import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as o}from"./index-CGj_12n1.js";import{A as W}from"./ActionButton-CClS75b0.js";import{B as C}from"./button-C4nZXFML.js";import"./button.variants-BQkt_1YJ.js";import{C as G}from"./checkbox-filter-CR9wM4A6.js";import{I as Q}from"./input-DyY2UfVx.js";import{S as H}from"./separator-6xmuS_PL.js";import{S as w}from"./skeleton-Shk8p_SP.js";import{u as J}from"./i18n-MOeN36sH.js";import{r as K}from"./string-format-D2CEWHqQ.js";import{u as P}from"./applications-config-q4OA8PiL.js";import{q as A,M as X,T as j}from"./query-builder-remote-CEpj2hQD.js";import{u as Y}from"./use-aggregation-builder-CTDbLjr3.js";function Z(u,r){const v=u.toLowerCase().split(/\s+/).filter(Boolean);return r.filter(a=>{const N=a.key.toLowerCase(),f=a.label.toLowerCase();function s(m,l){let p=0;for(const b of l){const S=m.indexOf(b,p);if(S===-1)return!1;p=S+b.length}return!0}return s(N,v)||s(f,v)})}function g(u,r){return r<u?r:u}function V({field:u,maxVisibleItems:r=5,searchVisible:v=!1}){const{t:a}=J(),f=P().variant_exploration.app_id,{data:s,isLoading:m}=Y(u.key,void 0,!0,f),[l,p]=o.useState(s||[]),[b,S]=o.useState([]),[i,h]=o.useState([]),[x,k]=o.useState(g(l.length,r)),[I,y]=o.useState(!1);o.useEffect(()=>{const n=A.getResolvedActiveQuery(f).content.find(e=>e.content.field===u.key);n?(h(n.content.value),y(!0)):h([]),s==null||s.sort((e,c)=>{const _=e.key&&i.includes(e.key),$=c.key&&i.includes(c.key);return _===$?c.count-e.count:_?-1:1}),s==null||s.forEach(e=>{e.label=e.key?K(e.key).replace(/\([^)]+\)|[^()]+/g,c=>c.startsWith("(")&&c.endsWith(")")?c:c.toLowerCase()).replace(/^\w/,c=>c.toUpperCase()):e.key}),p(s||[]),k(g((s==null?void 0:s.length)||0,r))},[s,f,u.key,r]);const E=o.useCallback(n=>{if(!n.trim()){p(s||[]),k(g((s==null?void 0:s.length)||0,r));return}const e=Z(n,s);r>e.length?k(e.length):e.length>r&&k(r),p(e)},[s,r]),L=o.useCallback(()=>{k(l.length)},[x,l]),T=o.useCallback(()=>{k(r)},[x]),z=o.useCallback(()=>{i.length!==l.length&&(y(!0),h(l.map(n=>n.key)))},[l,i]),R=o.useCallback(()=>{i.length!==0&&(y(!0),h([]))},[i]),B=o.useCallback(n=>{let e=[];i.some(c=>c===n.key)?e=i.filter(c=>c!==n.key):e=[...i,n.key],y(!0),h(e)},[i]),M=o.useCallback(()=>{y(!1),h([...b])},[b]),d=o.useCallback(n=>{y(!1),S(i),A.updateActiveQueryField(f,{field:u.key,value:[...i],merge_strategy:X.OVERRIDE_VALUES,operator:n})},[i,f,u.key]),O=o.useCallback(()=>{d(j.In)},[d]),U=o.useCallback(()=>{d(j.NotIn)},[d]),q=o.useCallback(()=>{d(j.All)},[d]),F=o.useCallback(()=>{d(j.In)},[d]);return t.jsxs("div",{className:"p-2 w-full max-w-md",children:[v&&t.jsx(Q,{type:"text",placeholder:a("common.filters.search.placeholder"),className:"w-full p-2 mb-2 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:n=>E(n.target.value),autoFocus:!0}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx(C,{size:"sm",onClick:()=>z(),variant:"link",className:"px-0",children:a("common.filters.buttons.all")}),t.jsx(C,{size:"sm",onClick:()=>R(),variant:"link",className:"px-0",children:a("common.filters.buttons.none")})]}),t.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[m&&Array.from({length:3},(n,e)=>t.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[t.jsx(w,{className:"w-full h-6 rounded"}),t.jsx(w,{className:"h-6 w-12 rounded-md"})]},`skeleton-${e}`)),!m&&l.length===0&&t.jsx("div",{className:"text-muted-foreground py-4",children:a("common.filters.no_values_found")}),!m&&l.length>0&&Array.from({length:x},(n,e)=>t.jsx("div",{className:"gap-3 py-1.5",children:t.jsx(G,{size:"xs",label:a(`common.filters.labels.${u.key}_value.${l[e].key}`,{defaultValue:l[e].label}),checked:i.some(c=>c===l[e].key),count:l[e].count,onCheckedChange:()=>B(l[e])})},l[e].key))]}),!m&&l.length>x&&t.jsx(C,{className:"mt-2 px-0",onClick:L,size:"sm",variant:"link",children:a("common.filters.buttons.show_more",{count:l.length-r})}),!m&&x>r&&t.jsx(C,{className:"mt-2 px-0",onClick:T,size:"sm",variant:"link",children:a("common.filters.buttons.show_less")}),t.jsx(H,{className:"my-4 border-border",id:`${u.key}_divider`}),t.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[t.jsx(C,{size:"xs",variant:"ghost",onClick:M,disabled:!I||m,children:a("common.filters.buttons.clear")}),t.jsx("div",{className:"flex space-x-2",children:t.jsx(W,{size:"xs",className:"h-7",color:"primary",actions:[{label:a("common.filters.buttons.some_not_in"),onClick:F},{label:a("common.filters.buttons.all"),onClick:q},{label:a("common.filters.buttons.not_in"),onClick:U}],onDefaultAction:O,disabled:m,children:a("common.filters.buttons.apply")})})]})]})}V.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},searchVisible:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{V as M};
