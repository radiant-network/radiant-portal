import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{r as l}from"./index-CGj_12n1.js";import{u as M,c as z}from"./api-Bgk4f9pC.js";import{F as N}from"./filter-button-AktNwcqE.js";import{B as G}from"./button-C9LBm9DC.js";import{u as T}from"./i18n-Dl9M4sbZ.js";import{S as C}from"./skeleton-Shk8p_SP.js";import{g as U,C as B,a as X,b as J,c as Q,d as W}from"./command-3_OtwHJd.js";import{X as V}from"./x-CubKniSv.js";import{S as Y}from"./search-DqA1hdnz.js";import{T as K}from"./test-tube-diagonal-U7YTje3f.js";import{c as O}from"./createLucideIcon-8Lr1oLzj.js";import{U as Z}from"./user-CZ8KFWeE.js";import{L as ee}from"./list-filter-DyVHreeM.js";import{P as te}from"./priority-indicator-D13dJMYF.js";import{C as se,R as ae,H as re,F as ne}from"./refresh-ccw-Bwg-o3xn.js";import{C as oe}from"./check-DRc1RmCY.js";import{P as ie}from"./pen-BVjgPDnY.js";/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],ce=O("Barcode",le);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],A=O("FolderOpen",ue);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],me=O("OctagonX",pe);function de(t){return{case_id:A,patient_id:Z,mrn:ce,request_id:K}[t.toLowerCase()]||A}function P({onSelect:t,onClear:r,selectedValue:e,placeholder:m,minSearchLength:n=3,onAutocomplete:i}){const{t:c}=T(),[f,h]=l.useState(""),[p,b]=l.useState(""),[v,x]=l.useState(!1);l.useEffect(()=>{h(e||"")},[e]),l.useEffect(()=>{const u=setTimeout(()=>{b(f)},300);return x(!0),()=>clearTimeout(u)},[f]);const{data:a}=M(p&&p.length>=n?p:null,u=>u?i(u,n):Promise.resolve({}),{revalidateOnFocus:!1,dedupingInterval:300}),d=l.useCallback((u,y)=>{const S=y.trim();t(u,S),h(S),x(!1)},[t]),w=l.useCallback(()=>{h(""),r==null||r()},[r]),j=a&&Object.keys(a).length>0;return s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"text-sm font-medium text-foreground h-[14px] mb-[8px]",children:c("case_exploration.filters_group.search_by_id")}),s.jsxs(U,{className:"relative h-8 w-[260px] overflow-visible",shouldFilter:!1,children:[s.jsx(B,{className:"px-[6px]",wrapperClassName:"focus-within:ring-primary focus-visible:outline-none focus-visible:ring-ring focus-visible:ring-offset-0 [&:has(:focus-visible)]:ring-1",placeholder:m,leftAddon:s.jsx(Y,{size:16}),rightAddon:f.length>0&&s.jsx(V,{onClick:w,size:16}),value:f,onValueChange:h,onFocus:()=>{x(!0)},onBlur:()=>setTimeout(()=>x(!1),100)}),v&&f.length>0&&s.jsxs(X,{className:"absolute max-h-[240px] left-0 top-full z-50 mt-1 w-full overflow-auto rounded-md border bg-background shadow-lg",onMouseDown:u=>u.preventDefault(),children:[!j&&s.jsx(J,{children:c("common.table.filters.no_values_found")}),j&&Object.keys(a||{}).map(u=>s.jsxs(s.Fragment,{children:[Object.keys(a||{}).indexOf(u)!==0&&s.jsx("hr",{className:"w-full h-px bg-border"}),s.jsx(Q,{heading:s.jsx("span",{className:"h-[28px] &:not(:first-child)]:bg-border",children:c(`common.table.filters.search.${u}`,u.toUpperCase())}),children:((a==null?void 0:a[u])||[]).map(y=>{const S=de(y.type);return s.jsxs(W,{className:"h-[32px]",value:`${y.value}::${u}`,onSelect:k=>{d(y.type,k.split("::")[0])},children:[s.jsx(S,{size:16,className:"text-muted-foreground"}),s.jsx("span",{children:y.value})]},y.value)})},u)]}))]})]})]})}P.__docgenInfo={description:"",methods:[],displayName:"TableFiltersSearch",props:{placeholder:{required:!1,tsType:{name:"string"},description:""},onSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: string, value: string) => void",signature:{arguments:[{type:{name:"string"},name:"type"},{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},selectedValue:{required:!1,tsType:{name:"string"},description:""},minSearchLength:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"3",computed:!1}},onAutocomplete:{required:!0,tsType:{name:"signature",type:"function",raw:"(prefix: string, minSearchLength: number) => Promise<GroupedAutocompleteResults>",signature:{arguments:[{type:{name:"string"},name:"prefix"},{type:{name:"number"},name:"minSearchLength"}],return:{name:"Promise",elements:[{name:"Record",elements:[{name:"string"},{name:"Array",elements:[{name:"AutocompleteResult"}],raw:"AutocompleteResult[]"}],raw:"Record<string, AutocompleteResult[]>"}],raw:"Promise<GroupedAutocompleteResults>"}}},description:""}}};function I(t){return t.sort((r,e)=>r.label.localeCompare(e.label))}function fe(t,r){const e=[];for(const m in r)t[m].length>0&&e.push({field:r[m].key,value:t[m]});return e}function he({filterSearchs:t,visibleFilters:r}){return s.jsxs("div",{className:"flex flex-col justify-start gap-2 min-w-[400px] h-[48px]",children:[s.jsx(C,{className:"w-[120px] h-[24px]"}),s.jsxs("div",{className:"flex gap-2 h-[32px]",children:[t==null?void 0:t.map(e=>s.jsx(C,{className:"w-[260px] h-full"},e.id)),Object.keys(r).map(e=>s.jsx(C,{className:"w-[100px] h-full"},e)),s.jsx(C,{className:"w-[75px] h-full"})]})]})}function D({loading:t=!1,openFilters:r,setOpenFilters:e,visibleFilters:m,filters:n,setFilters:i,changedFilterButtons:c,setChangedFilterButtons:f,setSearchCriteria:h,filterButtons:p,filterSearchs:b,criterias:v,defaultFilters:x,defaultSearchFilters:a={}}){const{t:d}=T(),w=l.useCallback((o,g)=>{i({...n,[o]:g})},[n,i]),j=l.useMemo(()=>p.filter(o=>!o.isVisible),[p]),u=p.some(o=>o.selectedItems.length>0)||c.length>0,y=()=>{i({...x,...a}),f([]),e({})},S=l.useCallback(o=>{f([...c,...o.filter(_=>!c.includes(_))]);const g=o.reduce((_,F)=>(_[F]=!0,_),{});e({...r,...g})},[]),k=l.useCallback((o,g)=>{const _={...n,...a};i({..._,[o]:[g]})},[n,i]),$=l.useCallback(()=>{i({...n,...a})},[n,i]);return l.useEffect(()=>{h(fe(n,v))},[n,h]),t?s.jsx(he,{filterSearchs:b,visibleFilters:m}):s.jsxs("div",{id:"table-filters",className:"py-0 flex flex-2 flex-wrap gap-2 items-button",children:[b==null?void 0:b.map(({id:o,searchTerm:g,placeholder:_,minSearchLength:F,onAutocomplete:H})=>s.jsx(P,{onSelect:k,onClear:$,selectedValue:g,placeholder:_,minSearchLength:F,onAutocomplete:H},`table-filter-search-${o}`)),s.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[p.filter(o=>o.isVisible).sort((o,g)=>v[o.key].weight-v[g.key].weight).map(o=>s.jsx(N,{popoverSize:o.popoverSize,label:o.label,options:o.options,selected:o.selectedItems,onSelect:g=>w(o.key,g),isOpen:o.isOpen,withTooltip:o.withTooltip},o.key)),j.length>0&&s.jsx(N,{label:d("common.filters.more","More"),options:j,selected:[],onSelect:S,actionMode:!0,icon:s.jsx(ee,{size:16}),placeholder:d("common.table.filters.more_placeholder","Filters"),closeOnSelect:!0}),u&&s.jsxs(G,{variant:"link",onClick:y,className:"text-sm py-2 px-3 h-8",children:[s.jsx(V,{size:14}),d("common.actions.clear","Clear")]})]})]})}D.__docgenInfo={description:`Controlled component

His parent component must manage all different filter states, useState`,methods:[],displayName:"DataTableFilters",props:{loading:{defaultValue:{value:"false",computed:!1},required:!1},defaultSearchFilters:{defaultValue:{value:"{}",computed:!1},required:!1}}};const R=["routine","urgent","asap","stat"];function ge(t){return t.sort((e,m)=>{var c,f;const n=R.indexOf(((c=e.key)==null?void 0:c.toLowerCase())||""),i=R.indexOf(((f=m.key)==null?void 0:f.toLowerCase())||"");return n!==-1&&i!==-1?n-i:n!==-1?-1:i!==-1?1:0}).map(e=>({...e,label:s.jsx(te,{size:"sm",code:e.key})}))}const xe="case_exploration.status";function ye(t){return{draft:ie,"on-hold":re,active:ae,completed:oe,incomplete:se,revoke:me}[t.toLowerCase()]||ne}function be(t,r){return t.map(e=>({...e,label:r(`${xe}.${e.key}`,e.label||""),icon:ye(e.key||"")}))}function _e(t,r){const[e,m]=l.useState(()=>{if(typeof window>"u")return r;try{const n=localStorage.getItem(t);return n?JSON.parse(n):r}catch{return r}});return l.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(e))}catch{}},[t,e]),[e,m]}const q=["priority","status","case_analysis"],ve={priority:{key:"priority_code",weight:1},status:{key:"status_code",weight:2},case_analysis:{key:"case_analysis_code",weight:3},project:{key:"project_code",weight:3},performer_lab:{key:"performer_lab_code",weight:4},requested_by:{key:"requested_by_code",weight:5},case_id:{key:"case_id",weight:6},patient_id:{key:"patient_id",weight:7},mrn:{key:"mrn",weight:8},request_id:{key:"request_id",weight:9}};async function we(t,r){if(!t||t.length<r)return{};const e=await z.autocompleteCases(t,"10");return e!=null&&e.data&&e.data.length>0?e.data.reduce((n,i)=>(n[i.type]||(n[i.type]=[]),n[i.type].push(i),n),{}):{}}async function Se(t){return(await z.casesFilters(t)).data}const L={priority:[],status:[],case_analysis:[],project:[],performer_lab:[],requested_by:[]},E={case_id:[],patient_id:[],mrn:[],request_id:[]};function je({loading:t=!0,setSearchCriteria:r}){const[e,m]=l.useState([]),[n,i]=l.useState({}),[c,f]=_e("case-exploration-filters",{...L,...E}),{t:h}=T(),{data:p}=M("case-filters",()=>Se({search_criteria:[]}),{revalidateOnFocus:!1,revalidateOnMount:!0,revalidateIfStale:!1,revalidateOnReconnect:!1}),b=l.useMemo(()=>p?Object.keys(p).map(a=>{const d={key:a,label:h(`case_exploration.case.filters.${a}`),isVisible:q.includes(a),isOpen:n[a]||!1,selectedItems:c[a]||[],options:[]};switch(a){case"status":return{...d,options:I(be(p[a]||[],h))};case"project":case"performer_lab":case"requested_by":return{...d,popoverSize:"lg",isVisible:c[a]&&c[a].length>0||e.includes(a)||!1,options:I(p[a]||[]),withTooltip:!0};case"priority":return{...d,options:ge(p[a]||[])};case"case_analysis":return{...d,options:I(p[a]||[]),popoverSize:"lg",withTooltip:!0};default:return d}}).filter(a=>a.options.length>0):[],[p,c,e,n,h]),x=(()=>{const a=["case_id","patient_id","mrn","assay_id"];for(const d of a){const w=c[d]||[];if(w.length>0)return{type:d,value:w[0]}}return null})();return s.jsx(D,{visibleFilters:q,filterSearchs:[{id:"search",searchTerm:x==null?void 0:x.value,placeholder:h("case_exploration.filters_group.search_placeholder"),minSearchLength:1,onAutocomplete:we}],filterButtons:b,changedFilterButtons:e,setChangedFilterButtons:m,filters:c,setFilters:f,openFilters:n,setOpenFilters:i,loading:t,setSearchCriteria:r,criterias:ve,defaultFilters:L,defaultSearchFilters:E})}je.__docgenInfo={description:"",methods:[],displayName:"FiltersGroupForm",props:{loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},setSearchCriteria:{required:!0,tsType:{name:"signature",type:"function",raw:"(searchCriteria: SearchCriterion[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"SearchCriterion"}],raw:"SearchCriterion[]"},name:"searchCriteria"}],return:{name:"void"}}},description:""}}};export{je as F};
