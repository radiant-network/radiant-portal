import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{a as oe}from"./index-B-lxVbXh.js";import{q as _,M as ae,T as C}from"./query-builder-remote-Bza3nrNy.js";import{R as $,r as a}from"./index-DQLiH3RP.js";import{B as v}from"./button-B4RNn5Ar.js";import{C as le}from"./checkbox-BPlUEr5r.js";import{I as ne}from"./input-DyY2UfVx.js";import{A as ce}from"./ActionButton-yaQJeqfP.js";import"./button.variants-Czj0iLzG.js";import{u as ie,C as ue}from"./applications-config-pyPLye2e.js";import{n as me}from"./number-format-DDJvc-iv.js";import{u as pe}from"./i18n-DzPeDqse.js";import{S as de}from"./separator-XMoClt4p.js";import{u as fe,o as ye}from"./index-GTOYCLEy.js";import{S as E}from"./skeleton-Shk8p_SP.js";import{c as R}from"./config-mock-BXxtYAjK.js";import"./v4-CtRu48qb.js";import"./api-B-gH50Ma.js";import"./index-b4Krvw3J.js";import"./index-CECE1b4A.js";import"./index-CJPVTaBz.js";import"./spinner-DHVcj7-u.js";import"./utils-D-KgF5mV.js";import"./createLucideIcon-BMP5cxO1.js";import"./tooltip-2a7OmUZw.js";import"./index-DZeBqZZX.js";import"./index-CS2et-gJ.js";import"./index-BlJj-Uol.js";import"./check-DSCf8CVO.js";import"./index-DDGWSPzp.js";import"./index-C66Dxnp2.js";import"./dropdown-menu-5z4VmTsG.js";import"./index-CKWZTibS.js";import"./ellipsis-BtlAG3ey.js";import"./iframe-BfS_44vz.js";import"./index-BjfAAjgr.js";const he=$.createContext({seqId:"1"}),xe=s=>ye.aggregateGermlineOccurrences(s.seqId,s.aggregationBody).then(o=>o.data);function ke(s,o=30,x=!1,c){let d;const{seqId:p}=$.useContext(he);x?d={seqId:p,aggregationBody:{field:s,size:o}}:d=null;const r=_.getResolvedActiveQuery(c);return r&&d&&(d.aggregationBody.sqon={content:r.content,op:r.op}),fe(d,xe,{revalidateOnFocus:!1})}function ge(s,o){return o.filter(x=>x.key.toLowerCase().includes(s.toLowerCase()))}function I(s,o){return o<s?o:s}function b({field:s,maxVisibleItems:o=5,searchVisible:x=!1}){const{t:c}=pe(),p=ie().variant_exploration.app_id,{data:r,isLoading:k}=ke(s.key,void 0,!0,p),[n,w]=a.useState(r||[]),[F,G]=a.useState([]),[i,f]=a.useState([]),[g,y]=a.useState(I(n.length,o)),[H,h]=a.useState(!1);a.useEffect(()=>{let l=_.getResolvedActiveQuery(p).content.find(t=>t.content.field===s.key);l?(f(l.content.value),h(!0)):f([]),r==null||r.sort((t,u)=>{const j=t.key&&i.includes(t.key),re=u.key&&i.includes(u.key);return j===re?u.count-t.count:j?-1:1}),r==null||r.forEach(t=>{var u;t.label=(u=t.key)==null?void 0:u.replace(/_/g," ").replace(/^\w/,j=>j.toUpperCase())}),w(r||[]),y(I((r==null?void 0:r.length)||0,o))},[r,p,s.key,o]);const W=a.useCallback(l=>{if(!l.trim()){w(r||[]),y(I((r==null?void 0:r.length)||0,o));return}const t=ge(l,r);o>t.length?y(t.length):t.length>o&&y(o),w(t)},[r,o]),P=a.useCallback(()=>{y(n.length)},[g,n]),J=a.useCallback(()=>{y(o)},[g]),K=a.useCallback(()=>{i.length!==n.length&&(h(!0),f(n.map(l=>l.key)))},[n,i]),X=a.useCallback(()=>{i.length!==0&&(h(!0),f([]))},[i]),Y=a.useCallback(l=>{let t=[];i.some(u=>u===l.key)?t=i.filter(u=>u!==l.key):t=[...i,l.key],h(!0),f(t)},[i]),Z=a.useCallback(()=>{h(!1),f([...F])},[F]),m=a.useCallback(l=>{h(!1),G(i),_.updateActiveQueryField(p,{field:s.key,value:[...i],merge_strategy:ae.OVERRIDE_VALUES,operator:l})},[i,p,s.key]),D=a.useCallback(()=>{m(C.In)},[m]),ee=a.useCallback(()=>{m(C.NotIn)},[m]),te=a.useCallback(()=>{m(C.All)},[m]),se=a.useCallback(()=>{m(C.In)},[m]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[x&&e.jsx(ne,{type:"text",placeholder:c("common.filters.search.placeholder"),className:"w-full p-2 mb-2 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:l=>W(l.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(v,{size:"sm",onClick:()=>K(),variant:"link",className:"px-0",children:c("common.filters.buttons.all")}),e.jsx(v,{size:"sm",onClick:()=>X(),variant:"link",className:"px-0",children:c("common.filters.buttons.none")})]}),e.jsx("div",{className:"max-h-[250px] overflow-auto",children:k?Array.from({length:3},(l,t)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(E,{className:"w-full h-6 rounded"}),e.jsx(E,{className:"h-6 w-12 rounded-md"})]},`skeleton-${t}`)):n.length===0?e.jsx("div",{className:"text-muted-foreground py-4",children:c("common.filters.noValuesFound")}):Array.from({length:g},(l,t)=>e.jsx("div",{className:"gap-3 py-1.5",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("label",{className:"flex gap-2 overflow-hidden items-start py-0.5",children:[e.jsx(le,{className:"w-4 h-4 py-0.5",checked:i.some(u=>u===n[t].key),onCheckedChange:()=>Y(n[t])}),e.jsx("div",{className:"overflow-hidden whitespace-normal break-words text-xs",children:c(`common.filters.labels.${s.key}_value.${n[t].key}`,{defaultValue:n[t].label})}),e.jsx("span",{className:"checkmark"})]}),e.jsx("span",{className:"bg-accent px-2 h-5 rounded-md text-xs flex items-center",children:me(n[t].count||0)})]})},n[t].key))}),!k&&n.length>g&&e.jsx(v,{className:"mt-2 px-0",onClick:P,size:"sm",variant:"link",children:c("common.filters.buttons.showMore",{count:n.length-o})}),!k&&g>o&&e.jsx(v,{className:"mt-2 px-0",onClick:J,size:"sm",variant:"link",children:c("common.filters.buttons.showLess")}),e.jsx(de,{className:"my-4 border-border",id:`${s.key}_divider`}),e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(v,{size:"xs",variant:"ghost",onClick:Z,disabled:!H||k,children:c("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(ce,{size:"xs",className:"h-7",color:"primary",actions:[{label:c("common.filters.buttons.someNotIn"),onClick:se},{label:c("common.filters.buttons.all"),onClick:te},{label:c("common.filters.buttons.notIn"),onClick:ee}],onDefaultAction:D,disabled:k,children:c("common.filters.buttons.apply")})})]})]})}b.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},searchVisible:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const V={...R,variant_exploration:{...R.variant_exploration,aggregations:{variant:{items:[{key:"chromosome",type:"multiple"},{key:"filter",type:"multiple"},{key:"zygosity",type:"multiple"},{key:"impact_score",type:"multiple"},{key:"variant_class",type:"multiple"},{key:"symbol",type:"multiple"}]}}}},st={title:"Feature/Query Filters/Multi Select",component:b,args:{field:{key:"chromosome",type:"multiple"},maxVisibleItems:10,searchVisible:!0},decorators:[s=>e.jsx(ue,{config:V,children:e.jsx(s,{})})]},S={render:s=>e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})})},N={render:s=>(oe("activeQuery")(_.updateActiveQueryField(V.variant_exploration.app_id,{field:"chromosome",value:["Option1","Option4"]})),e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})}))},A={args:{searchVisible:!1},render:s=>e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})})};var B,O,Q;S.parameters={...S.parameters,docs:{...(B=S.parameters)==null?void 0:B.docs,source:{originalSource:`{
  render: args => {
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(Q=(O=S.parameters)==null?void 0:O.docs)==null?void 0:Q.source}}};var q,M,T;N.parameters={...N.parameters,docs:{...(q=N.parameters)==null?void 0:q.docs,source:{originalSource:`{
  render: args => {
    action('activeQuery')(queryBuilderRemote.updateActiveQueryField(config.variant_exploration.app_id, {
      field: 'chromosome',
      value: ['Option1', 'Option4']
    }));
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(T=(M=N.parameters)==null?void 0:M.docs)==null?void 0:T.source}}};var z,L,U;A.parameters={...A.parameters,docs:{...(z=A.parameters)==null?void 0:z.docs,source:{originalSource:`{
  args: {
    searchVisible: false
  },
  render: args => {
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(U=(L=A.parameters)==null?void 0:L.docs)==null?void 0:U.source}}};const rt=["Default","DataAppliedToQueryBuilder","HiddenSearch"];export{N as DataAppliedToQueryBuilder,S as Default,A as HiddenSearch,rt as __namedExportsOrder,st as default};
