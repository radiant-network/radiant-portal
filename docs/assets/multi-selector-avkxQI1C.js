import{j as a}from"./jsx-runtime-D_zvdyIk.js";import{b as re,g as ne,_ as se,a as ie,d as F,c as ue}from"./command-DNEJ4r_l.js";import{r as u}from"./index-CGj_12n1.js";import{B as oe}from"./badge-aQXnmXeU.js";import{c as O}from"./utils-D-KgF5mV.js";import{u as ce}from"./useDebounce-CWd6BpJ3.js";import{S as de}from"./skeleton-Shk8p_SP.js";import{X as me}from"./x-CubKniSv.js";import{C as fe}from"./check-DRc1RmCY.js";function S(c,n){if(c.length===0)return{};if(!n)return{"":c};const f={};return c.forEach(d=>{const p=d[n]||"";f[p]||(f[p]=[]),f[p].push(d)}),f}function H(c,n){return n.filter(f=>c.includes(f.value))}function pe(c,n){for(const[,f]of Object.entries(c))if(f.some(d=>n.find(p=>p.value===d.value)))return!0;return!1}function J({value:c,onChange:n,placeholder:f,defaultOptions:d=[],options:p,debounceDelay:U=500,onSearch:m,onSearchSync:E,emptyIndicator:_,maxSelected:D=Number.MAX_SAFE_INTEGER,onMaxSelected:g,hidePlaceholderWhenSelected:W,disabled:T,groupBy:b,className:$,selectFirstItem:Q=!0,creatable:j=!1,triggerSearchOnFocus:q=!1,commandProps:s,inputProps:i,hideClearAllButton:Y=!1,renderBadge:G,ref:Z}){const o=u.useRef(null),[y,C]=u.useState(!1),[P,z]=u.useState(!1),[K,X]=u.useState(!1),I=u.useRef(null),[l,x]=u.useState(H(c||[],d)),[R,L]=u.useState(S(d,b)),[h,V]=u.useState(""),w=ce(h,U);u.useImperativeHandle(Z,()=>({selectedValue:[...l],input:o.current,focus:()=>{var e;return(e=o==null?void 0:o.current)==null?void 0:e.focus()},reset:()=>x([])}),[l]);const N=e=>{I.current&&!I.current.contains(e.target)&&o.current&&!o.current.contains(e.target)&&(C(!1),o.current.blur())},M=u.useCallback(e=>{const t=l.filter(r=>r.value!==e.value);x(t),n==null||n(t.map(r=>r.value))},[n,l]),ee=u.useCallback(e=>{const t=o.current;t&&((e.key==="Delete"||e.key==="Backspace")&&t.value===""&&l.length>0&&(l[l.length-1].fixed||M(l[l.length-1])),e.key==="Escape"&&t.blur())},[M,l]);u.useEffect(()=>(y?(document.addEventListener("mousedown",N),document.addEventListener("touchend",N)):(document.removeEventListener("mousedown",N),document.removeEventListener("touchend",N)),()=>{document.removeEventListener("mousedown",N),document.removeEventListener("touchend",N)}),[y]),u.useEffect(()=>{c&&d.length>0&&x(H(c,d))},[c,d]),u.useEffect(()=>{if(!p||m)return;const e=S(p||[],b);JSON.stringify(e)!==JSON.stringify(R)&&L(e)},[d,p,b,m,R]),u.useEffect(()=>{const e=()=>{const r=E==null?void 0:E(w);L(S(r||[],b))};(async()=>{!E||!y||(q&&e(),w&&e())})()},[w,b,y,q]),u.useEffect(()=>{const e=async()=>{X(!0);const r=await(m==null?void 0:m(w));L(S(r||[],b)),X(!1)};(async()=>{!m||!y||(q&&await e(),w&&await e())})()},[w,b,y,q]);const te=()=>{if(!j||pe(R,[{value:h,label:h}])||l.find(t=>t.value===h))return;const e=a.jsx(F,{value:h,className:"cursor-pointer",onMouseDown:t=>{t.preventDefault(),t.stopPropagation()},onSelect:t=>{if(l.length>=D){g==null||g(l.length);return}V("");const r=[...l,{value:t,label:t}];x(r),n==null||n(r.map(A=>A.value))},children:`Create "${h}"`});if(!m&&h.length>0||m&&w.length>0&&!K)return e},le=u.useCallback(()=>m&&!j&&Object.keys(R).length===0?a.jsx("div",{className:"p-2 py-4 text-center text-sm",children:"No data"}):a.jsx(re,{children:_||a.jsx("div",{className:"text-center text-sm",children:"No data"})}),[j,_,m,R]),ae=u.useCallback(()=>{if(s!=null&&s.filter)return s.filter;if(j)return(e,t)=>e.toLowerCase().includes(t.toLowerCase())?1:-1},[j,s==null?void 0:s.filter]);return a.jsxs(ne,{ref:I,...s,onKeyDown:e=>{var t;ee(e),(t=s==null?void 0:s.onKeyDown)==null||t.call(s,e)},className:O("h-auto overflow-visible bg-background",s==null?void 0:s.className),shouldFilter:(s==null?void 0:s.shouldFilter)!==void 0?s.shouldFilter:!m,filter:ae(),children:[a.jsxs("div",{className:O("flex min-h-9 shadow-xs rounded-md border border-input text-sm ring-offset-background focus-within:ring-1 focus-within:ring-ring",{"px-3 py-2":l.length!==0,"cursor-text":!T&&l.length!==0},$),onClick:()=>{var e;T||(e=o==null?void 0:o.current)==null||e.focus()},children:[a.jsxs("div",{className:"relative flex flex-1 flex-wrap gap-1",children:[l.map(e=>G?G({option:e,onRemove:()=>M(e)}):a.jsx(oe,{"data-disabled":T||void 0,onClose:()=>M(e),children:e.label},e.value)),a.jsx(se.Input,{...i,ref:o,value:h,disabled:T,onValueChange:e=>{var t;V(e),(t=i==null?void 0:i.onValueChange)==null||t.call(i,e)},onBlur:e=>{var t;P||C(!1),(t=i==null?void 0:i.onBlur)==null||t.call(i,e)},onFocus:e=>{var t;C(!0),(t=i==null?void 0:i.onFocus)==null||t.call(i,e)},placeholder:W&&l.length!==0?"":f,className:O("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":W,"px-3 py-2":l.length===0,"ml-1":l.length!==0},i==null?void 0:i.className)})]}),a.jsx("button",{type:"button",onClick:()=>{x(l.filter(e=>e.fixed)),n==null||n(l.filter(e=>e.fixed).map(e=>e.value))},className:O((Y||T||l.length<1||l.filter(e=>e.fixed).length===l.length)&&"hidden"),children:a.jsx(me,{size:18,className:""})})]}),a.jsx("div",{className:O("relative",y?"block":"hidden"),children:a.jsx(ie,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in fade-in-0 zoom-in-95",onMouseLeave:()=>{z(!1)},onMouseEnter:()=>{z(!0)},onMouseUp:()=>{var e;(e=o==null?void 0:o.current)==null||e.focus()},children:K?a.jsx("div",{className:"p-1",children:a.jsx(de,{className:"h-8 w-full"})}):a.jsxs(a.Fragment,{children:[le(),te(),!Q&&a.jsx(F,{value:"-",className:"hidden"}),Object.entries(R).map(([e,t])=>a.jsx(ue,{heading:e,className:"h-full overflow-auto",children:a.jsx(a.Fragment,{children:t.map(r=>{var B;const A=(B=l.map(v=>v.value))==null?void 0:B.includes(r.value);return a.jsxs(F,{value:r.label,disabled:r.disable,onMouseDown:v=>{v.preventDefault(),v.stopPropagation()},onSelect:()=>{if(l.length>=D){g==null||g(l.length);return}V("");let v=[];l.find(k=>k.value===r.value)?v=l.filter(k=>k.value!==r.value):v=[...l,r],x(v),n==null||n(v.map(k=>k.value))},className:O("cursor-pointer",r.disable&&"cursor-default text-muted-foreground"),children:[a.jsx("span",{className:"flex-1",children:r.label}),A?a.jsx(fe,{className:"w-4"}):null]},r.value)})})},e))]})})})]})}J.displayName="MultipleSelector";J.__docgenInfo={description:"",methods:[{name:"focus",docblock:null,modifiers:[],params:[],returns:null},{name:"reset",docblock:null,modifiers:[],params:[],returns:null}],displayName:"MultipleSelector",props:{ref:{required:!1,tsType:{name:"union",raw:"React.RefCallback<MultipleSelectorRef> | React.RefObject<MultipleSelectorRef>",elements:[{name:"ReactRefCallback",raw:"React.RefCallback<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]},{name:"ReactRefObject",raw:"React.RefObject<MultipleSelectorRef>",elements:[{name:"MultipleSelectorRef"}]}]},description:""},value:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},defaultOptions:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"",defaultValue:{value:"[]",computed:!1}},options:{required:!1,tsType:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"},description:"manually controlled options"},placeholder:{required:!1,tsType:{name:"string"},description:""},emptyIndicator:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"Empty component."},debounceDelay:{required:!1,tsType:{name:"number"},description:"Debounce time for async search. Only work with `onSearch`.",defaultValue:{value:"500",computed:!1}},triggerSearchOnFocus:{required:!1,tsType:{name:"boolean"},description:"Only work with `onSearch` prop. Trigger search when `onFocus`.\nFor example, when user click on the input, it will trigger the search to get initial options.",defaultValue:{value:"false",computed:!1}},onSearch:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => Promise<MultiSelectorOption[]>",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Promise",elements:[{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}],raw:"Promise<MultiSelectorOption[]>"}}},description:"async search"},onSearchSync:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => MultiSelectorOption[]",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"Array",elements:[{name:"MultiSelectorOption"}],raw:"MultiSelectorOption[]"}}},description:`sync search. This search will not showing loadingIndicator.
The rest props are the same as async search.
i.e.: creatable, groupBy, delay.`},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(options: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"options"}],return:{name:"void"}}},description:""},maxSelected:{required:!1,tsType:{name:"number"},description:"Limit the maximum number of selected options.",defaultValue:{value:"Number.MAX_SAFE_INTEGER",computed:!0}},onMaxSelected:{required:!1,tsType:{name:"signature",type:"function",raw:"(maxLimit: number) => void",signature:{arguments:[{type:{name:"number"},name:"maxLimit"}],return:{name:"void"}}},description:"When the number of selected options exceeds the limit, the onMaxSelected will be called."},hidePlaceholderWhenSelected:{required:!1,tsType:{name:"boolean"},description:"Hide the placeholder when there are options selected."},disabled:{required:!1,tsType:{name:"boolean"},description:""},groupBy:{required:!1,tsType:{name:"string"},description:"Group the options base on provided key."},className:{required:!1,tsType:{name:"string"},description:""},selectFirstItem:{required:!1,tsType:{name:"boolean"},description:`First item selected is a default behavior by cmdk. That is why the default is true.
This is a workaround solution by add a dummy item.

@reference: https://github.com/pacocoursey/cmdk/issues/171`,defaultValue:{value:"true",computed:!1}},creatable:{required:!1,tsType:{name:"boolean"},description:"Allow user to create option when there is no option matched.",defaultValue:{value:"false",computed:!1}},commandProps:{required:!1,tsType:{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof Command>",elements:[{name:"Command"}]},description:"Props of `Command`"},inputProps:{required:!1,tsType:{name:"Omit",elements:[{name:"ReactComponentPropsWithoutRef",raw:"React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>",elements:[{name:"CommandPrimitive.Input"}]},{name:"union",raw:"'value' | 'placeholder' | 'disabled'",elements:[{name:"literal",value:"'value'"},{name:"literal",value:"'placeholder'"},{name:"literal",value:"'disabled'"}]}],raw:`Omit<
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>,
  'value' | 'placeholder' | 'disabled'
>`},description:"Props of `CommandInput`"},hideClearAllButton:{required:!1,tsType:{name:"boolean"},description:"hide the clear all button.",defaultValue:{value:"false",computed:!1}},renderBadge:{required:!1,tsType:{name:"signature",type:"function",raw:"(params: { option: MultiSelectorOption; onRemove: () => void }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ option: MultiSelectorOption; onRemove: () => void }",signature:{properties:[{key:"option",value:{name:"MultiSelectorOption",required:!0}},{key:"onRemove",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]}},name:"params"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"Render the badge for each option."}}};export{J as M};
