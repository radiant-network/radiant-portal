import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{a as re}from"./index-B-lxVbXh.js";import{q as _,M as oe,T as C}from"./query-builder-remote-CCBfoM9g.js";import{r as l}from"./index-DQLiH3RP.js";import{B as g}from"./button-B_hWqCKH.js";import{C as le}from"./checkbox-CO27iIkV.js";import{I as ae}from"./input-DyY2UfVx.js";import{A as ne}from"./ActionButton-A54waDHb.js";import"./button.variants-Czj0iLzG.js";import{u as ce,C as ie}from"./applications-config-pyPLye2e.js";import{n as ue}from"./number-format-D03oK8BY.js";import{u as me}from"./i18n-C20of0WZ.js";import{S as pe}from"./separator-DcuX0n1V.js";import{u as de,o as fe}from"./index-Cszs0DFs.js";import{S as E}from"./skeleton-Shk8p_SP.js";import{c as B}from"./config-mock-BXxtYAjK.js";import"./v4-CtRu48qb.js";import"./api-BXByjzrT.js";import"./index-D-AYaadb.js";import"./index-CECE1b4A.js";import"./index-CJPVTaBz.js";import"./spinner-DHVcj7-u.js";import"./utils-D-KgF5mV.js";import"./createLucideIcon-BMP5cxO1.js";import"./index-DDGWSPzp.js";import"./index-C5A_jyAq.js";import"./index-C66Dxnp2.js";import"./check-DSCf8CVO.js";import"./dropdown-menu-maOUzwaK.js";import"./index-Bf9LPmYV.js";import"./index-DD7n3F2b.js";import"./index-Bx8PXznd.js";import"./ellipsis-BtlAG3ey.js";import"./iframe-CzvtgGEw.js";import"./index-BjfAAjgr.js";const ye=s=>fe.aggregateGermlineOccurrences(s.seqId,s.aggregationBody).then(r=>r.data);function he(s,r=30,h=!1,c){let d;h?d={seqId:"1",aggregationBody:{field:s,size:r}}:d=null;const m=_.getResolvedActiveQuery(c);return m&&d&&(d.aggregationBody.sqon={content:m.content,op:m.op}),de(d,ye,{revalidateOnFocus:!1})}function xe(s,r){return r.filter(h=>h.key.toLowerCase().includes(s.toLowerCase()))}function I(s,r){return r<s?r:s}function b({field:s,maxVisibleItems:r=5,searchVisible:h=!1}){const{t:c}=me(),m=ce().variant_exploration.app_id,{data:o,isLoading:x}=he(s.key,void 0,!0,m),[n,w]=l.useState(o||[]),[F,V]=l.useState([]),[i,f]=l.useState([]),[k,y]=l.useState(I(n.length,r)),[G,v]=l.useState(!1);l.useEffect(()=>{let a=_.getResolvedActiveQuery(m).content.find(t=>t.content.field===s.key);f(a?a.content.value:[]),o==null||o.sort((t,u)=>{const j=t.key&&i.includes(t.key),se=u.key&&i.includes(u.key);return j===se?u.count-t.count:j?-1:1}),o==null||o.forEach(t=>{var u;t.label=(u=t.key)==null?void 0:u.replace(/_/g," ").replace(/^\w/,j=>j.toUpperCase())}),w(o||[]),y(I((o==null?void 0:o.length)||0,r))},[o,m,s.key,r]);const H=l.useCallback(a=>{if(!a.trim()){w(o||[]),y(I((o==null?void 0:o.length)||0,r));return}const t=xe(a,o);r>t.length?y(t.length):t.length>r&&y(r),w(t)},[o,r]),W=l.useCallback(()=>{y(n.length)},[k,n]),P=l.useCallback(()=>{y(r)},[k]),J=l.useCallback(()=>{i.length!==n.length&&(v(!0),f(n.map(a=>a.key)))},[n,i]),K=l.useCallback(()=>{i.length!==0&&(v(!0),f([]))},[i]),X=l.useCallback(a=>{let t=[];i.some(u=>u===a.key)?t=i.filter(u=>u!==a.key):t=[...i,a.key],v(!0),f(t)},[i]),Y=l.useCallback(()=>{v(!1),f([...F])},[F]),p=l.useCallback(a=>{v(!1),V(i),_.updateActiveQueryField(m,{field:s.key,value:[...i],merge_strategy:oe.OVERRIDE_VALUES,operator:a})},[i,m,s.key]),Z=l.useCallback(()=>{p(C.In)},[p]),D=l.useCallback(()=>{p(C.NotIn)},[p]),ee=l.useCallback(()=>{p(C.All)},[p]),te=l.useCallback(()=>{p(C.In)},[p]);return e.jsxs("div",{className:"p-2 w-full max-w-md",children:[h&&e.jsx(ae,{type:"text",placeholder:c("common.filters.search.placeholder"),className:"w-full p-2 mb-2 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:a=>H(a.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(g,{size:"sm",onClick:()=>J(),variant:"link",className:"px-0",children:c("common.filters.buttons.all")}),e.jsx(g,{size:"sm",onClick:()=>K(),variant:"link",className:"px-0",children:c("common.filters.buttons.none")})]}),e.jsx("div",{className:"max-h-[250px] overflow-auto",children:x?Array.from({length:3},(a,t)=>e.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[e.jsx(E,{className:"w-full h-6 rounded"}),e.jsx(E,{className:"h-6 w-12 rounded-md"})]},`skeleton-${t}`)):n.length===0?e.jsx("div",{className:"text-muted-foreground py-4",children:c("common.filters.noValuesFound")}):Array.from({length:k},(a,t)=>e.jsx("div",{className:"gap-3 py-1.5",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("label",{className:"flex gap-2 overflow-hidden items-start py-0.5",children:[e.jsx(le,{className:"w-4 h-4 py-0.5",checked:i.some(u=>u===n[t].key),onCheckedChange:()=>X(n[t])}),e.jsx("div",{className:"overflow-hidden whitespace-normal break-words text-xs",children:c(`common.filters.labels.${s.key}_value.${n[t].key}`,{defaultValue:n[t].label})}),e.jsx("span",{className:"checkmark"})]}),e.jsx("span",{className:"bg-accent px-2 h-5 rounded-md text-xs flex items-center",children:ue(n[t].count||0)})]})},n[t].key))}),!x&&n.length>k&&e.jsx(g,{className:"mt-2 px-0",onClick:W,size:"sm",variant:"link",children:c("common.filters.buttons.showMore",{count:n.length-r})}),!x&&k>r&&e.jsx(g,{className:"mt-2 px-0",onClick:P,size:"sm",variant:"link",children:c("common.filters.buttons.showLess")}),e.jsx(pe,{className:"my-4 border-border",id:`${s.key}_divider`}),e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(g,{size:"xs",variant:"ghost",onClick:Y,disabled:!G||x,children:c("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(ne,{size:"xs",className:"h-7",color:"primary",actions:[{label:c("common.filters.buttons.someNotIn"),onClick:te},{label:c("common.filters.buttons.all"),onClick:ee},{label:c("common.filters.buttons.notIn"),onClick:D}],onDefaultAction:Z,disabled:x,children:c("common.filters.buttons.apply")})})]})]})}b.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},searchVisible:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const $={...B,variant_exploration:{...B.variant_exploration,aggregations:{variant:{items:[{key:"chromosome",type:"multiple"},{key:"filter",type:"multiple"},{key:"zygosity",type:"multiple"},{key:"impact_score",type:"multiple"},{key:"variant_class",type:"multiple"},{key:"symbol",type:"multiple"}]}}}},De={title:"Feature/Query Filters/Multi Select",component:b,args:{field:{key:"chromosome",type:"multiple"},maxVisibleItems:10,searchVisible:!0},decorators:[s=>e.jsx(ie,{config:$,children:e.jsx(s,{})})]},S={render:s=>e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})})},N={render:s=>(re("activeQuery")(_.updateActiveQueryField($.variant_exploration.app_id,{field:"chromosome",value:["Option1","Option4"]})),e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})}))},A={args:{searchVisible:!1},render:s=>e.jsx("div",{className:"space-y-6",children:e.jsx(b,{...s})})};var O,Q,M;S.parameters={...S.parameters,docs:{...(O=S.parameters)==null?void 0:O.docs,source:{originalSource:`{
  render: args => {
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(M=(Q=S.parameters)==null?void 0:Q.docs)==null?void 0:M.source}}};var R,q,T;N.parameters={...N.parameters,docs:{...(R=N.parameters)==null?void 0:R.docs,source:{originalSource:`{
  render: args => {
    action('activeQuery')(queryBuilderRemote.updateActiveQueryField(config.variant_exploration.app_id, {
      field: 'chromosome',
      value: ['Option1', 'Option4']
    }));
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(T=(q=N.parameters)==null?void 0:q.docs)==null?void 0:T.source}}};var z,L,U;A.parameters={...A.parameters,docs:{...(z=A.parameters)==null?void 0:z.docs,source:{originalSource:`{
  args: {
    searchVisible: false
  },
  render: args => {
    return <div className="space-y-6">
        <MultiSelectFilter {...args} />
      </div>;
  }
}`,...(U=(L=A.parameters)==null?void 0:L.docs)==null?void 0:U.source}}};const et=["Default","DataAppliedToQueryBuilder","HiddenSearch"];export{N as DataAppliedToQueryBuilder,S as Default,A as HiddenSearch,et as __namedExportsOrder,De as default};
