import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as d}from"./index-DQLiH3RP.js";import{B as M}from"./button-DsDgt4oh.js";import{R as m,q as j,M as w,D as J}from"./query-builder-remote-DQDcrGW9.js";import{u as oe}from"./applications-config-pyPLye2e.js";import{d as B,S as G,a as Q,b as z,c as H}from"./select-EcNoXCvM.js";import{I as k}from"./input-DyY2UfVx.js";import{C as ie}from"./checkbox-BPlUEr5r.js";import{L as ce}from"./label-BwU4_qxe.js";import{E as de,L as me,G as ue,a as pe,b as he,c as xe}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{u as fe}from"./i18n-CO6PNgAN.js";import{u as ve,o as _e}from"./index-n0DPRcfI.js";import{S as P}from"./skeleton-Shk8p_SP.js";function K({children:u}){return e.jsx("p",{className:"text-sm text-muted-foreground",children:u})}K.__docgenInfo={description:"",methods:[],displayName:"TextMuted",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""}}};const Ne=u=>_e.statisticsGermlineOccurrences(u.seqId,u.statisticsBody).then(n=>n.data);function Y(u,n,r=!1){const o={seqId:"1",statisticsBody:{field:u}},a=r?J:j.getResolvedActiveQuery(n);return a&&(o.statisticsBody.sqon={content:a.content,op:a.op}),ve(o,Ne,{revalidateOnFocus:!1})}function W(u,n,r,o){var N;let a=!1,h=m.LessThan,f="0",v="0",l="",S=!1;const p=n.content.find(c=>"content"in c&&"field"in c.content?c.content.field===u:!1),_=n.content.find(c=>"content"in c&&"field"in c.content?c.content.field===`${u}_unit`:!1);if(p){const c=p.content.value;if(console.log("[NumericalFilter] values",c),c.includes("__missing__"))return{hasUnappliedItems:a,selectedRange:h,minValue:f,maxValue:v,numericalValue:l,hasNoData:!0,selectedUnit:void 0};a=!0,c.length===2?(h=m.Between,f=Number(c[0]).toFixed(3),v=Number(c[1]).toFixed(3)):l=c[0],p.op&&(h=p.op)}else console.log("[NumericalFilter else] no filter exists",r),S=!1,(r==null?void 0:r.defaultMin)!==void 0?(f=r.defaultMin.toString(),l=r.defaultMin.toString()):(o==null?void 0:o.min)!==void 0&&(f=Number(o.min.toFixed(3)).toString(),l=Number(o.min.toFixed(3)).toString()),(r==null?void 0:r.defaultMax)!==void 0?v=r.defaultMax.toString():(o==null?void 0:o.max)!==void 0&&(v=Number(o.max.toFixed(3)).toString()),r!=null&&r.defaultOperator&&(h=m[r.defaultOperator]);return{hasUnappliedItems:a,selectedRange:h,minValue:f,maxValue:v,numericalValue:l,hasNoData:S,selectedUnit:_?_.content.value[0]:(N=r==null?void 0:r.rangeTypes)!=null&&N.length?r.rangeTypes[0].key:void 0}}function ye({field:u}){var U,q,A,D;const{t:n}=fe(),r=oe(),o=r.variant_exploration.app_id,a=u.key,h={[m.GreaterThan]:{display:n("common.filters.operators.greaterThan"),dropdown:n("common.filters.operators.greaterThan"),icon:xe},[m.LessThan]:{display:n("common.filters.operators.lessThan"),dropdown:n("common.filters.operators.lessThan"),icon:he},[m.Between]:{display:n("common.filters.operators.between"),dropdown:n("common.filters.operators.between"),icon:pe},[m.GreaterThanOrEqualTo]:{display:n("common.filters.operators.greaterThanOrEqual"),dropdown:n("common.filters.operators.greaterThanOrEqual"),icon:ue},[m.LessThanOrEqualTo]:{display:n("common.filters.operators.lessThanOrEqual"),dropdown:n("common.filters.operators.lessThanOrEqual"),icon:me},[m.In]:{display:n("common.filters.operators.in"),dropdown:n("common.filters.operators.in"),icon:de}},{data:f,isLoading:v}=Y(a,o,!0),{data:l,isLoading:S}=Y(a,o,!1),[p,_]=d.useState(m.GreaterThan),[N,c]=d.useState("0"),[T,b]=d.useState("0"),[E,I]=d.useState("0"),[O,R]=d.useState(!1),[y,X]=d.useState(),[Z,x]=d.useState(!1),C=r.variant_exploration.aggregations,s=(U=Object.values(C).flatMap(t=>t.items).find(t=>t.key===a))==null?void 0:U.defaults,g=u.type==="numerical"&&(s==null?void 0:s.noDataInputOption),$=(s==null?void 0:s.intervalDecimal)!==void 0&&((s==null?void 0:s.max)!==void 0||(s==null?void 0:s.min)!==void 0)||l&&(l.min!==void 0||l.max!==void 0),V=(s==null?void 0:s.min)??(l==null?void 0:l.min)??0,F=(s==null?void 0:s.max)??(l==null?void 0:l.max)??100,L=d.useCallback(()=>{const t=j.getResolvedActiveQuery(o);if(t!=null&&t.content){var i=W(a,t,s,l);R(i.hasNoData),I(i.minValue),b(i.maxValue),x(i.hasUnappliedItems),_(i.selectedRange),c(i.numericalValue)}},[o,a,s,l]);d.useEffect(()=>{L()},[L]);const ee=d.useCallback(t=>{_(t),x(!0)},[]),te=d.useCallback(t=>{R(t),x(!0)},[]),ae=d.useCallback(t=>{X(t),x(!0)},[]),se=()=>{x(!1);var t=W(a,J,s,f);R(t.hasNoData),I(t.minValue),b(t.maxValue),x(t.hasUnappliedItems),_(t.selectedRange),c(t.numericalValue)},ne=d.useCallback(()=>{if(x(!1),O){j.updateActiveQueryField(o,{field:a,value:["__missing__"],merge_strategy:w.OVERRIDE_VALUES});return}let t=[];t=p===m.Between?[parseFloat(E.toString()),parseFloat(T.toString())]:[parseFloat(N.toString())],j.updateActiveQueryField(o,{field:a,value:t,merge_strategy:w.OVERRIDE_VALUES,operator:p}),y&&j.updateActiveQueryField(o,{field:`${a}_unit`,value:[y],merge_strategy:w.OVERRIDE_VALUES})},[o,a,p,N,E,T,O,y]),re=Object.entries(m).map(([t,i])=>{if(i in h){const le=h[i].icon;return e.jsx(B,{value:i,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{size:16}),e.jsx("span",{children:h[i].dropdown})]})},i)}return null}).filter(Boolean);return e.jsxs("div",{className:"p-2 w-full max-w-md",id:`${a}_container`,children:[e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${a}_operator`,children:e.jsxs(G,{value:p,onValueChange:ee,children:[e.jsx(Q,{children:e.jsx(z,{placeholder:n("common.filters.operators.selectOperator"),children:h[p].display})}),e.jsx(H,{children:re})]})}),p===m.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(k,{className:"w-half",value:E,onChange:t=>{const i=t.target.value;isNaN(Number(i))||(I(i),x(!0))},min:V,max:F,id:`${a}_min`,"data-testid":`${a}_min`}),e.jsx(k,{className:"w-half",value:T,onChange:t=>{const i=t.target.value;isNaN(Number(i))||(b(i),x(!0))},min:V,max:F,id:`${a}_max`,"data-testid":`${a}_max`})]}):e.jsx(k,{className:"w-full",value:N,onChange:t=>{const i=t.target.value;isNaN(Number(i))||(c(i),x(!0))},min:V,max:F,id:`${a}_value`,"data-testid":`${a}_value`}),$&&e.jsx("div",{id:`${a}_interval`,children:e.jsxs(K,{children:[n("common.filters.labels.actualInterval")," : ",(q=l==null?void 0:l.min)==null?void 0:q.toFixed(3)," -"," ",(A=l==null?void 0:l.max)==null?void 0:A.toFixed(3)]})})]}),(s==null?void 0:s.rangeTypes)&&s.rangeTypes.length>0&&e.jsx("div",{id:`${a}_range_type_container`,children:S&&v?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-5 w-16 mb-1",id:`${a}_unit_label_skeleton`}),e.jsx(P,{className:"h-9 w-full",id:`${a}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"text-sm",id:`${a}_unit_label`,children:n("common.filters.labels.unit")}),e.jsxs(G,{defaultValue:y||s.rangeTypes[0].key,onValueChange:ae,children:[e.jsx(Q,{children:e.jsx(z,{placeholder:n("common.filters.labels.selectUnit"),children:((D=s.rangeTypes.find(t=>t.key===y))==null?void 0:D.name)||n("common.filters.labels.selectUnit")})}),e.jsx(H,{children:s.rangeTypes.map(t=>e.jsx(B,{value:t.key,children:t.name},t.key))})]})]})}),g&&!$&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden",id:`${a}_no_data_label`,children:[e.jsx(ie,{checked:O,onCheckedChange:te,id:`${a}_no_data`}),e.jsx("span",{children:n("common.filters.labels.noData")})]})]}),e.jsx("hr",{className:"my-4 border-border",id:`${a}_divider`}),e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(M,{size:"xs",variant:"ghost",onClick:se,disabled:!Z,id:`${a}_clear`,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(M,{size:"xs",className:"h-7",color:"primary",onClick:ne,id:`${a}_apply`,children:n("common.filters.buttons.apply")})})]})]})}ye.__docgenInfo={description:"",methods:[],displayName:"NumericalFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};export{ye as N};
