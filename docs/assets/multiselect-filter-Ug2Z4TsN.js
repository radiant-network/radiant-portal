import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{r as l}from"./index-CGj_12n1.js";import{A as W}from"./ActionButton-3Jbj_BdW.js";import{B as C}from"./button-DEZJFT95.js";import"./button.variants-BQkt_1YJ.js";import{C as G}from"./checkbox-CZhHNwpD.js";import{I as Q}from"./input-DyY2UfVx.js";import{S as H}from"./separator-6xmuS_PL.js";import{S as _}from"./skeleton-Shk8p_SP.js";import{u as J}from"./i18n-CA10OmEn.js";import{n as K}from"./number-format-DDJvc-iv.js";import{r as P}from"./string-format-D2CEWHqQ.js";import{u as X}from"./applications-config-viUeW4FZ.js";import{q as A,M as Y,T as N}from"./query-builder-remote-CEpj2hQD.js";import{u as Z}from"./use-aggregation-builder-CTDbLjr3.js";function V(u,r){const v=u.toLowerCase().split(/\s+/).filter(Boolean);return r.filter(c=>{const w=c.key.toLowerCase(),d=c.label.toLowerCase();function t(p,o){let f=0;for(const x of o){const j=p.indexOf(x,f);if(j===-1)return!1;f=j+x.length}return!0}return t(w,v)||t(d,v)})}function S(u,r){return r<u?r:u}function D({field:u,maxVisibleItems:r=5,searchVisible:v=!1}){const{t:c}=J(),d=X().variant_exploration.app_id,{data:t,isLoading:p}=Z(u.key,void 0,!0,d),[o,f]=l.useState(t||[]),[x,j]=l.useState([]),[i,h]=l.useState([]),[b,k]=l.useState(S(o.length,r)),[I,y]=l.useState(!1);l.useEffect(()=>{const n=A.getResolvedActiveQuery(d).content.find(e=>e.content.field===u.key);n?(h(n.content.value),y(!0)):h([]),t==null||t.sort((e,a)=>{const g=e.key&&i.includes(e.key),$=a.key&&i.includes(a.key);return g===$?a.count-e.count:g?-1:1}),t==null||t.forEach(e=>{e.label=e.key?P(e.key).replace(/\([^)]+\)|[^()]+/g,a=>a.startsWith("(")&&a.endsWith(")")?a:a.toLowerCase()).replace(/^\w/,a=>a.toUpperCase()):e.key}),f(t||[]),k(S((t==null?void 0:t.length)||0,r))},[t,d,u.key,r]);const E=l.useCallback(n=>{if(!n.trim()){f(t||[]),k(S((t==null?void 0:t.length)||0,r));return}const e=V(n,t);r>e.length?k(e.length):e.length>r&&k(r),f(e)},[t,r]),L=l.useCallback(()=>{k(o.length)},[b,o]),T=l.useCallback(()=>{k(r)},[b]),R=l.useCallback(()=>{i.length!==o.length&&(y(!0),h(o.map(n=>n.key)))},[o,i]),z=l.useCallback(()=>{i.length!==0&&(y(!0),h([]))},[i]),B=l.useCallback(n=>{let e=[];i.some(a=>a===n.key)?e=i.filter(a=>a!==n.key):e=[...i,n.key],y(!0),h(e)},[i]),M=l.useCallback(()=>{y(!1),h([...x])},[x]),m=l.useCallback(n=>{y(!1),j(i),A.updateActiveQueryField(d,{field:u.key,value:[...i],merge_strategy:Y.OVERRIDE_VALUES,operator:n})},[i,d,u.key]),O=l.useCallback(()=>{m(N.In)},[m]),U=l.useCallback(()=>{m(N.NotIn)},[m]),q=l.useCallback(()=>{m(N.All)},[m]),F=l.useCallback(()=>{m(N.In)},[m]);return s.jsxs("div",{className:"p-2 w-full max-w-md",children:[v&&s.jsx(Q,{type:"text",placeholder:c("common.filters.search.placeholder"),className:"w-full p-2 mb-2 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:n=>E(n.target.value),autoFocus:!0}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(C,{size:"sm",onClick:()=>R(),variant:"link",className:"px-0",children:c("common.filters.buttons.all")}),s.jsx(C,{size:"sm",onClick:()=>z(),variant:"link",className:"px-0",children:c("common.filters.buttons.none")})]}),s.jsx("div",{className:"max-h-[250px] overflow-auto",children:p?Array.from({length:3},(n,e)=>s.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[s.jsx(_,{className:"w-full h-6 rounded"}),s.jsx(_,{className:"h-6 w-12 rounded-md"})]},`skeleton-${e}`)):o.length===0?s.jsx("div",{className:"text-muted-foreground py-4",children:c("common.filters.no_values_found")}):Array.from({length:b},(n,e)=>s.jsx("div",{className:"gap-3 py-1.5",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("label",{className:"flex gap-2 overflow-hidden items-start py-0.5",children:[s.jsx(G,{className:"w-4 h-4 py-0.5",checked:i.some(a=>a===o[e].key),onCheckedChange:()=>B(o[e])}),s.jsx("div",{className:"overflow-hidden whitespace-normal break-words text-xs",children:c(`common.filters.labels.${u.key}_value.${o[e].key}`,{defaultValue:o[e].label})}),s.jsx("span",{className:"checkmark"})]}),s.jsx("span",{className:"bg-accent px-2 h-5 rounded-md text-xs flex items-center",children:K(o[e].count||0)})]})},o[e].key))}),!p&&o.length>b&&s.jsx(C,{className:"mt-2 px-0",onClick:L,size:"sm",variant:"link",children:c("common.filters.buttons.show_more",{count:o.length-r})}),!p&&b>r&&s.jsx(C,{className:"mt-2 px-0",onClick:T,size:"sm",variant:"link",children:c("common.filters.buttons.show_less")}),s.jsx(H,{className:"my-4 border-border",id:`${u.key}_divider`}),s.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[s.jsx(C,{size:"xs",variant:"ghost",onClick:M,disabled:!I||p,children:c("common.filters.buttons.clear")}),s.jsx("div",{className:"flex space-x-2",children:s.jsx(W,{size:"xs",className:"h-7",color:"primary",actions:[{label:c("common.filters.buttons.some_not_in"),onClick:F},{label:c("common.filters.buttons.all"),onClick:q},{label:c("common.filters.buttons.not_in"),onClick:U}],onDefaultAction:O,disabled:p,children:c("common.filters.buttons.apply")})})]})]})}D.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},searchVisible:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{D as M};
