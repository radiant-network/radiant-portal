import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as m}from"./index-CGj_12n1.js";import{A as oe,a as ie,o as ce}from"./use-aggregation-builder-CTDbLjr3.js";import{E as de,L as me,G as ue,a as pe,b as he,c as xe}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{B as M}from"./button-DmrUzutC.js";import{C as _e}from"./checkbox-CTcM57vQ.js";import{I as w}from"./input-DyY2UfVx.js";import{L as fe}from"./label-CnYaQ8j3.js";import{d as B,S as G,a as Q,b as z,c as P}from"./select-ISZjwlvT.js";import{S as Y}from"./skeleton-Shk8p_SP.js";import{u as ve}from"./i18n-B3yaVQvA.js";import{u as Ne}from"./applications-config-q4OA8PiL.js";import{R as u,q as b,M as k,D as W}from"./query-builder-remote-CEpj2hQD.js";function J({children:p}){return e.jsx("p",{className:"text-sm text-muted-foreground",children:p})}J.__docgenInfo={description:"",methods:[],displayName:"TextMuted",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""}}};const K="integer",ye=p=>ce.statisticsGermlineSNVOccurrences(p.seqId,p.statisticsBody).then(r=>r.data);function je(p,r,l,c=!1){const d={seqId:l,statisticsBody:{field:p}},t=c?W:b.getResolvedActiveQuery(r);return t&&(d.statisticsBody.sqon={content:t.content,op:t.op}),ie(d,ye,{revalidateOnFocus:!1})}function H(p,r,l,c){var y;let d=!1,t=u.LessThan,x="0",s="0",v="",j=!1;const h=(c==null?void 0:c.type)===K?0:3,f=r.content.find(i=>"content"in i&&"field"in i.content?i.content.field===p:!1),N=r.content.find(i=>"content"in i&&"field"in i.content?i.content.field===`${p}_unit`:!1);if(f){const i=f.content.value;if(console.log("[NumericalFilter] values",i),i.includes("__missing__"))return{hasUnappliedItems:d,selectedRange:t,minValue:x,maxValue:s,numericalValue:v,hasNoData:!0,selectedUnit:void 0};d=!0,i.length===2?(t=u.Between,x=Number(i[0]).toFixed(h),s=Number(i[1]).toFixed(h)):v=i[0],f.op&&(t=f.op)}else console.log("[NumericalFilter else] no filter exists",l),j=!1,(l==null?void 0:l.defaultMin)!==void 0?(x=l.defaultMin.toString(),v=l.defaultMin.toString()):(c==null?void 0:c.min)!==void 0&&(x=Number(c.min.toFixed(h)).toString(),v=Number(c.min.toFixed(h)).toString()),(l==null?void 0:l.defaultMax)!==void 0?s=l.defaultMax.toString():(c==null?void 0:c.max)!==void 0&&(s=Number(c.max.toFixed(h)).toString()),l!=null&&l.defaultOperator&&(t=u[l.defaultOperator]);return{hasUnappliedItems:d,selectedRange:t,minValue:x,maxValue:s,numericalValue:v,hasNoData:j,selectedUnit:N?N.content.value[0]:(y=l==null?void 0:l.rangeTypes)!=null&&y.length?l.rangeTypes[0].key:void 0}}function Se({field:p}){var L,q,D,U;const{t:r}=ve(),l=Ne(),{seqId:c}=m.useContext(oe),d=l.variant_exploration.app_id,t=p.key,x={[u.GreaterThan]:{display:r("common.filters.operators.greater_than"),dropdown:r("common.filters.operators.greater_than"),icon:xe},[u.LessThan]:{display:r("common.filters.operators.less_than"),dropdown:r("common.filters.operators.less_than"),icon:he},[u.Between]:{display:r("common.filters.operators.between"),dropdown:r("common.filters.operators.between"),icon:pe},[u.GreaterThanOrEqualTo]:{display:r("common.filters.operators.greater_than_or_equal"),dropdown:r("common.filters.operators.greater_than_or_equal"),icon:ue},[u.LessThanOrEqualTo]:{display:r("common.filters.operators.less_than_or_equal"),dropdown:r("common.filters.operators.less_than_or_equal"),icon:me},[u.In]:{display:r("common.filters.operators.in"),dropdown:r("common.filters.operators.in"),icon:de}},{data:s,isLoading:v}=je(t,d,c,!1),j=(s==null?void 0:s.type)===K?0:3,[h,f]=m.useState(u.GreaterThan),[N,y]=m.useState("0"),[i,T]=m.useState("0"),[E,I]=m.useState("0"),[V,R]=m.useState(!1),[S,X]=m.useState(),[Z,_]=m.useState(!1),C=l.variant_exploration.aggregations,n=(L=Object.values(C).flatMap(a=>a.items).find(a=>a.key===t))==null?void 0:L.defaults,g=p.type==="numerical"&&(n==null?void 0:n.noDataInputOption),A=(n==null?void 0:n.intervalDecimal)!==void 0&&((n==null?void 0:n.max)!==void 0||(n==null?void 0:n.min)!==void 0)||s&&(s.min!==void 0||s.max!==void 0),F=(n==null?void 0:n.min)??(s==null?void 0:s.min)??0,O=(n==null?void 0:n.max)??(s==null?void 0:s.max)??100,$=m.useCallback(()=>{const a=b.getResolvedActiveQuery(d);if(!(a!=null&&a.content))return;const o=H(t,a,n,s);R(o.hasNoData),I(o.minValue),T(o.maxValue),_(o.hasUnappliedItems),f(o.selectedRange??u.GreaterThan),y(o.numericalValue)},[d,t,n,s]);m.useEffect(()=>{$()},[$]);const ee=m.useCallback(a=>{f(a),_(!0)},[]),te=m.useCallback(a=>{R(a),_(!0)},[]),ae=m.useCallback(a=>{X(a),_(!0)},[]),ne=()=>{_(!1);const a=H(t,W,n,s);R(a.hasNoData),I(a.minValue),T(a.maxValue),_(a.hasUnappliedItems),f(a.selectedRange),y(a.numericalValue)},re=m.useCallback(()=>{if(_(!1),V){b.updateActiveQueryField(d,{field:t,value:["__missing__"],merge_strategy:k.OVERRIDE_VALUES});return}let a=[];a=h===u.Between?[parseFloat(E.toString()),parseFloat(i.toString())]:[parseFloat(N.toString())],b.updateActiveQueryField(d,{field:t,value:a,merge_strategy:k.OVERRIDE_VALUES,operator:h}),S&&b.updateActiveQueryField(d,{field:`${t}_unit`,value:[S],merge_strategy:k.OVERRIDE_VALUES})},[d,t,h,N,E,i,V,S]),se=Object.entries(u).map(([a,o])=>{if(o in x){const le=x[o].icon;return e.jsx(B,{value:o,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{size:16}),e.jsx("span",{children:x[o].dropdown})]})},o)}return null}).filter(Boolean);return e.jsxs("div",{className:"p-2 w-full max-w-md",id:`${t}_container`,children:[e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${t}_operator`,children:e.jsxs(G,{value:h,onValueChange:ee,children:[e.jsx(Q,{children:e.jsx(z,{placeholder:r("common.filters.operators.select_operator"),children:x[h].display})}),e.jsx(P,{children:se})]})}),h===u.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(w,{className:"w-half",value:E,onChange:a=>{const o=a.target.value;isNaN(Number(o))||(I(o),_(!0))},min:F,max:O,id:`${t}_min`,"data-testid":`${t}_min`}),e.jsx(w,{className:"w-half",value:i,onChange:a=>{const o=a.target.value;isNaN(Number(o))||(T(o),_(!0))},min:F,max:O,id:`${t}_max`,"data-testid":`${t}_max`})]}):e.jsx(w,{className:"w-full",value:N,onChange:a=>{const o=a.target.value;isNaN(Number(o))||(y(o),_(!0))},min:F,max:O,id:`${t}_value`,"data-testid":`${t}_value`}),A&&e.jsx("div",{id:`${t}_interval`,children:e.jsxs(J,{children:[r("common.filters.labels.actual_interval")," : ",(q=s==null?void 0:s.min)==null?void 0:q.toFixed(j)," -"," ",(D=s==null?void 0:s.max)==null?void 0:D.toFixed(j)]})})]}),(n==null?void 0:n.rangeTypes)&&n.rangeTypes.length>0&&e.jsx("div",{id:`${t}_range_type_container`,children:v?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-5 w-16 mb-1",id:`${t}_unit_label_skeleton`}),e.jsx(Y,{className:"h-9 w-full",id:`${t}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"text-sm",id:`${t}_unit_label`,children:r("common.filters.labels.unit")}),e.jsxs(G,{defaultValue:S||n.rangeTypes[0].key,onValueChange:ae,children:[e.jsx(Q,{children:e.jsx(z,{placeholder:r("common.filters.labels.select_unit"),children:((U=n.rangeTypes.find(a=>a.key===S))==null?void 0:U.name)||r("common.filters.labels.select_unit")})}),e.jsx(P,{children:n.rangeTypes.map(a=>e.jsx(B,{value:a.key,children:a.name},a.key))})]})]})}),g&&!A&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden",id:`${t}_no_data_label`,children:[e.jsx(_e,{checked:V,onCheckedChange:te,id:`${t}_no_data`}),e.jsx("span",{children:r("common.filters.labels.no_data")})]})]}),e.jsx("hr",{className:"my-4 border-border",id:`${t}_divider`}),e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(M,{size:"xs",variant:"ghost",onClick:ne,disabled:!Z,id:`${t}_clear`,children:r("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(M,{size:"xs",className:"h-7",color:"primary",onClick:re,id:`${t}_apply`,children:r("common.filters.buttons.apply")})})]})]})}Se.__docgenInfo={description:"",methods:[],displayName:"NumericalFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};export{Se as N};
