import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{r as p}from"./index-CGj_12n1.js";import{u as M,c as z}from"./api-Bgk4f9pC.js";import{F as O}from"./filter-button-Cf601rol.js";import{B as P}from"./button-DdJjyXh7.js";import{u as I}from"./i18n-CzLTciQL.js";import{S}from"./skeleton-Shk8p_SP.js";import{g as U,C as B,a as G,b as X,c as J,d as Q}from"./command-3_OtwHJd.js";import{X as R}from"./x-CubKniSv.js";import{S as W}from"./search-DqA1hdnz.js";import{T as K}from"./test-tube-diagonal-U7YTje3f.js";import{c as T}from"./createLucideIcon-8Lr1oLzj.js";import{U as Y}from"./user-CZ8KFWeE.js";import{L as Z}from"./list-filter-DyVHreeM.js";import{P as ee}from"./priority-indicator-Bspfq1w_.js";import{C as te,R as se,H as ae,F as re}from"./refresh-ccw-Bwg-o3xn.js";import{C as ne}from"./check-DRc1RmCY.js";import{P as oe}from"./pen-BVjgPDnY.js";/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],le=T("Barcode",ie);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],N=T("FolderOpen",ce);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],pe=T("OctagonX",ue);function de(t){return{case_id:N,patient_id:Y,mrn:le,request_id:K}[t.toLowerCase()]||N}async function me(t,a){if(!t||t.length<a)return{};const e=await z.autocompleteCases(t,"10");return e!=null&&e.data&&e.data.length>0?e.data.reduce((r,i)=>(r[i.type]||(r[i.type]=[]),r[i.type].push(i),r),{}):{}}function V({onSelect:t,onClear:a,selectedValue:e,placeholder:l,minSearchLength:r=3}){const{t:i}=I(),[c,h]=p.useState(""),[g,d]=p.useState(""),[_,y]=p.useState(!1);p.useEffect(()=>{h(e||"")},[e]),p.useEffect(()=>{const u=setTimeout(()=>{d(c)},300);return y(!0),()=>clearTimeout(u)},[c]);const{data:f}=M(g&&g.length>=r?g:null,u=>u?me(u,r):Promise.resolve({}),{revalidateOnFocus:!1,dedupingInterval:300}),o=p.useCallback((u,b)=>{const j=b.trim();t(u,j),h(j),y(!1)},[t]),m=p.useCallback(()=>{h(""),a==null||a()},[a]),w=f&&Object.keys(f).length>0;return s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"text-sm font-medium text-foreground h-[14px] mb-[8px]",children:i("case_exploration.filters_group.search_by_id")}),s.jsxs(U,{className:"relative h-8 w-[260px] overflow-visible",shouldFilter:!1,children:[s.jsx(B,{className:"px-[6px]",wrapperClassName:"focus-within:ring-primary focus-visible:outline-none focus-visible:ring-ring focus-visible:ring-offset-0 [&:has(:focus-visible)]:ring-1",placeholder:l,leftAddon:s.jsx(W,{size:16}),rightAddon:c.length>0&&s.jsx(R,{onClick:m,size:16}),value:c,onValueChange:h,onFocus:()=>{y(!0)},onBlur:()=>setTimeout(()=>y(!1),100)}),_&&c.length>0&&s.jsxs(G,{className:"absolute max-h-[240px] left-0 top-full z-50 mt-1 w-full overflow-auto rounded-md border bg-background shadow-lg",onMouseDown:u=>u.preventDefault(),children:[!w&&s.jsx(X,{children:i("common.table.filters.no_values_found")}),w&&Object.keys(f||{}).map(u=>s.jsxs(s.Fragment,{children:[Object.keys(f||{}).indexOf(u)!==0&&s.jsx("hr",{className:"w-full h-px bg-border"}),s.jsx(J,{heading:s.jsx("span",{className:"h-[28px] &:not(:first-child)]:bg-border",children:i(`common.table.filters.search.${u}`,u.toUpperCase())}),children:((f==null?void 0:f[u])||[]).map(b=>{const j=de(b.type);return s.jsxs(Q,{className:"h-[32px]",value:`${b.value}::${u}`,onSelect:C=>{o(b.type,C.split("::")[0])},children:[s.jsx(j,{size:16,className:"text-muted-foreground"}),s.jsx("span",{children:b.value})]},b.value)})},u)]}))]})]})]})}V.__docgenInfo={description:"",methods:[],displayName:"TableFiltersSearch",props:{placeholder:{required:!1,tsType:{name:"string"},description:""},onSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: string, value: string) => void",signature:{arguments:[{type:{name:"string"},name:"type"},{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},selectedValue:{required:!1,tsType:{name:"string"},description:""},minSearchLength:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"3",computed:!1}}}};function F(t){return t.sort((a,e)=>a.label.localeCompare(e.label))}function fe(t,a){const e=[];for(const l in a)t[l].length>0&&e.push({field:a[l].key,value:t[l]});return e}function he({filterSearchs:t,visibleFilters:a}){return s.jsxs("div",{className:"flex flex-col justify-start gap-2 min-w-[400px] h-[48px]",children:[s.jsx(S,{className:"w-[120px] h-[24px]"}),s.jsxs("div",{className:"flex gap-2 h-[32px]",children:[t==null?void 0:t.map(e=>s.jsx(S,{className:"w-[260px] h-full"},e.id)),Object.keys(a).map(e=>s.jsx(S,{className:"w-[100px] h-full"},e)),s.jsx(S,{className:"w-[75px] h-full"})]})]})}function D({loading:t=!1,openFilters:a,setOpenFilters:e,visibleFilters:l,filters:r,setFilters:i,changedFilterButtons:c,setChangedFilterButtons:h,setSearchCriteria:g,filterButtons:d,filterSearchs:_,criterias:y,defaultFilters:f,defaultSearchFilters:o={}}){const{t:m}=I(),w=p.useCallback((n,x)=>{i({...r,[n]:x})},[r,i]),u=p.useMemo(()=>d.filter(n=>!n.isVisible),[d]),b=d.some(n=>n.selectedItems.length>0)||c.length>0,j=()=>{i({...f,...o}),h([]),e({})},C=p.useCallback(n=>{h([...c,...n.filter(v=>!c.includes(v))]);const x=n.reduce((v,k)=>(v[k]=!0,v),{});e({...a,...x})},[]),$=p.useCallback((n,x)=>{const v={...r,...o};i({...v,[n]:[x]})},[r,i]),H=p.useCallback(()=>{i({...r,...o})},[r,i]);return p.useEffect(()=>{g(fe(r,y))},[r,g]),t?s.jsx(he,{filterSearchs:_,visibleFilters:l}):s.jsxs("div",{id:"table-filters",className:"py-0 flex flex-2 flex-wrap gap-2 items-button",children:[_==null?void 0:_.map(({id:n,searchTerm:x,placeholder:v,minSearchLength:k})=>s.jsx(V,{onSelect:$,onClear:H,selectedValue:x,placeholder:v,minSearchLength:k},`table-filter-search-${n}`)),s.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[d.filter(n=>n.isVisible).sort((n,x)=>y[n.key].weight-y[x.key].weight).map(n=>s.jsx(O,{popoverSize:n.popoverSize,label:n.label,options:n.options,selected:n.selectedItems,onSelect:x=>w(n.key,x),isOpen:n.isOpen,withTooltip:n.withTooltip},n.key)),u.length>0&&s.jsx(O,{label:m("common.filters.more","More"),options:u,selected:[],onSelect:C,actionMode:!0,icon:s.jsx(Z,{size:16}),placeholder:m("common.table.filters.more_placeholder","Filters"),closeOnSelect:!0}),b&&s.jsxs(P,{variant:"link",onClick:j,className:"text-sm py-2 px-3 h-8",children:[s.jsx(R,{size:14}),m("common.actions.clear","Clear")]})]})]})}D.__docgenInfo={description:`Controlled component

His parent component must manage all different filter states, useState`,methods:[],displayName:"DataTableFilters",props:{loading:{defaultValue:{value:"false",computed:!1},required:!1},defaultSearchFilters:{defaultValue:{value:"{}",computed:!1},required:!1}}};function ge(t,a){const[e,l]=p.useState(()=>{if(typeof window>"u")return a;try{const r=localStorage.getItem(t);return r?JSON.parse(r):a}catch{return a}});return p.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(e))}catch{}},[t,e]),[e,l]}const q=["routine","urgent","asap","stat"];function xe(t){return t.sort((e,l)=>{var c,h;const r=q.indexOf(((c=e.key)==null?void 0:c.toLowerCase())||""),i=q.indexOf(((h=l.key)==null?void 0:h.toLowerCase())||"");return r!==-1&&i!==-1?r-i:r!==-1?-1:i!==-1?1:0}).map(e=>({...e,label:s.jsx(ee,{size:"sm",code:e.key})}))}function ye(t){return{draft:oe,"on-hold":ae,active:se,completed:ne,incomplete:te,revoke:pe}[t.toLowerCase()]||re}function be(t,a){const e="case_exploration.status";return t.map(l=>({...l,label:a(`${e}.${l.key}`,l.label||""),icon:ye(l.key||"")}))}const A=["priority","status","case_analysis"],_e={priority:{key:"priority_code",weight:1},status:{key:"status_code",weight:2},case_analysis:{key:"case_analysis_code",weight:3},project:{key:"project_code",weight:3},performer_lab:{key:"performer_lab_code",weight:4},requested_by:{key:"requested_by_code",weight:5},case_id:{key:"case_id",weight:6},patient_id:{key:"patient_id",weight:7},mrn:{key:"mrn",weight:8},request_id:{key:"request_id",weight:9}};async function ve(t){return(await z.casesFilters(t)).data}const E={priority:[],status:[],case_analysis:[],project:[],performer_lab:[],requested_by:[]},L={case_id:[],patient_id:[],mrn:[],request_id:[]};function we({loading:t=!0,setSearchCriteria:a}){const[e,l]=p.useState([]),[r,i]=p.useState({}),[c,h]=ge("case-exploration-filters",{...E,...L}),{t:g}=I(),{data:d}=M("case-filters",()=>ve({search_criteria:[]}),{revalidateOnFocus:!1,revalidateOnMount:!0,revalidateIfStale:!1,revalidateOnReconnect:!1}),_=p.useMemo(()=>d?Object.keys(d).map(o=>{const m={key:o,label:g(`case_exploration.case.filters.${o}`),isVisible:A.includes(o),isOpen:r[o]||!1,selectedItems:c[o]||[],options:[]};switch(o){case"status":return{...m,options:F(be(d[o]||[],g))};case"project":case"performer_lab":case"requested_by":return{...m,popoverSize:"lg",isVisible:c[o]&&c[o].length>0||e.includes(o)||!1,options:F(d[o]||[]),withTooltip:!0};case"priority":return{...m,options:xe(d[o]||[])};case"case_analysis":return{...m,options:F(d[o]||[]),popoverSize:"lg",withTooltip:!0};default:return m}}).filter(o=>o.options.length>0):[],[d,c,e,r,g]),f=(()=>{const o=["case_id","patient_id","mrn","assay_id"];for(const m of o){const w=c[m]||[];if(w.length>0)return{type:m,value:w[0]}}return null})();return s.jsx(D,{visibleFilters:A,filterSearchs:[{id:"search",searchTerm:f==null?void 0:f.value,placeholder:g("case_exploration.filters_group.search_placeholder"),minSearchLength:1}],filterButtons:_,changedFilterButtons:e,setChangedFilterButtons:l,filters:c,setFilters:h,openFilters:r,setOpenFilters:i,loading:t,setSearchCriteria:a,criterias:_e,defaultFilters:E,defaultSearchFilters:L})}we.__docgenInfo={description:"",methods:[],displayName:"FiltersGroupForm",props:{loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},setSearchCriteria:{required:!0,tsType:{name:"signature",type:"function",raw:"(searchCriteria: SearchCriterion[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"SearchCriterion"}],raw:"SearchCriterion[]"},name:"searchCriteria"}],return:{name:"void"}}},description:""}}};export{we as F};
