import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as m}from"./index-CGj_12n1.js";import{u as oe,o as ie}from"./api-Bgk4f9pC.js";import{E as ce,L as de,G as me,a as ue,b as pe,c as xe}from"./less-than-or-equal-operator-icon-BI5aNTvi.js";import{c as he}from"./index-C66Dxnp2.js";import{B as q}from"./button-C9LBm9DC.js";import{d as fe,e as _e}from"./card-BdbO89L0.js";import{C as ve}from"./checkbox-B0xIRynn.js";import{I as k}from"./input-CUZJ9Qyj.js";import{L as Ne}from"./label-CnYaQ8j3.js";import{d as B,S as G,a as z,b as Q,c as P}from"./select-CvMCtLHe.js";import{S as Y}from"./skeleton-Shk8p_SP.js";import{A as je}from"./use-aggregation-builder-M8Os28Pp.js";import{u as ye}from"./i18n-Dl9M4sbZ.js";import{u as be}from"./applications-config-q4OA8PiL.js";import{R as u,q as E,M as w,D as W}from"./query-builder-remote-CKam2jCw.js";const Se=he({slots:{base:"text-muted-foreground"},variants:{size:{xs:{base:"text-xs"},sm:{base:"text-sm"}}},defaultVariants:{size:"sm"}});function J({className:p,size:n,children:l}){const i=Se({size:n});return e.jsx("p",{className:i.base({className:p}),children:l})}J.__docgenInfo={description:"",methods:[],displayName:"TextMuted"};const K="integer",Ee=p=>ie.statisticsGermlineSNVOccurrences(p.seqId,p.statisticsBody).then(n=>n.data);function Te(p,n,l,i=!1){const d={seqId:l,statisticsBody:{field:p}},a=i?W:E.getResolvedActiveQuery(n);return a&&(d.statisticsBody.sqon={content:a.content,op:a.op}),oe(d,Ee,{revalidateOnFocus:!1})}function H(p,n,l,i){var y;let d=!1,a=u.LessThan,h="0",r="0",v="",b=!1;const x=(i==null?void 0:i.type)===K?0:3,_=n.content.find(c=>"content"in c&&"field"in c.content?c.content.field===p:!1),N=n.content.find(c=>"content"in c&&"field"in c.content?c.content.field===`${p}_unit`:!1);if(_){const c=_.content.value;if(console.log("[NumericalFilter] values",c),c.includes("__missing__"))return{hasUnappliedItems:d,selectedRange:a,minValue:h,maxValue:r,numericalValue:v,hasNoData:!0,selectedUnit:void 0};d=!0,c.length===2?(a=u.Between,h=Number(c[0]).toFixed(x),r=Number(c[1]).toFixed(x)):v=c[0],_.op&&(a=_.op)}else console.log("[NumericalFilter else] no filter exists",l),b=!1,(l==null?void 0:l.defaultMin)!==void 0?(h=l.defaultMin.toString(),v=l.defaultMin.toString()):(i==null?void 0:i.min)!==void 0&&(h=Number(i.min.toFixed(x)).toString(),v=Number(i.min.toFixed(x)).toString()),(l==null?void 0:l.defaultMax)!==void 0?r=l.defaultMax.toString():(i==null?void 0:i.max)!==void 0&&(r=Number(i.max.toFixed(x)).toString()),l!=null&&l.defaultOperator&&(a=u[l.defaultOperator]);let j;return N&&N.content.value[0]&&((y=l==null?void 0:l.rangeTypes)!=null&&y.length)&&(j=l.rangeTypes[0].key),{hasUnappliedItems:d,selectedRange:a,minValue:h,maxValue:r,numericalValue:v,hasNoData:b,selectedUnit:j}}function Ve({field:p}){var L,D,M,U;const{t:n}=ye(),l=be(),{seqId:i}=m.useContext(je),d=l.variant_exploration.app_id,a=p.key,h={[u.GreaterThan]:{display:n("common.filters.operators.greater_than"),dropdown:n("common.filters.operators.greater_than"),icon:xe},[u.LessThan]:{display:n("common.filters.operators.less_than"),dropdown:n("common.filters.operators.less_than"),icon:pe},[u.Between]:{display:n("common.filters.operators.between"),dropdown:n("common.filters.operators.between"),icon:ue},[u.GreaterThanOrEqualTo]:{display:n("common.filters.operators.greater_than_or_equal"),dropdown:n("common.filters.operators.greater_than_or_equal"),icon:me},[u.LessThanOrEqualTo]:{display:n("common.filters.operators.less_than_or_equal"),dropdown:n("common.filters.operators.less_than_or_equal"),icon:de},[u.In]:{display:n("common.filters.operators.in"),dropdown:n("common.filters.operators.in"),icon:ce}},{data:r,isLoading:v}=Te(a,d,i,!1),b=(r==null?void 0:r.type)===K?0:3,[x,_]=m.useState(u.GreaterThan),[N,j]=m.useState("0"),[y,c]=m.useState("0"),[T,V]=m.useState("0"),[I,F]=m.useState(!1),[S,X]=m.useState(),[Z,f]=m.useState(!1),C=l.variant_exploration.aggregations,s=(L=Object.values(C).flatMap(t=>t.items).find(t=>t.key===a))==null?void 0:L.defaults,g=p.type==="numerical"&&(s==null?void 0:s.noDataInputOption),A=(s==null?void 0:s.intervalDecimal)!==void 0&&((s==null?void 0:s.max)!==void 0||(s==null?void 0:s.min)!==void 0)||r&&(r.min!==void 0||r.max!==void 0),R=(s==null?void 0:s.min)??(r==null?void 0:r.min)??0,O=(s==null?void 0:s.max)??(r==null?void 0:r.max)??100,$=m.useCallback(()=>{const t=E.getResolvedActiveQuery(d);if(!(t!=null&&t.content))return;const o=H(a,t,s,r);F(o.hasNoData),V(o.minValue),c(o.maxValue),f(o.hasUnappliedItems),_(o.selectedRange??u.GreaterThan),j(o.numericalValue)},[d,a,s,r]);m.useEffect(()=>{$()},[$]);const ee=m.useCallback(t=>{_(t),f(!0)},[]),te=m.useCallback(t=>{F(t),f(!0)},[]),ae=m.useCallback(t=>{X(t),f(!0)},[]),ne=()=>{f(!1);const t=H(a,W,s,r);F(t.hasNoData),V(t.minValue),c(t.maxValue),f(t.hasUnappliedItems),_(t.selectedRange),j(t.numericalValue)},se=m.useCallback(()=>{if(f(!1),I){E.updateActiveQueryField(d,{field:a,value:["__missing__"],merge_strategy:w.OVERRIDE_VALUES});return}let t=[];t=x===u.Between?[parseFloat(T.toString()),parseFloat(y.toString())]:[parseFloat(N.toString())],E.updateActiveQueryField(d,{field:a,value:t,merge_strategy:w.OVERRIDE_VALUES,operator:x}),S&&E.updateActiveQueryField(d,{field:`${a}_unit`,value:[S],merge_strategy:w.OVERRIDE_VALUES})},[d,a,x,N,T,y,I,S]),re=Object.entries(u).map(([t,o])=>{if(o in h){const le=h[o].icon;return e.jsx(B,{value:o,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{size:16}),e.jsx("span",{children:h[o].dropdown})]})},o)}return null}).filter(Boolean);return e.jsxs(e.Fragment,{children:[e.jsx(fe,{id:`${a}_container`,size:"sm",variant:"outline",children:e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{id:`${a}_operator`,children:e.jsxs(G,{value:x,onValueChange:ee,children:[e.jsx(z,{size:"sm",children:e.jsx(Q,{placeholder:n("common.filters.operators.select_operator"),children:h[x].display})}),e.jsx(P,{children:re})]})}),x===u.Between?e.jsxs("div",{className:"flex gap-2 flex-row",children:[e.jsx(k,{variant:"facet",className:"w-half",value:T,onChange:t=>{const o=t.target.value;isNaN(Number(o))||(V(o),f(!0))},min:R,max:O,id:`${a}_min`,"data-testid":`${a}_min`}),e.jsx(k,{variant:"facet",className:"w-half",value:y,onChange:t=>{const o=t.target.value;isNaN(Number(o))||(c(o),f(!0))},min:R,max:O,id:`${a}_max`,"data-testid":`${a}_max`})]}):e.jsx(k,{variant:"facet",className:"w-full",value:N,onChange:t=>{const o=t.target.value;isNaN(Number(o))||(j(o),f(!0))},min:R,max:O,id:`${a}_value`,"data-testid":`${a}_value`}),A&&e.jsx("div",{id:`${a}_interval`,children:e.jsxs(J,{size:"xs",children:[n("common.filters.labels.actual_interval")," : ",(D=r==null?void 0:r.min)==null?void 0:D.toFixed(b)," -"," ",(M=r==null?void 0:r.max)==null?void 0:M.toFixed(b)]})})]}),(s==null?void 0:s.rangeTypes)&&s.rangeTypes.length>0&&e.jsx("div",{id:`${a}_range_type_container`,children:v?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-5 w-16 mb-1",id:`${a}_unit_label_skeleton`}),e.jsx(Y,{className:"h-9 w-full",id:`${a}_select_skeleton`})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"text-sm",id:`${a}_unit_label`,children:n("common.filters.labels.unit")}),e.jsxs(G,{defaultValue:S||s.rangeTypes[0].key,onValueChange:ae,children:[e.jsx(z,{children:e.jsx(Q,{placeholder:n("common.filters.labels.select_unit"),children:((U=s.rangeTypes.find(t=>t.key===S))==null?void 0:U.name)||n("common.filters.labels.select_unit")})}),e.jsx(P,{children:s.rangeTypes.map(t=>e.jsx(B,{value:t.key,children:t.name},t.key))})]})]})}),g&&!A&&e.jsxs("label",{className:"flex items-center space-x-2 overflow-hidden",id:`${a}_no_data_label`,children:[e.jsx(ve,{checked:I,onCheckedChange:te,id:`${a}_no_data`}),e.jsx("span",{children:n("common.filters.labels.no_data")})]})]})}),e.jsx(_e,{size:"sm",children:e.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[e.jsx(q,{size:"xxs",variant:"ghost",onClick:ne,disabled:!Z,id:`${a}_clear`,children:n("common.filters.buttons.clear")}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(q,{size:"xxs",variant:"outline",onClick:se,id:`${a}_apply`,children:n("common.filters.buttons.apply")})})]})})]})}Ve.__docgenInfo={description:"",methods:[],displayName:"NumericalFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""}}};export{Ve as N};
