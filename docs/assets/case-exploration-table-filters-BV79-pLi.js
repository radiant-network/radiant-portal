import{j as n}from"./jsx-runtime-D_zvdyIk.js";import{r as u}from"./index-CGj_12n1.js";import{u as L,c as P}from"./api-Dbaoo8nA.js";import{F as T}from"./filter-button-CiHnVZ_E.js";import{B as H}from"./button-CZ0IdblP.js";import{u as F}from"./i18n-CzVYxKjz.js";import{S as k}from"./skeleton-Shk8p_SP.js";import{g as G,C as U,a as X,b as J,c as W,d as B}from"./command-3_OtwHJd.js";import{X as V}from"./x-CubKniSv.js";import{S as K}from"./search-DqA1hdnz.js";import{T as Q}from"./test-tube-diagonal-U7YTje3f.js";import{c as I}from"./createLucideIcon-8Lr1oLzj.js";import{U as Y}from"./user-CZ8KFWeE.js";import{L as Z}from"./list-filter-DyVHreeM.js";import{P as ee}from"./priority-indicator-McYPb4VM.js";import{F as A,C as te,R as se,H as ne}from"./refresh-ccw-Bwg-o3xn.js";import{C as ae}from"./check-DRc1RmCY.js";import{P as oe}from"./pen-BVjgPDnY.js";/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],ie=I("Barcode",re);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],N=I("FolderOpen",le);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ue=I("OctagonX",ce);function pe(e){return{case_id:N,patient_id:Y,mrn:ie,request_id:Q}[e.toLowerCase()]||N}async function me(e,s,t){if(!e||e.length<s)return{};const a=await t(e,"10");return!(a!=null&&a.data)||a.data.length===0?{}:a.data.reduce((l,i)=>(l[i.type]||(l[i.type]=[]),l[i.type].push(i),l),{})}function E({onSelect:e,onClear:s,selectedValue:t,placeholder:a,minSearchLength:o=3,api:l}){const{t:i}=F(),[h,d]=u.useState(""),[p,f]=u.useState(""),[c,g]=u.useState(!1);u.useEffect(()=>{d(t||"")},[t]),u.useEffect(()=>{const m=setTimeout(()=>{f(h)},300);return()=>clearTimeout(m)},[h]);const{data:b}=L(p&&p.length>=o?p:null,m=>m?me(m,o,l):Promise.resolve({}),{revalidateOnFocus:!1,dedupingInterval:300}),w=u.useCallback((m,y)=>{const v=y.trim();e(m,v),d(v),g(!1)},[e]),C=u.useCallback(()=>{d(""),s==null||s()},[s]),_=b&&Object.keys(b).length>0;return n.jsxs("div",{className:"flex flex-col",children:[n.jsx("label",{className:"text-sm font-medium text-foreground h-[14px] mb-[8px]",children:i("case_exploration.filters_group.search_by_id")}),n.jsxs(G,{className:"relative h-8 w-[260px] overflow-visible",shouldFilter:!1,children:[n.jsx(U,{className:"px-[6px]",wrapperClassName:"focus-within:ring-primary focus-visible:outline-none focus-visible:ring-ring focus-visible:ring-offset-0 [&:has(:focus-visible)]:ring-1",placeholder:a,leftAddon:n.jsx(K,{size:16}),rightAddon:h.length>0&&n.jsx(V,{onClick:C,size:16}),value:h,onValueChange:d,onFocus:()=>{g(!0)},onBlur:()=>setTimeout(()=>g(!1),100)}),c&&h.length>0&&n.jsxs(X,{className:"absolute max-h-[240px] left-0 top-full z-50 mt-1 w-full overflow-auto rounded-md border bg-background shadow-lg",onMouseDown:m=>m.preventDefault(),children:[!_&&n.jsx(J,{children:i("common.table.filters.no_values_found")}),_&&Object.keys(b||{}).map(m=>n.jsxs(n.Fragment,{children:[Object.keys(b||{}).indexOf(m)!==0&&n.jsx("hr",{className:"w-full h-px bg-border"}),n.jsx(W,{heading:n.jsx("span",{className:"h-[28px] &:not(:first-child)]:bg-border",children:i(`common.table.filters.search.${m}`,m.toUpperCase())}),children:((b==null?void 0:b[m])||[]).map(y=>{const v=pe(y.type);return n.jsxs(B,{className:"h-[32px]",value:`${y.value}::${m}`,onSelect:r=>{w(y.type,r.split("::")[0])},children:[n.jsx(v,{size:16,className:"text-muted-foreground"}),n.jsx("span",{children:y.value})]},y.value)})},m)]}))]})]})]})}E.__docgenInfo={description:"",methods:[],displayName:"TableFiltersSearch",props:{placeholder:{required:!1,tsType:{name:"string"},description:""},onSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: string, value: string) => void",signature:{arguments:[{type:{name:"string"},name:"type"},{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},selectedValue:{required:!1,tsType:{name:"string"},description:""},minSearchLength:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"3",computed:!1}},api:{required:!0,tsType:{name:"signature",type:"function",raw:`(
  prefix: string,
  limit?: string,
  options?: RawAxiosRequestConfig,
) => Promise<AxiosResponse<AutocompleteResult[]>>`,signature:{arguments:[{type:{name:"string"},name:"prefix"},{type:{name:"string"},name:"limit"},{type:{name:"RawAxiosRequestConfig"},name:"options"}],return:{name:"Promise",elements:[{name:"AxiosResponse",elements:[{name:"Array",elements:[{name:"AutocompleteResult"}],raw:"AutocompleteResult[]"}],raw:"AxiosResponse<AutocompleteResult[]>"}],raw:"Promise<AxiosResponse<AutocompleteResult[]>>"}}},description:""}}};function O(e){return e.sort((s,t)=>s.label.localeCompare(t.label))}function de(e){return Object.keys(e).filter(s=>e[s].visible)}function fe(e,s){const t=[],a=Object.keys(s);for(const o in e)if(e[o].length!==0){if(a.includes(o)){t.push({field:s[o].key,value:e[o]});continue}t.push({field:o,value:e[o]})}return t}function R(e,s){const t={};for(const a in e)Object.keys(s).includes(a)&&(t[a]=e[a]);return t}function he(e,s){for(const t in e)if(!Object.keys(s).includes(t)&&e[t].length>0)return e[t][0]}function ge({filterSearch:e,visibleFilters:s}){return n.jsxs("div",{className:"flex flex-col justify-start gap-2 min-w-[400px] h-[48px]",children:[n.jsx(k,{className:"w-[120px] h-[24px]"}),n.jsxs("div",{className:"flex gap-2 h-[32px]",children:[e&&n.jsx(k,{className:"w-[260px] h-full"}),Object.keys(s).map(t=>n.jsx(k,{className:"w-[100px] h-full"},t)),n.jsx(k,{className:"w-[75px] h-full"})]})]})}function D({loading:e=!1,openFilters:s,setOpenFilters:t,filters:a,setFilters:o,changedFilterButtons:l,setChangedFilterButtons:i,setSearchCriteria:h,filterButtons:d,filterSearch:p,criterias:f,defaultFilters:c}){const{t:g}=F(),b=u.useCallback((r,x)=>{o({...a,[r]:x})},[a,o]),w=u.useMemo(()=>d.filter(r=>!r.isVisible),[d]),C=d.some(r=>r.selectedItems.length>0)||l.length>0,_=()=>{o(c),i([]),t({})},m=u.useCallback(r=>{const x=[...l,...r.filter(j=>!l.includes(j))];i(x);const S=r.reduce((j,$)=>(j[$]=!0,j),{});t({...s,...S})},[]),y=u.useCallback((r,x)=>{o({...R(a,f),[r]:[x]})},[a,o]),v=u.useCallback(()=>{o(R(a,f))},[a,o]);return u.useEffect(()=>{h(fe(a,f))},[a,h]),e?n.jsx(ge,{filterSearch:p,visibleFilters:Object.keys(f).filter(r=>f[r].visible)}):n.jsxs("div",{id:"table-filters",className:"py-0 flex flex-2 flex-wrap gap-2 items-button",children:[p&&n.jsx(E,{onSelect:y,onClear:v,selectedValue:he(a,f),placeholder:p.placeholder,minSearchLength:p.minSearchLength,api:p.api}),n.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[d.filter(r=>r.isVisible).sort((r,x)=>{const S=Math.max(...Object.keys(f).map(j=>f[j].weight??-1));return(f[r.key].weight??S+l.indexOf(r.key))-(f[x.key].weight??S+l.indexOf(x.key))}).map(r=>n.jsx(T,{popoverSize:r.popoverSize,label:r.label,options:r.options,selected:r.selectedItems,onSelect:x=>b(r.key,x),isOpen:r.isOpen,withTooltip:r.withTooltip},r.key)),w.length>0&&n.jsx(T,{label:g("common.filters.more","More"),options:w,selected:l,onSelect:m,actionMode:!0,icon:n.jsx(Z,{size:16}),placeholder:g("common.table.filters.more_placeholder","Filters"),closeOnSelect:!0}),C&&n.jsxs(H,{variant:"link",onClick:_,className:"text-sm py-2 px-3 h-8",children:[n.jsx(V,{size:14}),g("common.actions.clear","Clear")]})]})]})}D.__docgenInfo={description:`Controlled component

His parent component must manage all different filter states, useState`,methods:[],displayName:"DataTableFilters",props:{loading:{defaultValue:{value:"false",computed:!1},required:!1}}};const q=["routine","urgent","asap","stat"];function xe(e){return e.sort((t,a)=>{var i,h;const o=q.indexOf(((i=t.key)==null?void 0:i.toLowerCase())||""),l=q.indexOf(((h=a.key)==null?void 0:h.toLowerCase())||"");return o!==-1&&l!==-1?o-l:o!==-1?-1:l!==-1?1:0}).map(t=>({...t,label:n.jsx(ee,{size:"sm",code:t.key})}))}const be="case_exploration.status";function ye(e){return{draft:oe,submitted:ne,in_progress:se,completed:ae,incomplete:te,revoke:ue,unknown:A}[e.toLowerCase()]||A}function ve(e,s){return e.map(t=>({...t,label:s(`${be}.${t.key}`,t.label||""),icon:ye(t.key||"")}))}function je(e,s){const[t,a]=u.useState(()=>{if(typeof window>"u")return s;try{const o=localStorage.getItem(e);return o?JSON.parse(o):s}catch{return s}});return u.useEffect(()=>{try{localStorage.setItem(e,JSON.stringify(t))}catch{}},[e,t]),[t,a]}const M={priority:{key:"priority_code",weight:1,visible:!0},status:{key:"status_code",weight:2,visible:!0},case_analysis:{key:"case_analysis_code",weight:3,visible:!0},project:{key:"project_code",visible:!1},performer_lab:{key:"performer_lab_code",visible:!1},requested_by:{key:"requested_by_code",visible:!1}},z={priority:[],status:[],case_analysis:[],project:[],performer_lab:[],requested_by:[]};async function we(e){return(await P.casesFilters(e)).data}function _e({loading:e=!0,setSearchCriteria:s}){const[t,a]=u.useState([]),[o,l]=u.useState({}),[i,h]=je("case-exploration-filters",{...z}),{t:d}=F(),{data:p}=L("case-filters",()=>we({search_criteria:[]}),{revalidateOnFocus:!1,revalidateOnMount:!0,revalidateIfStale:!1,revalidateOnReconnect:!1}),f=u.useMemo(()=>p?Object.keys(p).map(c=>{const g={key:c,label:d(`case_exploration.case.filters.${c}`),isVisible:de(M).includes(c),isOpen:o[c]||!1,selectedItems:i[c]||[],options:[]};switch(c){case"status":return{...g,options:O(ve(p[c]||[],d))};case"project":case"performer_lab":case"requested_by":return{...g,popoverSize:"lg",isVisible:i[c]&&i[c].length>0||t.includes(c)||!1,options:O(p[c]||[]),withTooltip:!0};case"priority":return{...g,options:xe(p[c]||[])};case"case_analysis":return{...g,options:O(p[c]||[]),popoverSize:"lg",withTooltip:!0};default:return g}}):[],[p,i,t,o,d]);return n.jsx(D,{filterSearch:{placeholder:d("case_exploration.filters_group.search_placeholder"),minSearchLength:1,api:c=>P.autocompleteCases(c,"10")},filterButtons:f,changedFilterButtons:t,setChangedFilterButtons:a,filters:i,setFilters:h,openFilters:o,setOpenFilters:l,loading:e,setSearchCriteria:s,criterias:M,defaultFilters:z})}_e.__docgenInfo={description:"",methods:[],displayName:"FiltersGroupForm",props:{loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},setSearchCriteria:{required:!0,tsType:{name:"signature",type:"function",raw:"(searchCriteria: SearchCriterion[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"SearchCriterion"}],raw:"SearchCriterion[]"},name:"searchCriteria"}],return:{name:"void"}}},description:""}}};export{_e as F};
