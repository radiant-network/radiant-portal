import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as n}from"./index-CGj_12n1.js";import{A as Q}from"./action-button-CiOB9jQw.js";import{B as b}from"./button-zz6RklMM.js";import"./button.variants-Du9eY_ux.js";import{C as H}from"./checkbox-filter-DLXakNDu.js";import{d as W,e as J}from"./card-BdbO89L0.js";import{I as K}from"./input-Dm5winle.js";import{S as P}from"./separator-6xmuS_PL.js";import{S as A}from"./skeleton-Shk8p_SP.js";import{u as X}from"./i18n-BaapSkCg.js";import{u as Y}from"./applications-config-q4OA8PiL.js";import{q as I,M as Z,T as S}from"./query-builder-remote-D-ktMVpU.js";import{u as V}from"./use-aggregation-builder-Dk6R3r5x.js";import{S as D}from"./search-DqA1hdnz.js";function ee(i,r){const a=i.toLowerCase().split(/\s+/).filter(Boolean);return r.filter(v=>{const j=v.key.toLowerCase(),N=v.label.toLowerCase();function d(s,u){let l=0;for(const f of u){const y=s.indexOf(f,l);if(y===-1)return!1;l=y+f.length}return!0}return d(j,a)||d(N,a)})}function g(i,r){return r<i?r:i}function te({field:i,maxVisibleItems:r=5}){const{t:a,sanitize:v,lazyTranslate:j}=X(),d=Y().variant_exploration.app_id,{data:s,isLoading:u}=V(i.key,void 0,!0,d),[l,f]=n.useState(s||[]),[y,w]=n.useState([]),[c,h]=n.useState([]),[C,k]=n.useState(g(l.length,r)),[z,x]=n.useState(!1);n.useEffect(()=>{const o=I.getResolvedActiveQuery(d).content.find(e=>e.content.field===i.key);o?(h(o.content.value),x(!0)):h([]),s==null||s.sort((e,m)=>{const _=e.key&&c.includes(e.key),G=m.key&&c.includes(m.key);return _===G?m.count-e.count:_?-1:1}),s==null||s.forEach(e=>{e.label=a(`common.filters.values.${i.key}.${v(e.key)}`,{defaultValue:j(e.key)})}),f(s||[]),k(g((s==null?void 0:s.length)||0,r))},[s,d,i.key,r]);const E=n.useCallback(o=>{if(!o.trim()){f(s||[]),k(g((s==null?void 0:s.length)||0,r));return}const e=ee(o,s);r>e.length?k(e.length):e.length>r&&k(r),f(e)},[s,r]),T=n.useCallback(()=>{k(l.length)},[C,l]),F=n.useCallback(()=>{k(r)},[C]),L=n.useCallback(()=>{c.length!==l.length&&(x(!0),h(l.map(o=>o.key)))},[l,c]),R=n.useCallback(()=>{c.length!==0&&(x(!0),h([]))},[c]),B=n.useCallback(o=>{let e=[];c.some(m=>m===o.key)?e=c.filter(m=>m!==o.key):e=[...c,o.key],x(!0),h(e)},[c]),M=n.useCallback(()=>{x(!1),h([...y])},[y]),p=n.useCallback(o=>{x(!1),w(c),I.updateActiveQueryField(d,{field:i.key,value:[...c],merge_strategy:Z.OVERRIDE_VALUES,operator:o})},[c,d,i.key]),O=n.useCallback(()=>{p(S.In)},[p]),$=n.useCallback(()=>{p(S.NotIn)},[p]),q=n.useCallback(()=>{p(S.All)},[p]),U=n.useCallback(()=>{p(S.In)},[p]);return t.jsxs(t.Fragment,{children:[t.jsxs(W,{size:"sm",variant:"outline",children:[t.jsx(K,{startIcon:D,size:"xs",type:"text",placeholder:a("common.filters.search.placeholder"),className:"w-full text-xs py-1.5 px-3 mb-4 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:o=>E(o.target.value),autoFocus:!0}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx(b,{size:"xs",onClick:()=>L(),variant:"link",className:"px-0",children:a("common.filters.buttons.all")}),t.jsx(P,{orientation:"vertical",className:"h-4"}),t.jsx(b,{size:"xs",onClick:()=>R(),variant:"link",className:"px-0",children:a("common.filters.buttons.none")})]}),t.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[u&&Array.from({length:3},(o,e)=>t.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[t.jsx(A,{className:"w-full h-6 rounded"}),t.jsx(A,{className:"h-6 w-12 rounded-md"})]},`skeleton-${e}`)),!u&&l.length===0&&t.jsx("div",{className:"text-muted-foreground py-4",children:a("common.filters.no_values_found")}),!u&&l.length>0&&Array.from({length:C},(o,e)=>t.jsx("div",{className:"gap-3 py-1.5",children:t.jsx(H,{size:"xs",label:a(`common.filters.labels.${i.key}_value.${l[e].key}`,{defaultValue:l[e].label}),checked:c.some(m=>m===l[e].key),count:l[e].count,onCheckedChange:()=>B(l[e])})},l[e].key))]}),!u&&l.length>C&&t.jsx(b,{className:"mt-2 px-0",onClick:T,size:"xs",variant:"link",children:a("common.filters.buttons.show_more",{count:l.length-r})}),!u&&C>r&&t.jsx(b,{className:"mt-2 px-0",onClick:F,size:"xs",variant:"link",children:a("common.filters.buttons.show_less")})]}),t.jsx(J,{size:"sm",children:t.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[t.jsx(b,{size:"xxs",variant:"ghost",onClick:M,disabled:!z||u,children:a("common.filters.buttons.clear")}),t.jsx("div",{className:"flex space-x-2",children:t.jsx(Q,{size:"xxs",variant:"outline",className:"h-7",color:"primary",actions:[{label:a("common.filters.buttons.some_not_in"),onClick:U},{label:a("common.filters.buttons.all"),onClick:q},{label:a("common.filters.buttons.not_in"),onClick:$}],onDefaultAction:O,disabled:u,children:a("common.filters.buttons.apply")})})]})})]})}te.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}}}};export{te as M};
