import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{r as c}from"./index-CGj_12n1.js";import{u as A,c as q}from"./api-CYd6hB4-.js";import{F as k}from"./filter-button-DHs0OGhQ.js";import{B as $}from"./button-D_eIh1jo.js";import{u as C}from"./i18n-C8eomWfd.js";import{S as F}from"./skeleton-Shk8p_SP.js";import{g as P,C as U,a as G,b as B,c as X,d as J}from"./command-3_OtwHJd.js";import{X as M}from"./x-CubKniSv.js";import{S as Q}from"./search-DqA1hdnz.js";import{T as W}from"./test-tube-diagonal-U7YTje3f.js";import{c as S}from"./createLucideIcon-8Lr1oLzj.js";import{U as K}from"./user-CZ8KFWeE.js";import{L as Y}from"./list-filter-DyVHreeM.js";import{P as Z}from"./priority-indicator-bB5AfDKH.js";import{C as ee,R as te,H as se,F as ae}from"./refresh-ccw-Bwg-o3xn.js";import{C as re}from"./check-DRc1RmCY.js";import{P as oe}from"./pen-BVjgPDnY.js";/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],ie=S("Barcode",ne);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],I=S("FolderOpen",le);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ue=S("OctagonX",ce),E=1;function pe(e){return{case_id:I,patient_id:K,mrn:ie,request_id:W}[e.toLowerCase()]||I}async function de(e){if(!e||e.length<E)return{};const a=await q.autocompleteCases(e,"10");return a!=null&&a.data&&a.data.length>0?a.data.reduce((t,o)=>(t[o.type]||(t[o.type]=[]),t[o.type].push(o),t),{}):{}}function z({onSelect:e,onClear:a,selectedValue:r}){const{t}=C(),[o,d]=c.useState(""),[p,x]=c.useState(""),[h,u]=c.useState(!1);c.useEffect(()=>{d(r||"")},[r]),c.useEffect(()=>{const n=setTimeout(()=>{x(o)},300);return u(!0),()=>clearTimeout(n)},[o]);const{data:f}=A(p&&p.length>=E?p:null,n=>n?de(n):Promise.resolve({}),{revalidateOnFocus:!1,dedupingInterval:300}),v=c.useCallback((n,m)=>{const b=m.trim();e(n,b),d(b),u(!1)},[e]),y=c.useCallback(()=>{d(""),a==null||a()},[a]),l=f&&Object.keys(f).length>0;return s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"text-sm font-medium text-foreground h-[14px] mb-[8px]",children:t("case_exploration.filters_group.search_by_id")}),s.jsxs(P,{className:"relative h-8 w-[260px] overflow-visible",shouldFilter:!1,children:[s.jsx(U,{className:"px-[6px]",wrapperClassName:"focus-within:ring-primary focus-visible:outline-none focus-visible:ring-ring focus-visible:ring-offset-0 [&:has(:focus-visible)]:ring-1",placeholder:t("case_exploration.filters_group.search_placeholder"),leftAddon:s.jsx(Q,{size:16}),rightAddon:o.length>0&&s.jsx(M,{onClick:y,size:16}),value:o,onValueChange:d,onFocus:()=>{u(!0)},onBlur:()=>setTimeout(()=>u(!1),100)}),h&&o.length>0&&s.jsxs(G,{className:"absolute max-h-[240px] left-0 top-full z-50 mt-1 w-full overflow-auto rounded-md border bg-background shadow-lg",onMouseDown:n=>n.preventDefault(),children:[!l&&s.jsx(B,{children:t("common.filters.no_values_found")}),l&&Object.keys(f||{}).map(n=>s.jsxs(s.Fragment,{children:[Object.keys(f||{}).indexOf(n)!==0&&s.jsx("hr",{className:"w-full h-px bg-border"}),s.jsx(X,{heading:s.jsx("span",{className:"h-[28px] &:not(:first-child)]:bg-border",children:t(`case_exploration.case.search.${n}`,n.toUpperCase())}),children:((f==null?void 0:f[n])||[]).map(m=>{const b=pe(m.type);return s.jsxs(J,{className:"h-[32px]",value:`${m.value}::${n}`,onSelect:w=>{v(m.type,w.split("::")[0])},children:[s.jsx(b,{size:16,className:"text-muted-foreground"}),s.jsx("span",{children:m.value})]},m.value)})},n)]}))]})]})]})}z.__docgenInfo={description:"",methods:[],displayName:"TableFiltersSearch",props:{onSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: string, value: string) => void",signature:{arguments:[{type:{name:"string"},name:"type"},{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},selectedValue:{required:!1,tsType:{name:"string"},description:""}}};function j(e){return e.sort((a,r)=>a.label.localeCompare(r.label))}function me(e,a){const r=[];for(const t in a)e[t].length>0&&r.push({field:a[t].key,value:e[t]});return r}function fe({filterSearchs:e=[],filterButtons:a}){return s.jsxs("div",{className:"flex justify-start gap-2 min-w-[400px] h-[48px]",children:[s.jsx("div",{className:"flex h-[32px]",children:e==null?void 0:e.map(({id:r})=>s.jsx(F,{className:"w-[120px] h-full"},r))}),s.jsx("div",{className:"flex gap-2 h-[32px]",children:a.map(r=>s.jsx(F,{className:"w-[150px] h-full"},r.key))})]})}function L({loading:e=!1,openFilters:a,setOpenFilters:r,filters:t,setFilters:o,changedFilterButtons:d,setChangedFilterButtons:p,setSearchCriteria:x,filterButtons:h,filterSearchs:u,criterias:f,defaultFilters:v,defaultSearchFilters:y={}}){const{t:l}=C(),n=c.useCallback((i,g)=>{o({...t,[i]:g})},[t,o]),m=c.useMemo(()=>h.filter(i=>!i.isVisible),[h]),b=h.some(i=>i.selectedItems.length>0)||d.length>0,w=()=>{o({...v,...y}),p([]),r({})},R=c.useCallback(i=>{p([...d,...i.filter(_=>!d.includes(_))]);const g=i.reduce((_,H)=>(_[H]=!0,_),{});r({...a,...g})},[]),V=c.useCallback((i,g)=>{const _={...t,...y};o({..._,[i]:[g]})},[t,o]),D=c.useCallback(()=>{o({...t,...y})},[t,o]);return c.useEffect(()=>{x(me(t,f))},[t,x]),e?s.jsx(fe,{filterSearchs:u,filterButtons:h.filter(i=>i.isVisible)}):s.jsxs("div",{id:"table-filters",className:"py-0 flex flex-2 flex-wrap gap-2 items-button",children:[u==null?void 0:u.map(({id:i,searchTerm:g})=>s.jsx(z,{onSelect:V,onClear:D,selectedValue:g},`table-filter-search-${i}`)),s.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[h.filter(i=>i.isVisible).sort((i,g)=>f[i.key].weight-f[g.key].weight).map(i=>s.jsx(k,{popoverSize:i.popoverSize,label:i.label,options:i.options,selected:i.selectedItems,onSelect:g=>n(i.key,g),isOpen:i.isOpen,withTooltip:i.withTooltip},i.key)),m.length>0&&s.jsx(k,{label:l("common.filters.more","More"),options:m,selected:[],onSelect:R,actionMode:!0,icon:s.jsx(Y,{size:16}),placeholder:l("common.table.filters.more_placeholder","Filters"),closeOnSelect:!0}),b&&s.jsxs($,{variant:"link",onClick:w,className:"text-sm py-2 px-3 h-8",children:[s.jsx(M,{size:14}),l("common.actions.clear","Clear")]})]})]})}L.__docgenInfo={description:`Controlled component

His parent component must manage all different filter states, useState`,methods:[],displayName:"DataTableFilters",props:{loading:{defaultValue:{value:"false",computed:!1},required:!1},defaultSearchFilters:{defaultValue:{value:"{}",computed:!1},required:!1}}};function he(e,a){const[r,t]=c.useState(()=>{if(typeof window>"u")return a;try{const o=localStorage.getItem(e);return o?JSON.parse(o):a}catch{return a}});return c.useEffect(()=>{try{localStorage.setItem(e,JSON.stringify(r))}catch{}},[e,r]),[r,t]}const O=["routine","urgent","asap","stat"];function ge(e){return e.sort((r,t)=>{var p,x;const o=O.indexOf(((p=r.key)==null?void 0:p.toLowerCase())||""),d=O.indexOf(((x=t.key)==null?void 0:x.toLowerCase())||"");return o!==-1&&d!==-1?o-d:o!==-1?-1:d!==-1?1:0}).map(r=>({...r,label:s.jsx(Z,{size:"sm",code:r.key})}))}function xe(e){return{draft:oe,"on-hold":se,active:te,completed:re,incomplete:ee,revoke:ue}[e.toLowerCase()]||ae}function ye(e,a){const r="case_exploration.status";return e.map(t=>({...t,label:a(`${r}.${t.key}`,t.label||""),icon:xe(t.key||"")}))}const be={priority:{key:"priority_code",weight:1},status:{key:"status_code",weight:2},case_analysis:{key:"case_analysis_code",weight:3},project:{key:"project_code",weight:3},performer_lab:{key:"performer_lab_code",weight:4},requested_by:{key:"requested_by_code",weight:5},case_id:{key:"case_id",weight:6},patient_id:{key:"patient_id",weight:7},mrn:{key:"mrn",weight:8},request_id:{key:"request_id",weight:9}};async function _e(e){return(await q.casesFilters(e)).data}const T={priority:[],status:[],case_analysis:[],project:[],performer_lab:[],requested_by:[]},N={case_id:[],patient_id:[],mrn:[],request_id:[]};function ve({loading:e=!0,setSearchCriteria:a}){const[r,t]=c.useState([]),[o,d]=c.useState({}),[p,x]=he("case-exploration-filters",{...T,...N}),{t:h}=C(),{data:u}=A("case-filters",()=>_e({search_criteria:[]}),{revalidateOnFocus:!1,revalidateOnMount:!0,revalidateIfStale:!1,revalidateOnReconnect:!1}),f=c.useMemo(()=>u?Object.keys(u).map(l=>{const n={key:l,label:h(`case_exploration.case.filters.${l}`),isVisible:["priority","status","case_analysis"].includes(l),isOpen:o[l]||!1,selectedItems:p[l]||[],options:[]};switch(l){case"status":return{...n,options:j(ye(u[l]||[],h))};case"project":case"performer_lab":case"requested_by":return{...n,popoverSize:"lg",isVisible:p[l]&&p[l].length>0||r.includes(l)||!1,options:j(u[l]||[]),withTooltip:!0};case"priority":return{...n,options:ge(u[l]||[])};case"case_analysis":return{...n,options:j(u[l]||[]),popoverSize:"lg",withTooltip:!0};default:return n}}).filter(l=>l.options.length>0):[],[u,p,r,o,h]),y=(()=>{const l=["case_id","patient_id","mrn","assay_id"];for(const n of l){const m=p[n]||[];if(m.length>0)return{type:n,value:m[0],label:h(`case_exploration.case.headers.${n}`,n.toUpperCase())+": "+m[0]}}return null})();return s.jsx(L,{filterSearchs:[{id:"search",searchTerm:y==null?void 0:y.value}],filterButtons:f,changedFilterButtons:r,setChangedFilterButtons:t,filters:p,setFilters:x,openFilters:o,setOpenFilters:d,loading:e,setSearchCriteria:a,criterias:be,defaultFilters:T,defaultSearchFilters:N})}ve.__docgenInfo={description:"",methods:[],displayName:"FiltersGroupForm",props:{loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},setSearchCriteria:{required:!0,tsType:{name:"signature",type:"function",raw:"(searchCriteria: SearchCriterion[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"SearchCriterion"}],raw:"SearchCriterion[]"},name:"searchCriteria"}],return:{name:"void"}}},description:""}}};export{ve as F};
