import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{R as E,r as o}from"./index-DQLiH3RP.js";import{B as v}from"./button-C2rCU7Ok.js";import{C as G}from"./checkbox-Ce_wbgB6.js";import{I as W}from"./input-DyY2UfVx.js";import{A as H}from"./ActionButton-BqVcLudk.js";import"./button.variants-BQkt_1YJ.js";import{q as w,M as J,T as N}from"./query-builder-remote-DQDcrGW9.js";import{u as K}from"./applications-config-pyPLye2e.js";import{n as P}from"./number-format-DDJvc-iv.js";import{u as V}from"./i18n-awiSXLtO.js";import{S as X}from"./separator-PkW7KAol.js";import{u as Y,o as Z}from"./index-Bu11wbXr.js";import{S as I}from"./skeleton-Shk8p_SP.js";import{r as D}from"./string-format-D2CEWHqQ.js";const ee=E.createContext({seqId:"1"}),se=n=>Z.aggregateGermlineOccurrences(n.seqId,n.aggregationBody).then(l=>l.data);function te(n,l=30,h=!1,r){let m;const{seqId:d}=E.useContext(ee);h?m={seqId:d,aggregationBody:{field:n,size:l}}:m=null;const s=w.getResolvedActiveQuery(r);return s&&m&&(m.aggregationBody.sqon={content:s.content,op:s.op}),Y(m,se,{revalidateOnFocus:!1})}function le(n,l){const h=n.toLowerCase().split(/\s+/).filter(Boolean);return l.filter(r=>{const m=r.key.toLowerCase(),d=r.label.toLowerCase();function s(f,a){let y=0;for(const g of a){const j=f.indexOf(g,y);if(j===-1)return!1;y=j+g.length}return!0}return s(m,h)||s(d,h)})}function S(n,l){return l<n?l:n}function oe({field:n,maxVisibleItems:l=5,searchVisible:h=!1}){const{t:r}=V(),d=K().variant_exploration.app_id,{data:s,isLoading:f}=te(n.key,void 0,!0,d),[a,y]=o.useState(s||[]),[g,j]=o.useState([]),[i,k]=o.useState([]),[C,x]=o.useState(S(a.length,l)),[_,b]=o.useState(!1);o.useEffect(()=>{let c=w.getResolvedActiveQuery(d).content.find(e=>e.content.field===n.key);c?(k(c.content.value),b(!0)):k([]),s==null||s.sort((e,u)=>{const A=e.key&&i.includes(e.key),$=u.key&&i.includes(u.key);return A===$?u.count-e.count:A?-1:1}),s==null||s.forEach(e=>{e.label=e.key?D(e.key).toLowerCase().replace(/^\w/,u=>u.toUpperCase()):e.key}),y(s||[]),x(S((s==null?void 0:s.length)||0,l))},[s,d,n.key,l]);const R=o.useCallback(c=>{if(!c.trim()){y(s||[]),x(S((s==null?void 0:s.length)||0,l));return}const e=le(c,s);l>e.length?x(e.length):e.length>l&&x(l),y(e)},[s,l]),q=o.useCallback(()=>{x(a.length)},[C,a]),B=o.useCallback(()=>{x(l)},[C]),L=o.useCallback(()=>{i.length!==a.length&&(b(!0),k(a.map(c=>c.key)))},[a,i]),O=o.useCallback(()=>{i.length!==0&&(b(!0),k([]))},[i]),T=o.useCallback(c=>{let e=[];i.some(u=>u===c.key)?e=i.filter(u=>u!==c.key):e=[...i,c.key],b(!0),k(e)},[i]),F=o.useCallback(()=>{b(!1),k([...g])},[g]),p=o.useCallback(c=>{b(!1),j(i),w.updateActiveQueryField(d,{field:n.key,value:[...i],merge_strategy:J.OVERRIDE_VALUES,operator:c})},[i,d,n.key]),M=o.useCallback(()=>{p(N.In)},[p]),z=o.useCallback(()=>{p(N.NotIn)},[p]),U=o.useCallback(()=>{p(N.All)},[p]),Q=o.useCallback(()=>{p(N.In)},[p]);return t.jsxs("div",{className:"p-2 w-full max-w-md",children:[h&&t.jsx(W,{type:"text",placeholder:r("common.filters.search.placeholder"),className:"w-full p-2 mb-2 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:c=>R(c.target.value),autoFocus:!0}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx(v,{size:"sm",onClick:()=>L(),variant:"link",className:"px-0",children:r("common.filters.buttons.all")}),t.jsx(v,{size:"sm",onClick:()=>O(),variant:"link",className:"px-0",children:r("common.filters.buttons.none")})]}),t.jsx("div",{className:"max-h-[250px] overflow-auto",children:f?Array.from({length:3},(c,e)=>t.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[t.jsx(I,{className:"w-full h-6 rounded"}),t.jsx(I,{className:"h-6 w-12 rounded-md"})]},`skeleton-${e}`)):a.length===0?t.jsx("div",{className:"text-muted-foreground py-4",children:r("common.filters.noValuesFound")}):Array.from({length:C},(c,e)=>t.jsx("div",{className:"gap-3 py-1.5",children:t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("label",{className:"flex gap-2 overflow-hidden items-start py-0.5",children:[t.jsx(G,{className:"w-4 h-4 py-0.5",checked:i.some(u=>u===a[e].key),onCheckedChange:()=>T(a[e])}),t.jsx("div",{className:"overflow-hidden whitespace-normal break-words text-xs",children:r(`common.filters.labels.${n.key}_value.${a[e].key}`,{defaultValue:a[e].label})}),t.jsx("span",{className:"checkmark"})]}),t.jsx("span",{className:"bg-accent px-2 h-5 rounded-md text-xs flex items-center",children:P(a[e].count||0)})]})},a[e].key))}),!f&&a.length>C&&t.jsx(v,{className:"mt-2 px-0",onClick:q,size:"sm",variant:"link",children:r("common.filters.buttons.showMore",{count:a.length-l})}),!f&&C>l&&t.jsx(v,{className:"mt-2 px-0",onClick:B,size:"sm",variant:"link",children:r("common.filters.buttons.showLess")}),t.jsx(X,{className:"my-4 border-border",id:`${n.key}_divider`}),t.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[t.jsx(v,{size:"xs",variant:"ghost",onClick:F,disabled:!_||f,children:r("common.filters.buttons.clear")}),t.jsx("div",{className:"flex space-x-2",children:t.jsx(H,{size:"xs",className:"h-7",color:"primary",actions:[{label:r("common.filters.buttons.someNotIn"),onClick:Q},{label:r("common.filters.buttons.all"),onClick:U},{label:r("common.filters.buttons.notIn"),onClick:z}],onDefaultAction:M,disabled:f,children:r("common.filters.buttons.apply")})})]})]})}oe.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},searchVisible:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{oe as M};
