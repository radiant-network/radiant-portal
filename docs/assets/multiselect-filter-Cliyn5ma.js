import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as o}from"./index-CGj_12n1.js";import{A as W}from"./action-button-DDdwU0ca.js";import{B as b}from"./button-6H8fMtir.js";import"./button.variants-Du9eY_ux.js";import{C as $}from"./checkbox-filter-DLXakNDu.js";import{d as G,e as Q}from"./card-BdbO89L0.js";import{I as H}from"./input-CUZJ9Qyj.js";import{S as J}from"./separator-6xmuS_PL.js";import{S as _}from"./skeleton-Shk8p_SP.js";import{u as K}from"./i18n-BFLsYGP8.js";import{r as P}from"./string-format-D2CEWHqQ.js";import{u as X}from"./applications-config-q4OA8PiL.js";import{q as A,M as Y,T as S}from"./query-builder-remote-CKam2jCw.js";import{u as Z}from"./use-aggregation-builder-CzI8JdmD.js";import{S as V}from"./search-DqA1hdnz.js";function D(u,c){const i=u.toLowerCase().split(/\s+/).filter(Boolean);return c.filter(j=>{const p=j.key.toLowerCase(),s=j.label.toLowerCase();function m(l,x){let y=0;for(const v of x){const n=l.indexOf(v,y);if(n===-1)return!1;y=n+v.length}return!0}return m(p,i)||m(s,i)})}function g(u,c){return c<u?c:u}function ee({field:u,maxVisibleItems:c=5}){const{t:i}=K(),p=X().variant_exploration.app_id,{data:s,isLoading:m}=Z(u.key,void 0,!0,p),[l,x]=o.useState(s||[]),[y,v]=o.useState([]),[n,f]=o.useState([]),[C,h]=o.useState(g(l.length,c)),[I,k]=o.useState(!1);o.useEffect(()=>{const r=A.getResolvedActiveQuery(p).content.find(e=>e.content.field===u.key);r?(f(r.content.value),k(!0)):f([]),s==null||s.sort((e,a)=>{const N=e.key&&n.includes(e.key),q=a.key&&n.includes(a.key);return N===q?a.count-e.count:N?-1:1}),s==null||s.forEach(e=>{e.label=e.key?P(e.key).replace(/\([^)]+\)|[^()]+/g,a=>a.startsWith("(")&&a.endsWith(")")?a:a.toLowerCase()).replace(/^\w/,a=>a.toUpperCase()):e.key}),x(s||[]),h(g((s==null?void 0:s.length)||0,c))},[s,p,u.key,c]);const w=o.useCallback(r=>{if(!r.trim()){x(s||[]),h(g((s==null?void 0:s.length)||0,c));return}const e=D(r,s);c>e.length?h(e.length):e.length>c&&h(c),x(e)},[s,c]),E=o.useCallback(()=>{h(l.length)},[C,l]),z=o.useCallback(()=>{h(c)},[C]),L=o.useCallback(()=>{n.length!==l.length&&(k(!0),f(l.map(r=>r.key)))},[l,n]),F=o.useCallback(()=>{n.length!==0&&(k(!0),f([]))},[n]),R=o.useCallback(r=>{let e=[];n.some(a=>a===r.key)?e=n.filter(a=>a!==r.key):e=[...n,r.key],k(!0),f(e)},[n]),T=o.useCallback(()=>{k(!1),f([...y])},[y]),d=o.useCallback(r=>{k(!1),v(n),A.updateActiveQueryField(p,{field:u.key,value:[...n],merge_strategy:Y.OVERRIDE_VALUES,operator:r})},[n,p,u.key]),B=o.useCallback(()=>{d(S.In)},[d]),M=o.useCallback(()=>{d(S.NotIn)},[d]),O=o.useCallback(()=>{d(S.All)},[d]),U=o.useCallback(()=>{d(S.In)},[d]);return t.jsxs(t.Fragment,{children:[t.jsxs(G,{size:"sm",variant:"outline",children:[t.jsx(H,{startIcon:V,variant:"facet",type:"text",placeholder:i("common.filters.search.placeholder"),className:"w-full text-xs py-1.5 px-3 mb-4 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",onChange:r=>w(r.target.value),autoFocus:!0}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx(b,{size:"xs",onClick:()=>L(),variant:"link",className:"px-0",children:i("common.filters.buttons.all")}),t.jsx(J,{orientation:"vertical",className:"h-4"}),t.jsx(b,{size:"xs",onClick:()=>F(),variant:"link",className:"px-0",children:i("common.filters.buttons.none")})]}),t.jsxs("div",{className:"max-h-[250px] overflow-auto",children:[m&&Array.from({length:3},(r,e)=>t.jsxs("div",{className:"flex justify-between items-center py-2 space-x-2",children:[t.jsx(_,{className:"w-full h-6 rounded"}),t.jsx(_,{className:"h-6 w-12 rounded-md"})]},`skeleton-${e}`)),!m&&l.length===0&&t.jsx("div",{className:"text-muted-foreground py-4",children:i("common.filters.no_values_found")}),!m&&l.length>0&&Array.from({length:C},(r,e)=>t.jsx("div",{className:"gap-3 py-1.5",children:t.jsx($,{size:"xs",label:i(`common.filters.labels.${u.key}_value.${l[e].key}`,{defaultValue:l[e].label}),checked:n.some(a=>a===l[e].key),count:l[e].count,onCheckedChange:()=>R(l[e])})},l[e].key))]}),!m&&l.length>C&&t.jsx(b,{className:"mt-2 px-0",onClick:E,size:"xs",variant:"link",children:i("common.filters.buttons.show_more",{count:l.length-c})}),!m&&C>c&&t.jsx(b,{className:"mt-2 px-0",onClick:z,size:"xs",variant:"link",children:i("common.filters.buttons.show_less")})]}),t.jsx(Q,{size:"sm",children:t.jsxs("div",{className:"flex align-right justify-end items-center space-x-2",children:[t.jsx(b,{size:"xxs",variant:"ghost",onClick:T,disabled:!I||m,children:i("common.filters.buttons.clear")}),t.jsx("div",{className:"flex space-x-2",children:t.jsx(W,{size:"xxs",variant:"outline",className:"h-7",color:"primary",actions:[{label:i("common.filters.buttons.some_not_in"),onClick:U},{label:i("common.filters.buttons.all"),onClick:O},{label:i("common.filters.buttons.not_in"),onClick:M}],onDefaultAction:B,disabled:m,children:i("common.filters.buttons.apply")})})]})})]})}ee.__docgenInfo={description:"",methods:[],displayName:"MultiSelectFilter",props:{field:{required:!0,tsType:{name:"AggregationConfig"},description:""},maxVisibleItems:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}}}};export{ee as M};
